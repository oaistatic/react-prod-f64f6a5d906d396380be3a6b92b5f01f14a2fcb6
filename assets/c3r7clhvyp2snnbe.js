const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kqivh2k2gjqolo2l.js","assets/gg0tb34p9fzo1omt.js","assets/g670b8vtkhx0yc6d.js","assets/root-ilxovqci.css","assets/ewqfcp1vbowm20lj.js","assets/fzrn137102spawew.js","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/f36jz1b044mtoyky.js"])))=>i.map(i=>d[i]);
import{n2 as P,be as F,fc as A,fd as $,fe as _,bg as H,bf as L,kX as b,bU as S,bV as U,c2 as I,ch as B,bW as J}from"./g670b8vtkhx0yc6d.js";import{j as e,r as x}from"./gg0tb34p9fzo1omt.js";import{bM as K,e1 as X,a4 as G,c7 as W}from"./forbprkns1cohsbl.js";import{u as q,D as Q}from"./l1f523cjrk6yf2ut.js";import{u as Y,U as Z,a as z}from"./gxaekez9ch7w0c1d.js";import{s as ee}from"./ewqfcp1vbowm20lj.js";import"./k5ngqk6bkqja3f09.js";import"./hfprk7ndga1i73cv.js";import"./exrawr7mctocf8w4.js";import"./lm9ksh5fuccnc15x.js";function y(s){return P({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(s)}function M(s){return P({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{d:"M7 12V7H6v5h1z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(s)}const se=U(()=>J(()=>import("./kqivh2k2gjqolo2l.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>s.JsonViewer));function fe({threadId:s,threadUserId:n}){return Y(Z.isDebugModalOpen)&&e.jsx(F,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>z.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(ae,{threadId:s,threadUserId:n??void 0,onClose:()=>z.toggleDebugModalOpen()})})}const te=(s,n)=>{const l=JSON.stringify(n,null,2),r=new Blob([l],{type:"application/json"}),a=window.URL.createObjectURL(r),c=document.createElement("a");c.href=a,c.download=s,c.click(),window.URL.revokeObjectURL(a)},T="<|im_start|>",R="<|im_sep|>",O="<|im_end|>",le="<|fim_suffix|>",ne="<|meta_sep|>";function D({prompt:s}){const[n,l]=x.useState({}),r=[],a=[];let c=0;for(;;){const o=s.indexOf(T,c);if(o===-1)break;const i=s.indexOf(R,o);if(i===-1)break;let t=s.indexOf(O,i);const h=s.indexOf(le,i);if(h!==-1&&(t===-1||h<t)&&(t=h),t===-1)break;const p=s.substring(o+T.length,i).replace(ne," channel="),w=s.substring(i+R.length,t);a.push(o);const v=n[o];r.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>l(u=>({...u,[o]:!u[o]})),children:v?e.jsx(M,{size:14}):e.jsx(y,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",p,"]"]})]}),e.jsx("div",{className:S("whitespace-pre-wrap",v&&"line-clamp-2 truncate"),children:w})]},o)),c=t+O.length}function g(o){const i={};for(const t of a)i[t]=o;l(i)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>g(!0),children:[e.jsx(y,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>g(!1),children:[e.jsx(M,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:r})]})}const j=I.div`mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ${({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent"}`;function ae({threadId:s,threadUserId:n,message:l,onClose:r}){const[a,c]=x.useState(l?"message":"json"),{data:g,isLoading:o,refetch:i}=q({threadId:s,threadUserId:n,refetchOnMount:"always"}),t=g?.thread;if(x.useEffect(()=>{c(l?"message":t?.turns.length?`turn${t?.turns.length-1}`:"thread")},[t?.turns.length,l]),!o&&!t&&!l)return e.jsxs(Q,{onClickRetry:()=>i(),children:["Failed to load."," "]});if(o)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const h=t?.turns,p=t?.turns[t.turns.length-1],w=p?.artifacts__?.model_snapshots?.default_id,v=p?.artifacts__?.settings?.model_response?.completion_model?.model,u=w??v,N=p?.artifacts__?.eval_preset,V=n&&s?X(n,s):null,C=l?.metadata?.__internal?.debug?.render_for_completion_result_decoded;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(A,{orientation:"vertical",value:a,onValueChange:m=>c(m),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center justify-start gap-3 p-2",children:[l&&e.jsx(_,{value:"message",children:e.jsx(j,{$isSelected:a==="message",children:"Message"})},"message"),C&&e.jsx(_,{value:"render_for_completion",children:e.jsx(j,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),t&&e.jsx(_,{value:"thread",children:e.jsx(j,{$isSelected:a==="thread",children:"Thread"})},"thread"),h?.map((m,d)=>e.jsxs(x.Fragment,{children:[e.jsx(_,{value:`turn${d}`,children:e.jsxs(j,{$isSelected:a===`turn${d}`,children:["Turn[",d,"]"]})},d),m.artifacts__?.debug_ddtrace_urls?.map(f=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:f,className:"text-nowrap",rel:"noreferrer",children:["Trace[",d,"] â†—"]})},f))]},d))]}),e.jsxs("div",{className:"flex items-center justify-end",children:[t&&e.jsxs(H,{size:"small",color:"secondary",onClick:()=>te("thread.json",t),children:[e.jsx(K,{className:"icon-sm"})," thread.json"]}),e.jsx(L,{onClick:r})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[u&&e.jsxs(e.Fragment,{children:[e.jsx(k,{name:"Model",id:u,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),N&&N!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{name:"Eval Preset",id:N,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),V&&e.jsx(e.Fragment,{children:e.jsx(k,{name:"Permalink",id:V,className:"flex-shrink-1"})})]}),h?.map((m,d)=>{const f=m.model_response?.text;return e.jsxs(b,{value:`turn${d}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:S("flex flex-col gap-2 p-2",(m.index??0)%2===1&&"bg-token-main-surface-secondary"),children:[e.jsx(D,{prompt:m.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:ee(f??"")??f})]})]})," "]},d)}),t&&e.jsx(b,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(E,{data:t,collapsed:4,jsonFiltersKey:"thread"})}),l&&e.jsx(b,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(E,{data:l,collapsed:4,jsonFiltersKey:"message"})}),C&&e.jsx(b,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(D,{prompt:C??""})})]},t?.turns.length??"message")})}function E({data:s,collapsed:n,jsonFiltersKey:l}){const[r,a]=x.useState(n??!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>a(!r),className:"flex items-center gap-1",children:r?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(se,{jsonFiltersKey:l,json:s,jsonViewProps:{collapsed:r,shortenTextAfterLength:0}},String(r))})]})}function k({name:s,id:n,className:l}){const r=B(),a=x.useCallback(c=>{G(n,r,c)},[n,r]);return e.jsxs("div",{className:S("flex items-center gap-2 truncate",l),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:n,className:"truncate text-gray-500 dark:text-white",children:n}),e.jsx(W,{onCopy:a})]})}export{E as DebugJsonViewer,fe as DebugModal,ae as DebugModalContents};
//# sourceMappingURL=c3r7clhvyp2snnbe.js.map
