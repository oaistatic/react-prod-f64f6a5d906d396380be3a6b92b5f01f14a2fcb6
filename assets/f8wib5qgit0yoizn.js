import{ch as O,gE as B,n5 as F,ho as L,n6 as q,e as N,n7 as U,dZ as I,kw as Q}from"./g670b8vtkhx0yc6d.js";import{u as $,b as G,h as y,r as e,j as o,ai as Z,l as z,O as H}from"./gg0tb34p9fzo1omt.js";import{W as J}from"./lq61ygipep4zgxzl.js";import{m as V,n as X,j as Y,W as tt,u as st,o as rt,k as et}from"./nir0q9e2l94u37hi.js";import{u as ot,W as nt}from"./ekrjz1qfz0wzkkjd.js";import{u as at}from"./eqymi4bdej7dbca6.js";import{K as p,e as x}from"./forbprkns1cohsbl.js";import"./cs320738df36xnc1.js";import"./f51c6zie1stj9anw.js";import"./ii534sx9kl9dq5ip.js";import"./e3erq0emp0cqk1ou.js";import"./epts3f5f624a6l7w.js";import"./mu0w85wyyiji3bj8.js";import"./b40xa0ca5oqnzth6.js";import"./b451x40oixvdmzqh.js";import"./cnl9n9geu2oxb8o4.js";import"./f4wsvwai0sxxe1lf.js";import"./kqivh2k2gjqolo2l.js";import"./ewqfcp1vbowm20lj.js";import"./fzrn137102spawew.js";import"./f36jz1b044mtoyky.js";import"./jgs7169reknaons9.js";import"./h6uvwty3c3amaxiz.js";import"./hu61i4occl5w2buc.js";import"./iot1vlqga29hiiwl.js";import"./c7e30quc1do1jojv.js";import"./kv8a9039cr2p5scx.js";import"./ogvupmk4xezkmrqf.js";import"./juuj7s9t3x7u9it2.js";import"./lptwpbjabrvjmhsj.js";import"./hsr6nqstg4abtqru.js";import"./k5ngqk6bkqja3f09.js";import"./isn1igquqvc1qe44.js";import"./lv749h5qyvjegoog.js";import"./ns3o7cu7dtun5l1w.js";import"./ds557awgotgdm7n4.js";import"./c7q67liujwt03fxw.js";import"./ob8dna56sqm37byd.js";import"./bznan1jknv1y4qru.js";import"./go2lz3yja1ixfdzl.js";function it({taskId:s,onClose:u}){const n=$(),l=O(),i=G(),c=y(),{data:t,error:b}=V(s),{isLoading:w}=X(s),W=Y(({getTurnsForTask:a})=>a(s)),m=B(),f=e.useMemo(()=>m?new L(q()):new F,[m]),_=N(f.isEmpty$),[k,d]=e.useState([]),[M,g]=e.useState(!1),{focusedAssistantTurn:r,setFocusedAssistantTurnId:S}=ot({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),D=t?.task?.current_turn_id,C=!!t?.task.has_unread_turn&&D===t.current_assistant_turn?.id,h=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!m)return;const a=t?.task?.title;if(a){const R=document.title;return document.title=a,()=>{document.title=R}}},[m,t?.task?.title]),e.useEffect(()=>{C&&h&&tt.markTurnAsRead(s).then(()=>{n.invalidateQueries({queryKey:["wham","tasks"]}),n.invalidateQueries({queryKey:["wham","task",s]})})},[C,h,s,n]),at(),st([{key:"newTask",action:()=>{c("/codex",{state:{focusComposer:!0}})},actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[p.Mod,p.Shift,"o"]},{key:"closeTask",action:()=>{c("/codex")},actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[p.Escape]}]);const T=k.length>0,E=e.useCallback(({force:a=!1}={})=>{if(a||!T&&_){d([]),u();return}g(!0)},[u,T,_]),j=r?rt(r.turn_status):!1,v=r?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||r?.id===t?.current_assistant_turn?.id,A=t?.current_diff_task_turn?.id===r?.id||r?.sibling_turn_ids?.includes(t?.current_diff_task_turn?.id??""),P=!t?.current_diff_task_turn,K=j&&v&&(A||P);return b?(l.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),o.jsx(Z,{to:"/codex"})):o.jsx(U.Provider,{value:f,children:o.jsx(nt,{permissions:"write",taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:M,setConfirmClose:g,task:t?.task,focusedAssistantTurn:r,pastTurns:W,clearComments:()=>d([]),setComments:d,comments:k,canFollowUp:K,handleClose:E,setFocusedAssistantTurnId:S,loadingTurnMapping:w})})}function ut(){const s=y(),u=z(),{taskId:n}=H();et();const l=u.state??{},{backgroundLocation:i}=l,c=e.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return n?o.jsx(I,{children:o.jsx(J,{children:o.jsx(it,{taskId:n,onClose:c})})}):null}const Ht=()=>[{title:"Codex"}],Jt=Q(function(){return o.jsx(ut,{})});export{Jt as default,Ht as meta};
//# sourceMappingURL=f8wib5qgit0yoizn.js.map
