import{d as P,m as k,bg as A,jl as z,cA as V,ck as Y,cD as H,dX as q,hx as G,bU as L,jp as U,c6 as X,kw as Z}from"./g670b8vtkhx0yc6d.js";import{b as S,r as g,j as e,M as v,h as J,ai as K}from"./gg0tb34p9fzo1omt.js";import{L as Q,bP as $}from"./forbprkns1cohsbl.js";import{g as M}from"./epts3f5f624a6l7w.js";import{u as ee,A as te,R as se,N as ne,a as ae}from"./bg3lnoqnod0uwuhc.js";import{h as oe}from"./o1efssv80j1s2jn6.js";import{F}from"./jnf6ovox5e5qitwu.js";import{W as O}from"./e3erq0emp0cqk1ou.js";import{C as W}from"./c2dpp00i676113px.js";import{b as re}from"./lptwpbjabrvjmhsj.js";import{u as ie}from"./fy0u9jux1siot03l.js";import{s as le,t as ce,v as B,j as I}from"./nir0q9e2l94u37hi.js";import{u as de}from"./btvken3m81tjj676.js";import{I as me}from"./mu0w85wyyiji3bj8.js";import{a as ue}from"./jgs7169reknaons9.js";import{W as xe}from"./gltmx7p7ryx2z3jy.js";import"./eyn5f5xfm2iythcf.js";import"./cnl9n9geu2oxb8o4.js";import"./f4wsvwai0sxxe1lf.js";import"./cf441rgiwd88s4mv.js";import"./fz8lyjvdpywhlf94.js";import"./cs320738df36xnc1.js";import"./f51c6zie1stj9anw.js";import"./jpdmr6hprcjyd5ie.js";import"./me58wahxzwibdrxp.js";import"./pnx8yl9r7yj5moem.js";import"./felxwdrg3fgsr1mu.js";import"./eqymi4bdej7dbca6.js";import"./ds557awgotgdm7n4.js";import"./c7q67liujwt03fxw.js";import"./ogvupmk4xezkmrqf.js";import"./juuj7s9t3x7u9it2.js";function ge({handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o,lockPageView:i}){const r=S();return g.useEffect(()=>{O.recordEnvironmentsView()},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(W,{title:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(T,{handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o,lockPageView:i})]})}function T({handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o,lockPageView:i,shouldDisableRow:r,disablePill:f}){const u=S(),c=P(),[d,b]=g.useState(""),[j,w]=g.useState(null),{mutate:y,isPending:m}=ie({onSuccess:t=>{O.recordCreateEnvSuccess(),a(t.id,M(t)),o()}}),{data:h,isLoading:p}=le(),x=k(c,"2134057841"),n=k(c,"1535847699"),N=de({defaultValues:{repositoryId:"",agentNetworkAccess:x?{mode:"off"}:null},validators:{onSubmit:({value:t})=>{const C={};return(!t.repositoryId||t.repositoryId==="")&&(C.repositoryId=u.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),x&&t.agentNetworkAccess?.mode==="on"&&t.agentNetworkAccess.preset_allowlist===re&&(!t.agentNetworkAccess.allowlist_domains||t.agentNetworkAccess.allowlist_domains.length===0)&&(C.agentNetworkAccess=u.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),{fields:C}}},onSubmit:({value:t})=>{O.recordEnvironmentsSubmit(),i(),y({...t,label:d,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",maintenanceSetupCommands:"",envVars:[],secrets:[],autoSetupSettings:n?{use_auto_setup:!0}:null})}}),_=t=>{t.preventDefault(),t.stopPropagation(),N.handleSubmit()};g.useEffect(()=>{p||h?.installations.length===0&&oe()},[p,h,c]);const R=ee();return e.jsx("form",{onSubmit:_,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(te,{selectedInstallationId:j,setSelectedInstallationId:w}),e.jsx(N.Field,{name:"repositoryId",children:t=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(se,{installationId:j,selectedRepository:t.state.value,onSelect:(C,D)=>{t.handleChange(C),b(D)},shouldDisableRow:r,disablePill:f}),e.jsx(F,{field:t})]})}),x&&e.jsx(N.Field,{name:"agentNetworkAccess",children:t=>e.jsxs("div",{className:"flex flex-col gap-4",children:[R!=null&&e.jsx(ne,{disabledByWorkspaceSettings:R,agentNetworkAccess:t.state.value,onChange:t.handleChange}),e.jsx(F,{field:t}),t.state.value?.mode==="on"&&e.jsx(ae,{})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(A,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(N.Subscribe,{selector:t=>t.values,children:t=>e.jsx(A,{color:"primary",size:"medium",loading:m,disabled:!d||x&&!t.agentNetworkAccess,onClick:()=>N.handleSubmit(),children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})})]})]})})}function fe({selectedTab:s,onChange:a}){const o=S(),i=P(),r=k(i,"2665240312"),f=g.useCallback(u=>{a(u)},[a]);return e.jsx("div",{className:"border-token-border-primary flex w-full items-center border-b align-middle",children:r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ue,{currentTab:s,onChange:f,withUnderline:!0,tabs:[{label:o.formatMessage({id:"wham.selectEnvironmentHeader.create",defaultMessage:"Existing environments"}),key:"select"},{label:o.formatMessage({id:"wham.selectEnvironmentHeader.select",defaultMessage:"New environment"}),key:"create"}]})})})}function he({environment:s,isSelected:a,className:o}){return e.jsxs("div",{className:L("flex items-center justify-between gap-2",o),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:s.label}),s.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(v,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:s.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:s.description})]}),a?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function pe({environment:s,isSelected:a,onClick:o}){return e.jsx("button",{className:L("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:o,type:"button",children:e.jsx(he,{environment:s,isSelected:a,className:"w-full"})})}function E(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(Q,{className:"h-14 w-full"})})}const ve=10;function be({handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o}){const i=S(),[r,f]=g.useState(""),u=P(),c=k(u,"2673860158"),{data:d,isLoading:b,fetchNextPage:j,hasNextPage:w,isFetchingNextPage:y}=B({pageSize:ve,enforceRepoAccess:c}),m=g.useMemo(()=>d?.pages.flatMap(n=>n.items??[])??[],[d]),h=m.filter(n=>n.label.toLowerCase().includes(r.toLowerCase())),p=I(n=>n.environmentId),x=I(n=>n.setEnvironmentId);return g.useEffect(()=>{if(p){const n=m.find(l=>l.id===p);n?a(n.id,M(n)):x(null)}else m.length===1&&(x(m[0].id),a(m[0].id,M(m[0])))},[p,m,a,x]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(z,{color:"search",iconPosition:"left",icon:V,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:r,onChange:n=>f(n.target.value),placeholder:i.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:i.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:b?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(E,{}),e.jsx(E,{}),e.jsx(E,{}),e.jsx(E,{}),e.jsx(E,{}),e.jsx(E,{}),e.jsx(E,{})]}):e.jsxs(e.Fragment,{children:[h.length===0&&!w?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):h.map((n,l)=>e.jsxs("div",{children:[e.jsx(pe,{environment:n,isSelected:p===n.id,onClick:()=>a(n.id,M(n))}),l!==h.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},n.id)),e.jsx(me,{isFetchingNextPage:y,hasNextPage:w??!1,fetchNextPage:j,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(A,{color:"secondary",size:"medium",type:"button",onClick:s,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(A,{color:"primary",size:"medium",disabled:!p,onClick:o,children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function je(){const s=S(),a=Y(),r=H()?.name??s.formatMessage({id:"wham.codexOnboardingEnvironments.workspaceName",defaultMessage:"Workspace"});return e.jsx(q,{label:s.formatMessage({id:"wham.codexOnboardingEnvironments.environmentExistsTooltip",defaultMessage:"An environment has already been created for {workspaceName}. Youâ€™ll be able to create a new environment later for this repo in settings."},{workspaceName:r}),children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-tertiary inline-flex items-center justify-center gap-1 rounded-3xl py-1.5 ps-1.5 pe-1.5",children:[e.jsx(G,{className:"icon-sm"}),!a&&e.jsx("div",{className:"justify-start pe-1 text-xs leading-3 font-medium",children:e.jsx(v,{id:"wham.codexOnboardingEnvironments.environmentExists",defaultMessage:"Environment already exists"})})]})})}function we({handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o}){const i=S(),[r,f]=g.useState("select"),{data:u}=ce(),c=d=>u?.some(b=>b.repos.includes(d.id))??!1;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(W,{title:i.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:i.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx("div",{className:"pb-4",children:e.jsx(fe,{selectedTab:r,onChange:d=>{f(d)}})}),r==="select"?e.jsx(be,{handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o}):e.jsx(T,{lockPageView:()=>{},handleGoBack:s,handleSelectEnvironment:a,goToNextPage:o,shouldDisableRow:c,disablePill:e.jsx(je,{})})]})}function Ne(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(v,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost thereâ€¦"}),e.jsx(X,{})]})})}function Ee(){const{eligible:s,isLoading:a}=$(),o=P(),i=k(o,"2673860158"),r=k(o,"2395384117"),{data:f,isLoading:u}=B({pageSize:1,enforceRepoAccess:i}),c=J(),[d,b]=g.useState(!1),j=()=>{c("/codex/onboarding/connections")},w=()=>{c(r?"/codex/onboarding/starter-tasks":"/codex/onboarding/data-check")},y=I(l=>l.setEnvironmentId),m=I(l=>l.setBranch),h=(l,N)=>{y(l),m(N)},x=(f?.pages.flatMap(l=>l.items).length??0)>0;if(a||u)return e.jsx(Ne,{});if(!s)return e.jsx(K,{to:"/codex"});const n=!d&&x&&!0;return e.jsx(xe,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:n?e.jsx(we,{handleGoBack:j,handleSelectEnvironment:h,goToNextPage:w}):e.jsx(ge,{handleGoBack:j,handleSelectEnvironment:h,goToNextPage:w,lockPageView:()=>b(!0)})})})}const st=()=>[{title:"Codex"}],nt=Z(function(){return e.jsx(Ee,{})});export{nt as default,st as meta};
//# sourceMappingURL=gsuymyr8oaez6a6t.js.map
