import{k2 as f,k3 as p,k1 as _,cG as h,d as w,G as g,l7 as y,ad as l,ar as u,a7 as S,h as b,bs as c,bt as d,mo as F,R as V,bW as x}from"./g670b8vtkhx0yc6d.js";import{b6 as E,b0 as z}from"./forbprkns1cohsbl.js";import{f as m,r as i}from"./gg0tb34p9fzo1omt.js";function R(){const t=h(),a=w(),e=g(a);return t&&!y(t)&&e?.isEnterprisey()}function q(){return f(E.ChartSerialization)}function D(t,a){const e=t==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(e,{userId:a})??!1),n=i.useCallback(()=>{o(!0),u.setItem(e,!0,{userId:a})},[e,a]);return[s,n]}function L(t){const[a,e]=i.useState([]),s=S(t,b.getBranch);return i.useEffect(()=>{const o=T(s);o.length!==a.length&&e(o)},[a.length,t,s]),a}function I(t){const a=t.metadata?.aggregate_result?.messages.filter(z)??[];let e=0;const s=(t.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:a[e++]}),r}),o=(t.metadata?.attachments??[]).filter(n=>p(n.name)).map(n=>({type:"table",file_id:n.id??"",title:_(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function T(t){return t.filter(e=>e.message?.author.role==="tool"&&e.message?.author.name==="python"||(e.message?.metadata?.attachments??[]).length>0).flatMap(e=>I(e.message))}async function C(t,a,e){const s=await t.text(),{parse:o}=await x(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:a,download_url:e}}function k(t){const a=t[0].values.length,e=[];for(let s=0;s<a;s++){const o=t.map(n=>n.values[s]);e.push(o)}return e}function N(t){return m({queryKey:["ada-visualization","chart",t.file_id],queryFn:async()=>{const a=await c(t.file_id);if(a.status===d.Success){const e=await fetch(a.download_url);if(e.status!==200)throw new Error("Failed to download chart json from interpreter");const s=await e.json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:a.file_name??"",download_url:a.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function M(t){return m({queryKey:["ada-visualization","table",t.file_id],queryFn:async()=>{if(t.file_name&&F(t.file_name)){const a=await V.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:t.file_id}}});return{content:a.sheets.map(e=>({name:e.name,columnNames:e.columns.map(s=>s.name),columnTypes:e.columns.map(()=>"string"),rows:k(e.columns)})),download_url:a.download_url,file_name:t.file_name}}else{const a=await c(t.file_id);if(a.status===d.Success){const e=await fetch(a.download_url);return C(e,a.file_name??"",a.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{L as a,M as b,N as c,R as d,D as e,I as g,q as u};
//# sourceMappingURL=fg8jzk06sc5a5vhq.js.map
