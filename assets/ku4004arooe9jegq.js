import{r,j as t,M as y}from"./gg0tb34p9fzo1omt.js";import{e0 as A,aq as _,j as H,h as F,bj as I,P as x,l as L,t as R,g as z,k4 as B,bg as j,c2 as G,q as K}from"./g670b8vtkhx0yc6d.js";import{dM as O,dN as U,dO as V}from"./forbprkns1cohsbl.js";import{E as q}from"./o1bp14c110cdqm7b.js";function D({initialText:c,clientThreadId:n,currentLeaf:i,onExitEdit:d,onRequestCompletion:h,disabled:C,attachments:o}){const[l,M]=r.useState(c??""),u=r.useRef(null),b=A(),p=_.useStore(),g=l.trim()==="",E=r.useCallback(e=>{M(e.currentTarget.value)},[]),m=r.useCallback(e=>{if(g)return;const s={},a=O();o&&(s.attachments=o),a&&(s.__internal={search_settings:a});const v=p.getActiveSystemHintType(),{systemHints:N,extraStreamParams:P}=U(v?[v]:[]),S=H(n),w=F.getParentNode(S,i).message.id;h({sourceEvent:e,parentMessageId:w,promptMessage:I(l,Object.keys(s).length>0?s:void 0),extraStreamParams:P,completionMetadata:{conversationMode:S?.mode,systemHints:N}}),d(),x.logEvent("Change Active Node",{intent:"edit_save"})},[g,o,n,p,h,d,i,l]),f=r.useCallback(()=>{L(n,e=>{R.setCurrentBranch(e,i)}),x.logEvent("Change Active Node",{intent:"edit_cancel"}),d(),x.logEvent("Cancel Edit Prompt",{threadId:z(n)})},[i,d,n]);r.useEffect(()=>{const e=u.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=u.current,s=a=>{a.isComposing||(a.key==="Enter"&&a.metaKey?m(a):a.key==="Escape"&&f())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[f,m]);const k=o&&o.length>0&&t.jsx(J,{children:o.map(e=>t.jsx(V,{width:b?"wide":"normal",file:e.name,contextConnectorInfo:B(e.context_connector_info)},e.id))}),T=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(q,{ref:u,value:l,onChange:E,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[k,T,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(j,{as:"button",color:"secondary",onClick:f,children:t.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(j,{as:"button",onClick:m,disabled:C||g,children:t.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const J=G.div`flex gap-2 flex-wrap`;function ee({message:c,...n}){return t.jsx(D,{currentLeaf:c.id,initialText:K(c),attachments:c.metadata?.attachments,...n})}export{ee as TextMessageEditor};
//# sourceMappingURL=ku4004arooe9jegq.js.map
