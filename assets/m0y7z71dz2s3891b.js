import{r as l,ap as $,o as Z,b as ee,j as n,A as te,m as v}from"./gg0tb34p9fzo1omt.js";import{jW as _,jw as se,ar as W,a7 as H,h as I,cn as ae,kj as oe,hn as ne,j_ as O,j5 as ie,hp as re,dj as D,os as ce,mE as de,nB as le}from"./g670b8vtkhx0yc6d.js";import{ki as ue,lG as V,c8 as me,C as f,lH as pe,lI as he,fy as fe,dV as ge,lJ as xe,u as U,lK as Ce,lL as ve,lB as Te,lM as we,lN as Ie,lO as be,lP as k,lQ as G,lz as Se,lR as ye,c1 as M,lS as L,lT as P,lU as Ee,lV as Ae,lW as _e}from"./forbprkns1cohsbl.js";import{L as Ne}from"./ejkv34dzwipa230i.js";import{T as Re}from"./c8ep7627nr5x9804.js";import{g as je}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./k5ngqk6bkqja3f09.js";import"./gffsn29yylc5pncm.js";import"./ihgbljwwpo1mzi43.js";import"./go2lz3yja1ixfdzl.js";import"./gomrh6779xe4lvq3.js";import"./mgu35bfjmjtg3slf.js";import"./e0kfywq1jfn60tks.js";import"./jh4r0k3f3n3zptua.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./h431y4zi2z7ivdmh.js";import"./jec2dxephizdapuu.js";import"./dku20bpa2hgnbl5b.js";import"./be6sa05e05n18ich.js";import"./j8f1yha947to1zwq.js";import"./l8bgi7e4c78ddktv.js";import"./dl1zw2u5dp7czf6c.js";import"./e6r7gqenbe47ga9h.js";import"./eiffxi5640gvsu4t.js";import"./o68lxipd1oht2mfn.js";import"./kxn66emqpeqvk1h7.js";import"./isn1igquqvc1qe44.js";import"./bk8slwxjkdlmxjxm.js";import"./ob8dna56sqm37byd.js";import"./bznan1jknv1y4qru.js";import"./fz8lyjvdpywhlf94.js";import"./cs320738df36xnc1.js";import"./f51c6zie1stj9anw.js";import"./jpdmr6hprcjyd5ie.js";import"./me58wahxzwibdrxp.js";import"./pnx8yl9r7yj5moem.js";import"./felxwdrg3fgsr1mu.js";import"./kr5jdtt5uczx95b1.js";import"./cx1v46pslsfvescw.js";import"./e83gfa4m2yetz3zf.js";const z="oai/apps/canmoreSidebarWidth",Me=.25,Fe=400,B=400;function K(e){return e-Fe}function E(e,s){return $(B,K(e),s??Me*e)}function We(){const e=_.useState(_.selectWindowWidth),s=E(e,se(W.DANGER_SECRET_FOLDERS_ONLY_getItem(z))),a=q(),[t,i]=l.useState(s);l.useEffect(()=>{(t<B||t>K(e))&&i(E(e,t))},[e]);function r(u){i(p=>E(e,p+=u.delta.x))}function o(u){i(u),W.DANGER_SECRET_FOLDERS_ONLY_setItem(z,u)}function c(){const u=E(e,void 0);o(u)}const d=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:d,viewportWidth:e,handleDrag:r,handleDoubleClick:c,persist:o}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function q(e){const s=_.useState(_.selectWindowWidth);return(e??s)>1e3}const j="sharedCanvas";function Oe(){const[e,s]=Z(),a=e.get(j),t=ee();l.useEffect(()=>{const i=a&&ue.createRemixTempTextdoc(a,t);if(!i)return;requestAnimationFrame(()=>{V(i)});const r=new URLSearchParams(e);r.delete(j),s(r);const o=new URL(window.location.href);o.searchParams.delete(j),history.replaceState(null,"",o)},[a,e,s,t])}const De="textdocId",ke=e=>{const a=new URLSearchParams(window.location.search).get(De),t=H(e,i=>I.findNode(i,({message:r})=>{const o=r.metadata?.canvas;return o?.create_source===me.HIVE&&(a?o?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{V(t)})},[t])};function Le(e,s){let a;return s?.type===f.Textdoc?s.textdocId.startsWith(pe)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===f.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziTurnId}),he(e,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const Y=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:i=!1,width:r})=>{const{setTargetedContent:o}=fe(),c=l.useRef(!1);if(l.useEffect(()=>(c.current&&o(void 0),c.current=!0,()=>{c.current=!1}),[a]),a==null)return null;switch(a.type){case f.Textdoc:return n.jsx(Re,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:r});case f.Kanzi:break;case f.ADAVisualization:return null}},Pe=300,ze=e=>{switch(e?.type){case f.Textdoc:return e.textdocId;case f.Kanzi:return null;default:return null}};function He(e,s){const[a,t,i,r]=H(e,m=>[I.getRequestId(m),I.getConversationLastTurn(m),I.isMessageTurnEnded(m),I.getVariantIds(m).length>1]),o=ge(a),c=xe(),d=U(),[u,p]=l.useMemo(()=>{if(t&&r)return[void 0,null];if(s===!0)return[void 0,null];let m;return!i&&t&&(m=ae(t.messageGroups,C=>C.type!==oe)),Ve({groupedMessage:m,currentlyFocusedObject:d,isRequestActive:o,latestTextdocId:c})},[i,t,r,d,s,o,c]),b=p!=null,T=ze(p),N=Ce("canvas");l.useEffect(()=>{if(p&&u&&!ne()&&(N(),ve(p,u),p.type===f.Textdoc)){const{textdocId:m}=p,C=je(m);Te(document.getElementById(C))}},[b,T])}function Ve({groupedMessage:e,currentlyFocusedObject:s,isRequestActive:a,latestTextdocId:t}){switch(e?.type){case O.Canmore:{const[i,r]=e.messages;if(!we(i))break;const o=Ie(a,i,r??null),c=o.textdocId??t;if(c&&(o.function===be.CreateTextdoc?(o.content??"").length>Pe||o.status===k.WAITING:o.status===k.STREAMING))return[o.messageId,{type:f.Textdoc,textdocId:c}];break}case O.kanzi:break}return[void 0,null]}const A={type:"spring",bounce:.12,duration:.64},Ue={type:"spring",bounce:0,duration:.58},x={duration:0},Ge=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:i,handleDrag:r,handleDoubleClick:o,persist:c}=We(),d=M(),[u,p]=l.useState(!d),[b,T]=l.useState(!1),N=d?x:A,m=d?x:Ue,C=Ee(({rect:h})=>h),{windowHeight:w,windowWidth:S}=de(h=>h,{windowWidth:0,windowHeight:0});let g=C??{top:0,left:t,width:S-t,height:w},F=!1;if(C&&(g.top<0||g.top+g.height>w)){F=!0;const h={width:(S-t)*.75,height:w*.75};g={top:w/2-h.height/2,left:(S-t-h.width)/2+t,width:h.width,height:h.height}}const y=C?.borderRadius,R=Ae(),X=R?.history!=null||R?.showChangesAtVersion!=null,J=le();return n.jsxs(n.Fragment,{children:[X&&n.jsx(Ne,{onClick:()=>_e(R.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(v.div,{initial:{marginInlineEnd:J?-260:0},animate:{marginInlineEnd:0},transition:m,children:[n.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:d?x:{...A,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(v.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:d?x:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:F?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:t,y:0,width:i,height:w,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:d?x:{opacity:{duration:.14,bounce:.1}},borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:b||d?x:A,onAnimationComplete:()=>p(!1),children:n.jsx(v.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:N,children:n.jsxs("div",{className:"h-full",children:[n.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:d?x:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>T(!0),onPointerUp:()=>T(!1),onDrag:(h,Q)=>r(Q),onDragEnd:()=>{T(!1),c(t)},onDoubleClick:()=>o()}),b&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(Y,{onClose:a,clientThreadId:e,isAnimating:!d&&u,focusedObject:s,width:S-t})]})})})]})},Be=l.memo(Ge),Ke=({clientThreadId:e,focusedObject:s,onClose:a})=>{const t=M();return n.jsx(ce,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:n.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:t?x:A,children:n.jsx(Y,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})})},qe=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const t=U(),i=q(s)&&!re(ye,t?.type),r=M();He(e,a||r),Oe(),ke(e),l.useEffect(()=>{G()},[e]);const o=t&&(i?n.jsx(Be,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-sidebar"):n.jsx(Ke,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-modal"));l.useEffect(()=>{if(t)return L(d=>Le(d,t)),()=>L(null)},[t]);const c=o!=null;return l.useEffect(()=>(D.setActiveStageSidebar(c),()=>{c&&D.setActiveStageSidebar(!1)}),[c]),r?n.jsx("div",{children:o},e):n.jsx(te,{children:o},e)},Dt=e=>{const s=l.useRef(null);return n.jsx(ie,{ref:s,onError:(a,t)=>{G(),setTimeout(()=>{s.current?.resetErrorBoundary()}),Se.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:n.jsx(qe,{...e})})};export{Dt as CanvasFocusedViewManager};
//# sourceMappingURL=m0y7z71dz2s3891b.js.map
