const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iv14ii8okf6yz304.js","assets/gg0tb34p9fzo1omt.js","assets/g670b8vtkhx0yc6d.js","assets/root-ilxovqci.css","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/kqivh2k2gjqolo2l.js","assets/ewqfcp1vbowm20lj.js","assets/fzrn137102spawew.js","assets/f36jz1b044mtoyky.js","assets/jgs7169reknaons9.js","assets/epts3f5f624a6l7w.js","assets/nir0q9e2l94u37hi.js","assets/cnl9n9geu2oxb8o4.js","assets/f4wsvwai0sxxe1lf.js","assets/mu0w85wyyiji3bj8.js","assets/gt2c25hojvlnw6hf.js","assets/h6uvwty3c3amaxiz.js","assets/hu61i4occl5w2buc.js","assets/iot1vlqga29hiiwl.js","assets/ansi-1f6vhsjh.css","assets/c7e30quc1do1jojv.js","assets/kv8a9039cr2p5scx.js","assets/ogvupmk4xezkmrqf.js","assets/juuj7s9t3x7u9it2.js","assets/lptwpbjabrvjmhsj.js","assets/hsr6nqstg4abtqru.js","assets/k5ngqk6bkqja3f09.js","assets/wham-task-turn-grouping-iz0raby8.css","assets/eiffxi5640gvsu4t.js","assets/o68lxipd1oht2mfn.js","assets/jlkzv5bipqb1jti4.js","assets/h9p1albvmprbl3kb.js","assets/code-diff-krvv6lyt.css","assets/e3erq0emp0cqk1ou.js","assets/b40xa0ca5oqnzth6.js","assets/b451x40oixvdmzqh.js"])))=>i.map(i=>d[i]);
import{b as D,u as Ot,r as v,a as nt,j as o,M as F,h as rt,A as ot,f as Pt,e as Wt}from"./gg0tb34p9fzo1omt.js";import{d as J,m as Y,ch as at,bg as W,c6 as de,ck as $t,dX as Z,hQ as Ht,e6 as he,e as Gt,n4 as it,iA as we,eP as ct,aB as Kt,cO as Vt,bU as lt,jl as zt,dW as Qt,n3 as Xt,be as qt,bV as Ut,bW as Yt,a as Ne,R as Zt,b6 as Jt,g0 as es,i_ as ze,hi as ve,g2 as ae,af as ie,hl as ts,hm as ss,bS as ns,g1 as rs}from"./g670b8vtkhx0yc6d.js";import{n5 as os,mQ as ut,pn as as,co as is,po as cs,dd as dt,L as ls,pp as Ae,K as se,e as ht,oe as us,i5 as ds,ap as mt,d8 as hs,pq as ms,pr as fs,ps as gs,da as ps,pt as xs,db as Cs,pu as Qe,kX as vs,pv as Ms,jW as ws,pw as As,px as bs}from"./forbprkns1cohsbl.js";import{W as K}from"./e3erq0emp0cqk1ou.js";import{W as be,j,C as ft,S as Es,D as ys,E as Ss,F as ks,u as gt,K as js,t as Fs,l as Bs,k as Ns,m as Ts,n as _s,h as Xe,w as qe,J as Is}from"./nir0q9e2l94u37hi.js";import{C as pt,a as Ee,u as Ds,b as Rs,c as Ls,S as Ue,s as Os}from"./epts3f5f624a6l7w.js";import{u as Ps}from"./b40xa0ca5oqnzth6.js";import{e as Ws}from"./b451x40oixvdmzqh.js";function $s(){const t=J();return Y(t,"3651421897")}function Hs({taskId:t,hasMultipleInProgressOrStreamingTurns:e}){const s=D(),r=at(),n=Ot(),[a,i]=v.useState(!1),{mutate:c}=nt({mutationFn:async()=>{i(!0),await be.cancelTask(t)},onError:()=>{r.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{n.refetchQueries({queryKey:["wham","task",t]}),n.invalidateQueries({queryKey:["wham","tasks"]})}});return o.jsx(W,{color:"primary",type:"button",size:"small",icon:a?de:os,onClick:()=>(K.recordCancel("task-details"),c()),disabled:a,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:e&&o.jsx(F,{id:"wham.composer.stopButton.multipleInProgressOrStreamingTurns",defaultMessage:"Stop all"})})}function Gs({isSubmitDisabled:t,createTask:e,disabledReason:s}){const r=D(),n=$t(),[a,i]=v.useState(!1);return o.jsxs("div",{className:"flex items-center gap-2",onClick:c=>c.stopPropagation(),children:[o.jsx(Z,{open:n?a:void 0,onOpenChange:i,label:s??r.formatMessage({id:"wham.whamComposer.fasterTitle",defaultMessage:"Fast mode where the agent doesn't edit code"}),children:o.jsx(W,{color:"secondary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>(K.recordComposerAction("ask"),e({runEnvironmentInQaMode:!0})),children:o.jsx(F,{id:"wham.composer.askButton",defaultMessage:"Ask"})})}),o.jsx(Z,{label:s,children:o.jsx(W,{color:"primary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>(K.recordComposerAction("code"),e({runEnvironmentInQaMode:!1})),children:o.jsx(F,{id:"wham.composer.codeItButton",defaultMessage:"Code"})})})]})}function Te(t){const e=D(),s=j(r=>r.getRateLimit()?.resets_after_text);switch(t){case"enabled":return;case"rate-limit":return e.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset {resetsAfterText}"},{resetsAfterText:s});case"no-environment":return e.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"});case"no-content":return e.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"});case"no-github-connection":return e.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"});case"connect-github-error":return e.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"});default:Ht(t)}}function _e({isFollowUp:t,hasComments:e}){const s=j(l=>l.getRateLimit()?.remaining===0),r=j(({environmentId:l})=>l),n=j(({branch:l})=>l),a=he(),c=!Gt(a.isEmpty$)||e,{isConnected:u,error:d}=it(ct.GITHUB_CONNECTOR,"github","/codex",we.CODEX);return s?"rate-limit":!r&&!n&&!t?"no-environment":!t&&!u?"no-github-connection":!t&&d?"connect-github-error":c?"enabled":"no-content"}const Ks=4,Vs=t=>{switch(t){case 1:return o.jsx(ks,{"aria-hidden":!0,className:"icon-sm"});case 2:return o.jsx(Ss,{"aria-hidden":!0,className:"icon-sm"});case 3:return o.jsx(ys,{"aria-hidden":!0,className:"icon-sm"});default:return o.jsx(Es,{"aria-hidden":!0,className:"icon-sm"})}};function zs({attempts:t,setAttempts:e}){const s=D(),[r,n]=v.useState(!1),a=v.useRef(null),i=()=>n(!1),c=J(),u=Kt(c,"2179180337").value.max_attempts??Ks;return o.jsx(Qs,{children:o.jsxs(ut,{open:r,onOpenChange:n,children:[o.jsx(pt,{triggerText:s.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:s.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Number of simultaneous versions"}),ariaLabel:s.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open versions number selector, currently set to {count}x"},{count:t}),Icon:Vs(t),truncate:!1}),o.jsx(ft,{align:"start",isOpen:r,closePopover:i,popoverContentRef:a,children:o.jsx("div",{className:"flex w-50 flex-col rounded-lg p-1.5",children:[...Array(u)].map((d,l)=>o.jsx(Ee,{className:"w-full",onClick:()=>{e(l+1),i()},isSelected:t===l+1,label:s.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:l+1})},l+1))})})]})})}function Qs({children:t}){const e=D(),s=as(),r=s&&!s.isLoading&&s.eligible;return o.jsx(is,{side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",show:r,sideOffset:0,className:"w-60",announcementKey:cs,title:e.formatMessage({id:"wham.composerBon.nuxTooltip.title",defaultMessage:"Best-of-N"}),description:e.formatMessage({id:"wham.composerBon.nuxTooltip.description",defaultMessage:"Generate multiple solutions so you can pick the best approach."}),onDismiss:s.markAsViewed,children:t})}function Xs({comments:t,onClearComments:e}){const s=D();return t.length===0?null:o.jsxs("div",{className:"bg bg-token-bg-secondary mx-1 mt-1 flex items-center gap-2 rounded-t-3xl rounded-b-lg py-0.5 ps-3 pe-0.5 font-semibold text-blue-400",children:[o.jsx(dt,{className:"icon"}),o.jsx("div",{className:"flex-1 text-sm",children:o.jsx(F,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),o.jsx("button",{className:"text-token-text-secondary flex h-9 w-9 shrink-0 items-center justify-center",onClick:r=>{r.preventDefault(),r.stopPropagation(),e()},"aria-label":s.formatMessage({id:"wham.composer.clearComments",defaultMessage:"Clear comments"}),children:o.jsx(Vt,{className:"icon"})})]})}const xt=t=>v.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},v.createElement("path",{d:"M18 4C19.6569 4 21 5.34315 21 7V14.5H21.5L21.6025 14.5049C22.1067 14.5562 22.5 14.9823 22.5 15.5V17C22.5 18.6569 21.1569 20 19.5 20H4.5C2.89489 20 1.58421 18.7394 1.50391 17.1543L1.5 17V15.5L1.50488 15.3975C1.55621 14.8933 1.98232 14.5 2.5 14.5H3V7C3 5.34315 4.34315 4 6 4H18ZM3.5 17L3.50488 17.1025C3.55621 17.6067 3.98232 18 4.5 18H19.5C20.0523 18 20.5 17.5523 20.5 17V16.5H3.5V17ZM6 6C5.44772 6 5 6.44772 5 7V14.5H19V7C19 6.44772 18.5523 6 18 6H6Z",fill:"currentColor"}));function Ct({className:t}){return o.jsx(ls,{className:lt("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function $(t){return Array.isArray?Array.isArray(t):wt(t)==="[object Array]"}function qs(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Us(t){return t==null?"":qs(t)}function P(t){return typeof t=="string"}function vt(t){return typeof t=="number"}function Ys(t){return t===!0||t===!1||Zs(t)&&wt(t)=="[object Boolean]"}function Mt(t){return typeof t=="object"}function Zs(t){return Mt(t)&&t!==null}function I(t){return t!=null}function Me(t){return!t.trim().length}function wt(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Js="Incorrect 'index' type",en=t=>`Invalid value for key ${t}`,tn=t=>`Pattern length exceeds max of ${t}.`,sn=t=>`Missing ${t} property in key`,nn=t=>`Property 'weight' in key '${t}' must be a positive integer`,Ye=Object.prototype.hasOwnProperty;class rn{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(r=>{let n=At(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function At(t){let e=null,s=null,r=null,n=1,a=null;if(P(t)||$(t))r=t,e=Ze(t),s=ye(t);else{if(!Ye.call(t,"name"))throw new Error(sn("name"));const i=t.name;if(r=i,Ye.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(nn(i));e=Ze(i),s=ye(i),a=t.getFn}return{path:e,id:s,weight:n,src:r,getFn:a}}function Ze(t){return $(t)?t:t.split(".")}function ye(t){return $(t)?t.join("."):t}function on(t,e){let s=[],r=!1;const n=(a,i,c)=>{if(I(a))if(!i[c])s.push(a);else{let u=i[c];const d=a[u];if(!I(d))return;if(c===i.length-1&&(P(d)||vt(d)||Ys(d)))s.push(Us(d));else if($(d)){r=!0;for(let l=0,h=d.length;l<h;l+=1)n(d[l],i,c+1)}else i.length&&n(d,i,c+1)}};return n(t,P(e)?e.split("."):e,0),r?s:s[0]}const an={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},cn={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},ln={location:0,threshold:.6,distance:100},un={useExtendedSearch:!1,getFn:on,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var m={...cn,...an,...ln,...un};const dn=/[^ ]+/g;function hn(t=1,e=3){const s=new Map,r=Math.pow(10,e);return{get(n){const a=n.match(dn).length;if(s.has(a))return s.get(a);const i=1/Math.pow(a,.5*t),c=parseFloat(Math.round(i*r)/r);return s.set(a,c),c},clear(){s.clear()}}}class Ie{constructor({getFn:e=m.getFn,fieldNormWeight:s=m.fieldNormWeight}={}){this.norm=hn(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,P(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();P(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!I(e)||Me(e))return;let r={v:e,i:s,n:this.norm.get(e)};this.records.push(r)}_addObject(e,s){let r={i:s,$:{}};this.keys.forEach((n,a)=>{let i=n.getFn?n.getFn(e):this.getFn(e,n.path);if(I(i)){if($(i)){let c=[];const u=[{nestedArrIndex:-1,value:i}];for(;u.length;){const{nestedArrIndex:d,value:l}=u.pop();if(I(l))if(P(l)&&!Me(l)){let h={v:l,i:d,n:this.norm.get(l)};c.push(h)}else $(l)&&l.forEach((h,f)=>{u.push({nestedArrIndex:f,value:h})})}r.$[a]=c}else if(P(i)&&!Me(i)){let c={v:i,n:this.norm.get(i)};r.$[a]=c}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function bt(t,e,{getFn:s=m.getFn,fieldNormWeight:r=m.fieldNormWeight}={}){const n=new Ie({getFn:s,fieldNormWeight:r});return n.setKeys(t.map(At)),n.setSources(e),n.create(),n}function mn(t,{getFn:e=m.getFn,fieldNormWeight:s=m.fieldNormWeight}={}){const{keys:r,records:n}=t,a=new Ie({getFn:e,fieldNormWeight:s});return a.setKeys(r),a.setIndexRecords(n),a}function ce(t,{errors:e=0,currentLocation:s=0,expectedLocation:r=0,distance:n=m.distance,ignoreLocation:a=m.ignoreLocation}={}){const i=e/t.length;if(a)return i;const c=Math.abs(r-s);return n?i+c/n:c?1:i}function fn(t=[],e=m.minMatchCharLength){let s=[],r=-1,n=-1,a=0;for(let i=t.length;a<i;a+=1){let c=t[a];c&&r===-1?r=a:!c&&r!==-1&&(n=a-1,n-r+1>=e&&s.push([r,n]),r=-1)}return t[a-1]&&a-r>=e&&s.push([r,a-1]),s}const z=32;function gn(t,e,s,{location:r=m.location,distance:n=m.distance,threshold:a=m.threshold,findAllMatches:i=m.findAllMatches,minMatchCharLength:c=m.minMatchCharLength,includeMatches:u=m.includeMatches,ignoreLocation:d=m.ignoreLocation}={}){if(e.length>z)throw new Error(tn(z));const l=e.length,h=t.length,f=Math.max(0,Math.min(r,h));let p=a,C=f;const M=c>1||u,w=M?Array(h):[];let x;for(;(x=t.indexOf(e,C))>-1;){let k=ce(e,{currentLocation:x,expectedLocation:f,distance:n,ignoreLocation:d});if(p=Math.min(k,p),C=x+l,M){let L=0;for(;L<l;)w[x+L]=1,L+=1}}C=-1;let S=[],R=1,A=l+h;const N=1<<l-1;for(let k=0;k<l;k+=1){let L=0,O=A;for(;L<O;)ce(e,{errors:k,currentLocation:f+O,expectedLocation:f,distance:n,ignoreLocation:d})<=p?L=O:A=O,O=Math.floor((A-L)/2+L);A=O;let ne=Math.max(1,f-O+1),te=i?h:Math.min(f+O,h)+l,H=Array(te+2);H[te+1]=(1<<k)-1;for(let T=te;T>=ne;T-=1){let G=T-1,Q=s[t.charAt(G)];if(M&&(w[G]=+!!Q),H[T]=(H[T+1]<<1|1)&Q,k&&(H[T]|=(S[T+1]|S[T])<<1|1|S[T+1]),H[T]&N&&(R=ce(e,{errors:k,currentLocation:G,expectedLocation:f,distance:n,ignoreLocation:d}),R<=p)){if(p=R,C=G,C<=f)break;ne=Math.max(1,2*f-C)}}if(ce(e,{errors:k+1,currentLocation:f,expectedLocation:f,distance:n,ignoreLocation:d})>p)break;S=H}const b={isMatch:C>=0,score:Math.max(.001,R)};if(M){const k=fn(w,c);k.length?u&&(b.indices=k):b.isMatch=!1}return b}function pn(t){let e={};for(let s=0,r=t.length;s<r;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<r-s-1}return e}const le=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class Et{constructor(e,{location:s=m.location,threshold:r=m.threshold,distance:n=m.distance,includeMatches:a=m.includeMatches,findAllMatches:i=m.findAllMatches,minMatchCharLength:c=m.minMatchCharLength,isCaseSensitive:u=m.isCaseSensitive,ignoreDiacritics:d=m.ignoreDiacritics,ignoreLocation:l=m.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:u,ignoreDiacritics:d,ignoreLocation:l},e=u?e:e.toLowerCase(),e=d?le(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(p,C)=>{this.chunks.push({pattern:p,alphabet:pn(p),startIndex:C})},f=this.pattern.length;if(f>z){let p=0;const C=f%z,M=f-C;for(;p<M;)h(this.pattern.substr(p,z),p),p+=z;if(C){const w=f-z;h(this.pattern.substr(w),w)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=r?le(e):e,this.pattern===e){let M={isMatch:!0,score:0};return n&&(M.indices=[[0,e.length-1]]),M}const{location:a,distance:i,threshold:c,findAllMatches:u,minMatchCharLength:d,ignoreLocation:l}=this.options;let h=[],f=0,p=!1;this.chunks.forEach(({pattern:M,alphabet:w,startIndex:x})=>{const{isMatch:S,score:R,indices:A}=gn(e,M,w,{location:a+x,distance:i,threshold:c,findAllMatches:u,minMatchCharLength:d,includeMatches:n,ignoreLocation:l});S&&(p=!0),f+=R,S&&A&&(h=[...h,...A])});let C={isMatch:p,score:p?f/this.chunks.length:1};return p&&n&&(C.indices=h),C}}class V{constructor(e){this.pattern=e}static isMultiMatch(e){return Je(e,this.multiRegex)}static isSingleMatch(e){return Je(e,this.singleRegex)}search(){}}function Je(t,e){const s=t.match(e);return s?s[1]:null}class xn extends V{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Cn extends V{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}}class vn extends V{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Mn extends V{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class wn extends V{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class An extends V{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class yt extends V{constructor(e,{location:s=m.location,threshold:r=m.threshold,distance:n=m.distance,includeMatches:a=m.includeMatches,findAllMatches:i=m.findAllMatches,minMatchCharLength:c=m.minMatchCharLength,isCaseSensitive:u=m.isCaseSensitive,ignoreDiacritics:d=m.ignoreDiacritics,ignoreLocation:l=m.ignoreLocation}={}){super(e),this._bitapSearch=new Et(e,{location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:u,ignoreDiacritics:d,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class St extends V{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,r;const n=[],a=this.pattern.length;for(;(r=e.indexOf(this.pattern,s))>-1;)s=r+a,n.push([r,s-1]);const i=!!n.length;return{isMatch:i,score:i?0:1,indices:n}}}const Se=[xn,St,vn,Mn,An,wn,Cn,yt],et=Se.length,bn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,En="|";function yn(t,e={}){return t.split(En).map(s=>{let r=s.trim().split(bn).filter(a=>a&&!!a.trim()),n=[];for(let a=0,i=r.length;a<i;a+=1){const c=r[a];let u=!1,d=-1;for(;!u&&++d<et;){const l=Se[d];let h=l.isMultiMatch(c);h&&(n.push(new l(h,e)),u=!0)}if(!u)for(d=-1;++d<et;){const l=Se[d];let h=l.isSingleMatch(c);if(h){n.push(new l(h,e));break}}}return n})}const Sn=new Set([yt.type,St.type]);class kn{constructor(e,{isCaseSensitive:s=m.isCaseSensitive,ignoreDiacritics:r=m.ignoreDiacritics,includeMatches:n=m.includeMatches,minMatchCharLength:a=m.minMatchCharLength,ignoreLocation:i=m.ignoreLocation,findAllMatches:c=m.findAllMatches,location:u=m.location,threshold:d=m.threshold,distance:l=m.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:a,findAllMatches:c,ignoreLocation:i,location:u,threshold:d,distance:l},e=s?e:e.toLowerCase(),e=r?le(e):e,this.pattern=e,this.query=yn(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:a}=this.options;e=n?e:e.toLowerCase(),e=a?le(e):e;let i=0,c=[],u=0;for(let d=0,l=s.length;d<l;d+=1){const h=s[d];c.length=0,i=0;for(let f=0,p=h.length;f<p;f+=1){const C=h[f],{isMatch:M,indices:w,score:x}=C.search(e);if(M){if(i+=1,u+=x,r){const S=C.constructor.type;Sn.has(S)?c=[...c,...w]:c.push(w)}}else{u=0,i=0,c.length=0;break}}if(i){let f={isMatch:!0,score:u/i};return r&&(f.indices=c),f}}return{isMatch:!1,score:1}}}const ke=[];function jn(...t){ke.push(...t)}function je(t,e){for(let s=0,r=ke.length;s<r;s+=1){let n=ke[s];if(n.condition(t,e))return new n(t,e)}return new Et(t,e)}const ue={AND:"$and",OR:"$or"},Fe={PATH:"$path",PATTERN:"$val"},Be=t=>!!(t[ue.AND]||t[ue.OR]),Fn=t=>!!t[Fe.PATH],Bn=t=>!$(t)&&Mt(t)&&!Be(t),tt=t=>({[ue.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function kt(t,e,{auto:s=!0}={}){const r=n=>{let a=Object.keys(n);const i=Fn(n);if(!i&&a.length>1&&!Be(n))return r(tt(n));if(Bn(n)){const u=i?n[Fe.PATH]:a[0],d=i?n[Fe.PATTERN]:n[u];if(!P(d))throw new Error(en(u));const l={keyId:ye(u),pattern:d};return s&&(l.searcher=je(d,e)),l}let c={children:[],operator:a[0]};return a.forEach(u=>{const d=n[u];$(d)&&d.forEach(l=>{c.children.push(r(l))})}),c};return Be(t)||(t=tt(t)),r(t)}function Nn(t,{ignoreFieldNorm:e=m.ignoreFieldNorm}){t.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:a,score:i})=>{const c=n?n.weight:null;r*=Math.pow(i===0&&c?Number.EPSILON:i,(c||1)*(e?1:a))}),s.score=r})}function Tn(t,e){const s=t.matches;e.matches=[],I(s)&&s.forEach(r=>{if(!I(r.indices)||!r.indices.length)return;const{indices:n,value:a}=r;let i={indices:n,value:a};r.key&&(i.key=r.key.src),r.idx>-1&&(i.refIndex=r.idx),e.matches.push(i)})}function _n(t,e){e.score=t.score}function In(t,e,{includeMatches:s=m.includeMatches,includeScore:r=m.includeScore}={}){const n=[];return s&&n.push(Tn),r&&n.push(_n),t.map(a=>{const{idx:i}=a,c={item:e[i],refIndex:i};return n.length&&n.forEach(u=>{u(a,c)}),c})}class ee{constructor(e,s={},r){this.options={...m,...s},this.options.useExtendedSearch,this._keyStore=new rn(this.options.keys),this.setCollection(e,r)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Ie))throw new Error(Js);this._myIndex=s||bt(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){I(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const a=this._docs[r];e(a,r)&&(this.removeAt(r),r-=1,n-=1,s.push(a))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:a,sortFn:i,ignoreFieldNorm:c}=this.options;let u=P(e)?P(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Nn(u,{ignoreFieldNorm:c}),a&&u.sort(i),vt(s)&&s>-1&&(u=u.slice(0,s)),In(u,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const s=je(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:a,i,n:c})=>{if(!I(a))return;const{isMatch:u,score:d,indices:l}=s.searchIn(a);u&&n.push({item:a,idx:i,matches:[{score:d,value:a,norm:c,indices:l}]})}),n}_searchLogical(e){const s=kt(e,this.options),r=(c,u,d)=>{if(!c.children){const{keyId:h,searcher:f}=c,p=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(u,h),searcher:f});return p&&p.length?[{idx:d,item:u,matches:p}]:[]}const l=[];for(let h=0,f=c.children.length;h<f;h+=1){const p=c.children[h],C=r(p,u,d);if(C.length)l.push(...C);else if(c.operator===ue.AND)return[]}return l},n=this._myIndex.records,a={},i=[];return n.forEach(({$:c,i:u})=>{if(I(c)){let d=r(s,c,u);d.length&&(a[u]||(a[u]={idx:u,item:c,matches:[]},i.push(a[u])),d.forEach(({matches:l})=>{a[u].matches.push(...l)}))}}),i}_searchObjectList(e){const s=je(e,this.options),{keys:r,records:n}=this._myIndex,a=[];return n.forEach(({$:i,i:c})=>{if(!I(i))return;let u=[];r.forEach((d,l)=>{u.push(...this._findMatches({key:d,value:i[l],searcher:s}))}),u.length&&a.push({idx:c,item:i,matches:u})}),a}_findMatches({key:e,value:s,searcher:r}){if(!I(s))return[];let n=[];if($(s))s.forEach(({v:a,i,n:c})=>{if(!I(a))return;const{isMatch:u,score:d,indices:l}=r.searchIn(a);u&&n.push({score:d,key:e,value:a,idx:i,norm:c,indices:l})});else{const{v:a,n:i}=s,{isMatch:c,score:u,indices:d}=r.searchIn(a);c&&n.push({score:u,key:e,value:a,norm:i,indices:d})}return n}}ee.version="7.1.0";ee.createIndex=bt;ee.parseIndex=mn;ee.config=m;ee.parseQuery=kt;jn(kn);function Dn(){const{data:t}=js(),{data:e,isLoading:s}=Fs();return{environments:e??t,fullEnvironmentsLoading:s}}function Rn(){const t=D(),{environmentId:e,setEnvironmentId:s}=j(),[r,n]=v.useState(!1),a=v.useRef(null),{environments:i,fullEnvironmentsLoading:c}=Dn(),u=i?.find(l=>l.id===e);Ds("environment",r,()=>n(!1)),v.useEffect(()=>{if(!c){if(e&&!u)s(null);else if(!e&&i?.length){const l=Ae(i,[h=>!(h.is_pinned??!1),h=>-(h.task_count??0)]);s(l[0].id)}}},[c,e,u,i,s]),gt([{key:"whamEnvironments",action:()=>n(!0),actionMessageDescriptor:t.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:ht.Chat,keyboardBinding:[se.Mod,"e"]}]);const d=()=>n(!1);return c&&!i?.length?o.jsx("div",{className:"flex items-center gap-3 rounded-full",children:o.jsx(Ct,{})}):o.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[o.jsxs(ut,{open:r,onOpenChange:n,children:[o.jsx(pt,{triggerText:u?.label??t.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),toolTip:(u?.label?.length??0)>16?u?.label??"":u?.label||r?"":t.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),ariaLabel:t.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:o.jsx(xt,{"aria-hidden":!0,className:"icon-sm"})}),o.jsx(ft,{align:"start",isOpen:r,closePopover:d,popoverContentRef:a,children:o.jsx(Ln,{isLoading:c,environments:i??[],environmentId:e,setEnvironmentId:s,closePopover:d})})]}),u&&o.jsx(Rs,{environment:u})]})}function Ln({isLoading:t,environments:e,environmentId:s,setEnvironmentId:r,closePopover:n}){const a=D(),i=v.useRef(null),[c,u]=v.useState(""),d=x=>{r(x),n()},l=rt(),h=v.useMemo(()=>new ee(e,{threshold:.4,keys:["label","repos"]}),[e]),f=v.useMemo(()=>{if(!c?.trim()){const[A,N]=us(e,b=>b.is_pinned);return[...Ae(A,b=>-(b.task_count??0)),...Ae(N,b=>-(b.task_count??0))]}const x=c.trim().toLowerCase(),S=h?.search(c).map(A=>A.item)??[],R=A=>{const N=A.toLowerCase();return N===x?0:N.startsWith(x)?1:2};return S.sort((A,N)=>{if(A.is_pinned!==N.is_pinned)return A.is_pinned?-1:1;const b=R(A.label)-R(N.label);return b!==0?b:A.label.localeCompare(N.label)})},[c,h,e]),{hoveredId:p,setHoveredId:C,onKeyDown:M,getItemRef:w}=Ls({items:f,keyExtractor:x=>x.id,onSelect:d});return v.useEffect(()=>{i.current?.focus()},[]),o.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[e.length>4&&o.jsxs("div",{className:"contents",onClick:x=>{x.stopPropagation()},children:[o.jsx(zt,{ref:i,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:c,onChange:x=>u(x.target.value),onKeyDown:M,suppressFocus:!0,placeholder:a.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip",defaultMessage:"Search environmentsâ€¦"}),ariaLabel:a.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria",defaultMessage:"Search environments"})}),o.jsx("div",{className:"bg-token-border-default h-px w-full"})]}),o.jsx("div",{className:"flex flex-col overflow-y-auto p-1.5",children:t?o.jsx("div",{className:"flex w-full items-center justify-center py-2",children:o.jsx(de,{className:"ms-2"})}):e.length>0?f.length>0?f.map(x=>{const S=s===x.id;return o.jsx(Ee,{as:"button",ref:w(x),onMouseEnter:()=>C(x.id),className:"w-full",truncateLabel:!0,onClick:()=>{d(x.id)},isVirtualHover:p===x.id,isSelected:S,label:x.label},x.id)}):o.jsx("div",{className:"p-5 text-center",children:o.jsx("p",{className:"text-token-text-tertiary text-sm",children:o.jsx(F,{id:"wham.environmentPopover.noMatches",defaultMessage:"No matches found"})})}):o.jsxs("div",{className:"p-2 text-center",children:[o.jsx("p",{className:"text-token-text-primary text-sm",children:o.jsx(F,{id:"wham.environmentPopover.noEnvironments",defaultMessage:"No environments"})}),o.jsx("p",{className:"text-token-text-secondary text-xs",children:o.jsx(F,{id:"wham.environmentPopover.missingEnvironment",defaultMessage:"Codex requires an environment to work"})})]})}),o.jsx("div",{className:"bg-token-border-default h-px w-full"}),o.jsx("div",{className:"bg-token-bg-tertiary px-2 py-1.5",children:o.jsx(Ee,{className:"w-full",noDefaultHoverState:!0,onClick:()=>{l("/codex/settings/environments")},isSelected:!1,icon:o.jsx(Qt,{className:"icon-sm"}),label:a.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"})},"manage-environment")})]})}function On(){const t=D(),{isConnected:e,isLoading:s,openGithubModal:r,error:n,refetch:a}=it(ct.GITHUB_CONNECTOR,"github","/codex",we.CODEX),{enabled:i}=Xt(we.CODEX);return s?o.jsx(Ct,{className:"h-9"}):n?o.jsx(Z,{label:t.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:o.jsx(W,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:a,children:o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx(xt,{"aria-hidden":!0,className:"icon-sm"}),o.jsx(F,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):i?o.jsx(o.Fragment,{children:o.jsx("div",{className:"z-0 flex w-full justify-between",children:e?o.jsx("div",{className:"flex gap-4",children:o.jsx(Rn,{})}):o.jsx("div",{className:"flex gap-2",children:o.jsxs(W,{type:"button",color:"secondary",size:"small",onClick:r,children:[o.jsx(Ue,{"aria-hidden":!0,className:"icon-sm me-1.5"}),o.jsx(F,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):o.jsx(Z,{label:t.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:o.jsxs(W,{type:"button",color:"secondary",onClick:r,disabled:!0,children:[o.jsx(Ue,{"aria-hidden":!0,className:"icon-sm me-1.5"}),o.jsx(F,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function Pn(){const t=D(),e=rt(),{setupMfa:s}=Ps({redirectUrl:"/codex"});return o.jsx(qt,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:o.jsxs("div",{className:"flex w-full justify-end gap-2",children:[o.jsx(W,{color:"secondary",onClick:()=>{e("/")},children:o.jsx(F,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),o.jsx(W,{color:"primary",onClick:()=>{s()},children:o.jsx(F,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}const Wn=t=>v.createElement("svg",{width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 4.5C5.68355 4.5 5.84354 4.62492 5.88806 4.80299C6.08089 5.57434 6.30775 6.04206 6.63284 6.36716C6.95794 6.69225 7.42566 6.91911 8.19701 7.11194C8.37508 7.15646 8.5 7.31645 8.5 7.5C8.5 7.68355 8.37508 7.84354 8.19701 7.88806C7.42566 8.08089 6.95794 8.30775 6.63284 8.63284C6.30775 8.95794 6.08089 9.42566 5.88806 10.197C5.84354 10.3751 5.68355 10.5 5.5 10.5C5.31645 10.5 5.15646 10.3751 5.11194 10.197C4.91911 9.42566 4.69225 8.95794 4.36716 8.63284C4.04206 8.30775 3.57434 8.08089 2.80299 7.88806C2.62492 7.84354 2.5 7.68355 2.5 7.5C2.5 7.31645 2.62492 7.15646 2.80299 7.11194C3.57434 6.91911 4.04206 6.69225 4.36716 6.36716C4.69225 6.04206 4.91911 5.57434 5.11194 4.80299C5.15646 4.62492 5.31645 4.5 5.5 4.5Z",fill:"currentColor"}),v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.5 2.5C12.6835 2.5 12.8435 2.62492 12.8881 2.80299C13.0809 3.57434 13.3077 4.04206 13.6328 4.36716C13.9579 4.69225 14.4257 4.91911 15.197 5.11194C15.3751 5.15646 15.5 5.31645 15.5 5.5C15.5 5.68355 15.3751 5.84354 15.197 5.88806C14.4257 6.08089 13.9579 6.30775 13.6328 6.63284C13.3077 6.95794 13.0809 7.42566 12.8881 8.19701C12.8435 8.37508 12.6835 8.5 12.5 8.5C12.3165 8.5 12.1565 8.37508 12.1119 8.19701C11.9191 7.42566 11.6923 6.95794 11.3672 6.63284C11.0421 6.30775 10.5743 6.08089 9.80299 5.88806C9.62492 5.84354 9.5 5.68355 9.5 5.5C9.5 5.31645 9.62492 5.15646 9.80299 5.11194C10.5743 4.91911 11.0421 4.69225 11.3672 4.36716C11.6923 4.04206 11.9191 3.57434 12.1119 2.80299C12.1565 2.62492 12.3165 2.5 12.5 2.5Z",fill:"currentColor"}),v.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5 9.5C10.6835 9.5 10.8435 9.62492 10.8881 9.80299C11.0809 10.5743 11.3077 11.0421 11.6328 11.3672C11.9579 11.6923 12.4257 11.9191 13.197 12.1119C13.3751 12.1565 13.5 12.3165 13.5 12.5C13.5 12.6835 13.3751 12.8435 13.197 12.8881C12.4257 13.0809 11.9579 13.3077 11.6328 13.6328C11.3077 13.9579 11.0809 14.4257 10.8881 15.197C10.8435 15.3751 10.6835 15.5 10.5 15.5C10.3165 15.5 10.1565 15.3751 10.1119 15.197C9.91911 14.4257 9.69225 13.9579 9.36716 13.6328C9.04206 13.3077 8.57434 13.0809 7.80299 12.8881C7.62492 12.8435 7.5 12.6835 7.5 12.5C7.5 12.3165 7.62492 12.1565 7.80299 12.1119C8.57434 11.9191 9.04206 11.6923 9.36716 11.3672C9.69225 11.0421 9.91911 10.5743 10.1119 9.80299C10.1565 9.62492 10.3165 9.5 10.5 9.5Z",fill:"currentColor"})),$n=Ut(()=>Yt(()=>import("./iv14ii8okf6yz304.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36])).then(t=>t.SpeculativeTaskContentModal));function Hn({taskId:t,index:e,assistantTurn:s,suggestion:r,disabledReason:n,loading:a}){const i=s.output_items.find(c=>c.type==="pr")?.output_diff;return o.jsx(Z,{side:"right",sideOffset:10,label:n,children:o.jsxs("div",{className:"flex w-full items-center gap-1.5 rounded-lg px-2 py-1",children:[o.jsx("span",{className:"self-start pt-[0.125rem]",children:a?o.jsx(de,{className:"text-token-text-tertiary icon-sm"}):o.jsx(Wn,{className:"text-token-text-tertiary icon-sm"})}),o.jsx("span",{className:"text-token-text-primary line-clamp-2 flex-1 text-start text-sm leading-snug break-words",children:r.title}),i&&i.lines_added!=null&&i.lines_removed!=null&&o.jsx(Bs,{className:"text-sm",linesAdded:i.lines_added,linesRemoved:i.lines_removed}),o.jsx(Gn,{taskId:t,assistantTurn:s,suggestion:r,index:e})]})})}function Gn({taskId:t,assistantTurn:e,suggestion:s,index:r}){const[n,a]=v.useState(!1);return o.jsxs("div",{onClick:i=>{i.stopPropagation(),i.preventDefault()},children:[o.jsx(W,{color:"secondary",size:"small",icon:ds,onClick:i=>{i.stopPropagation(),i.preventDefault(),a(!0)},children:o.jsx(F,{id:"wham.speculativeFollowUpSuggestionRow.preview",defaultMessage:"Preview"})}),o.jsx($n,{taskId:t,suggestion:s,index:r,assistantTurn:e,isOpen:n,onClose:()=>a(!1)})]})}function Kn({taskId:t,turnId:e,followUpSuggestions:s,hasComments:r,isSubmitting:n,onSuggestionClick:a,children:i}){const c=Vn(),u=D(),[d,l]=v.useState(null),{data:h}=zn({taskId:t,turnId:e}),f=_e({isFollowUp:!0,hasComments:r});let p=Te(f);f==="no-content"&&(p=void 0);const C=!!h?.length&&t&&e;return v.useEffect(()=>{C&&K.recordFollowUpsSeen(t,e,s.length)},[C,t,e,s.length]),C?o.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[o.jsx(ot,{initial:!1,children:c==="visible"&&o.jsx("div",{className:"flex flex-col",inert:n,children:h.map(({suggested_task:M,assistant_turn:w},x)=>o.jsx(Hn,{index:x,taskId:t,turnId:e,assistantTurn:w,suggestion:M,disabledReason:p,loading:d===x&&n,onClick:()=>{n||(l(x),a(M))}},x))})}),c==="collapsed"&&o.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":u.formatMessage({id:"wham.speculativeFollowUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{K.recordFollowUpsExpanded(t,e)},children:[o.jsx(mt,{className:"icon-sm"}),o.jsx(F,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),i({isWrappedByContainer:!0})]}):i({isWrappedByContainer:!1})}function Vn(){const t=he(),{isExpanded:e}=Ne(t.store);return e?"collapsed":"visible"}function zn({taskId:t,turnId:e}){return Pt({queryKey:["wham","speculative-turns",t,e],queryFn:async()=>{const s=await Zt.safeGet("/wham/tasks/{task_id}/speculative_turns/{turn_id}",{parameters:{path:{task_id:t,turn_id:e}}}),r=s.speculative_turns;return Ws(r,a=>a.assistant_turn.turn_status==="completed")?s.speculative_turns.filter(a=>!a.assistant_turn.discarded):[]},refetchInterval:s=>s&&s.state?.data?.some(n=>n.assistant_turn.turn_status==="pending"||n.assistant_turn.turn_status==="in_progress")?3e4:!1})}function Qn({taskId:t,turnId:e,followUpSuggestions:s,hasComments:r,isSubmitting:n,onSuggestionClick:a,children:i}){const c=J(),u=qn(),d=D(),[l,h]=v.useState(null),f=_e({isFollowUp:!0,hasComments:r});let p=Te(f);f==="no-content"&&(p=void 0);const C=!(u==="hidden"||!s.length)&&t&&e;if(v.useEffect(()=>{C&&K.recordFollowUpsSeen(t,e,s.length)},[C,t,e,s.length]),C){if(Y(c,"2007094101")&&s.find(M=>!!M.assistantTurnId))return o.jsx(Kn,{taskId:t,turnId:e,followUpSuggestions:s,hasComments:r,isSubmitting:n,onSuggestionClick:a,children:({isWrappedByContainer:M})=>i({isWrappedByContainer:M})})}else return i({isWrappedByContainer:!1});return o.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[o.jsx(ot,{initial:!1,children:u==="visible"&&o.jsx("div",{className:"flex flex-col",inert:n,children:s.map((M,w)=>o.jsx(Xn,{index:w,taskId:t,turnId:e,suggestion:M.suggestion,disabledReason:p,loading:l===w&&n,onClick:()=>{n||(h(w),a(M.suggestion))}},w))})}),u==="collapsed"&&o.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":d.formatMessage({id:"wham.followUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{K.recordFollowUpsExpanded(t,e)},children:[o.jsx(mt,{className:"icon-sm"}),o.jsx(F,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),i({isWrappedByContainer:!0})]})}function Xn({taskId:t,turnId:e,index:s,suggestion:r,disabledReason:n,loading:a,onClick:i}){return o.jsx(Z,{side:"right",sideOffset:10,label:n,children:o.jsxs("button",{type:"button",disabled:!!n||a,className:"group hover:bg-token-bg-secondary focus:bg-token-bg-secondary -disabled:cursor-pointer flex w-full items-start gap-1.5 rounded-lg px-2 py-1 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{i(),K.recordFollowUpsClicked(t,e,s,r.severity)},children:[o.jsx("span",{className:"pt-[0.125rem]",children:a?o.jsx(de,{className:"text-token-text-tertiary icon-sm"}):o.jsx(dt,{className:"text-token-text-tertiary icon-sm"})}),o.jsx("span",{className:"text-token-text-primary line-clamp-2 text-start text-sm leading-snug break-words",children:r.title})]})})}function qn(){const t=J(),e=Y(t,"3485296344")||void 0,s=he(),{isExpanded:r}=Ne(s.store);return e?r?"collapsed":"visible":"hidden"}function Un(){const t=J(),e=j(r=>r.bestOfN);return e??Jt(t,"2398649844").get("default_attempts",1)}function ir({disableAutoFocus:t=!1,isBigBoxMode:e=!1,disableDuringSubmit:s=!1,expanded:r,followUp:n,onClearComments:a,onSubmit:i,onSuccess:c,attemptIndex:u,ariaLabel:d}){const l=D(),h=at(),{refetch:f}=Ns(),{refetch:p}=Ts(n?.taskId),{refetch:C}=_s(n?.taskId),M=j(({environmentId:g})=>g),w=j(({branch:g})=>g),x=j(({addTurnToTaskMap:g})=>g),[S,R]=v.useState(!0),[A,N]=v.useState(!1),b=es(),k=ze(g=>g.files),L=ze(ve.hasUploadInProgress),O=Un(),ne=j(g=>g.setBestOfN),[te,H]=v.useState(1),re=n?te:O,T=n?H:ne,G=J(),Q=Y(G,"3492040717"),jt=Y(G,"879591222")||void 0,De=Y(G,"3536244140"),me=$s(),[Ft,Re]=v.useState(!1),_=he(),{whisperControls:Bt,waveContainerRef:Nt}=hs({composerController:_,composerType:"codex"}),{controlsDisabled:fe,waveformData:Le,waveWidth:Tt,isExpanded:ge}=Ne(_.store),Oe=v.useRef(null),Pe=j(g=>g.getRateLimit()?.remaining===0),X=Pe&&!!n,_t=s&&A||X,oe=!!n&&(n.comments.length??0)>0;function It(g){for(const E of g)ae.uploadFile(b,ns(E),E,rs.Multimodal,[E.type],l,h)}function Dt(g){const E=g.target.files;E&&(It(E),g.target.value="")}function Rt(){return ve.getReadyFiles(b.getState()).flatMap(g=>{const E=g.fileSpec;return E&&"width"in E&&"height"in E&&g.fileId?[{content_type:ss.ImageAssetPointer,asset_pointer:ts(g.fileId),size_bytes:E.size,width:E.width,height:E.height}]:[]})}gt([{key:"focusComposer",action:()=>_.focus(),actionMessageDescriptor:l.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),group:ht.Chat,keyboardBinding:[se.Shift,se.Escape],altKeyboardBindings:n?void 0:[[se.Mod,se.Shift,"o"]]}]);const We=_e({isFollowUp:!!n,hasComments:oe}),$e=Te(We),pe=!!$e||A&&s||L,{mutate:q,isPending:He}=nt({mutationFn:async({runEnvironmentInQaMode:g,promptOverride:E}={runEnvironmentInQaMode:!1})=>{const U=E??_.getContentToSend().content,Ke=ve.getReadyFiles(b.getState());if(!(!!U.length||oe))throw new Error("No content to submit");const Ve=me?Rt():[];if(i?.(),ae.reset(b),N(!0),n)return await be.createFollowUpTask(n.taskId,n.turnId,U,n.comments,g,Q?re:void 0,Ve).catch(y=>{throw E||(_.setText(U),ae.restoreFiles(b,Ke)),y instanceof ie&&y.status===429?h.danger(l.formatMessage(st.rateLimit),{id:n.turnId,duration:5,hasCloseButton:!0}):y instanceof Xe?qe(y,n.turnId,l,h):y instanceof ie&&y.status===403&&y.detail?.toLowerCase().includes("multi-factor authentication")?Re(!0):h.danger(l.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:n.turnId,duration:5,hasCloseButton:!0}),y});{if(w){if(!M)throw new Error("Environment is required for new tasks.")}else throw new Error("Branch is required");R(!1);const y=crypto.randomUUID();return j.getState().addPendingTaskId(y),be.createNewTask(M,w,U,g,Q?re:void 0,Ve).catch(B=>{throw j.getState().removePendingTaskId(y),E||(_.getContentToSend().content.length?(h.danger(l.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:y,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(U)):(_.setText(U),ae.restoreFiles(b,Ke))),B}).catch(B=>{throw B instanceof ie&&B.status===429?h.danger(l.formatMessage(st.rateLimit),{id:y,duration:5,hasCloseButton:!0}):B instanceof Xe?qe(B,y,l,h):B instanceof ie&&B.status===403&&B.detail?.toLowerCase().includes("multi-factor authentication")?Re(!0):h.danger(l.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:y,duration:5,hasCloseButton:!0}),B}).then(B=>(j.getState().assignPendingTaskToFinalTask(y,B.task.id),j.getState().setRateLimit(B.rate_limit),B))}},onSuccess:g=>{x(g.task.id,g.turn),g.user_turn&&x(g.task.id,g.user_turn),c?.(g),setTimeout(()=>{_.focus()},0),p(),f(),n&&C()},onSettled:()=>{N(!1)}});v.useEffect(()=>{if(!pe)return _.subscribe("keydown",g=>{g.metaKey&&g.key==="Enter"?q({runEnvironmentInQaMode:!1}):g.altKey&&g.key==="Enter"&&q({runEnvironmentInQaMode:!0})})},[_,q,pe]);const Ge=Os(n?[n.turnStatus,...n.siblingTurnStatuses]:[],g=>g==="pending"||g==="in_progress"?1:0),xe=!!n&&jt&&Ge>0;let Ce;De?Ce=!fe&&We!=="no-content"&&!xe:Ce=!xe;const Lt=(n?.siblingTurnStatuses?.length??0)>1&&u?l.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:u}):l.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"});return o.jsx(Qn,{taskId:n?.taskId,turnId:n?.turnId,followUpSuggestions:n?.followUpSuggestions??[],hasComments:oe,isSubmitting:A,onSuggestionClick:g=>{q({runEnvironmentInQaMode:!1,promptOverride:g.body})},children:({isWrappedByContainer:g})=>o.jsxs("div",{className:"contents",inert:_t,children:[o.jsxs(ms,{expanded:X?!1:r,canCollapseWithInput:!He&&g,isTemporaryChat:!1,shouldUseTightRadius:g,onSubmit:()=>{He||q({runEnvironmentInQaMode:!1})},composerController:_,ariaLabel:d??l.formatMessage({id:"wham.whamComposer.ariaLabel",defaultMessage:"Codex composer"}),children:[o.jsx(fs,{children:o.jsx(gs,{composerController:_,enabled:e&&!X&&ge,children:fe?Le?o.jsx("div",{className:"max-w-full min-w-0 flex-1",ref:Nt,children:o.jsx(ps,{className:lt("h-14",e&&!X&&ge?"mt-12":void 0),waveform:Le,containerWidth:Tt,scaleFactor:10,initialValue:xs})}):null:o.jsx(Cs,{composerController:_,disableAutoFocus:t||Pe,textareaMaxHeightClassName:n?"max-h-[max(10rem,min(calc(100dvh-29rem),10rem))]":"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]",placeholder:n?Lt:S?l.formatMessage({id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"}):l.formatMessage({id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"})})})}),me&&k.length>0&&o.jsx(Qe,{children:o.jsx(vs,{files:k,selectedApps:[],activeSystemHintType:void 0,disableEditButton:!0,forceSmallView:!0,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),me&&o.jsx(Ms,{children:o.jsxs(o.Fragment,{children:[o.jsx("input",{ref:Oe,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:Dt}),o.jsx("button",{type:"button",className:"composer-btn","aria-label":l.formatMessage({id:"wham.whamComposer.attachImage",defaultMessage:"Attach image"}),onClick:()=>Oe.current?.click(),children:o.jsx(ws,{className:"icon"})})]})}),oe&&o.jsx(Qe,{children:o.jsx(Xs,{comments:n.comments,onClearComments:a})}),!fe&&o.jsx(As,{children:o.jsxs("div",{className:"flex gap-2",children:[!n&&o.jsx(On,{}),Q&&o.jsx(zs,{attempts:re,setAttempts:T})]})}),o.jsxs(bs,{children:[ge&&!X&&o.jsxs(o.Fragment,{children:[De&&o.jsx("div",{inert:A,children:Bt}),Ce&&o.jsx(Gs,{isSubmitDisabled:pe,createTask:q,disabledReason:$e}),xe&&o.jsx(Hs,{taskId:n.taskId,hasMultipleInProgressOrStreamingTurns:Ge>1})]}),X&&o.jsx(Is,{})]})]}),Ft&&o.jsx(Pn,{})]})})}const st=Wt({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Codex is busy right now. Please try again later."}});export{xt as S,ir as W,$s as u};
//# sourceMappingURL=ii534sx9kl9dq5ip.js.map
