import{r as C,b as ht,j as a,m as k,A as H,as as Ft}from"./gg0tb34p9fzo1omt.js";import{hH as zt,nI as Wt,lz as N,bo as Ct,lA as I,pF as at,pG as gt,R as $t,I as Zt,i3 as qt,i4 as Jt,i6 as Qt,i7 as te,d as ee,lV as oe}from"./forbprkns1cohsbl.js";import{j as D,C as w,h as ne,f as j,k as Et,q as se,S as xt,r as re,s as bt,E as ie,t as ae}from"./jh4r0k3f3n3zptua.js";import{C as ct}from"./ejkv34dzwipa230i.js";import{T as vt,Z as Y}from"./jy1u8exw8iz2slve.js";import{u as U,i as $,a as ce}from"./e6r7gqenbe47ga9h.js";import{aG as z,mE as le,bU as M,j2 as ue,f8 as de,ic as yt,f9 as ot,gm as fe,d3 as Z,c_ as Tt,c$ as me,ek as pe,d2 as he,d5 as St,d6 as Ce,c2 as Lt}from"./g670b8vtkhx0yc6d.js";import{p as At,q as Ot,a as ge}from"./bfgn782syyllzt4r.js";import{P as Ee,H as xe}from"./j0nw4kv698ot3br0.js";import{E as tt,j as be,G as P,c as lt}from"./gffsn29yylc5pncm.js";import{u as q}from"./go2lz3yja1ixfdzl.js";import{i as ve}from"./eiffxi5640gvsu4t.js";var _=(t=>(t[t.up=-1]="up",t[t.down=1]="down",t))(_||{}),W=(t=>(t.COMMENT="comment",t.COMPOSER="composer",t))(W||{}),L=(t=>(t.COLLAPSED="collapsed",t.EXPANDED="expanded",t))(L||{});const Nt=([t,e],[o,s])=>{const n=t+e,r=o+s;return t<r&&o<n},nt=([t,e])=>t+e,R=t=>{if(t.type===L.COLLAPSED)return[t.offsetY??0,0];const{offsetY:e,shiftY:o=0,height:s=0}=t,n=e+o;return o<0?[n,s+Math.abs(o)]:[n,s]},ye=(t,e,o)=>{if(!Nt(t,e))return null;const[s,n]=t,r=s+n,[i,c]=e,l=i+c,u=i-r,d=l-s;return o===_.up?u:d};var Pt=(t=>(t.ABOVE="above",t.BELOW="below",t))(Pt||{});function V(t,e){return z(t.coordsAtPos(e))}const ut=360,Te=250,wt=44,Se=.5,Le=[.5,.9,1],Ae=[1,.75,.2],Oe=({onClose:t,onSubmit:e,opensOverDocument:o=!1,opensFromGutter:s=!1,gutterHasComments:n=!1},r)=>{const i=ht(),c=C.useRef(null),l=C.useRef(!1),[u,d]=C.useState(""),[f,m]=C.useState(!0),p=()=>{document.hasFocus()&&(d(""),t?.(l.current))},h=(b,v=u)=>{l.current=!0,e?.(b,v),d("")},E=le(({windowWidth:b})=>o?b<ut+100?Te:ut:tt,0),g={};s&&(g.top=-12),o&&s?g.right=0:g.left=0;let x="";s&&!o?x="8px 50%":s&&o?x="calc(100% + 8px) 50%":o&&(x="center left");let T=0;s&&!o&&n&&(T=be);const S=b=>{const{metaKey:v,shiftKey:A,key:X}=b;X==="Enter"&&!b.nativeEvent.isComposing&&u&&!(A||v)?(h(b),b.preventDefault()):X==="Escape"&&(d(""),t?.(!1))},y=i.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return a.jsx(k.div,{ref:zt(c,r),className:M("absolute flex items-center",Y.commentComposer),style:{...g,minHeight:wt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:T},exit:{translateX:0},children:a.jsx(k.div,{className:M("no-scrollbar border-token-border-default relative z-10 flex items-center overflow-x-hidden border",vt,{"rounded-full":f,"rounded-2xl":!f}),initial:{width:o?tt:24,scale:o?void 0:Se},animate:{width:E,scale:o?void 0:Le},exit:{filter:"blur(16px)",scale:o?void 0:Ae,width:o?tt:24,opacity:o?0:[1,1,0]},transition:{type:"spring",bounce:o?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:x},children:a.jsxs(k.div,{className:"bg-token-main-surface-primary relative z-0 flex w-full items-center px-4 py-2.5",children:[a.jsx(k.div,{className:"absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl backdrop-saturate-25 dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),a.jsx(ve,{"aria-placeholder":y,value:u,className:"text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent px-1 py-0 pe-2 outline-0 focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:p,onHeightChange:(b,{rowHeight:v})=>{m(Math.floor(b/v)<=1)},onChange:({target:{value:b}})=>d(b),onKeyDown:S}),!u&&a.jsx("span",{"aria-hidden":!0,className:"text-token-text-secondary absolute inline-block ps-1 text-nowrap",children:y}),a.jsx(k.button,{className:M("-me-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:b=>h(b),children:a.jsx(Wt,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},Mt=C.forwardRef(Oe),Ne=(t,e)=>{if(e?.type!==D.SELECTION)return null;try{const{from:o,to:s}=e,{top:n}=t.dom.getBoundingClientRect(),{bottom:r,top:i}=V(t,o),{bottom:c}=V(t,s),l=$(t)?-30:-24;let u=r-n+l;const d=i-n;return u=c-n+8,{composerTop:u,loadingTop:d}}catch(o){return N.logError("Invalid position in SelectionCommentComposer",o),null}},Pe=({toolbarPosition:t,composerRect:e,view:o})=>{const{width:s}=e;let{height:n}=e;if(n||=wt,o==null||t==null)return null;const{right:r,left:i}=o.dom.getBoundingClientRect(),{left:c,top:l,aboveOrBelow:u,toolbarSize:d}=t,f=l-(u===Pt.ABOVE&&n!==0?n-d.height:0),m=ce(o)?12:0;return{left:Math.min(c,r-i-s-m),composerTop:f,aboveOrBelow:u}},we=({toolbarPosition:t,commentingOn:e,isWaitingForCommentResponse:o=!1,onAddComment:s})=>{const n=U()(),[r,i]=q(),c=Pe({view:n,toolbarPosition:t,composerRect:r});if(n==null||c==null)return null;const{left:l,composerTop:u}=c,d=(f,m)=>{if(e?.type!==D.SELECTION)return;const{action:p,sourceRange:h}=e;s?.(f,m,p,h,e.type)};return a.jsx(H,{children:e?.type===D.SELECTION&&!o&&a.jsx("div",{className:M("absolute",Y.commentComposer),style:{left:l,top:u},children:a.jsx(Mt,{opensOverDocument:!0,onClose:f=>{f||(w.cancelCommentingOn(),n&&$(n)&&!n.state.selection.empty&&n.dispatch(n.state.tr.setSelection(new ue(n.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:d,ref:i})},"composer")})};function Me(t,e,o){const s=t+e;for(const n of o.values()){const r=n.start,i=n.end;if(t<i&&r<s)return!0}return!1}const ke=50,je=200,_e=[Ee.proseMirrorNodeName(),xe.proseMirrorNodeName()],De=t=>t?t.isBlock:!1,Be=t=>{if(!t)return!1;const{isBlock:e,type:{name:o}}=t;return e&&_e.includes(o)},Ie=(t,e,o,s)=>{const n=t.posAtCoords({left:e,top:o});if(n==null)return;const{pos:r,inside:i}=n;if(i===-1)return;const{state:c}=t;let l=r,u=c.doc.nodeAt(l);for(;!De(u)&&l>=0;)l--,u=c.doc.nodeAt(l);if(!u||!Be(u))return;const d=s!=null&&Me(l,u.nodeSize,s);return{node:u,nodeHasComment:d,pos:l}};function Re(t,e,o){const s=Ie(t,e.x,e.y,o);if(s==null)return null;const{node:n,pos:r,nodeHasComment:i}=s,{top:c}=t.coordsAtPos(0);function l(){const p=r+1;return ge(t.state.doc,p)&&t.state.doc.nodeAt(p)?.isText?t.coordsAtPos(p).top:t.coordsAtPos(r).top}const u=l(),d=u-c;return{height:t.coordsAtPos(r+n.nodeSize-1).bottom-u,nodeHasComment:i,mouseEnteredAt:Date.now(),yOffset:d,pos:r}}function He(t){const e=C.useRef(!1),o=C.useRef(!1),[s,n]=C.useState(null),r=ne(),i=r()?.dom,c=C.useRef(!1),l=j(({visibleBlockCommentLauncher_DEBUG_ONLY:f})=>f),u=C.useCallback(Ct(f=>{e.current=!0;const{commentingOn:m}=j.getState();if(o.current||m!=null)return;const p=r();if(p==null||!e.current)return n(null);const{dom:h,state:E}=p,g=At(Ot,E)?.positions;if(g==null)return n(null);const x=Re(p,f,g);if(x==null||x.nodeHasComment&&t===P.COLLAPSED){n(null);return}if(c.current&&x.yOffset!==s?.yOffset){n(null);return}const T=p.coordsAtPos(0),S=h.getBoundingClientRect().width,b=(f.x-T.left)/S>=ke/100;n(b?x:null)},je),[r,c,s]);C.useEffect(()=>{if(i!=null)return de(i,{mouseenter:()=>{e.current=!0,o.current=!1},mouseleave:({relatedTarget:f})=>{if(u.cancel(),f instanceof HTMLElement&&f.closest("[data-block-comment-launcher]")){o.current=!0;return}o.current=!1,e.current=!1,j.getState().commentingOn==null&&n(null)},mousemove:u})},[r,i,t,u]);const d=C.useCallback(({relatedTarget:f})=>{const{commentingOn:m}=j.getState();m==null&&f!==i&&(o.current=!1,n(null))},[i]);return{visibleBlockComment:l??s,handleMouseLeave:d,onComposerVisibleChange:f=>{c.current=f}}}const Ye=({isWaitingForCommentResponse:t=!1,opensOverDocument:e=!1,hasComments:o=!1,activeBlockComment:s,composerRef:n,onLaunchComposer:r,onMouseLeave:i,onSubmit:c})=>{const[l,u]=C.useState(!1),{yOffset:d,height:f,pos:m}=s,p=()=>{u(!0),r?.(),N.logButtonClick(I.BLOCK_COMMENT_LAUNCHER),w.startCommentingOn({type:D.BLOCK,pos:m})},h=x=>{x||(u(!1),w.cancelCommentingOn())},E=(x,T)=>{u(!1),c?.(x,T)};C.useEffect(()=>()=>{w.mouseLeaveBlock()},[]);const g=o&&l?e?-88:88:0;return a.jsx(k.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",Y.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:f,translateY:d},onMouseLeave:i,"data-block-comment-launcher":!0,children:a.jsxs(H,{children:[l?a.jsx(Mt,{ref:n,opensFromGutter:!0,onClose:h,onSubmit:E,gutterHasComments:o,opensOverDocument:e},"composer"):null,a.jsx(k.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:g},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-right-4 after:-left-1 after:content-['']",onClick:p,onMouseEnter:()=>w.mouseEnterBlock(m),onMouseLeave:()=>w.mouseLeaveBlock(),disabled:l||t,children:a.jsx(se,{isLoading:t})},"launcer")]})})},Ge=({isWaitingForCommentResponse:t=!1,isRequestActive:e=!1,hasComments:o=!1,composerRef:s,gutterMode:n,onAddComment:r})=>{const i=Et(),{visibleBlockComment:c,handleMouseLeave:l,onComposerVisibleChange:u}=He(n),d=(f,m)=>{if(!c||!i)return;const{doc:p}=i,{pos:h}=c,E=p.nodeAt(h);if(!E)return;const{attrs:{start:g,end:x}}=E;r?.(f,m,xt.ASK,{start:g,end:x},D.BLOCK)};return a.jsx(H,{onExitComplete:()=>u(!1),children:c&&i&&(t||!e)&&a.jsx(Ye,{composerRef:s,isWaitingForCommentResponse:t,opensOverDocument:n===P.COLLAPSED,activeBlockComment:c,hasComments:o,onSubmit:d,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},Ve=({onAcceptComment:t,onDismissComment:e,disableActions:o=!1,entry:s,isGutterCollapsed:n=!1,isHovered:r=!1,isFocused:i=!1,isSomeCommentFocused:c=!1})=>{const{offsetY:l,type:u}=s,[d,f]=Ft();let m=null;if(u===L.COLLAPSED)m=!i&&a.jsx(re,{offsetY:l,count:s.count,onClick:()=>{N.logButtonClick(I.COLLAPSED_COMMENT),w.focusComment(s.children[0])}},"collapsed");else{const{comment:p}=s;if(p==null||p.content===""||p.status===at.DISMISSED)m=null;else if(p.status===at.ACCEPT_INITIATED)m=a.jsx("div",{className:"absolute",style:{top:l},children:a.jsx(bt,{})},"loading");else{const{id:h}=p;m=a.jsx(ie,{isSomeCommentFocused:c,isHovered:r,isFocused:i,offsetY:l,disableActions:o,onClick:()=>{N.logButtonClick(I.EXPANDED_COMMENT),w.focusComment(h)},onMouseEnter:()=>w.mouseEnterComment(h),onMouseLeave:()=>w.mouseLeaveComment(),comment:p,onAccept:E=>{N.logButtonClick(I.COMMENT_ACCEPT,{commentId:h}),t?.(E,h)},onDismiss:()=>{N.logButtonClick(I.COMMENT_DISMISS,{commentId:h}),e?.(h)},opensOverDocument:n},"expanded")}}return a.jsx(H,{onExitComplete:()=>f?.(),children:d&&m})},dt=({onMeasureHeight:t,comment:e,isFocused:o=!1})=>{const[{height:s},n]=q();return yt(()=>{t?.(s)},[s]),a.jsx(ae,{ref:n,comment:e,isFocused:o,disableAnimations:!0})},Ue=({comments:t,onMeasure:e,getStableCommentId:o})=>{const s=C.useRef(new Map),n=C.useRef(new Map),r=C.useRef(null),i=(c,l,u=!1)=>{l&&(u?n.current.set(o(c),l):s.current.set(o(c),l),r.current&&cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{e?.({focusedHeights:new Map(n.current),heights:new Map(s.current)}),r.current=null}))};return t?.length?a.jsxs("div",{className:"pointer-events-none invisible fixed start-0 top-0 overflow-clip","aria-hidden":"true",children:[t.map(c=>a.jsx(dt,{comment:c,onMeasureHeight:l=>i(c.id,l)},o(c.id))),t.map(c=>a.jsx(dt,{isFocused:!0,comment:c,onMeasureHeight:l=>i(c.id,l,!0)},`${o(c.id)}-focused`))]}):null},ft=(t,e,o)=>{let s=o+e;for(;e===_.down?s<t.length:s>-1;){const n=t[s],r=t[s-e],i=ye(R(n),R(r),e);if(i!=null&&n.type!==L.COLLAPSED)n.shiftY+=i;else break;s+=e}},mt=(t,e)=>{for(const o of e){const{index:s,amount:n}=o,r=t[s];r.type===L.EXPANDED&&(r.shiftY+=n),ft(t,_.down,s),ft(t,_.up,s);for(const i of t)i.type!==L.COLLAPSED&&(i.offsetY+=i.shiftY,i.shiftY=0)}},Xe=(t,e)=>{const o=[],[s,n]=e,r=s+n;for(let i=0;i<t.length;i++){const c=t[i],[l]=R(c),u=[l,c.type===L.EXPANDED?c.height:0],[d,f]=u;if(Nt(u,e)){const m=d+f,p=s-m,h=r-d,g=(Math.abs(p)<Math.abs(h)?_.up:_.down)===_.up?p:h;o.push({index:i,amount:g})}}return o},Ke=({gutterMode:t,focusedCommentId:e,gutterPositions:o,getCommentKey:s,getComment:n})=>{if(!o?.size)return[];const r=new Map,i=[];let c=null,l=-1;for(const d of o.values()){if(d.type===W.COMPOSER){c=[d.offsetY,d.height];continue}const{commentId:f,height:m,collapsedOffsetY:p,offsetY:h}=d;if(t===P.EXPANDED){const x=ot(i),T=x?nt(R(x)):0;let S=h;x&&S<=T&&(S=T),r.set(f,{originalOffsetY:h,offsetY:S}),e===f&&(l=i.length),i.push({key:s(f),comment:n(f),type:L.EXPANDED,height:m,offsetY:S,shiftY:0});continue}let E=i.findIndex(({offsetY:x,type:T})=>T===L.COLLAPSED&&x===p),g=i[E]??null;if(!g)g={key:i.length,type:L.COLLAPSED,offsetY:h,count:1,children:[f]},E=i.length,i.push(g);else{if(g.type!==L.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");g.count+=1,g.children.push(f),g.offsetY=p}e===f&&(l=E)}const u=i[l];if(t===P.COLLAPSED&&u?.type===L.COLLAPSED){const d=[];for(let f=0;f<u.children.length;f++){const m=u.children[f];m===e&&(l+=f+1);const p=ot(d),h=p?nt(R(p)):0,E=o.get(m)?.offsetY??0,g=Math.max(h,E);r.set(m,{originalOffsetY:E,offsetY:g}),d.push({type:L.EXPANDED,key:s(m),comment:n(m),offsetY:g,height:o.get(m)?.height??0,shiftY:0})}i.splice(l,0,...d)}if(e){const d=r.get(e);if(!d)return i;const{offsetY:f,originalOffsetY:m}=d,p=m-f,h=[{amount:p,index:l}];let E=l+1;for(;E<i.length;){const g=i[E],{type:x}=g;let T=p;if(x===L.EXPANDED&&g.comment?.id){const{offsetY:S,originalOffsetY:y}=z(r.get(g.comment.id));if(S===y)break;T=Math.max(y-S,p)}else break;h.push({amount:T,index:E}),E++}h.length&&mt(i,h)}else if(t!==P.COLLAPSED&&c){const d=Xe(i,c);mt(i,d)}return i},Fe=t=>{try{return Ke(t)}catch(e){return N.logError("Generating comment gutter entries",e),[]}},ze=t=>"length"in t?t.length===0:t.nodeSize===0,et=12,We=({composerHeight:t,getCommentHeight:e,getCollapsedStartPos:o,commentingOn:s,commentPositions:n,view:r})=>{if(!n||!r||ze(r.state.doc))return null;const{top:i}=r.dom.getBoundingClientRect(),c=Array.from(n.entries()).sort(([u,d],[f,m])=>d.start-m.start),l=new Map;for(const[u,{start:d}]of c)try{const f=o?.(d)??d,{top:m}=V(r,f),{top:p}=V(r,d),h=p-i,E=m-i,g=(e(u)??0)+et;l.set(u,{commentId:u,height:g,collapsedOffsetY:E,offsetY:h,type:W.COMMENT})}catch{continue}if(s?.type===D.BLOCK){const{pos:u}=s;try{const{top:d}=V(r,u),m=d-i-et;l.set("block-composer",{type:W.COMPOSER,height:(t??0)+et,offsetY:m})}catch{}}return l},kt=(t,e)=>e.nodeAt(t)?.isBlock?t+1:kt(t-1,e);function $e(t){const e=Et(),s=U()?.();if(!s)return null;if($(s)){if(!e)return null;const n=At(Ot,e);return n?n.positions:null}return new Map(t.map(n=>[n.id,n.at]))}const Ze=({gutterMode:t,focusedCommentId:e,commentingOn:o,comments:s,getStableId:n})=>{const[{height:r},i]=q(),c=U(),[l,u]=C.useState(()=>new Map),[d,f]=C.useState(()=>new Map),m=C.useCallback(({focusedHeights:y,heights:b})=>{u(y),f(b)},[]),p=y=>{const b=n(y);return y===e?l.get(b)??0:d.get(b)??0},h=c(),E=h!=null&&$(h)?y=>kt(y,h.state.doc):void 0,g=new Map(s?.map(y=>[n(y.id),y])),x=$e(s),T=We({composerHeight:r,commentingOn:o,getCommentHeight:p,getCollapsedStartPos:E,commentPositions:x,view:h}),S=Fe({gutterMode:t,gutterPositions:T,focusedCommentId:e,getComment:y=>g.get(n(y))??null,getCommentKey:n});return{blockComposerRef:i,onMeasureComments:m,gutterEntries:S}};function qe(){const e=U()(),o=j(({commentingOn:r})=>r),n=e==null?null:Ne(e,o);return n==null?null:a.jsx(k.div,{className:"absolute",style:{top:n.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:a.jsx(bt,{})},"selection-loading")}const Je=t=>a.jsx("div",{className:"absolute",style:{top:nt(R(t))},children:a.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),jo=({availableWidth:t,comments:e,commentsMode:o,disableBlockComments:s=!1,isRequestActive:n=!1,isWaitingForCommentResponse:r=!1,onAddComment:i,onAcceptComment:c,onDismissComment:l,getStableCommentId:u})=>{const d=j(({focusedCommentId:O})=>O),f=j(({hoveredCommentId:O})=>O),m=j(({commentingOn:O})=>O),p=fe(),h=t<lt?P.COLLAPSED:P.EXPANDED,{onMeasureComments:E,blockComposerRef:g,gutterEntries:x}=Ze({comments:e,getStableId:u,gutterMode:h,focusedCommentId:d,commentingOn:m}),T=x.length>0,S=m!=null&&!r&&m.type!=="selection"||T,b=(()=>{if(!S)return 0;switch(h){case P.COLLAPSED:return 0;case P.EXPANDED:return lt}})(),v=m?.type==="selection",A=ot(x),X=o===ct.ENABLED&&p&&!v&&!s;return a.jsxs(k.div,{className:M("pointer-events-none relative flex h-full shrink-0",Y.commentGutter,h===P.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[a.jsx(Ue,{getStableCommentId:u,comments:e,onMeasure:E}),a.jsxs("div",{className:M("pointer-events-auto absolute start-0 top-0 bottom-0 w-0 overflow-visible",{"ps-2":S||!s}),children:[a.jsx(H,{children:x.map(O=>{const{key:Ut,type:it}=O,Xt=!!d&&it===L.EXPANDED&&O.comment?.id===d,Kt=!!d&&O.type===L.COLLAPSED&&O.children.includes(d);return a.jsx(Ve,{isGutterCollapsed:h===P.COLLAPSED,isSomeCommentFocused:!!m||!!d,isHovered:it===L.EXPANDED&&O.comment?.id===f,isFocused:Xt||Kt,entry:O,disableActions:n||r||o===ct.COMMENTS_READONLY,onAcceptComment:(K,B)=>{try{c?.(K,z(e?.find(Q=>Q.id===B)))}catch(Q){N.logError(`Comment ${B} not found`,Q)}},onDismissComment:K=>{try{l?.(z(e?.find(B=>B.id===K)))}catch(B){N.logError(`Comment ${K} not found`,B)}}},Ut)})}),T&&A&&a.jsx(Je,{...A}),X&&a.jsx(Ge,{composerRef:g,gutterMode:h,onAddComment:i,isWaitingForCommentResponse:r,isRequestActive:n,hasComments:T}),r&&v&&a.jsx(qe,{})]})]})};var Qe="Separator",pt="horizontal",to=["horizontal","vertical"],jt=C.forwardRef((t,e)=>{const{decorative:o,orientation:s=pt,...n}=t,r=eo(s)?s:pt,c=o?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return a.jsx(Z.div,{"data-orientation":r,...c,...n,ref:e})});jt.displayName=Qe;function eo(t){return to.includes(t)}var oo=jt,st="Toolbar",[no,_o]=pe(st,[Tt,gt]),rt=Tt(),_t=gt(),[so,Dt]=no(st),Bt=C.forwardRef((t,e)=>{const{__scopeToolbar:o,orientation:s="horizontal",dir:n,loop:r=!0,...i}=t,c=rt(o),l=me(n);return a.jsx(so,{scope:o,orientation:s,dir:l,children:a.jsx(he,{asChild:!0,...c,orientation:s,dir:l,loop:r,children:a.jsx(Z.div,{role:"toolbar","aria-orientation":s,dir:l,...i,ref:e})})})});Bt.displayName=st;var It="ToolbarSeparator",Rt=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=Dt(It,o);return a.jsx(oo,{orientation:n.orientation==="horizontal"?"vertical":"horizontal",...s,ref:e})});Rt.displayName=It;var ro="ToolbarButton",J=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!t.disabled,children:a.jsx(Z.button,{type:"button",...s,ref:e})})});J.displayName=ro;var io="ToolbarLink",ao=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!0,children:a.jsx(Z.a,{...s,ref:e,onKeyDown:Ce(t.onKeyDown,r=>{r.key===" "&&r.currentTarget.click()})})})});ao.displayName=io;var Ht="ToolbarToggleGroup",co=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=Dt(Ht,o),r=_t(o);return a.jsx($t,{"data-orientation":n.orientation,dir:n.dir,...r,...s,ref:e,rovingFocus:!1})});co.displayName=Ht;var lo="ToolbarToggleItem",uo=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=_t(o),r={__scopeToolbar:t.__scopeToolbar};return a.jsx(J,{asChild:!0,...r,children:a.jsx(Zt,{...n,...s,ref:e})})});uo.displayName=lo;var fo=Bt,mo=Rt,po=(t=>(t.CODE="code",t.WRITING="writing",t))(po||{});const G=({children:t,toolbarType:e})=>a.jsx(fo,{className:M("border-token-border-default bg-token-main-surface-primary m-0 flex h-10 w-fit min-w-0 shrink items-center overflow-hidden rounded-full border px-2",vt,e==="code"?"py-0":"py-1"),children:t}),Yt=({icon:t,hideLabel:e,label:o})=>a.jsxs(a.Fragment,{children:[a.jsx(t,{className:M("icon-sm",{"text-token-text-tertiary me-0.5":!e,"text-token-text-primary":e})}),!e&&a.jsx("span",{className:"text-token-text-primary truncate text-sm",children:o})]}),Gt=Lt(J)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,ho=({label:t,icon:e,isDisabled:o=!1,hideLabel:s=!1,onClick:n,onMouseDown:r})=>a.jsx(Gt,{onClick:n,"aria-label":s?t:void 0,onMouseDown:r,disabled:o,children:a.jsx(Yt,{icon:e,hideLabel:s,label:t})}),Co=({icon:t,hideLabel:e,label:o,children:s,align:n="end"})=>a.jsxs(qt,{children:[a.jsx(Jt,{asChild:!0,children:a.jsx(Gt,{"aria-label":e?o:void 0,children:a.jsx(Yt,{icon:t,hideLabel:e,label:o})})}),a.jsx(Qt,{children:a.jsx(te,{align:n,className:M(Y.toolbar,"popover"),sideOffset:8,children:s})})]});G.Separator=Lt(mo)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-default`;G.Action=ho;G.Button=J;G.Popover=Co;const go=t=>C.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...t},C.createElement("path",{d:"M16.835 9.99968C16.8348 6.49038 13.8111 3.58171 10 3.58171C6.18893 3.58171 3.16523 6.49038 3.16504 9.99968C3.16504 11.4535 3.67943 12.7965 4.55273 13.8766C4.67524 14.0281 4.72534 14.2262 4.68945 14.4176C4.59391 14.9254 4.45927 15.4197 4.30469 15.904C4.93198 15.8203 5.5368 15.6959 6.12793 15.528L6.25391 15.5055C6.38088 15.4949 6.5091 15.5208 6.62305 15.5817C7.61731 16.1135 8.76917 16.4186 10 16.4186C13.8112 16.4186 16.835 13.5091 16.835 9.99968ZM18.165 9.99968C18.165 14.3143 14.4731 17.7487 10 17.7487C8.64395 17.7487 7.36288 17.4332 6.23438 16.8757C5.31485 17.118 4.36919 17.2694 3.37402 17.3307C3.14827 17.3446 2.93067 17.2426 2.79688 17.0602C2.66303 16.8778 2.63177 16.6396 2.71289 16.4284L2.91992 15.863C3.08238 15.3953 3.21908 14.9297 3.32227 14.4606C2.38719 13.2019 1.83496 11.6626 1.83496 9.99968C1.83515 5.68525 5.52703 2.25163 10 2.25163C14.473 2.25163 18.1649 5.68525 18.165 9.99968Z"}),C.createElement("path",{d:"M10 6.33498C10.3672 6.33502 10.665 6.63277 10.665 7.00002V9.33498L13 9.34865L13.1338 9.36232C13.4368 9.42427 13.665 9.69235 13.665 10.0137C13.665 10.335 13.4368 10.6031 13.1338 10.6651L13 10.6787L10.665 10.6651V13C10.665 13.3672 10.3672 13.665 10 13.6651C9.63278 13.6651 9.33505 13.3672 9.33496 13V10.6651L7 10.6787C6.63278 10.6787 6.33505 10.3809 6.33496 10.0137C6.33505 9.64649 6.63278 9.34865 7 9.34865L9.33496 9.33498V7.00002C9.33496 6.63275 9.63273 6.33498 10 6.33498Z"}));function Vt(t){const e=t();if(e==null)return;const{from:o,to:s,sourceFrom:n,sourceTo:r}=e;if(o==null||s==null||n==null||r==null){N.logError("Missing selection range on targeted edit",e);return}const i=xt.ASK;N.logButtonClick(I.TOOLBAR_ASK_CHATGPT,{action:i,sourceFrom:n,sourceTo:r}),w.startCommentingOn({type:D.SELECTION,from:o,to:s,sourceRange:{start:n,end:r},action:i})}function Eo(t,e,o){C.useEffect(()=>{if(o)return;const s=n=>{(n.metaKey||n.ctrlKey)&&n.key.toLowerCase()==="k"&&(n.preventDefault(),Vt(e))};return t?.addEventListener("keydown",s),()=>t?.removeEventListener("keydown",s)},[t,e,o])}const xo=({isSendDisabled:t=!1,getSelectionRange:e})=>{const o=ht(),s=()=>{Vt(e)};return a.jsx(G.Action,{isDisabled:t,label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:s,icon:go})},Do=({getEditorDom:t,getToolbarPosition:e,getSelectionRange:o,toolbarType:s,children:n,onAddComment:r,isWaitingForCommentResponse:i=!1,isSendDisabled:c=!1})=>{const[{height:l,width:u},d]=q(),[f,m]=C.useState(!0),[p,h]=C.useState(!1),E=t(),g=j(({commentingOn:v})=>v),[x,T]=C.useState(null);Eo(E,o,c);const S=C.useCallback(()=>{const v=t(),A=document.getSelection();return!A||A.type!=="Range"||A.isCollapsed||!v?.contains(A.anchorNode)},[t]);C.useEffect(()=>{const v=ee(()=>{h(!0)},200,{leading:!0}),A=()=>{v.cancel(),h(!1)};return E?.addEventListener("pointerdown",v,{passive:!0}),document.addEventListener("pointerup",A,{passive:!0}),()=>{E?.removeEventListener("pointerdown",v),document.removeEventListener("pointerup",A)}},[E]),C.useEffect(()=>{const v=()=>{m(S())};return document.addEventListener("selectionchange",v,{passive:!0}),()=>{document.removeEventListener("selectionchange",v)}},[S]),yt(()=>{if(f||S())return m(!0);try{const v=e({width:u,height:l});v!=null&&T(v)}catch(v){N.logError("Invalid position in getToolbarPosition",v)}},[l,u,f,S,e]);const y=a.jsxs(G,{toolbarType:s,children:[a.jsx(xo,{isSendDisabled:c,getSelectionRange:o}),n]}),b=!f&&!g&&x!=null;return a.jsxs(a.Fragment,{children:[a.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:a.jsx("div",{ref:d,children:y})}),a.jsx(H,{children:b&&a.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:x.top,left:x.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:M("absolute",Y.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:y})}),a.jsx(we,{toolbarPosition:x,commentingOn:g,isWaitingForCommentResponse:i,onAddComment:r})]})};function bo(t){let e=t;for(;e;){const s=window.getComputedStyle(e).overflowY;if(s==="auto"||s==="scroll")return e;e=e.parentElement}return null}function Bo(t,e){const o=U(),s=oe(),n=o();C.useEffect(()=>{const r=n?.dom;if(!r||t.length===0)return;const i=bo(r),c=e?Ct(e,100):null;return i&&c&&i.addEventListener("scroll",c,{passive:!0}),()=>{c&&(i&&i.removeEventListener("scroll",c),c.cancel())}},[n,s,t,e])}let F=null;function Io(){if(F!=null)return F;if(typeof window>"u")return 0;const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);try{F=t.offsetWidth-t.clientWidth}finally{document.body.removeChild(t)}return F}function Ro(t){return t==null?null:t.scrollHeight>t.clientHeight}export{Pt as A,jo as C,Do as T,po as a,ze as b,G as c,Io as g,Ro as i,Bo as u};
//# sourceMappingURL=io7yp3xixkpaizow.js.map
