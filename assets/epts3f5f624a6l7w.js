import{r as l,j as e,b as R,d as K,M as V,g as q}from"./gg0tb34p9fzo1omt.js";import{i4 as _,bv as T,dD as H,X as Z,K as W,e as G,mQ as O,at as U,ht as L,mR as X}from"./forbprkns1cohsbl.js";import{dX as I,bU as v,cJ as Y,jl as z,aR as J}from"./g670b8vtkhx0yc6d.js";import{j as Q,u as $,C as ee,W as te}from"./nir0q9e2l94u37hi.js";import{I as se}from"./mu0w85wyyiji3bj8.js";const ae=t=>l.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},l.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));function re({triggerText:t,toolTip:r,ariaLabel:s,Icon:n,truncate:o=!0}){return e.jsx(_,{className:"composer-btn px-2","aria-label":s,"data-pill":!0,children:e.jsx(I,{label:r,className:"text-sm font-medium",children:e.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[n,e.jsx("span",{className:v("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),e.jsx(T,{"aria-hidden":!0,className:"icon-sm"})]})})})}function ne({children:t,className:r,onClick:s,isSelected:n,isActive:o,isVirtualHover:d=!1,label:f,isDisabled:c,tooltipLabel:u,isSubMenuTrigger:i,noDefaultHoverState:m,as:j="button",truncateLabel:p,infoIcon:x,infoLink:g,icon:w,...C}){const y=R();let h=e.jsx(e.Fragment,{});t?h=e.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):f&&(h=e.jsxs("div",{className:v("flex items-center gap-3",p?"w-0 flex-1":"w-full"),children:[w&&(l.isValidElement(w)?w:e.jsx(oe,{icon:w})),f&&e.jsx("div",{className:v("flex flex-col items-start py-1",c&&"text-token-text-quaternary pointer-events-none",p&&"w-[100%]"),children:e.jsx("div",{className:v("flex items-center text-start text-sm",p&&"w-full"),children:e.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:f})})})]}),u&&(h=e.jsx(I,{sideOffset:-10,label:u,className:"w-full",children:h})));const M=e.jsxs("div",{className:v("flex items-center justify-center",(n||x&&g||i)&&"min-w-5"),children:[n&&e.jsx(Y,{className:"icon color:var(--tint-color,#0285FF) icon-sm","aria-label":y.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),x&&g&&e.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:x}),i&&e.jsx(H,{className:"icon text-token-text-tertiary w-7","aria-label":y.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),N=v("flex cursor-pointer items-center rounded-[10px] px-2.5 py-1",(n||x&&g||i)&&"gap-4",o&&"bg-black/5 dark:bg-white/5",!m&&"hover:bg-black/5 dark:hover:bg-white/5",d&&"bg-black/5 dark:bg-white/5",r);if(j==="div"){const b=C;return e.jsxs("div",{...b,className:N,children:[h,M]})}const k=C;return e.jsxs("button",{type:"button",...k,onClick:b=>{b.persist(),requestAnimationFrame(()=>{s?.(b)})},className:N,children:[h,M]})}function oe({icon:t}){const r=t;return e.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:e.jsx(r,{className:"h-5 w-5 shrink-0","aria-label":""})})}const S="wham-environment-popover-event";function ce(t,r,s){l.useEffect(()=>{function o(d){d.detail.popover!==t&&s()}return window.addEventListener(S,o),()=>{window.removeEventListener(S,o)}},[t,s]);const n=l.useCallback(o=>{window.dispatchEvent(new CustomEvent(S,{detail:{popover:o}}))},[]);l.useEffect(()=>{r&&n(t)},[r,n,t])}const le=({items:t,onSelect:r,keyExtractor:s})=>{const[n,o]=l.useState(null),[d]=l.useState(new Map);return{hoveredId:n,setHoveredId:o,getItemRef:c=>u=>{const i=s(c);return u&&d.set(i,u),()=>{d.delete(i)}},itemRefs:d,onKeyDown:c=>{const u=c.key==="ArrowDown"||c.key==="n"&&c.ctrlKey,i=c.key==="ArrowUp"||c.key==="p"&&c.ctrlKey;if(!(u||i||c.key==="Enter"))return;if(c.preventDefault(),c.key==="Enter"){n&&r(n);return}const m=t.findIndex(x=>s(x)===n),j=Z(m-(i?1:-1),0,t.length-1),p=s(t[j]);d.get(p)?.scrollIntoView({behavior:"instant",block:"nearest"}),o(p)}}};function ge({environment:t}){const r=R(),{branch:s,setBranch:n}=Q(),[o,d]=l.useState(""),[f,c]=l.useState(!1),u=l.useRef(null),i=()=>c(!1),m=l.useRef(t.repos[0]??null);return l.useEffect(()=>{(m.current!==t.repos[0]||!s)&&(m.current=t.repos[0],n(D(t)))},[s,n,t]),ce("branch",f,()=>c(!1)),$([{key:"whamBranches",action:()=>c(!0),actionMessageDescriptor:r.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:G.Chat,keyboardBinding:[W.Mod,"b"]}]),e.jsx("div",{className:"items-center rounded-full",children:e.jsxs(O,{open:f,onOpenChange:c,children:[e.jsx(re,{triggerText:s??r.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:s===""||f?"":s?.length?s:r.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:r.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:e.jsx(ae,{"aria-hidden":!0,className:"icon-sm"})}),e.jsx(ee,{align:"start",isOpen:f,closePopover:i,popoverContentRef:u,children:e.jsx(ie,{environment:t,repoId:m,searchQuery:o,setSearchQuery:d,setBranch:n,selectedBranch:s??"",closePopover:i})})]})})}function ie({environment:t,repoId:r,setBranch:s,selectedBranch:n,searchQuery:o,setSearchQuery:d,closePopover:f}){const c=R(),u=l.useRef(null),i=U(o,300),{data:m,isLoading:j,fetchNextPage:p,hasNextPage:x,isFetchingNextPage:g,error:w}=K({queryKey:["searchBranches",r.current,i],enabled:!!r.current,initialPageParam:null,queryFn:({pageParam:a})=>te.searchBranchesByRepository(r.current??"",i,L,a??null),getNextPageParam:a=>a?.cursor??null}),C=l.useMemo(()=>{const a=m?.pages?.flat().map(F=>F.items.flatMap(A=>A.branch))?.flat()??[],B=D(t);return B&&!a.includes(B)&&a.unshift(B),a},[m,t]),y=a=>{s(a),f()},h=l.useMemo(()=>o?.trim()?C.filter(a=>a.toLowerCase().includes(o.toLowerCase())):C??[],[o,C]),{hoveredId:M,setHoveredId:N,onKeyDown:k,getItemRef:b}=le({items:h,keyExtractor:a=>a,onSelect:y});return l.useEffect(()=>{u.current&&u.current.focus()},[]),e.jsxs("div",{className:"gap flex max-h-[280px] w-90 flex-col rounded-lg p-0 md:max-h-[360px]",onClick:a=>{a.stopPropagation()},children:[e.jsx(z,{ref:u,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",type:"text",autoComplete:"off",inputClassName:"text-sm",name:"search-branch",value:o,suppressFocus:!0,onKeyDown:k,onChange:a=>d(a.target.value),placeholder:c.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Search branchesâ€¦"}),ariaLabel:c.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),e.jsx("div",{className:"bg-token-border-default h-px w-full"}),e.jsxs("div",{className:"min-h-18 w-full overflow-y-auto p-1.5",children:[h?.map(a=>{const B=a===n;return e.jsx(ne,{className:"w-full max-w-full whitespace-nowrap",as:"button",onMouseEnter:()=>N(a),isVirtualHover:M===a,ref:b(a),onClick:()=>{y(a)},isSelected:B,label:a,truncateLabel:!0},a)}),w?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(V,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,e.jsx(se,{bgColor:"dark:bg-token-bg-secondary",hasNextPage:x,fetchNextPage:p,isFetchingNextPage:g||j})]})]})}function D(t){for(const r of t.repos){const s=t.repo_map?.[r];if(s?.default_branch)return s.default_branch}return"main"}var E,P;function ue(){if(P)return E;P=1;var t=J(),r=X();function s(n,o){return n&&n.length?r(n,t(o,2)):0}return E=s,E}var de=ue();const we=q(de);export{re as C,ae as S,ne as a,ge as b,le as c,D as g,we as s,ce as u};
//# sourceMappingURL=epts3f5f624a6l7w.js.map
