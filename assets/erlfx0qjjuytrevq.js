import{r as S,j as s}from"./gg0tb34p9fzo1omt.js";import{C as G}from"./a4255jj6lu2ywjjz.js";import{D as q}from"./e6r7gqenbe47ga9h.js";import{T as J,a as K,A as M,u as Q,i as X,C as Y,g as Z}from"./io7yp3xixkpaizow.js";import{C as $,c as z}from"./gffsn29yylc5pncm.js";import{C as V}from"./ejkv34dzwipa230i.js";import{b as tt,d as et,e as ot,f as k}from"./jh4r0k3f3n3zptua.js";import{C as rt}from"./jy1u8exw8iz2slve.js";import{g as nt,c1 as st,hH as U,hI as it}from"./forbprkns1cohsbl.js";import{aG as lt}from"./g670b8vtkhx0yc6d.js";import{u as at}from"./go2lz3yja1ixfdzl.js";import{C as ct}from"./j8f1yha947to1zwq.js";import"./be6sa05e05n18ich.js";import"./dku20bpa2hgnbl5b.js";import"./hb16nhh4rqym397l.js";import"./bfgn782syyllzt4r.js";import"./j0nw4kv698ot3br0.js";import"./f76gy0b8ieo4s693.js";import"./eiffxi5640gvsu4t.js";import"./o68lxipd1oht2mfn.js";import"./ihgbljwwpo1mzi43.js";import"./k5ngqk6bkqja3f09.js";import"./gomrh6779xe4lvq3.js";function mt(t,e){const r=t.doc.lineAt(e.from);return e.from===r.from&&e.to-1===r.to}function dt(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const ut=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:r=!1})=>{const o=tt(),f=et(),a=ot(),L=S.useCallback(i=>{const{height:c,width:m}=i,n=o();if(!f||!n)return null;const d=f.selection.asSingle();if(d.ranges.length===0)return null;const l=d.ranges[0],{empty:D,to:O}=l;let{head:p}=l;const{platform:H}=nt();p=H==="web"?p:O;const g=p===O;let h=p;if(g&&mt(f,l)&&(h-=1),D)return null;const{left:v,top:x,bottom:R}=n.contentDOM.getBoundingClientRect(),{left:w,top:N,bottom:C}=lt(n.coordsAtPos(h,g?-1:1)),E=dt(n);function A(){if(g)return Math.max(w-v+E-m,E);let u=w-v+E;return u+m>a&&(u=-(m-a)),u}function _(u){const W=c*2,I=u.contentHeight-(C-R)>W&&window.innerHeight-C>W,y=C-x+8,j=N-x-c-8;return g&&I||j<0?{top:y,aboveOrBelow:M.BELOW}:{top:j,aboveOrBelow:M.ABOVE}}const b=_(n);return{left:A(),top:b.top,aboveOrBelow:b.aboveOrBelow,toolbarSize:i}},[f,o,a]),B=S.useCallback(()=>o()?.dom??null,[o]);return s.jsx(J,{onAddComment:t,isWaitingForCommentResponse:r,isSendDisabled:e,toolbarType:K.CODE,getToolbarPosition:L,getEditorDom:B,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:c}=i,m=c.selection.asSingle();if(m.ranges.length===0)return null;const n=m.ranges[0],{from:d,to:l}=n;return d==null||l==null?null:{from:d,to:l,sourceFrom:d,sourceTo:l}}})};function ft({diff:t}){return Q(t?.edits??[]),null}function pt(t,e,r){const o=r?Z():0;return t<=1e3-o?t-(e?$:0):t-(e?z:0)}const Gt=({comments:t,currentlyStreamingLineIndex:e,isPreview:r=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:f=!1,readonlyReason:a,isRequestActive:L=!1,language:B,value:i,textdocDiff:c,onAcceleratorsExpandedChange:m,onAddComment:n,onAcceptComment:d,onDismissComment:l,onBlur:D,onSave:O,onChange:p,onCancelRequest:H,getStableCommentId:g=it,commentsMode:h=V.ENABLED,hideToolbar:v,hideAccelerators:x=!1,onSubmitAccelerator:R,modelCursor:w,codemirrorRef:N})=>{const C=S.useRef(null),E=st(),[{width:A},_]=at(),b=S.useRef(null),u=t.length>0,W=b.current,I=pt(A,u,X(W)??!1),y=k(({commentingOn:T})=>T),j=k(({hoveredCommentId:T})=>T),F=k(({focusedCommentId:T})=>T);S.useEffect(()=>{C.current?.UNSAFE_setValue(i||"")},[i]);const P=A-I;return s.jsx("div",{className:rt.code,ref:U(_,b),style:E&&r?{margin:"0 16px"}:{},children:s.jsxs(G,{id:"codemirror",comments:h===V.ALL_HIDDEN?void 0:t,commentingOn:y,currentlyStreamingLineIndex:e,hoveredCommentId:j,focusedCommentId:F,language:B,readonlyReason:a,onChange:p,value:i,textdocDiff:c,editorRef:U(C,N),width:I,modelCursor:w,isPreview:r,hideLineNumbers:E&&r,onBlur:D,onSave:O,children:[s.jsxs(G.EditorChildren,{children:[!v&&s.jsx(ut,{onAddComment:n,isSendDisabled:f,isWaitingForCommentResponse:o}),h!==V.ALL_HIDDEN&&s.jsx("div",{className:u?"me-4":"",children:s.jsx(Y,{getStableCommentId:g,availableWidth:P,comments:t,commentsMode:h,onAddComment:n,onAcceptComment:d,onDismissComment:l,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),s.jsxs(G.ContextChildren,{children:[c&&s.jsx(ft,{diff:c}),!x&&s.jsx(q,{isRequestActive:L,isVisuallyHidden:f||!!a?.isStreamingFromNative||a?.isReadonly&&!a.isStreaming,onSubmit:R,onCancel:H,actions:ct,onExpandedChange:m})]})]})})};export{Gt as CodeComposer};
//# sourceMappingURL=erlfx0qjjuytrevq.js.map
