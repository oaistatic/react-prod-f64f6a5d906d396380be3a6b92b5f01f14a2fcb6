const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m0y7z71dz2s3891b.js","assets/gg0tb34p9fzo1omt.js","assets/g670b8vtkhx0yc6d.js","assets/root-ilxovqci.css","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/ejkv34dzwipa230i.js","assets/jy1u8exw8iz2slve.js","assets/k5ngqk6bkqja3f09.js","assets/gffsn29yylc5pncm.js","assets/ihgbljwwpo1mzi43.js","assets/go2lz3yja1ixfdzl.js","assets/gomrh6779xe4lvq3.js","assets/c8ep7627nr5x9804.js","assets/mgu35bfjmjtg3slf.js","assets/e0kfywq1jfn60tks.js","assets/jh4r0k3f3n3zptua.js","assets/f76gy0b8ieo4s693.js","assets/gy64pge8qevmvg7e.js","assets/h431y4zi2z7ivdmh.js","assets/jec2dxephizdapuu.js","assets/dku20bpa2hgnbl5b.js","assets/be6sa05e05n18ich.js","assets/j8f1yha947to1zwq.js","assets/l8bgi7e4c78ddktv.js","assets/dl1zw2u5dp7czf6c.js","assets/e6r7gqenbe47ga9h.js","assets/eiffxi5640gvsu4t.js","assets/o68lxipd1oht2mfn.js","assets/kxn66emqpeqvk1h7.js","assets/isn1igquqvc1qe44.js","assets/bk8slwxjkdlmxjxm.js","assets/ob8dna56sqm37byd.js","assets/bznan1jknv1y4qru.js","assets/fz8lyjvdpywhlf94.js","assets/cs320738df36xnc1.js","assets/f51c6zie1stj9anw.js","assets/jpdmr6hprcjyd5ie.js","assets/me58wahxzwibdrxp.js","assets/pnx8yl9r7yj5moem.js","assets/felxwdrg3fgsr1mu.js","assets/kr5jdtt5uczx95b1.js","assets/cx1v46pslsfvescw.js","assets/e83gfa4m2yetz3zf.js","assets/btagl6w1gub4aw61.js","assets/l5wcma0jtzapjmsc.js","assets/fm40irtbnn4s9a6h.js","assets/mzkxlhrlmxhntkvn.js","assets/kthx8p8v40tfg708.js","assets/m1ohh9p1gptum5w5.js","assets/l4lldnfjv1apahqp.js","assets/kapf1vasjh1lo9ik.js","assets/ovfgk5oky70gv1q0.js","assets/jp0d5synnc6qwyap.js","assets/fzx0pfnkyz7dzd8w.js","assets/dwweugcujrtabsgm.js","assets/8b6w2kx5me0iugen.js","assets/dkpt9rl3nmxrd3k2.js"])))=>i.map(i=>d[i]);
import{jF as oe,fj as Be,h as re,j as me,bs as We,bt as De,D as ze,B as tt,bc as it,T as at,a6 as ie,a2 as nt,br as ot,i_ as rt,go as W,di as He,hZ as xs,aw as lt,oT as vs,bX as js,dv as $e,ot as ys,ou as Re,l as Ve,aA as ct,h3 as dt,a4 as ut,a3 as mt,t as gt,aD as ft,d as K,cI as be,eX as Ms,ch as ae,nH as qe,mR as pt,mP as ht,fa as Le,fg as R,dy as B,N as bs,m as ue,be as Qe,bg as xe,mS as ve,fk as je,dX as Xe,jp as xt,c2 as Ye,bU as le,oU as vt,nG as jt,nN as yt,dU as Ke,c5 as se,dm as Mt,cD as bt,mQ as wt,cl as Pt,mB as ws,mM as Tt,mD as Ps,g1 as kt,mN as St,bS as Ue,mO as _t,bR as Ts,c6 as Ze,mC as Ct,ov as Se,ow as _e,P as ks,bQ as Nt,G as Je,du as It,cO as Gt,S as At,af as zt,hx as Rt,je as Ss,bV as _s,bW as Cs,fr as Lt,bd as ye,g as Ut,fz as Ns,bj as Et,oV as Ft,jg as Ot,dj as as,nt as Bt,oW as Wt,cG as Dt,nF as Ht,a8 as $t,oX as Vt,oY as qt,Z as Qt,ar as ns,ad as os,jW as Xt,ff as rs,fm as Yt,g7 as Kt,g8 as Zt,kw as Jt,m2 as ei,a_ as ls,l_ as si}from"./g670b8vtkhx0yc6d.js";import{R as Is,r as m,j as e,b as $,u as Gs,e as ce,M as u,h as ge,al as ti,A as ii,m as As,O as ai,o as ni}from"./gg0tb34p9fzo1omt.js";import{dc as zs,M as Rs,lX as Ls,a as Us,ci as oi,bo as ri,cf as we,cg as H,cL as Es,ck as es,oa as li,a3 as Fs,hP as Os,ob as ci,dX as di,cq as Bs,t as Ws,an as ui,N as mi,hT as te,oc as Ee,cl as gi,cm as fi,w as pi,od as hi,cc as xi,q as vi,oe as cs,dO as ds,of as Ds,og as ji,cv as Hs,b6 as Me,mu as $s,hV as Q,hW as X,hX as Ce,aC as yi,oh as Mi,hY as bi,lY as wi,oi as Pi,cw as Ti,hZ as ki,oj as us,ok as Si,iW as _i,T as Ci,hU as Ni,ol as Ii,iu as Gi,bv as Ai,gc as zi,lx as ms,d as Ri,om as Li,on as gs,r as Ui,hc as Ei,hd as Fi,he as Oi}from"./forbprkns1cohsbl.js";import{G as Bi,A as de,M as Vs,a as Wi,b as fs,s as Di,c as Hi,S as $i,g as Vi,d as qi}from"./kthx8p8v40tfg708.js";import{M as qs}from"./m1ohh9p1gptum5w5.js";import{i as Fe}from"./ovfgk5oky70gv1q0.js";import{S as Qi}from"./isn1igquqvc1qe44.js";import{G as Xi}from"./jp0d5synnc6qwyap.js";import{C as Yi}from"./fzx0pfnkyz7dzd8w.js";import{S as Ki}from"./dwweugcujrtabsgm.js";import{u as Qs}from"./f51c6zie1stj9anw.js";import{h as Zi}from"./cs320738df36xnc1.js";import{a as Ji,G as ea}from"./8b6w2kx5me0iugen.js";import{b as sa}from"./dkpt9rl3nmxrd3k2.js";function ta(s,t){const i=me(s),a=re.getTree(i),n=[];let o=re.getCurrentNode(i);for(;o!=null&&(t==null||o.id!==t);)n.unshift(o.message),o=o.parentId!==""?a.getNodeByIdOrMessageId(o.parentId):void 0;return n}function ia(s){return s.filter(a=>a.recipient==="gizmo_editor.update_behavior").flatMap(a=>a.content.content_type==="text"?a.content.parts:a.content.content_type==="code"?[a.content.text]:[]).map(a=>JSON.parse(a)).reduce((a,n)=>({...a,...n}),{})}async function aa(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const a=nt.getImageAssetPointers(i);a.length>0&&(t=a.at(-1))}if(t!=null){const i=ot(t.asset_pointer),a=await We(i);if(a.status===De.Success)return{id:i,permalink:a.download_url}}}async function na(s,t,i,a){const n=ta(t,a),o=ia(n);let r=await aa(n);if(Fe(o)&&r==null)return;const{name:d,context:g,description:f,profile_pic_file_id:h,prompt_starters:l}=o;if(h!=null)try{const p=await We(h,s.id);p.status===De.Success&&(r={id:h,permalink:p.download_url})}catch(p){ze.addError(new Error("Error while retrieving profile pic in update",{cause:p})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const w={name:typeof d=="string"?d:void 0,description:typeof f=="string"?f:void 0,instructions:typeof g=="string"?g:void 0,promptStarters:Array.isArray(l)?l:void 0,profilePictureId:r?.id,profilePictureUrl:r?.permalink};return tt(w,p=>p!=null)}function oa(s){const t=new Set;for(const g of s.tools)t.add(g.type);const i=s.name??"",a=s.description??"",n=s.instructions??"",o=Array.from(t).join(","),r=i===""&&a===""&&n==="",d=s.profilePictureUrl!=null;return r?`The GPT you are about to has the following abilities: ${o}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${a}

context: ${n}

abilities: ${o}

${d?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const ra=10;function Xs(s,t){const i=s.current,a=t.current;if(Be(i,a))return;const n={};i.name!==a?.name&&(n.name=i.name),(i.description??"")!==(a?.description??"")&&(n.description=i.description??""),i.instructions!==(a?.instructions??"")&&(n.context=i.instructions??"");const o=new Set(a?.files?.map(h=>h.file_id)??[]),r=new Set(i.files?.map(h=>h.file_id)??[]),d=(i.files??[]).filter(h=>!o.has(h.file_id)),g=(a?.files??[]).filter(h=>!r.has(h.file_id));if(Fe(n)&&d.length===0&&g.length===0)return;const f=[];if(!Fe(n)){const h=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;f.push(oe(h))}if(g.length>0&&f.push(oe(`The user has removed the following files from the GPT. You can no longer reference these files: ${g.map(h=>h.file_id).join(", ")}`)),d.length>0){const h=d.slice(0,ra);f.push(oe(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${h.map(l=>l.file_id).join(", ")}`,{attachments:h.map(l=>({id:l.file_id,name:l.name,size:l.size}))}))}return f}function la(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(i=>`"${i.fileId}"`).join(", ")}`;return[oe(t)]}function ca(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!re.findNode(me(s),a=>a.message.content.content_type==="text"&&a.message.content.parts[0]===t))return[oe(t)]}function da(s,t){const{session:i}=it();at.initThread({clientThreadId:s,conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t},userId:i?.user?.id,accountId:i?.account?.id});const a=zs(s);return async(o,r,d,g)=>{a({sourceEvent:o,promptMessage:oe(g),prependMessages:Xs(r,d),completionMetadata:{conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}}})}}const ua="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.";function ma(s,t){m.useEffect(()=>{re.findNode(me(s),a=>dt(a.message)||a.message.author.role===ut.System&&a.message.content.content_type===mt.Text)||Ve(s,a=>{gt.updateTree(a,(n,o)=>{const r=n.findNode(d=>d.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,o);return r&&(r.id===o&&(o=n.rootId),n.deleteNode(r.id)),t?n.addMessageNode(o,ft(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):o})})},[s,t])}function ga(s,t,i){const{data:a}=$e(),n=a?.models.get(ys)??(a&&Ls(a.models.values(),r=>r.tags.includes(Re.GPT_4o)));Us(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i},{forcedModelId:n?.id}),m.useEffect(()=>{Ve(s,r=>{r.mode={kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:ct(i)},r.modelId=n?.id??r.modelId})},[s,t.id,i,n,a]);const[o]=m.useState(()=>{const r=t.id==null,d=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return r?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:d?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});ma(s,o)}function fa({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:r}){const d=m.useRef(r);d.current=r;const g=m.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:d.current}),[s,n]),f=rt(l=>l.files.filter(w=>w.status===W.Ready&&w.gizmoId!=null)),h=m.useCallback(l=>{if(t(w=>({...w,files:[...w.files??[],...He(f.map(p=>p.fileId!=null&&{file_id:p.fileId,name:p.file.name,size:p.file.size,type:xs(p.file),last_modified:p.file.lastModified,file_size_tokens:p.fileSpec?.fileTokenSize}))]})),o.current=Rs(a.current),!l.completionType||l.completionType===lt.Next){const w=re.getCurrentNode(me(i)),p=w.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?w.message:void 0;p&&(l.existingMessages=[p]),l.prependMessages=[...la(f)??[],...Xs(a,o)??[],...ca(i)??[],...l.prependMessages??[]]}return l},[i,f,a,o,t]);return e.jsx(vs.Provider,{value:g,children:e.jsx("div",{className:"relative flex h-full grow overflow-auto",children:e.jsx("div",{className:"grow",children:e.jsx(js,{clientThreadId:i,children:e.jsx(qs,{clientThreadId:i,getGizmosCompletionParams:h,hideHeader:!0})})})})})}const pa=Is.memo(fa);function ha({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,showActionsModal:r,shareOnly:d,onClose:g}){const[f,h]=m.useState({type:"privacy"});return f.type==="privacy"?e.jsx(va,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,setStep:h,showActionsModal:r,shareOnly:d,onClose:g}):e.jsx(ja,{publishedGizmo:f.publishedGizmo,onClose:g})}function xa(s){return s?R.Workspace:R.Link}function va({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:o,setStep:r,showActionsModal:d,shareOnly:g,onClose:f}){const h=K(),[l,w]=m.useState(!1),p=be(Ms.isBusinessWorkspace),v=$(),k=ae(),[y,S]=m.useState(qe(s)?xa(!!p):s.sharingRecipient),_=Gs(),b=oi(y,s.sharingTargets),{data:I,isLoading:C}=pt(),M=ht(),[P,z]=m.useState(t!=null&&t.gizmo.display.categories.length>0?M.data?.categories.find(j=>j.id===t.gizmo.display.categories[0])?.id:void 0);m.useEffect(()=>{z(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[V,c]=m.useState(void 0),G=m.useRef(ri((j,A)=>Le.generateCategory(j,A),1e3)),L=I?.is_verified?void 0:v.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});y===R.Marketplace&&L!=null&&!C&&S(R.Link);const E=p&&!s.sharingTargets?.some(j=>j.recipient===R.Link),F=we(s,y,P),O=F.includes(H.MissingPublicActionPrivacyPolicyURL),ne=s.tools.find(j=>j.type===B.JIT_PLUGIN&&!j.metadata.privacy_policy_url),fe=be(j=>j.currentWorkspace),Z=bs();m.useEffect(()=>{let j=!0;return(async()=>{try{if(P!=null)return;const A=await G.current(s.name,s.instructions);j&&P==null&&(A?z(A.id):c(!0))}catch{j&&P==null&&c(!0)}})(),()=>{j=!1}},[s.instructions,s.name,Z,P]);const q=ue(h,"4226692983");return e.jsx(Qe,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:f,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:b?e.jsx(xe,{color:"primary",disabled:F.length>0,loading:l,onClick:async()=>{try{if(w(!0),g){if(!t?.gizmo.id){k.danger(v.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}),{toastId:"simple_share_gizmo_modal",loggingTitle:"Error sharing GPT",loggingDescription:"Error message when GPT ID is missing (shouldn't happen)"});return}const j=await Le.shareGizmo(t.gizmo.id,P?{sharing:ve(y,[],je),categories:[P]}:{sharing:ve(y,[],je)});j.error?(k.warning(v.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:j.sharing_targets}),o({gizmoId:t.gizmo.id,sharingRecipient:y,categories:t.gizmo.display.categories,moderationType:Vs.PublishBlocked,sharingTargets:j.sharing_targets,showModal:de.AppealAvailable})):(_.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],A=>j.resource),i(A=>({...A,sharingRecipient:y})),k.success(v.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),f())}else{const j=await a({recipient:y,subjects:ve(y,[],je)},P);j?(r({type:"published",publishedGizmo:j}),i(A=>({...A,id:j.gizmo.id,sharingRecipient:y})),j.gizmo.live_version!=null&&i({liveVersion:j.gizmo.live_version}),k.success(v.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(k.warning(v.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),f())}}finally{w(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):q?e.jsx(e.Fragment,{children:e.jsx(xe,{color:"primary",onClick:async()=>{await n(y,P)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(xe,{color:"secondary",onClick:j=>es(h,t,k,j,v.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Es,{value:y,onValueChange:j=>S(j),children:[s.sharingTargets&&s.sharingTargets.map((j,A)=>e.jsx(Ne,{value:j.recipient,disabled:j.recipient===R.Marketplace&&L!=null,tooltipText:j.recipient===R.Marketplace?L??v.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:j.recipient},A)),E&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{value:R.Link,disabled:!0,tooltipText:v.formatMessage(ps.workspaceDisabledHint),shareLevel:R.Link,workspaceName:fe?.name}),e.jsx(Ne,{value:R.Link,disabled:!0,tooltipText:v.formatMessage(ps.workspaceDisabledHint),shareLevel:R.Marketplace,workspaceName:fe?.name})]})]})}),O&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:j=>e.jsx("button",{onClick:()=>{d(ne?.metadata.action_id)},className:"underline",children:j})}})}),y!==R.Private&&e.jsx(Bi,{gizmo:s,category:P,categories:y===R.Marketplace?M.data?.categories??[]:void 0,onCategoryChange:y===R.Marketplace?j=>z(j.id):void 0}),y===R.Marketplace&&(V?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!b&&q&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ja({publishedGizmo:s,onClose:t}){const i=K(),a=li(i,s),n=$(),o=ae();return e.jsx(Qe,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:t,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(xe,{color:"primary",as:"link",to:a,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:a}),e.jsx("button",{onClick:r=>{es(i,s,o,r,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Fs,{className:"icon-sm"})})]})})})}const ps=ce({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ne({shareLevel:s,workspaceName:t,value:i,disabled:a=!1,tooltipText:n}){const o=m.useId();return e.jsx(Xe,{disabled:n==null,label:n,side:"top",triggerAs:null,children:e.jsxs(Os,{id:o,value:i,disabled:a,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:o,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Wi,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(ci,{children:e.jsx(xt,{className:"icon-lg me-1"})})]})})}function Oe(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Ys(s){window.history.length>1?s(-1):s(vt())}function ya({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:o,updateGizmo:r,promoteGizmo:d,appealGizmo:g,setAppealState:f,showActionsModal:h}){const l=K(),w=bt(),p=m.useMemo(()=>{const I=[];return(s==null||a||i)&&I.push(H.Loading),s!=null&&I.push(...we(s)),n&&I.push(H.UploadingProfilePic),o&&I.push(H.GeneratingProfilePic),I},[s,a,i,n,o]),v=qe(s),k=I=>{requestAnimationFrame(()=>Pt(l,w?.isWorkspaceAccount()?$i:ha,{gizmo:s,publishedGizmo:t,promoteGizmo:d,appealGizmo:g,setAppealState:f,showActionsModal:h,updateGizmo:r,shareOnly:I==="share"}))},[y,S]=m.useState(!1),_=s.sharingRecipient?fs[s.sharingRecipient]:fs.private,b=a||i;return e.jsxs(e.Fragment,{children:[v?e.jsx(te,{color:"primary",onClick:()=>k("promote"),loading:p.length>0&&p.every(I=>[H.Loading,H.UploadingProfilePic,H.GeneratingProfilePic].includes(I)),disabled:b||s.id===void 0||p.length>0,tooltip:p.length>0?p.map(Ee).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(u,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(te,{color:"secondary",loading:a||!t,disabled:b,icon:_,onClick:()=>k("share"),children:e.jsx(u,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(te,{color:"primary",onClick:async()=>{let I=s.sharing.subjects.map(Di);const C=wt(s.sharing.subjects);I=ve(s.sharing.recipient,I,C?.capabilities??je);const M=t&&Oe(t)?t.gizmo.display.categories[0]:void 0;await d({recipient:s.sharing.recipient,subjects:I},M)&&S(!0)},loading:i||!t,disabled:b||p.length>0,tooltip:p.length>0?p.map(Ee).join(`
`):void 0,children:e.jsx(u,{id:"84QVoj",defaultMessage:"Update"})})]}),y&&t&&e.jsx(Hi,{publishedGizmo:t,sharing:Oe(t)?t.gizmo.sharing:void 0,onClose:()=>S(!1),workspaceName:w?.data.name??""})]})}function Ma({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const a=K(),n=$(),o=ae(),r=ge(),[d,g]=m.useState(!1),{canDelete:f}=jt(t),{canCreate:h}=yt();return!(t||i||s?.id&&s.liveVersion>0||f)?null:e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(te,{color:"ghost",icon:Mt}),children:[t!=null&&e.jsxs(se.Item,{onClick:w=>{es(a,t,o,w)},children:[e.jsx(Ws,{className:"icon-sm"}),e.jsx(u,{...Y.copyLink})]}),i!=null&&e.jsxs(se.Item,{onClick:()=>{window.confirm(n.formatMessage(Y.revertConfirm))&&i()},children:[e.jsx(ui,{className:"icon-sm"}),e.jsx(u,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(se.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Qi,{className:"icon-sm"}),e.jsx(u,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),h&&e.jsxs(se.Item,{onClick:async()=>{const w=await Le.copyGizmo({gizmoId:s.id});w.gizmo.id&&r(`/gpts/editor/${w.gizmo.id}`)},children:[e.jsx(Fs,{className:"icon-sm"}),e.jsx(u,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&Oe(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(se.Item,{color:"danger",onClick:()=>{g(!0)},children:[e.jsx(mi,{className:"icon-sm"}),e.jsx(u,{id:"tNrOLG",defaultMessage:"Delete GPT"})]})]}),d&&e.jsx(Xi,{gizmoId:s?.id||"",onSuccess:()=>Ys(r),onClose:()=>{g(!1)}})]})}const he=Ye.div`flex items-center gap-1`;function ba({gizmoEditorData:s}){const t=be(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case R.Private:return e.jsxs(he,{children:[e.jsx(pi,{className:"icon-xs"}),e.jsx(u,{...Y.onlyMe})]});case R.Link:return e.jsxs(he,{children:[e.jsx(Ws,{className:"icon-xs"}),e.jsx(u,{...Y.anyoneWithLink})]});case R.Workspace:return e.jsxs(he,{children:[e.jsx(fi,{className:"icon-xs"}),t]});case R.Marketplace:return e.jsxs(he,{children:[e.jsx(gi,{className:"icon-xs"}),e.jsx(u,{...Y.public})]});default:return e.jsx("div",{})}}function wa({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(u,{...Y.newGPT})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:qe(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),e.jsx(u,{...Y.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),s.sharingRecipient===R.Marketplace?e.jsx(u,{...Y.published}):e.jsx(u,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(u,{...Y.dotSeparator,tagName:"span"}),e.jsx(ba,{gizmoEditorData:s})]})})]})]})}const Pa=Ye.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function Ta({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,publishedGizmo:o,updateGizmo:r,promoteGizmo:d,appealGizmo:g,setAppealState:f,revertDraft:h,draftMessage:l,className:w,hasUnpublishedChanges:p,showActionsModal:v}){const k=ge();return e.jsxs("div",{className:le("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",w),children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Ys(k),children:e.jsx(di,{className:"icon"})}),e.jsx(wa,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&(o?.gizmo?.live_version??0)>1&&e.jsx(Pa,{onClick:()=>k(`/g/${s.id}/view`),children:e.jsx(u,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(ti,{value:o.gizmo.updated_at,day:"numeric",month:"short",year:new Date(o.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),l,e.jsx(Ma,{gizmoEditorData:s,publishedGizmo:o,revertDraft:h}),e.jsx(ya,{gizmo:s,publishedGizmo:o,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,updateGizmo:r,promoteGizmo:d,appealGizmo:g,setAppealState:f,hasUnpublishedChanges:p,showActionsModal:v})]})]})}const Y=ce({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),ka=512;function Sa(){return e.jsx("div",{className:"border-token-border-medium relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Ze,{className:"h-1/4 w-1/4"})})}function _a({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:a,setIsGeneratingProfilePic:n}){const o=$(),r=ae(),[d,g]=m.useState(void 0),f=m.useRef(t);m.useEffect(()=>{f.current=t});async function h(p){if(p.length>0){n(!1);const v=await St(p[0],ka),k=Ue(v);g({tempId:k,file:v,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),f.current("uploading"),_t(k,v,o,r,Ts.ProfilePicture,{onFileCreated(y,S,_){g(b=>b!=="initial"&&b?.tempId===y&&b.status===W.Uploading?{...b,progress:10,fileId:S,cdnUrl:_}:b)},onFileUploadProgress(y,S){g(_=>_!=="initial"&&_?.tempId===y&&_.status===W.Uploading?{..._,progress:S}:_)},onFileUploaded(y,S,_){g(b=>b!=="initial"&&b?.tempId===y?(f.current(b),{...b,status:W.Ready,progress:100,fileSpec:{name:b.file.name,id:b.fileId,size:b.file.size,..._??{}}}):b)},onError(y){g(S=>{if(S!=="initial"&&S?.tempId===y){f.current(void 0);return}return S})}})}}const{open:l,getInputProps:w}=Qs({disabled:!1,noClick:!0,onDropAccepted:h,onDropRejected:p=>Zi(p,o,r,kt.ProfilePicture),multiple:!0,maxSize:Ps,...ws(Tt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Ke,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:a?e.jsx(Sa,{}):d!=null&&d!="initial"&&d.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(hi,{file:d.file}),d.status===W.Uploading&&d.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(xi,{percentage:d.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(vi,{className:"text-4xl"})})}),children:[e.jsx(se.Item,{onClick:l,children:e.jsx(u,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(se.Item,{onClick:i,children:e.jsx(u,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...w()})]})}function Ca({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:a}){const n=$(),o=ae(),[r,d]=m.useState(0),g=m.useRef(new Map),f=Ct(i,void 0),h=async M=>{ks.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const P=await t();M.length>0&&await Promise.all(M.map(z=>{const V=Ue(z);g.current.set(V,{tempId:V,gizmoId:P,file:z,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),Nt(Ue(z),z,n,o,{kind:Ts.Gizmo,gizmoId:P},{onFileUploaded:(c,G,L,E)=>{const F=g.current.get(c);F==null||F.fileId==null||(a(O=>({...O,files:[...O.files??[],{file_id:F.fileId,name:F.file.name,size:F.file.size,type:E?.mimeType??xs(z),last_modified:F.file.lastModified,file_size_tokens:E?.fileTokenSize}]})),g.current.delete(c),d(O=>O+1))},onFileCreated:(c,G,L)=>{g.current.set(c,{tempId:c,gizmoId:P,file:z,status:W.Uploading,progress:1,...g.current.get(c),fileId:G,cdnUrl:L}),d(E=>E+1)},onFileUploadProgress:(c,G)=>{const L=g.current.get(c);L?.status===W.Uploading&&g.current.set(c,{...L,progress:G}),d(E=>E+1)},onError:c=>{g.current.delete(c)}},{usesRetrievalIndex:i!=null&&Se(i,z.type,z.name)===_e.Retrieval})}))},{getInputProps:l,open:w}=Qs({disabled:!1,noClick:!0,onDropAccepted:h,multiple:!0,maxSize:Ps,maxFiles:10,...ws(f)}),p=s?.files??[];function v(M){return e.jsx(ds,{onRemoveFileClick:()=>{g.current.delete(M.tempId),d(P=>P+1)},file:M.file,loadingPercentage:M.status===W.Uploading?M.progress:void 0},M.tempId)}function k(M){return e.jsx(ds,{file:M.name,fileId:M.file_id,onRemoveFileClick:()=>a(P=>({...P,files:P?.files?.filter(z=>z.file_id!==M.file_id)})),gizmoId:s?.id},M.file_id)}const y=Array.from(g.current.values()).filter(M=>p.every(P=>P.file_id!==M.fileId)),[S,_]=cs(y,M=>i!=null&&Se(i,M.file.type,M.file.name)===_e.CodeInterpreter),[b,I]=cs(p,M=>i!=null&&M.type!=null&&Se(i,M.type,M.name)===_e.CodeInterpreter),C=m.useRef(b.length);return m.useEffect(()=>{b.length>C.current&&a(M=>M.tools?.some(P=>P.type===B.PYTHON)?M:{...M,tools:[...M.tools??[],{type:B.PYTHON}]}),C.current=b.length},[b.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:e.jsx(u,{...Na.knowledgeWarning})}),_.length>0||I.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[_.map(v),I.map(k)]}):null,S.length>0||b.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(u,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.map(v),b.map(k)]})]}):null,e.jsx("div",{children:e.jsxs(te,{onClick:w,children:[e.jsx("input",{...l()}),e.jsx(u,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const Na=ce({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function Ia({placeholder:s,text:t,onChange:i,onClose:a}){return e.jsxs(Qe,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:a,primaryButton:e.jsx(te,{onClick:a,children:e.jsx(u,{id:"FeFVdS",defaultMessage:"Close"})}),children:[e.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:t,onChange:n=>{i(n.target.value)},placeholder:s}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...Ds.instructionsWarning})})]})}const Ie=Ye.div`text-sm text-red-500`;function Ga({children:s,collapsed:t,initial:i}){return e.jsx(ii,{initial:i,children:!t&&e.jsx(As.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function Aa({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const a=$(),n=ae(),o=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((r,d)=>r.type!==B.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(ki,{isDisabled:i,actionTool:r,onShowActionsEditor:()=>t(r.metadata.domain)}),r.metadata.auth?.type==="oauth"&&e.jsx(Yi,{label:a.formatMessage(U.callbackUrlLabel),value:`https://chat.openai.com/aip/${r.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},d)),(s?.tools?.filter(r=>r.type===B.JIT_PLUGIN)??[]).length>=us?e.jsx("div",{children:a.formatMessage(U.maxActionsReached,{number:us})}):e.jsx(te,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(u,{...U.createActionLabel})})]});return i?e.jsx(Xe,{side:"top",label:a.formatMessage(U.disabledCustomActionsTooltip),children:o}):o}function za(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===B.JIT_PLUGIN)}function Ra({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:a,setIsUploadingProfilePic:n,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,requireGizmoId:d,onShowActionsEditor:g}){const f=s?.tools??[],[h,l]=m.useState(!1),[w,p]=m.useState(!0),v=s?.promptStarters??[],k=[...v,...v.length<ji?[""]:[]],y=we(s),S=K(),b=Je(S)?.isWorkspaceAccount(),I=Hs(Me.WorkspaceGPTCustomActions),C=$(),{data:M}=$e({isGizmo:!0}),P=ue(S,"1854238036"),{gizmoModelsData:z}=It(),V=z?.editor?$s(s?.tools??[])?z.editor.models_list_with_custom_actions:z.editor.models_list:[];return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Q,{children:[e.jsx(_a,{gizmoEditorData:s,generateProfilePic:a,isGeneratingProfilePic:o,setIsGeneratingProfilePic:r,onFileChange:async c=>{if(c!=null&&c!=="uploading"&&c.fileId!=null){const G=await We(c.fileId);G.status===De.Success&&t({profilePictureId:c.fileId!=null?c.fileId:void 0,profilePictureUrl:G.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(c==="uploading")}}),e.jsx(X,{label:e.jsx(u,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(u,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ce,{type:"text",placeholder:C.formatMessage(U.gptNamePlaceholder),value:s?.name??"",onChange:c=>{t({name:c.target.value})},onBlurCapture:()=>t(c=>({...c,name:c.name.trim()})),"data-testid":"gizmo-name-input"}),y.includes(H.GizmoNameTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(u,{...U.nameTooLong,values:{length:yi}})}):null]}),e.jsxs(Q,{className:"mt-4",children:[e.jsx(X,{label:e.jsx(u,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(u,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ce,{type:"text",placeholder:C.formatMessage(U.descriptionPlaceholder),value:s?.description??"",onChange:c=>t({description:c.target.value}),onBlurCapture:()=>t(c=>({...c,description:c.description?.trim()??""})),"data-testid":"gizmo-description-input"}),y.includes(H.GizmoDescriptionTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(u,{...U.descriptionTooLong,values:{length:Mi}})}):null]}),e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:C.formatMessage(U.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(bi,{className:"resize-none",rows:8,value:s?.instructions,onChange:c=>t({instructions:c.target.value}),onBlurCapture:()=>t(c=>({...c,instructions:c.instructions.trim()})),placeholder:C.formatMessage(U.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>l(!0),children:e.jsx(Ki,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...Ds.instructionsWarning})}),y.includes(H.GizmoInstructionsTooLong)?e.jsx(Ie,{className:"mt-1",children:e.jsx(u,{...U.instructionsTooLong,values:{length:wi}})}):null]}),e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(u,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:k.map((c,G)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"rounded-e-none",value:c,type:"text",maxLength:Pi,onChange:L=>{const E=L.target.value;t(F=>({...F,promptStarters:He(G>=(v.length??0)?[...v??[],E]:v.map((O,ne)=>ne===G?E===""?void 0:E:O))}))}}),e.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>t(L=>({...L,promptStarters:v.filter((E,F)=>F!==G)})),children:e.jsx(Gt,{className:"icon-sm"})})]},G))})]}),e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:C.formatMessage(U.knowledgeExplanation)}),e.jsx(Ca,{gizmoEditorData:s,requireGizmoId:d,currentModelConfig:i,updateGizmo:t})]}),P&&M&&e.jsxs(Q,{children:[e.jsx(X,{label:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[e.jsx(u,{id:"wnVs4X",defaultMessage:"Recommended Model"}),e.jsx(Ji,{description:e.jsx(u,{...U.recommendedModelExplainer})})]})}),e.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)",marginTop:"4px",marginBottom:"8px"},children:e.jsx(u,{...U.recommendedModelDescriberUnderTitle})}),e.jsxs("select",{className:"border-token-border-medium bg-token-main-surface-primary w-full rounded-lg border px-3 py-2 text-sm",value:s.defaultModel??"",onChange:c=>{At.logEvent("gizmo_recommended_model_selected",c.target.value),t({defaultModel:c.target.value===""?null:c.target.value})},children:[e.jsx("option",{value:"",children:C.formatMessage({id:"gizmoEditor.noneOption",defaultMessage:"No Recommended Model - Users will use any model they prefer"})}),[...M.models.values()].filter(c=>V.includes(c.id)).sort((c,G)=>c.title.localeCompare(G.title)).map(c=>e.jsx("option",{value:c.id,children:c.title},c.id))]})]}),e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(u,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(ea,{enabledTools:f,onEnabledToolsChange:c=>t({tools:c})})]}),e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(u,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(Aa,{isDisabled:!!(b&&!I),gizmo:s,onShowActionsEditor:g})]}),!b&&za(s)&&e.jsxs(Q,{children:[e.jsx(X,{label:e.jsx(u,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!w,onClick:()=>{p(c=>!c)}}),e.jsx(Ga,{collapsed:w,initial:!1,children:e.jsx(Ti,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(u,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),h&&e.jsx(Ia,{text:s.instructions??"",onChange:c=>{t({instructions:c})},onClose:()=>l(!1),placeholder:C.formatMessage(U.instructionsSubtitle)})]})}const U=ce({recommendedModelDescriberUnderTitle:{id:"gizmo.recommendedModelDescriberUnderTitle",defaultMessage:"Recommend a model to the user, which should be used by default for best results."},recommendedModelExplainer:{id:"gizmo.recommendedModelExplainer",defaultMessage:"When the user loads a new conversation with the GPT the recommended model will be used. If the model is not available to the user, a similar model may be automatically selected."},nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters. If you need to provide more context, you may want to attach a file or knowledge document."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function La(s,t){const i=Ss(s);if(!Array.isArray(s.detail))return i;const a=He(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(U.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(U.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(U.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return a.length>0?a.join(`
`):i}function Ua({upsertDraftError:s}){const t=$(),i=La(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(u,{...Ks.errorSavingDraft})}),i!=null&&e.jsx(Xe,{label:i,children:e.jsx(Rt,{className:"icon-sm"})})]})}function Ea({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:a,className:n}){return a instanceof zt?e.jsx(Ua,{upsertDraftError:a}):i?e.jsxs("div",{className:le("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(u,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(u,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"text-token-text-tertiary w-4",children:t&&e.jsx(Ze,{})})]}):null}const Ks=ce({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),Fa=_s(()=>Cs(()=>import("./m0y7z71dz2s3891b.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44])).then(s=>s.CanvasFocusedViewManager));var Oa=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Oa||{});const Ba=new Lt;function Wa({clientThreadId:s,gizmoHasCustomActions:t,preferredModelId:i}){const{modelLabel:a,dropdownSections:n}=Ii(s,t,i),o=e.jsxs(Gi,{children:[e.jsx(u,{id:"IhcP1l",defaultMessage:"Model"}),e.jsx("span",{className:"text-token-text-secondary text-xs font-medium",children:a}),e.jsx(Ai,{className:"icon-sm text-token-text-tertiary"})]});return e.jsx(Ke,{size:"small",alignOffset:-4,triggerButton:o,children:e.jsx(Ot,{sections:n})})}function Da({gizmoEditorData:s,isSavingDraft:t,showTitle:i=!0}){const[a,n]=m.useState(()=>ye());Us(a,{kind:ie.GizmoTest,gizmo_id:s.id}),m.useEffect(()=>{Ve(a,S=>{S.mode={kind:ie.GizmoTest,gizmo_id:s.id}})},[a,s.id]);const o=s.files?.map(S=>S.file_id).join();m.useEffect(()=>{Ut(a)!=null&&n(ye())},[s.id,s.instructions,s.tools,o,a]);const r=m.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),d=K(),g=ue(d,"1213809372"),f=ue(d,"1854238036");Si(a,s.defaultModel,void 0,s.id);const h=g||f,[l,w]=m.useState(0),p=()=>{w(S=>S-360)},v=s.id,k=Ha(a);m.useEffect(()=>Ns(Ba,{test_gizmo_action:({rootDomain:S,operationName:_})=>{v&&k(v,S,_)}}),[k,v]);const y=m.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(_i,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(vs.Provider,{value:r,children:e.jsx(Ci,{clientThreadId:a,children:e.jsx("div",{className:le("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon"}),e.jsxs("button",{onClick:()=>{p(),n(ye())},className:"flex items-center gap-2",children:[e.jsx(u,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(As.div,{className:"text-token-text-primary",animate:{rotate:l},transition:{duration:.3},children:e.jsx(Ni,{className:"icon invisible group-hover:visible"})})]}),h&&e.jsx(Wa,{clientThreadId:a,gizmoHasCustomActions:!!$s(s.tools),preferredModelId:s.defaultModel??void 0})]})})}),e.jsxs("div",{className:le("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(js,{clientThreadId:a,children:e.jsx(qs,{clientThreadId:a,hideHeader:!0,renderEmptyState:y()})}),e.jsx(sa.Sidebars,{children:e.jsx(Fa,{clientThreadId:a,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})}const hs=Is.memo(Da);function Ha(s){const t=zs(s);return m.useCallback((a,n,o)=>{t({eventSource:"url",promptMessage:Et(`Call the ${n} API with the ${o} operation`,{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:Ft(n)}}}),completionMetadata:{conversationMode:{kind:ie.GizmoTest,gizmo_id:a}}})},[t])}const $a=_s(()=>Cs(()=>import("./l5wcma0jtzapjmsc.js"),__vite__mapDeps([45,1,2,3,46,4,5,47,48,49,35,36,37,38,39,40,50,51,8,34,52,30,53,54,55,56,57])).then(s=>s.GizmoActionsEditor));var Zs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Zs||{});function Ge({value:s,label:t,testId:i}){return e.jsx(Os,{value:s,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":i,children:t})}function Va({className:s,editorTab:t,setEditorTab:i}){const a=$();return e.jsxs(Es,{className:le("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",s),value:t,onValueChange:n=>{i(n)},children:[e.jsx(Ge,{value:"magic",label:a.formatMessage(Ae.magicMakerLabel)}),e.jsx(Ge,{value:"advanced",label:a.formatMessage(Ae.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ge,{value:"preview",label:a.formatMessage(Ae.previewLabel)})})]})}function qa(s,t){return s.length!==t.length?!1:s.every(i=>t.some(a=>a.type===i.type))}function Qa(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&qa(s.tools,t.tools)&&Be(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Js=({gizmo:s,onNewGizmoId:t})=>{const i=Gs(),a=bs(),n=Hs(Me.BrowsingAvailable),o=a?.includes(Me.GizmoCanvasToggle)&&a?.includes(Me.Canvas),r=K(),d=ue(r,"4148168517"),g=$(),f=ae(),h=()=>{const x=[];n&&x.push({type:B.BROWSER}),o&&x.push({type:B.CANVAS});const T={...gs,tools:[...gs.tools,...x]};return d?{...T,tools:[...T.tools.filter(N=>N.type!==B.DALLE),{type:B.IMAGE_GEN}]}:T},l=m.useRef(s!=null?ms(s):h()),w=m.useRef(s),p=m.useRef(l.current),[v,k]=m.useState(()=>l.current),[y,S]=m.useState(()=>ye()),[_]=m.useState(()=>({context_message:oa(l.current),model_slug:Re.GPT_4o,enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ga(y,p.current,_);const{data:b}=$e({isGizmo:!0}),I=b?.models.get(ys)??(b&&Ls(b.models.values(),x=>x.tags.includes(Re.GPT_4o))),{data:C}=$t(l.current.id),M=Vt(),{isPending:P,error:z}=M,V=qt(),c=m.useMemo(()=>C!=null&&!Qa(v,C),[v,C]),G=async()=>{const x=l.current;try{const T=await M.mutateAsync({editorData:x,gizmoId:x.id});if(w.current=T,l.current.id==null){const N=T.gizmo.id;l.current={...l.current,id:N,sharingTargets:T.gizmo.sharing_targets},k(l.current),t?.(N)}for(const N of T.tools.filter(D=>D.type===B.JIT_PLUGIN)){const D=l.current.tools.find(J=>J.type===B.JIT_PLUGIN&&J.metadata.domain===N.metadata.domain);D&&D.metadata.action_id!==N.metadata.action_id&&(D.metadata={...D.metadata,action_id:N.metadata.action_id},k(l.current))}return T}catch(T){const N=Ss(T)??g.formatMessage(Ks.errorSavingDraft);throw f.warning(N,{duration:2}),T}},L=m.useRef(void 0),E=async()=>l.current.id!=null?l.current.id:(L.current==null&&(L.current=G().then(x=>x.gizmo.id).catch(x=>{throw L.current=void 0,x})),L.current),[F]=m.useState(()=>Ri(()=>G(),2e3,{trailing:!0})),O=m.useCallback((x,T=!0)=>{const N=typeof x=="function"?x(l.current):Li(l.current,x);Be(N,l.current)||(l.current=N,k(l.current),T&&F())},[F]),ne=m.useRef(void 0);m.useEffect(()=>Ns(Qt,{completionFinished:async x=>{const T=x.serverThreadId;if(T==null){pe(!1);return}try{const N=await na(l.current,T,f,ne.current);N!=null&&(O(N),p.current=Rs(l.current))}catch(N){ze.addError(N),f.warning("Something went wrong generating your GPT",{duration:3})}finally{ne.current=re.getCurrentNode(me(T)).message.id,pe(!1)}}}),[f,O]);const fe=da(y,_),[Z,q]=m.useState(void 0);m.useEffect(()=>{q(Vi(s))},[s?.gizmo.id]);const j=async(x,T)=>{const N=we(l.current,x.recipient,T);if(N.length>0){f.warning(`Could not save GPT:

${N.map(ee=>`- ${Ee(ee)}`).join(`
`)}`,{duration:3});return}const D=await G(),J=D.gizmo.id;try{return ks.logEvent("Promote Gizmo",{gizmo_id:D.gizmo.id,sharing_recipient:x.recipient,editor_tab:A}),await V.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:x.subjects,sharingRecipient:x.recipient,categories:T==null?void 0:[T]}},{onSuccess(ke){i.setQueryData(rs(i,J).queryKey,ke),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:J}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:J}]})}})}catch(ee){if(ee instanceof Yt)q({gizmoId:J,sharingRecipient:x.recipient,moderationType:Vs.PublishBlocked,sharingTargets:ee.response?.sharing_targets,showModal:de.AppealAvailable});else{ze.addError(ee);const ke=ee.detail??"An unknown error occurred";f.warning("Error saving GPT - "+ke,{duration:6})}}},[A,ss]=m.useState(()=>{const x=ns.getItem(os.GizmoEditorTab);return Object.values(Zs).includes(x)?x:"magic"}),Pe=Xt.useState(({windowWidth:x})=>x);m.useEffect(()=>{Pe!=null&&Pe>=768&&A==="preview"&&ss("magic")},[Pe,A]);const[et,st]=m.useState(!1),[ts,pe]=m.useState(!1),[is,Te]=m.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(Ta,{gizmoEditorData:v,isUpsertLoading:M.isPending,isPromoteLoading:V.isPending,hasUnpublishedChanges:c,isUploadingProfilePic:et,isGeneratingProfilePic:ts,publishedGizmo:C,updateGizmo:O,promoteGizmo:async(x,T)=>{const N=await j(x,T);return l.current={...l.current,sharingRecipient:x.recipient},k(l.current),ns.setItem(os.GizmoEditorTab,A),N},appealGizmo:async(x,T)=>{Z!=null&&q({...Z,sharingRecipient:x,categories:T==null?void 0:[T],showModal:de.AppealAvailable})},setAppealState:q,revertDraft:C!=null&&c?()=>{const x=i.getQueryData(rs(i,l.current.id).queryKey);if(x!=null){const T=ms(x);l.current=T,k(T),G()}}:void 0,draftMessage:e.jsx(Ea,{isPublished:C!=null&&(C.gizmo.share_recipient==="marketplace"||C.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:c,isSavingDraft:P,upsertDraftError:z,className:"text-sm"}),showActionsModal:x=>{Te(x)},className:"shrink-0"}),Z&&e.jsx(qi,{appealState:Z,onAppealClose:()=>q({...Z,showModal:de.None}),onAppealSubmitted:()=>q({...Z,showModal:de.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:is!==void 0?e.jsx($a,{currentlyEditingActionDomain:is,gizmoEditorData:v,updateGizmo:O,onClose:()=>{Te(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Va,{editorTab:A,setEditorTab:ss,className:"mb-2 shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:A==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(pa,{gizmoEditorData:v,updateGizmo:O,clientThreadId:y,gizmoEditorDataRef:l,magicMakerBehaviorOverrides:_,magicMakerConversationGizmoEditorDataRef:p,requireGizmoId:E},y)}):A==="advanced"?e.jsx(Ra,{gizmoEditorData:v,updateGizmo:O,currentModelConfig:I,generateProfilePic:x=>{pe(!0),fe(x,l,p,ua)},setIsUploadingProfilePic:st,isGeneratingProfilePic:ts,setIsGeneratingProfilePic:pe,requireGizmoId:E,onShowActionsEditor:x=>{Te(x)}}):e.jsx(hs,{gizmoEditorData:v,isSavingDraft:P,showTitle:!1})})]})})}),e.jsx("div",{className:le("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",A!=="preview"&&"md:flex"),children:e.jsx("div",{className:"grow",children:e.jsx(hs,{gizmoEditorData:v,isSavingDraft:P})})})]})]})};function Xa({gizmoId:s,version:t}){const{data:i}=Wt({gizmoId:s,draft:!0,version:t}),a=be(Ms.accountUserId),o=Dt()?.id,r=Ht(i)&&i!=null&&a!=null&&o!=null;return i==null||!r?null:e.jsx(Js,{gizmo:i})}function Ya({onNewGizmoId:s}){return e.jsx(Js,{onNewGizmoId:s})}const Ka=({gizmoId:s,remixSourceId:t,version:i})=>{const a=ge(),n=K(),o=Je(n),r=m.useRef(void 0);m.useEffect(()=>(as.enterGizmoEditor(),()=>{as.exitGizmoEditor()}),[]);let d=s;return s!=null&&r.current===s&&(d=void 0),zi({resetThreadAction:()=>{a("/")}}),o?d!==void 0?e.jsx(Xa,{gizmoId:d,version:i},d):e.jsx(Ya,{remixSourceId:t,onNewGizmoId:g=>{r.current=g,window.history.replaceState(window.history.state,"",Bt(g))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ze,{})})},Ae=ce({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Za(s){const t=ge();m.useEffect(()=>{s||t(Kt(Zt.NO_ACCESS))},[s,t])}const fn=()=>(Ui(),null),pn=Jt(function(){const t=K(),i=Je(t),a=!!i?.hasPlusFeatures();Za(i==null||a);const n=ai(),[o]=ni(),r=ge(),d=n.slug,g=o.get("version"),f=d?ei(d):void 0,h=o.get("remixFrom");return m.useEffect(()=>{Ei(!0).then(l=>{Fi.initializeAndGatherData(l),Oi.initializeAndGatherData(l)})},[]),m.useEffect(()=>{i!=null&&!a&&r("/")},[i,r,a]),m.useEffect(()=>{f&&ls(f)&&r(`/g/${d}/project`)},[f,r,d]),!a||f&&ls(f)?null:e.jsx(si,{children:e.jsx(Ka,{gizmoId:f,remixSourceId:h??void 0,version:g!=null?Number(g):void 0})})});export{Ba as G,Oa as a,fn as c,pn as g};
//# sourceMappingURL=l0megibcinj0wzxk.js.map
