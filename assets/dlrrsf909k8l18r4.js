import{R as h,ch as v,d as Q,cD as w,dV as P,nO as F,m as x,nP as O,nQ as G,nR as K,nS as W,nT as U,ma as E,eO as N,eP as k,nU as z,nV as V,dR as j,dX as H,nW as J,eC as Z,nm as X,be as $,bg as S}from"./g670b8vtkhx0yc6d.js";import{f as C,u as M,a as _,b as R,j as t,r as y,e as L}from"./gg0tb34p9fzo1omt.js";import{W as Y}from"./iqrx9d1h7vf5nk0v.js";import{d as I,e as ee,c as se}from"./m22845s1ft2he4f8.js";import{aE as te}from"./forbprkns1cohsbl.js";const ge=({workspaceId:e,roleId:a})=>C({queryKey:[e,"role",a],enabled:!!a,queryFn:async()=>(await h.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).role,staleTime:1e3*60*5}),fe=({workspaceId:e})=>C({queryKey:[e,"roles"],queryFn:()=>h.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e}}})}),be=({workspaceId:e,currentRoles:a})=>{const s=M(),u=v(),r=R(),{mutateAsync:o}=_({mutationFn:i=>h.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_name:i.name,description:i.description}}),onMutate:({name:i,description:l})=>{s.cancelQueries({queryKey:[e,"roles"]});const m=a;return s.setQueryData([e,"roles"],d=>(d||(d={data:[],object:"list",has_more:!1}),{...d,data:[{id:"new",name:i,permissions:[],resource_type:"workspace",predefined_role:!1,description:l,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...d.data]})),{previousRoles:m}},onError:(i,l,m)=>{s.setQueryData([e,"roles"],m?.previousRoles),s.invalidateQueries({queryKey:[e,"roles"]}),i.message==="Role with this name already exists."&&u.warning(r.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},onSuccess:()=>{s.invalidateQueries({queryKey:[e,"roles"]})}});return{createRole:o}},he=({workspaceId:e})=>{const a=M(),{mutateAsync:s}=_({mutationFn:async u=>await h.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:u}}}),onSettled:()=>{a.invalidateQueries({queryKey:[e,"roles"]})}});return{deleteRole:s}},xe=({workspaceId:e})=>{const a=M(),s=v(),u=R(),{mutateAsync:r}=_({mutationFn:async o=>await h.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:o.id}},requestBody:{role_name:o.name,description:o.description,permissions:o.permissions}}),onMutate:({id:o,name:i,permissions:l})=>{const m=a.getQueryData([e,"role",o]);return a.setQueryData([e,"role",o],d=>({...d,name:i,permissions:l})),{previousRoles:m}},onError:(o,i,l)=>{a.setQueryData([e,"role",i.id],l?.previousRoles),o.message==="Role with this name already exists."?s.warning(u.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):s.danger(u.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{a.invalidateQueries({queryKey:[e,"roles"]}),s.success(u.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:r}},ye=({workspaceId:e,roleId:a})=>C({queryKey:[e,a,"role-groups"],queryFn:async()=>(await h.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).groups}),Me=({workspaceId:e,roleId:a})=>{const s=M(),{mutateAsync:u}=_({mutationFn:async({id:r})=>await h.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_id:a,principal_id:r,principal_type:"group"}}),onSuccess:(r,o)=>{const i=[e,a,"role-groups"];s.setQueryData(i,l=>[...l,{id:o.id,name:o.name??"",num_members:o.num_members??0,created_time:new Date().toDateString()}]),s.invalidateQueries({queryKey:i})}});return{assignGroup:u}},_e=({workspaceId:e,roleId:a})=>{const s=M(),{mutateAsync:u}=_({mutationFn:async r=>await h.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e,role_id:a,principal_id:r,principal_type:"group"},path:{workspace_id:e}}}),onSuccess:(r,o)=>{const i=[e,a,"role-groups"];s.setQueryData(i,l=>l?l.filter(m=>m.id!==o):[]),s.invalidateQueries({queryKey:i})}});return{unassignGroup:u}},ae=()=>{const e=Q(),a=w(),s=P(),u=F(),r=a?.residencyRegion==="no_constraint"&&!s,o=x(e,"614413305"),i=x(e,"773249106"),l=x(e,"417039829"),m=x(e,"2509278897"),d=x(e,"3940160259"),c=x(e,"3507761600"),n=O(),f=G(),p=K(),b=W(),T=U(),{enabled:D}=E(N[k.GITHUB_CONNECTOR]),q=a?.isCBP()??!1,A=z(),B=V();return{isCBP:q,githubConnectorEnabled:D,isInSupportedDrRegion:u,isSharedProjectsEnabled:i,showAgentInternetAccessToggle:c,showHiveToggle:l,showDeepResearchToggle:d,isAppleIntelligenceToggleEnabled:r&&m,isAppleIntelligenceMdmToggleEnabled:o,includeFeatures:n,includeModels:f,includeBetaSettings:p,includeBetaSettingsAdvanced:b,includeGizmoPermissions:T,isMDMEnabled:A,includeAgentMode:B}},re=({ariaLabel:e,role:a,permissionName:s,handleSaveRole:u,disabled:r=!1,disabledReason:o})=>{const i=R();if(s==="codex_github_connector")return t.jsx(ne,{});const l=t.jsx(j,{size:"normal","aria-label":e,checked:r?!1:a.permissions.includes(s),onCheckedChange:m=>{let d=[...a.permissions];m?d.push(s):d=d.filter(c=>c!==s),u({...a,permissions:d})},disabled:r});return r&&o?t.jsx(H,{label:i.formatMessage(o),children:l}):l},ne=()=>{const{enabled:e}=E(N[k.GITHUB_CONNECTOR]);return t.jsx(j,{checked:e,disabled:!0,"aria-hidden":!0})},oe="https://help.openai.com/en/articles/11750701-rbac",Re=({role:e,onSave:a})=>{const s=R(),u=w(),r=ae(),{permissionsBySection:o,totalPermissionsCount:i}=y.useMemo(()=>{const n=J({isCanvasEnabled:!0,isEnterprisey:u?.isEnterprisey()??!1,...r,isQuorumM0:!1,isQuorumM1:!1}).map(p=>({...p,entries:p.entries.filter(b=>b.rbac)})).filter(p=>p.entries.length>0),f=n.flatMap(p=>p.entries).length;return{permissionsBySection:n,totalPermissionsCount:f}},[u,r]),[l,m]=y.useState(""),d=o.map(c=>({...c,entries:c.entries.filter(n=>{const f=typeof n.title=="string"?n.title:s.formatMessage(n.title),p=n.description?typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues):"";return n.rbac&&([f,p].join(" ").toLowerCase().includes(l.toLowerCase())||n.permissionName.toLowerCase().includes(l.toLowerCase()))})})).filter(c=>c.entries.length>0);return t.jsxs(I,{children:[t.jsx("div",{className:"text-token-text-secondary text-sm",children:s.formatMessage(ie.customRoleDescription,{link:c=>t.jsx(Z,{className:"underline",target:"_blank",rel:"noreferrer",href:oe,children:c})})}),t.jsx("div",{className:"flex flex-row items-center justify-between",children:t.jsx(X,{inputClassName:"w-[250px] rounded-full! text-sm",value:l,onChange:c=>{m(c.target.value)},placeholder:s.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:i})})}),d.map(c=>t.jsx(Y,{title:c.title,description:c.description,descriptionValues:c.descriptionValues,children:t.jsx(ee,{children:c.entries.map(n=>{const f=n.permissionName,p=typeof n.title=="string"?n.title:s.formatMessage(n.title);return t.jsx(se,{children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-md",children:p}),n.description&&t.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues)})]}),t.jsx(re,{ariaLabel:p,role:e,permissionName:n.permissionName,handleSaveRole:a,disabled:n.disabled,disabledReason:n.disabledReason})]})},f)})})},String(c.title.defaultMessage)))]})},ie=L({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A userâ€™s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},discardChangesLabel:{id:"0gdhtj",defaultMessage:"Discard changes"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),Ce=({onClose:e,onSave:a,isCreate:s,defaultData:u})=>{const r=R(),[o,i]=y.useState(u?.name||""),[l,m]=y.useState(u?.description||""),[d,c]=y.useState(""),[n,f]=y.useState(!1),p=async()=>{if(!o.trim()){c(r.formatMessage(g.roleNameError));return}f(!0);try{await a({name:o,description:l}),e()}catch{}finally{f(!1)}};return t.jsx($,{testId:"modal-upsert-role",size:"custom",className:"max-w-lg text-sm",isOpen:!0,onClose:e,showCloseButton:!0,type:"success",title:r.formatMessage(s?g.createRoleTitle:g.editRoleTitle),primaryButton:t.jsx(S,{color:"primary",onClick:()=>p(),loading:n,children:r.formatMessage(g.buttonSaveLabel)}),secondaryButton:t.jsx(S,{onClick:e,color:"secondary",children:r.formatMessage(g.buttonCancelLabel)}),children:t.jsxs("form",{className:"flex flex-col gap-6",children:[t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(g.roleNameLabel)}),t.jsx("input",{type:"text",className:`border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm ${d?"border-token-text-status-error":""}`,placeholder:r.formatMessage(g.roleNameLabel),value:o,onChange:b=>{i(b.target.value),c("")}}),d&&t.jsx("span",{className:"text-token-text-status-error mt-1 text-xs",children:d})]}),t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(g.descriptionLabel)}),t.jsx("span",{className:"text-token-text-tertiary ms-1 text-sm font-medium",children:r.formatMessage(g.optionalLabel)}),t.jsx("input",{type:"text",className:"border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm",placeholder:r.formatMessage(g.descriptionLabel),value:l,onChange:b=>m(b.target.value)})]}),t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary mb-1 flex w-full flex-row gap-4 rounded-xl p-4",children:[t.jsx(te,{className:"icon"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:r.formatMessage(g.infomationTitle)}),t.jsx("div",{className:"text-token-text-secondary",children:r.formatMessage(g.informationText)})]})]})]})})},g=L({createRoleTitle:{id:"xmlnWv",defaultMessage:"New custom role"},editRoleTitle:{id:"6A6tgB",defaultMessage:"Edit custom role"},roleNameLabel:{id:"VGBBHP",defaultMessage:"Role name"},optionalLabel:{id:"KR/EbO",defaultMessage:"(optional)"},descriptionLabel:{id:"BnuWZw",defaultMessage:"Description"},infomationTitle:{id:"L1pBDh",defaultMessage:"What's a custom role?"},informationText:{id:"DvDdnE",defaultMessage:"Roles are a great way to control which features a user can access. When assigned, the userâ€™s permissions will be calculated as the sum of their custom roles."},buttonCancelLabel:{id:"rMxszm",defaultMessage:"Cancel"},buttonSaveLabel:{id:"JELOdt",defaultMessage:"Save"},roleNameError:{id:"iyN7K7",defaultMessage:"Role name is required"}}),le="role-workspace-member",Se=e=>e.id.startsWith(le)&&e.predefined_role;export{re as P,Re as R,Ce as U,Me as a,_e as b,ge as c,he as d,xe as e,fe as f,be as g,ae as h,Se as i,ye as u};
//# sourceMappingURL=dlrrsf909k8l18r4.js.map
