const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/getvm5mgtnpzq2ky.js","assets/gg0tb34p9fzo1omt.js","assets/forbprkns1cohsbl.js","assets/g670b8vtkhx0yc6d.js","assets/root-ilxovqci.css","assets/conversation-small-mtta3ozz.css","assets/bkdh21oto7zc9owi.js","assets/efiwa07221ko4miy.js","assets/eevne3mgmubxp954.js","assets/f05qbhqoe2emb7iq.js","assets/o7vbzpc2nqgu80zi.js"])))=>i.map(i=>d[i]);
import{b as Ss,r as l,j as e,M as W,o as na,h as oa,O as aa}from"./gg0tb34p9fzo1omt.js";import{cD as ra,d as Ee,f$ as ia,gI as Un,bU as As,a7 as Pe,iL as la,bm as xs,dE as Cs,bV as bs,bW as ys,P as fe,cq as ca,ar as Ys,ad as qs,hx as ua,ic as tt,gr as at,a6 as Oe,nX as da,co as On,F as ps,b9 as fs,h as G,a4 as zn,aW as ma,g0 as Gn,ch as rt,c5 as Ae,g1 as Ue,O as pa,nY as fa,e6 as it,cG as ga,o as Wn,hr as ha,N as Sa,cg as Aa,dw as xa,nZ as Ca,ht as ba,ap as ya,m as xe,g3 as yn,aq as Pa,eD as ka,mZ as ja,eG as Ma,n_ as Ta,iA as Pn,iN as Vn,dD as Ra,hj as kn,ia as va,cE as wa,gn as _a,e5 as Ea,bq as x,hn as jn,hk as Ba,mC as Fa,i_ as Mn,e as we,my as Da,mz as Ia,g as ds,C as Tn,j1 as La,gp as Rn,a as $s,l as ye,eP as Ha,cl as Kn,lz as Na,n$ as vn,gA as ms,hY as Ua,mB as Oa,mD as za,g2 as Qs,G as lt,b6 as Ga,bn as Wa,o0 as Yn,o1 as Va,at as Ka,o2 as Ya,dP as gs,iM as qa,o3 as $a,dt as Qa,b2 as Ja,o4 as Xa,j as nt,gq as Za,o5 as er,eb as sr,dj as wn,jQ as tr,o6 as nr,o7 as or,o8 as ar,fn as ot,o9 as rr,oa as ir,gt as lr,l7 as cr,ob as ur,oc as dr,od as mr,D as pr,ay as fr,az as gr,dF as qn,hi as hr,go as Sr,dx as Ar,gQ as xr,a8 as Cr,mu as br,gZ as yr,oe as Pr,e9 as kr,ea as jr,e0 as Mr,aB as Tr,mA as Rr,lb as vr,of as wr,eO as _r,gB as Er,og as Br,kN as Fr}from"./g670b8vtkhx0yc6d.js";import{i as ze,j2 as Dr,j3 as Ir,j4 as Js,B as $n,k as Qn,l as Jn,j5 as Lr,f9 as ee,fa as _e,j6 as u,j7 as Hr,j8 as Nr,gm as Ur,j9 as Or,ja as zr,jb as Gr,jc as Wr,jd as Vr,je as Kr,jf as Yr,jg as qr,jh as $r,ji as Qr,jj as Jr,jk as Xr,jl as Zr,jm as ei,jn as si,jo as ti,jp as ni,jq as Xn,jr as oi,js as ai,jt as ri,ju as ii,jv as li,jw as ci,jx as ui,jy as di,gv as mi,jz as pi,jA as fi,jB as gi,jC as hi,jD as Si,jE as Ai,jF as xi,jG as Ci,jH as bi,jI as yi,jJ as Pi,jK as ki,jL as ji,jM as Mi,jN as Ti,jO as Ri,jP as vi,jQ as wi,jR as _i,b$ as Zn,jS as eo,A as ct,jT as Ei,jU as Bi,jV as Fi,aP as Di,jW as so,q as Ii,jX as Li,jY as Hi,jZ as _n,j_ as Ni,j$ as Ui,ds as Oi,du as zi,k0 as Gi,k1 as Wi,k2 as Vi,fn as Ki,k3 as Yi,k4 as qi,k5 as $i,k6 as Qi,k7 as Ji,k8 as Xi,k9 as Zi,ka as el,kb as sl,kc as tl,kd as nl,ke as ol,kf as al,dF as rl,fy as il,kg as ll,kh as En,d3 as Ne,hc as cl,hd as ul,he as dl,ki as ml,kj as pl,kk as fl,kl as gl,km as hl,kn as Sl,ko as Al,kp as xl,kq as Cl,kr as bl,ks as yl,kt as I,aD as Pl,ku as kl,kv as jl,kw as Xs,b_ as Ml,kx as Tl,ky as Rl,kz as vl,kA as wl,kB as _l,kC as Zs,kD as Bn,kE as El,kF as Bl,kG as Fl,bZ as Dl,kH as Il,kI as Fn,kJ as Ll,cq as Dn,d as Hl,bf as Nl,kK as Ul,ip as Ol,kL as zl,kM as Gl,kN as Wl,kO as Vl,d5 as Kl,kP as In,kQ as Ln,kR as Hn,kS as Yl,kT as ql,kU as $l,kV as Nn,i3 as Ql,kW as Jl,kX as Xl,i6 as Zl,i7 as ec,kY as sc,kZ as tc,k_ as nc,k$ as oc,hA as ac,l0 as rc,l1 as ic,l2 as lc,l3 as cc,dA as uc,l4 as dc,bd as to,l5 as mc,l6 as pc,l7 as fc,iL as gc,dE as hc,l8 as Sc,d6 as Ac,l9 as xc,z as Cc,la as bc,lb as yc,lc as Pc,ld as et,fl as st,le as kc,lf as jc,E as Mc,lg as Tc}from"./forbprkns1cohsbl.js";import{P as Rc,u as vc}from"./me58wahxzwibdrxp.js";import{u as wc}from"./pnx8yl9r7yj5moem.js";import{getTabScreenshot as _c}from"./felxwdrg3fgsr1mu.js";import{u as Ec}from"./f51c6zie1stj9anw.js";import{P as Bc,u as Fc,h as Dc}from"./cs320738df36xnc1.js";const hs="month",no="year";function Ic(){const t=ra(),a=Ee(),m=Ss(),{markAsViewed:d}=ze(Dr),{initialBillingDetails:r}=wc(t,!0),f=l.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function h(){try{await Lr(r,f)}catch{}}const{shouldShowBanner:n,discountValue:i,discountDuration:p}=Ir();if(l.useEffect(()=>{n&&i&&p&&Js.logShowReferrerRedemptionBanner()},[n,i,p]),!n||!i||!p)return null;const P=Lc(m,r,i,p),y=Hc(m,r,i,p),k=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:P}),e.jsx("span",{className:"text-token-text-secondary",children:y})]});return e.jsx($n,{onPrimaryCtaClick:()=>{d(),Js.logClickReferrerRedeemButton(),h()},primaryCtaText:e.jsx(W,{...ia(a)}),onDismiss:()=>{d(),Js.logCloseReferrerRedemptionBanner()},content:k})}function Lc(t,a,m,d){const{currencySymbol:r}=Qn(Jn(),a.currency),f=d?d.period:hs,h=d?d.num_periods:1,n=r.code.defaultMessage?.toString()??Un,i=t.formatNumber(m.value,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2});let p;return f===hs?p=h===1?e.jsx(W,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}}):f===no&&(p=h===1?e.jsx(W,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}})),p}function Hc(t,a,m,d){const{currencySymbol:r}=Qn(Jn(),a.currency),f=d?d.period:hs,h=d?d.num_periods:1,n=r.code.defaultMessage?.toString()??Un,i=t.formatNumber(m.value,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2});let p;return f===hs?p=h===1?e.jsx(W,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used â€” claim your free month of Plus."}):e.jsx(W,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:i,num_months:h}}):f===no&&(p=h===1?e.jsx(W,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:i,num_years:h}})),p}const Nc=bs(()=>ys(()=>import("./getvm5mgtnpzq2ky.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),oo=l.memo(function({className:a}){const{store:m}=ee(),d=m.useIsHeaderContentAreaPopulated(),f=m.useContentAreaId(_e.HeaderTop)===u.AgentModeAnnouncementBanner?"z-0":Hr.PromptTextareaHeader;return e.jsx("div",{className:As(a??"absolute start-0 end-0 bottom-full",f),children:e.jsx(Nr,{shouldRender:d,contentArea:_e.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Uc,{}),e.jsx(Oc,{})]})})})});function Uc(){const{store:t}=ee(),a=t.useSharedProps(p=>p?.clientThreadId),m=t.useContentAreaId(_e.HeaderTop),d=Ur(),r=Pe(a,p=>p?.modelId),f=Or.useStore(),h=la(),n=xs(Cs);let i;switch(m){case u.ProjectConversationTaskNoFileAccess:i=e.jsx(Vc,{});break;case u.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(ni,{clientThreadId:a});break;case u.S09KM1:i=null;break;case u.BannerSignup:i=e.jsx(Wc,{});break;case u.BannerTermsDisclaimer:i=e.jsx(Kc,{});break;case u.PromptTextareaAction:i=e.jsx(Yc,{});break;case u.BannersRateLimit:i=e.jsx(qc,{});break;case u.BannersBeaconUI:i=e.jsx($c,{});break;case u.BannerSidekickAnnouncement:i=e.jsx(ti,{});break;case u.SearchBrowserExtensionAnnouncement:i=e.jsx(si,{});break;case u.MoonshineAnnouncement:i=e.jsx(ei,{});break;case u.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx(Zr,{});break;case u.BannerMemoryFull:i=e.jsx(Xr,{});break;case u.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case u.JawboneAnnouncement:d?i=e.jsx(Nc,{}):i=null;break;case u.JawboneMaxActiveAnnouncement:d?i=e.jsx(Jr,{}):i=null;break;case u.PromoRedemptionAnnouncement:i=e.jsx(Rc,{});break;case u.OperatorAnnouncement:i=e.jsx(Qr,{});break;case u.BannerPlusUpsell:i=e.jsx($r,{});break;case u.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(Ic,{});break;case u.RefereeRedemptionAvailableAnnouncement:i=e.jsx(qr,{});break;case u.ReferralProgramUpsellAnnouncement:i=e.jsx(Yr,{});break;case u.TatertotIntakeFormAnnouncement:i=!1;break;case u.StudentsUpsellAnnouncement:i=e.jsx(Kr,{});break;case u.ModelDeprecationBanner:i=Vr(r);break;case u.TeamsContextualAnswersUpsell:i=e.jsx(Wr,{});break;case u.KanziConfig:i=!1;break;case u.AgentModeAnnouncementBanner:i=h&&!n&&e.jsx(Gr,{});break;case u.LanguageUpsellBanner:i=e.jsx(zr,{onDismissSideEffect:()=>{fe.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),f.closeBanner()},onPrimaryCtaClickSideEffect:()=>{fe.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),f.closeBanner()}});break;default:i=null;break}return i}function Oc(){const{store:t}=ee(),a=t.useContentAreaId(_e.HeaderBottom);let m;switch(a){case Xn.DallePromptControls:m=e.jsx(Gc,{});break;default:m=null;break}return m}const zc=bs(()=>ys(()=>import("./efiwa07221ko4miy.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function Gc(){const{store:t}=ee(),a=t.useSharedProps(m=>m?.composerController);return a?e.jsx(zc,{composerController:a}):null}function Wc(){const{store:t}=ee(),a=t.useSharedProps(r=>r?.clientThreadId),m=ca(),d=oi();return a?m?e.jsx(ai,{threadId:a,showSignUp:d}):e.jsx(ri,{threadId:a,showLogin:d}):null}function Vc(){return l.useEffect(()=>()=>{Ys.getItem(qs.TasksHasSeenProjectDisclaimerBanner)||Ys.setItem(qs.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx($n,{icon:e.jsx(ua,{}),title:e.jsx(W,{id:"ibX3g7",defaultMessage:"Tasks canâ€™t access project files"}),content:e.jsx(W,{id:"fm94Tm",defaultMessage:"Thereâ€™s a task in this conversation â€” just FYI, it wonâ€™t be able to access project files."}),onDismiss:()=>{Ys.setItem(qs.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Kc(){const{store:t}=ee(),a=t.useSharedProps(m=>m?.clientThreadId);return a?e.jsx(ii,{threadId:a}):null}function Yc(){const{store:t}=ee(),a=t.useSharedProps();return a?e.jsx(li,{...a}):null}function qc(){const{store:t}=ee(),a=t.useSharedProps(d=>d?.clientThreadId),m=t.useSharedProps(d=>d?.composerController);return!a||!m?null:e.jsx(ci,{clientThreadId:a,composerController:m})}function $c(){const{store:t}=ee(),a=t.useSharedProps(d=>d?.clientThreadId),m=t.useSharedProps(d=>d?.composerController);return!a||!m?null:e.jsx(ui,{clientThreadId:a})}const Qc=5,Jc=l.memo(function(a){return Xc(a),Zc(a),di({clientThreadId:a.clientThreadId}),eu(),null});function Xc(t){const{store:a}=ee(),m=a.useSetSharedProps();tt(()=>{m(t)},[t,m])}function Zc(t){const{clientThreadId:a,canContinue:m}=t,{store:d}=ee(),r=l.useRef({top:d.useContentAreaApi(_e.HeaderTop),bottom:d.useContentAreaApi(_e.HeaderBottom)}).current,f=mi(a),{shouldShowBannerSignup:h,shouldShowBannerTermsDisclaimer:n}=su(a),i=pi(a,t.composerController),p=fi(a),P=gi(t);hi(t);const y=Si(),k=Ai(t),v=xi(a),se=Ci(t),re=bi(a),ie=yi(a),le=vc(),{eligible:te}=ze(Pi),V=ki(),w=ji(),_=Mi(),S=Ti(),ue=Ri(a),j=vi(a),L=wi(),ne=_i(a),o=Pe(a,U=>U?.modelId),H=Zn(a),ge=at(),N=eo(),{eligible:E}=ze(ct.hasSeenAgentModeAnnouncementBanner),oe=E&&N&&ge!==fs;tt(()=>{o&&H?.kind===Oe.GizmoInteraction&&H.gizmo&&da(o,H.gizmo)?r.top.set(u.ProjectConversationTaskNoFileAccess):se.eligible?r.top.set(u.AdvancedVoiceOnMobileAnnouncement):n?r.top.set(u.BannerTermsDisclaimer):i?r.top.set(u.BannersRateLimit):p?r.top.set(u.BannersBeaconUI):L?r.top.set(u.BannerPlusUpsell):re?r.top.set(u.JawboneAnnouncement):ie?r.top.set(u.JawboneMaxActiveAnnouncement):P.eligible?r.top.set(u.BannerSidekickAnnouncement):y?r.top.set(u.MoonshineAnnouncement):k?r.top.set(u.SearchBrowserExtensionReactiveAnnouncement):le?r.top.set(u.PromoRedemptionAnnouncement):te?r.top.set(u.OperatorAnnouncement):_?r.top.set(u.ReferralProgramUpsellAnnouncement):m?r.top.set(u.PromptTextareaAction):h?r.top.set(u.BannerSignup):v?r.top.set(u.BannerMemoryFull):V?r.top.set(u.ReferrerRedemptionAvailableAnnouncement):w?r.top.set(u.RefereeRedemptionAvailableAnnouncement):S?r.top.set(u.StudentsUpsellAnnouncement):ue?r.top.set(u.ModelDeprecationBanner):j?r.top.set(u.TeamsContextualAnswersUpsell):ne?r.top.set(u.LanguageUpsellBanner):oe?r.top.set(u.AgentModeAnnouncementBanner):r.top.set(null)},[r,ge,m,n,h,i,P,v,se,oe]),tt(()=>{f&&r.bottom.set(Xn.DallePromptControls)},[r,f])}function eu(){const{store:t}=ee();l.useEffect(()=>()=>{t.reset()},[t])}function su(t){const a=Ee(),{isUnauthenticated:m}=On(),d=ps(a,"3637408529",{disableExposureLog:!0}),f=ps(a,"3637408529").get("no_auth_banner_signup_rate_limit",Qc),h=d.get("should_show_no_auth_signup_banner",!0),n=Ei(k=>k.bannerDisclaimerClientThreadId),i=Bi(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[P,y]=Pe(t,k=>[G.getConversationTurns(k).filter(v=>v.role===zn.User).length,tu(G.getCurrentNode(k)?.message)]);return t&&(p.shouldShowBannerTermsDisclaimer=y&&m&&P===1&&!i&&(n==null||n===t),p.shouldShowBannerSignup=h&&y&&m&&P>0&&P%f===0),p}function tu(t){return t?.author.role===zn.Assistant&&ma(t)}function nu({modelSupportedImageMimeTypes:t}){const a=xs(Cs),m=Gn(),d=rt(),r=Ss();return a?e.jsx(Ae.Item,{icon:Fi,onClick:async()=>{const f=await _c();if(f)try{const h=atob(f.base64image),n=h.length,i=new Uint8Array(n);for(let P=0;P<n;P++)i[P]=h.charCodeAt(P);const p=new File([i],f.filename,{type:f.mimetype});Di.uploadFile(m,p,t,r,d,void 0,void 0,Ue.Multimodal)}catch{}},children:e.jsx(W,{id:"HiFPUD",defaultMessage:"Attach screenshot"})},"attach_screenshot"):null}function ou({clientThreadId:t,modelSupportedImageMimeTypes:a,openFileDialog:m,historyDisabled:d,isDisabled:r,highlightTooltip:f,disabledReason:h,currentModelName:n,isLoadingConnectors:i,connectorConfig:p,onSelectConnector:P,onConnectorOauthRedirect:y,showLabel:k,showUpsell:v,hideBorder:se,isSmall:re,showMenuForNoAuth:ie,visualTreatment:le}){const te=pa(),{gdriveStatus:V,o365Status:w}=fa(),{isUnauthenticated:_}=On(),S=d?"text-white":f?"text-brand-blue-800":"",ue=!v&&(V!=="false"||w!=="false"||te),j=_?so:Ii,L=e.jsx(j,{"aria-label":"",className:As("icon",S)}),ne=a.length>0,o=ue?e.jsx(Hi,{clientThreadId:t,icon:L,showLabel:_&&k,modelSupportedImageMimeTypes:a,isLoadingConnectors:i,connectorConfig:p,onSelectConnector:P,onConnectorOauthRedirect:y,openFileDialog:m,isDisabled:r,highlightTooltip:f,disabledReason:h,currentModelName:n}):e.jsx(Bc,{isSmall:re,hideBorder:se,clientThreadId:t,openFileDialog:m,showLabel:k,showUpsell:v,icon:L,isDisabled:r,highlightTooltip:f,disabledReason:h,currentModelName:n,visualTreatment:le,showMenuForNoAuth:ie,modelSupportsImages:ne});return e.jsx(Li,{showBackground:f,className:"bg-brand-blue-800/20",children:o})}const au=bs(()=>ys(()=>import("./eevne3mgmubxp954.js"),__vite__mapDeps([8,1,3,4,2,5,9])).then(t=>t.GithubOnboardingModal)),ru=bs(()=>ys(()=>import("./o7vbzpc2nqgu80zi.js"),__vite__mapDeps([10,1,3,4,2,5])).then(t=>t.ImageGenComposer)),iu=()=>null,lu=1,cu=3e3;function uu({onCreateNewCompletion:t,onContinueGenerating:a,account:m,currentModelId:d,currentModelConfig:r,disableDraftPersistence:f=!1,areModelsLoading:h,clientThreadId:n,isNewThread:i,isCompletionInProgress:p,className:P,disabled:y=!1,disabledReason:k,canPause:v=!1,canContinue:se=!1,isInteractableSharedThread:re,onAutocompleteSelect:ie,headerClassName:le,hideHeader:te,onlyAllowImageUploads:V,layoutMode:w,modelsData:_}){"use forget";_n.markStart("PromptTextarea"),_n.markRendered("PromptTextarea");const S=Ee(),ue=l.useRef(null),[j,L]=na(),ne=oa(),o=it();Ni(o),Ui();const H=ga(),ge=m?.isTeam(),N=Wn(S),E=Ss(),oe=rt(),U=Gn(),Be=Oi.useStore(),[O,ke,Ge,We,z,de]=Pe(n,s=>[G.getCurrentLeafId(s),G.getRequestId(s),G.findNode(s,c=>!!c.message.metadata?.b1de6e2_s),G.getIsNewConversation(s),G.lastUserMessage(s)?.metadata?.system_hints?.includes(x.Agent),!!s?.interruptionInProgress&&!!G.getCurrentNode(s)?.message.metadata?.n7jupd_message]),{gizmoEditorData:K,mode:he,getGizmoId:me}=ha(),Fe=Sa(),pe=Aa(),Ve=zi(),Y=xa(n),q=!!Ca(),ao=Gi.useIsEnabled(n),Ke=!!ba(),A=at(),D=ya(),ro=eo(),io=ze(ct.hasSeenAgentModeAnnouncementBanner),ut=xe(S,"222095887"),{fullyCollapsedToolMenu:Ye,showSlashHint:lo}=yn(),dt=Pa.useState(({locked:s})=>s),co=ka(),mt=ja(),{connectionInstanceData:Ps,isLoading:uo}=Ma({skip:!co}),{selectedSources:pt,selectedMCPSources:qe,addSource:ks}=Wi(n);l.useEffect(()=>{const s=j.get("add_source");s&&A&&(ks(s),j.delete("add_source"),L(j))},[A,ks,j,L]);const ft=Vi(S);Ta({skip:!ft,productSku:Pn.PROMPT_TEXT_AREA});const{platformConnectors:gt}=Vn(ft&&(qe?.size??0)>0,Pn.PROMPT_TEXT_AREA),ht=l.useMemo(()=>Array.from(qe??[]).map(s=>gt.get(s)).filter(s=>s!==void 0),[gt,qe]),js=l.useRef(0),$e=l.useRef(!1);let C=Zn(n),Qe=C&&"gizmo"in C?C.gizmo:void 0;const mo=Ra(),Je=Qe?.gizmo.id??mo,St=Ki(Je),po=Yi(),At=qi(n),[$,Xe]=l.useState(null);$!==null&&(C={gizmo:$,gizmo_id:$.gizmo.id,kind:Oe.GizmoInteraction},Qe=$);const je=kn(r,C,A),Ze=va(),xt=wa(S).flags,es=xt?.includes(_a.NoAuthEnableFileUploads),{systemHints:Ct}=Ea(),fo=!xe(S,"3084799213"),bt=We||(z??!1)||fo,b=l.useMemo(()=>Ct?.filter(s=>$i({systemHint:s,modelConfig:r,conversationMode:C,isTemporaryChat:pe}))?.filter(s=>s.systemHint!==x.Agent?!0:bt),[Ct,r,C,pe,bt]),go=b==null||b.length>0,Q=l.useMemo(()=>(A&&b?.find(s=>s.systemHint===A))??null,[b,A]),Ms=l.useCallback(s=>{jn()&&s?.preventDefault(),D(null,{analyticsMetadata:{clientThreadId:n}})},[D,n]),Ts=Qi(d,Q?.systemHint??null),ho=!y&&(je!==Ue.None||h)&&(N||es),J=Ba(r,C),Rs=Fa(r,C);let X=Mn(s=>s.files);const[ss]=l.useState(()=>Ji());he==="magic"?X=X.filter(s=>s.gizmoId!=null):X=X.filter(s=>s.gizmoId==null);const So=Xi(),Me=X.length>0||So,yt=Mn(hr.hasUploadInProgress),Pt=Zi(s=>s.selectedApps),Ao=el()&&Pt.length>0,xo=sl(n),vs=o.useState(s=>tl({currentModelConfig:r,composerController:s})),kt=we(o.isEmpty$),jt=!kt,ts=!vs&&!yt&&(jt||Me),Mt=(je===Ue.Multimodal?Da:Ia)-X.length,Tt=Mt<=0,Co=Q?.systemHint===x.Research,bo=xe(S,"3544641259"),{selectedRepos:ws}=nl(n),Rt=(Co||Ts)&&bo&&pt?.size===0&&qe?.size===0,vt=Ge?.message.metadata?.async_task_id,_s=ol(s=>vt?s.tasks[vt]:null),Es=_s?.status===al.RUNNING,wt=rl(ds(n)||n)?.value,yo=wt===Tn.STREAMING,Po=wt===Tn.REALTIME,ns=p&&v||yo||Po||Es,Te=ts&&!y&&!Ke&&(!ns||At)&&!Rt,[_t,ko]=l.useState(!1),{targetedContent:Et,setTargetedContent:os}=il(),Z=Et?.isFocusedViewContent&&!Ve?void 0:Et;l.useEffect(()=>{!Z||Us.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>o.focus()))},[Z]);const{getUpsellLabelType:jo,getUpsellShowsAttach:Mo}=ll(),{isToolsInPlusMenu:Bs,showConnectedApps:as,isSingleLine:Bt,hasAddFileSlashCommand:Ft,supportsCollapsedMoreMenu:Dt}=yn(),Re=go&&!dt&&(C==null||C?.kind===Oe.PrimaryAssistant||C?.kind===Oe.GizmoInteraction&&St),To=Re&&N&&(!ge||!uo)&&!Rn(A)&&!Bs,rs=$s(o.store,s=>s.controlsDisabled);l.useEffect(()=>{if(!H?.id)return;const s=En.getAndReset(H.id,Y);s&&o.setText(s.inputText)},[H?.id,Y,o]),l.useEffect(()=>{const s=j.get("prompt")??"";o.getCurrentText().length===0&&s.length>0&&o.setText(s)},[o,j]);const Fs=l.useCallback(()=>{A!==x.Slurm&&A!=null&&!b?.some(s=>s.systemHint===x.Slurm)||(Q==null&&D(x.Slurm),ye(n,s=>{const c=s.selectedSources?.get(x.Slurm)??new Set;s.selectedSources??=new Map,s.selectedSources.set(x.Slurm,new Set([...c,Ha.GITHUB_CONNECTOR]))}))},[A,Q,n,D,b]);l.useEffect(()=>{if(j.has("github_onboarding")){const s=j.get("github_onboarding");let c=Ne.ConfigureRepos;s&&[Ne.ConfigureRepos,Ne.SyncRepos,Ne.IndexRepos].includes(s)&&(c=s),mt&&c!==Ne.ConfigureRepos?Fs():Kn(S,au,{initialState:c,onFinishFlow:Fs}),L(g=>(g.delete("github_onboarding"),g))}},[j,L,S,A,Q,n,D,b,Fs,mt]),l.useEffect(()=>{const s=Na(j),c=A??s[0],g=c===x.Slurm,T=c===x.Research;if(!g&&!T)return;const B=j.getAll("sources");if(!B.length)return;const F=j.get("redirect_source"),R=B.map(ce=>ce.trim()).filter(vn),M=new Set(R.filter(ce=>!ms(ce))),ta=new Set(R.filter(ms));ye(n,ce=>{ce.selectedSources=new Map([[c,M]]),ce.selectedMCPSources=new Map([[c,ta]]),ce.hasModifiedSources=!0}),L(ce=>(ce.delete("sources"),ce)),F==="suggested_ca_prompts"&&fe.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[n,ks,j,D,L,A]),l.useEffect(()=>{_t!==Te&&(ko(Te),Te&&cl(!0).then(s=>{ul.startEnforcement(s),dl.startEnforcement(s)}))},[Te,_t,C?.kind,Fe]);const is=Ua(r,C),{handleFileAccepted:It}=Fc(E,kn(r,C,A),J,"mouse",me,is?.attachments),Ro=l.useCallback((s,c)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.focus()})}),It(s,c)),[o,It]),ae=!y&&!Tt&&ho&&Ze==null,{getInputProps:Lt,open:Ht,inputRef:Nt}=Ec({disabled:!ae,noClick:!0,onDropAccepted:Ro,onDropRejected:s=>Dc(s,E,oe,je),multiple:!0,maxSize:za,maxFiles:Mt,...Oa(!N||V?J:Rs)}),Ce=l.useCallback(()=>{ae&&(fe.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:je.toString()}),Ht())},[ae,Ht,je]),Ut=$s(ss),Ot=l.useCallback(()=>{o.eraseContent(),Ut.clearMessages(),o.resize(lu),o.usedDictation=!1,o.dictationEdited=!1,o.dictationAssetPointer=null,o.dictationAssetTTL=null;for(const c of X)Qs.remove(U,c.tempId,"none");if(ml.markAllAsSent(),lt(S)){const c=Ga(S,"269676899"),g=c.get("skip_search",!1);if(c.get("clear_all",!1)){const B=[x.Slurm,x.Tatertot,x.Think];g&&B.push(x.Search),B.push(fs),A&&!B.includes(A)&&D(null)}}},[o,Ut,S,X,U,A,D]),[zt,Ds]=xs(s=>[Wa(s),Cs(s)]),vo=l.useMemo(()=>{if(Ds)return Yn;if(zt)return Va;if(Ka())return Ya},[Ds,zt]),Gt=we(gs.sidebarUrlTrayOpen$)&&Ds,wo=we(gs.context$),_o=qa(),Wt=(s,c)=>{if(s.preventDefault(),y||!ts&&!c||!C||de)return;const g=o.getContentToSend(),T=lc(g.content),{content:B,attachments:F}=cc(U,T,r,C,A);ye(n,R=>{R.hasModifiedSources=!1,R.hasModifiedGithubRepos=!1,R.startedWithMcp===void 0&&(R.startedWithMcp=ht.length>0)}),po(),t({sourceEvent:s,attachments:F,content:B,contentToSend:g,conversationMode:C,hasSelectedApps:Ao,isMessageFollowupsEnabled:ao,selectedApps:Pt,desktopOrigin:vo,shouldCollectSidebarContext:Gt,desktopSidebarContext:wo,selectedGizmoTag:$,selectedRepos:{selectedAllRepos:ws.selectedAllRepos,selectedRepos:ws.selectedRepos?[...ws.selectedRepos]:null},selectedSources:pt,selectedMCPConnectors:ht,systemHints:A?[A]:[],usedDictation:o.usedDictation,dictationEdited:o.dictationEdited,dictationAssetPointer:o.dictationAssetPointer,dictationAssetTTL:o.dictationAssetTTL,isN7jupdActive:Ts,isForceAllowCustomMcpModeEnabled:_o}),Z?.onCreateCompletion?.({serverThreadId:Y,currentLeafId:O}),Z?.shouldPersistAcrossMessages!==!0&&os(void 0),wn.hideThreadHeader();for(const R of X)R.status===Sr.Ready&&Be.addFile(R);Ot(),ro&&A===fs&&io.markAsViewed()},Eo=s=>{os(s.targetedReply),s.targetedReply&&fe.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:Y,sourceMessageId:s.messageId})},{maybeSetWaitingForRealtimeOnAbort:Vt,isWatingForRealtimeStatusChange:Bo}=pl(n),Is=l.useCallback(s=>{Vt(),fl(s,void 0,!0)},[Vt]),Kt=l.useCallback(()=>{Z?.onCleared?.({serverThreadId:Y,currentLeafId:O}),os(void 0),o.focus()},[O,Y,Z,os,o]),De=$a(r?.tags,C?.kind),{isFocused:Fo,autocompletions:Se}=$s(o.store),Ie=Fo&&Se.length>0,Yt=gl(n);l.useEffect(()=>o.subscribe("input",()=>{Yt&&hl(n)}),[o,Yt,n]);const Do=o.isReady(),Io=Qa(),Ls=Ja(_)?.id,qt={Enter:Al({toaster:oe,isAutocompletionActive:()=>Ie&&$e.current,canSubmit:Te,isTextContentTooLong:vs,requestCompletion:Wt}),Escape:Sl({canAbortCompletion:v&&p,clientThreadId:n,isAutocompletionActive:()=>Ie&&$e.current,clearAutocompletions:()=>o.setAutocompletions([]),abortCompletion:()=>Is(n),isEmpty:kt,hasTargetedContent:Z!=null,clearTargetedContent:Kt,hasSystemHint:Q!=null,removeSystemHint:Ms,hasSelectedTarget:$!=null,removeSelectedTarget:()=>Xe(null),hasNonDefaultModel:d!==Ls&&ut,removeNonDefaultModel:()=>{Io({modelId:Ls,location:"Escape key with non-default model"}),Ar(Ls)}})},Hs=l.useRef(qt);Hs.current=qt,l.useEffect(()=>{const s=Object.fromEntries(Object.keys(Hs.current).map(c=>[c,T=>{const B=Hs.current[c];return B?B(T):!1}]));o.registerKeyHandlers(s),o.registerFileInput({openFileDialog:Ce,inputRef:Nt})},[o,Ce,Nt,Do]),l.useEffect(()=>o.subscribe("paste",s=>{xl({filePickerStore:U,event:s,intl:E,toaster:oe,clientThreadId:n,conversationMode:C,currentModelConfig:r,getEditorGizmoId:me,modelSupportedImageMimeTypes:J,activeSystemHintType:A,setActiveSystemHintType:D,ctx:S})}),[E,n,C,r,me,J,o,oe,U,A,D,S]);const $t=l.useCallback(s=>{if(o.trimLeadingText("@"),s==="manage-prompts"){ne("/library?tab=prompts");return}if(ye(n,c=>{c.isUsingPromptTemplate=!0}),o.appendText(s.prompt),s.system_hint&&(D(s.system_hint),s.sources?.length)){const c=s.sources.map(F=>F.trim()).filter(vn),g=s.system_hint,T=new Set(c.filter(F=>!ms(F))),B=new Set(c.filter(ms));ye(n,F=>{F.selectedSources=new Map([[g,T]]),F.selectedMCPSources=new Map([[g,B]]),F.hasModifiedSources=!0})}},[o,ne,D,n]),Lo=Xa(n,ss,J,is?.attachments),Ho=l.useCallback(s=>{s.preventDefault(),Is(n),fe.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:ds(n),currentLeafId:G.getCurrentNode(nt(n)).message.id,eventSource:"mouse"}),Cl()},[n,Is]),Ns=l.useCallback(()=>{En.set(H?.id,Y,o.getCurrentText())},[Y,H?.id,o]),Us=La(S);l.useEffect(()=>{K||Us.composer.autofocusDisabled$()||o.focus()},[o]),l.useEffect(()=>{if(J.length>0)for(const c of X)bl(c.fileSpec?.mimeType,Rs)||Qs.remove(U,c.tempId,"none");else Qs.reset(U)},[d,U]),l.useEffect(()=>{(!De&&$||q)&&Xe(null)},[De,$,q]);const No=ps(S,"4031588851"),Qt=ps(S,"3637408529"),Uo=Qt.get("is_in_composer_text_exp",!1),Oo=Qt.get("composer_text","MESSAGE_CHATGPT"),zo=No.get("composer_text","MESSAGE_CHATGPT"),Go=Uo?Oo:zo,[ls,Wo]=(()=>{const s=k?yl(k):void 0;if(s)return[s.placeholder,s.isLastingDisabledStyle];if(re)return[I.placeholderWithName,!1];if(Z?.placeholderTextOverride!=null)return[Z.placeholderTextOverride,!1];if(r?.id===Za)return[I.n7jupdSystemHintPlaceholder,!1];if(Q){if(Rn(Q.systemHint))return ns?[I.n7jupdActivePlaceholder,!1]:[I.n7jupdSystemHintPlaceholder,!1];switch(Q.systemHint){case x.Search:return[I.searchPlaceholder,!1];case x.Think:return[I.thinkPlaceholder,!1];case x.Slurm:return[I.connectorPlaceholder,!1];case x.Research:return[I.researchPlaceholder,!1];case x.Canvas:return[I.canvasPlaceholder,!1];case x.Picture:return[I.picturePlaceholder,!1];case x.PictureV2:return[I.pictureV2Placeholder,!1];case x.ContextualAnswers:return[I.contextualAnswersPlaceholder,!1];case x.Tatertot:return[I.tatertotPlaceholder,!1]}}switch(Go){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[I.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[I.placeholderAskNameAnythingVariant,!1];default:return[I.placeholderWithName,!1]}})(),Jt=St?i?E.formatMessage(Pl.newChatInProject,{projectName:Qe?.gizmo.display.name??"this project"}):ls?E.formatMessage(ls,{name:"ChatGPT"}):"â€‹":ls?E.formatMessage(ls,{name:K!=null?he==="magic"?er:K.name||"GPT":Qe?.gizmo.display.name??"ChatGPT"}):"â€‹";l.useEffect(()=>o.subscribe("input",()=>{sr.getState().isThreadHeaderVisible&&wn.hideThreadHeader()}),[o]),l.useEffect(()=>o.subscribe("input",()=>{js.current=performance.now()}),[o]);const Os=tr()&&!!Se.find(s=>!!s.requires_file_upload),{connectorConfig:be,isLoading:Xt}=nr(),{onSelectConnector:cs,onConnectorOauthRedirect:zs}=kl({connectorConfig:be,modelSupportedImageMimeTypes:J,modelAcceptedMimeTypes:Rs,attachmentsProductFeature:is?.attachments,onOauthRedirect:Ns});jl(be,cs);let Zt=null;const us=[],en=[],sn=Mo(),Vo=N||sn||es,Gs=je===Ue.None&&!h?Xs.ModelNotSupported:Tt?Xs.HasReachedMaxFiles:Ze!=null?Xs.RateLimitReached:void 0,Ko=or("(width <= 510px)",ar);w||(w=i&&!Ko?"center":"bottom");const tn=J.length>0;if(N&&Bs){const s=[e.jsxs(Ae.Group,{children:[e.jsx(Ml,{openFileDialog:Ce,modelSupportsImages:tn,showMenuForNoAuth:!1,isDisabled:!ae,disabledReason:Gs,currentModelName:r?.title,rateLimitInfo:Ze}),ae&&tn&&e.jsx(Tl,{modelSupportedImageMimeTypes:J}),ae&&(as?e.jsx(Rl,{includeAction:!0,shortName:!0,connectorConfig:be,onConnectorClick:cs}):e.jsx(vl,{isLoadingConnectors:Xt,connectorConfig:be,onConnectorClick:cs,onOauthRedirect:zs})),e.jsx(wl,{}),e.jsx(nu,{modelSupportedImageMimeTypes:J})]},"add-files")],c=4,g=Dt&&Re&&(as&&_l(be)||b&&b.length>c+1),T=as&&e.jsx(Ae.Group,{children:e.jsx(sc,{includeSeparator:!1,includeAction:!0,shortName:!0,connectorConfig:be,onConnectorClick:zs})},"connect-apps"),B=[],F=[];if(Re&&b)if(Ye)s.push(e.jsx(Ae.Separator,{},"tools-separator")),F.push(e.jsx(Zs,{systemHints:b,selectedHintType:A,onSelectHintType:R=>{D(R,{analyticsMetadata:{clientThreadId:n}})}},"tools-items-system-hints")),as&&F.push(T);else{const R=b&&(g?b.slice(0,c):b);s.push(e.jsxs(Ae.Group,{children:[e.jsx(Zs,{systemHints:R,selectedHintType:A,onSelectHintType:M=>{D(M,{analyticsMetadata:{clientThreadId:n}})}}),g&&e.jsxs(Bn,{layoutMode:w,children:[e.jsx(Ae.Group,{children:e.jsx(Zs,{systemHints:b?.slice(c),selectedHintType:A,onSelectHintType:M=>{D(M,{analyticsMetadata:{clientThreadId:n}})}})}),T]},"plus-more-menu")]},"system-hints"))}Ye&&F.length>0?s.push(e.jsx(El,{layoutMode:w,items:F},"collapsed-tool-menu")):g&&B.length>0&&s.push(e.jsx(Bn,{layoutMode:w,children:B},"plus-more-menu")),ut&&(Ye||s.push(e.jsx(Ae.Separator,{},"models-divider")),s.push(e.jsx(Bl,{selectedModelId:d},"models-menu"))),T&&!g&&!Ye&&s.push(T),lo&&(s.push(e.jsx(Ae.Separator,{},"tools-separator")),s.push(e.jsx("div",{className:"text-token-text-tertiary p-2 text-center text-sm",children:E.formatMessage({id:"composer.plusMenu.typeSlashForQuickAccess",defaultMessage:"Type '/' for quick access"})}))),w==="bottom"&&!Dt&&s.reverse(),Zt=e.jsx(Fl,{onCloseAutoFocus:R=>{Us.composer.autofocusDisabled$()||(R.preventDefault(),o.focus())},items:s,children:e.jsx(Dl,{disabled:y,clientThreadId:n,rateLimitPopup:Bs?null:Ze,highlightTooltip:Os&&!Me,label:E.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}),secondaryLabel:e.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:e.jsx("span",{children:"/"})}),children:e.jsx(Il,{onDoubleClick:ae?Ce:void 0,onPointerDown:R=>{if(!jn())return;const M=Fn(S);M.isKeyboardOpen()&&(R.preventDefault(),M.closeKeyboard(()=>{Ll(S).open.set(!0)}))},disabled:rs})})})}else if(Vo){const s=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ou,{clientThreadId:n,modelSupportedImageMimeTypes:J,openFileDialog:Ce,historyDisabled:pe,highlightTooltip:Os&&!Me,isLoadingConnectors:Xt,connectorConfig:be,onSelectConnector:cs,onConnectorOauthRedirect:zs,showLabel:jo()==="all",showUpsell:sn&&!es,showMenuForNoAuth:es,isDisabled:!ae||rs,disabledReason:Gs,currentModelName:r?.title??"",visualTreatment:N?"composer-btn":"legacy"})},"file-upload-button");us.push(s),en.push(s)}N?To&&us.push(e.jsx(nc,{activeSystemHintType:A,systemHints:b,composerController:o,clientThreadId:n,disabled:rs})):us.push(e.jsx(tc,{account:m,clientBootstrapFlags:xt,features:Fe,currentModelConfig:r,isDisabled:!!rs,clientThreadId:n,composerController:o,gizmoId:Je}));const[Yo,nn]=l.useState(!1),on=Wo||Bo?"disabled":"default",qo=!Te,an=$l({promptDisabledReason:k,hasPendingFiles:yt,hasTextContent:jt,isTextContentTooLong:vs,hasAsyncTaskPending:xo,noSourceSelectedDr:!Rt,isDeepResearchTaskStreaming:Es,isThreadHardBlocked:Ke}),Le=ns?"streaming":qo?"disabled":"idle",He=l.useRef(null),ve=l.useRef(null),$o=xe(S,"222560275")||d&&!d.startsWith("o1")&&!d.startsWith("o3");l.useEffect(()=>{const s=()=>{He.current!=null&&pr.addAction("composer_state_disabled",{threadId:ds(n),disabledReason:He.current})};if(ts&&Le==="disabled"){let c="unknown";y?c=k??"component_disabled_unknown":p?c="completion_in_progress":Ke&&(c="thread_hard_blocked"),He.current!==c&&(ve.current&&clearTimeout(ve.current),ve.current=setTimeout(s,cu)),He.current=c}else He.current=null;return()=>{ve.current&&(clearTimeout(ve.current),ve.current=null)}},[n,ts,Le,y,k,p,Ke]);const Ws=[];if(Z?.label&&Ws.push({type:Z.type,value:Z.label,onRemoveRegion:Kt}),$!==null){const s=!!$.gizmo.tags?.includes(ot.FirstParty);Ws.push({type:"mention",value:$.gizmo.display.name,icon:e.jsx(Dn,{isFirstParty:s,src:$.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{Xe(null),o.focus()}})}l.useEffect(()=>{(!Se||Se.length===0||!Ie)&&($e.current=!1)},[Se,Ie]);const Qo=l.useCallback((s,c,g)=>{$e.current=s>=0,c&&o.setText(g?`${g.title}${g.body}`:"")},[o]),Jo=Fn(S),Xo=we(Jo.supportsVirtualKeyboardApi),rn=Ie&&Se&&Se.length>0&&Q?.systemHint!==x.Research&&Q?.systemHint!==x.Slurm&&!Ts&&!o.hasMultipleLines()&&o.canShowAutocompletion(),Vs=s=>{if(s.preventDefault(),s.stopPropagation(),js.current>0){const c=performance.now()-js.current;fr.hist(gr.DEFAULT,"final_user_input_to_submit_ms",[],c)}Le==="streaming"&&(!At||o.isEmpty())?Es?nn(!0):Ho(s):Wt(s)};l.useEffect(()=>{const s=ds(n),c=m?.normalizedAccountUserId;if(!c||f)return;const g=Hl(()=>{const T=o.getContentToSend().content;T===""?rr(s):ir(s,T,c)},1e3);return o.subscribe("change",g)},[m,n,o,f,Y]);const{connectedTypes:Ks}=lr(),ln=H&&cr(H),cn=l.useMemo(()=>{const s=[];ae&&Ft&&s.push({command:"upload",aliases:["file","attach"],title:E.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"}),icon:e.jsx(so,{"aria-label":"",className:"icon"}),onSelect:Ce});const c=Ps?.connection_statuses.filter(g=>g.user_connection_details.activation_status==="activated"&&["google_drive_oauth","google_drive_dwd"].includes(g.user_connection_details.knowledge_connector_type)).map(g=>g.user_connection_details.connection_type)??[];return ln&&(Ks.size>0||c.length>0)&&s.push({command:"all-connectors",aliases:["find","connectors","use"],title:E.formatMessage({id:"6YT2cp",defaultMessage:"Use all connectors"}),icon:e.jsx(Nl,{}),onSelect:()=>{D(x.Slurm,{analyticsMetadata:{clientThreadId:n}}),ye(n,g=>{const T=g.selectedSources?.get(x.Slurm)??new Set;g.selectedSources??=new Map,g.selectedSources.set(x.Slurm,new Set([...T,...Ks,...c]))})}}),s},[ae,Ft,Ps?.connection_statuses,ln,Ks,E,Ce,D,n]),un=xe(S,"773249106"),Zo=!1,{data:dn,isLoading:mn}={data:null,isLoading:!1},pn=l.useMemo(()=>[],[mn,Zo,dn?.prompts,b,$t]),fn=l.useMemo(()=>ur(()=>{if(!De)return[];const s=dr(S),c=mr(S),g=Ul(S),{data:T}=s(),{data:B}=c(),{data:F}=g();return Ol([...T?.items??[],...B?.list.items?.map(M=>M.resource)??[],...un?F?.items?.map(M=>M.gizmo)??[]:[]],M=>M.gizmo.id).map(M=>({command:M.gizmo.display.name,title:M.gizmo.display.name,disabled:q,icon:e.jsx(Dn,{simple:!0,isFirstParty:M.gizmo.tags?.includes(ot.FirstParty)===!0,src:M.gizmo.display.profile_picture_url,className:"icon",alt:""}),onSelect:()=>{fe.logEventWithStatsig("Composer GPT Selected","chatgpt_web_composer_gpt_selected",{gizmo:M.gizmo.id}),Xe(M)}}))}),[S,q,De,un]),gn=e.jsx(Jc,{canUseInlineTagging:De,isDisabled:y,clientThreadId:n,currentLeafId:O,currentRequestId:ke,canContinue:se,composerController:o,isNewThread:i,onContinueGenerating:s=>a({event:s,conversationMode:nt(n)?.mode,systemHints:A?[A]:[]}),onResetState:Ot,conversationMode:C,isShowingAutocomplete:!!rn}),hn=!ns&&C!=null&&$o&&zl.includes(C.kind)&&e.jsx(Gl,{clientThreadId:n,onTargetedReply:Eo}),Sn=rn&&e.jsx("div",{className:As("absolute start-0 z-[-1] box-border w-full ps-0",w==="center"?"top-full":"bottom-full",Xo&&"keyboard-open:fixed keyboard-open:bottom-[calc(var(--screen-keyboard-height,0px)+var(--composer-height,100px)+12px)] keyboard-open:px-4"),children:e.jsx(Wl,{suggestions:Se,composerController:o,onSelect:ie,onChange:Qo})}),An=e.jsx(rc,{composerController:o,parsedDocumentHandler:Lo}),xn=!te&&e.jsx(oo,{className:le}),Cn=e.jsx(Vl,{modelSupportedImageMimeTypes:J,uploadType:Ue.Multimodal,attachmentsProductFeature:is?.attachments}),{isImageGenEditor:ea}=Kl(),bn=xe(S,"3760395675"),sa=xe(S,"3127600850");return ea?e.jsxs(In.Provider,{value:ss,children:[e.jsx(Ln,{defaultOpen:bn,children:e.jsxs("form",{id:"prompt",className:P,onSubmit:Vs,children:[e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(Hn,{onOauthRedirect:Ns}),xn,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",children:[e.jsxs(Ql,{open:Re,children:[e.jsx(Jl,{className:"w-full",children:e.jsx(ru,{type:pe?"temporary":"default",ref:ue,placeholder:Jt,inputState:on,composerController:o,leftSideActions:en,state:Le,onSubmit:Vs,renderFiles:Me&&e.jsxs(e.Fragment,{children:[he==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(W,{...I.gizmoKnowledgeWarning})}),e.jsx(Xl,{files:X,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:n,gizmoId:Je,disableReason:an,modelId:d})}),e.jsx(Zl,{children:e.jsx(ec,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:s=>s.preventDefault(),children:Re&&b&&e.jsx(Nn,{gptsSlashCommands:fn,libraryPromptSlashCommands:pn,slashCommands:cn,systemHints:b,composerController:o,clientThreadId:n,layoutMode:w,modelsData:_})})})]}),Sn]}),An,Cn]}),e.jsx("input",{...Lt({className:"hidden"})})]})}),gn,hn]}):e.jsx(In.Provider,{value:ss,children:e.jsxs(Ln,{defaultOpen:bn,children:[e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(Hn,{onOauthRedirect:Ns}),sa&&e.jsx(iu,{}),xn,_s&&Yo&&e.jsx(Yl,{taskId:_s.taskId,clientThreadId:n,onClose:()=>nn(!1)}),e.jsx(ql,{hasFiles:Me,pendingFiles:X,isUploadDisabled:!ae,clientThreadId:n,highlightUploadTooltip:Os&&!Me,disableReason:an,uploadButtonDisabledReason:Gs,currentModel:r,conversationMode:C,state:Le,inputState:on,gizmoId:Je,includeSidebarContextTray:Gt,isTemporaryChat:pe,placeholder:Jt,composerController:o,onSubmit:Vs,replyRegions:Ws,leadingAction:Zt,legacyFooterActions:us,activeSystemHint:Q,hideSystemHint:dt,onRemoveSystemHint:Ms,contextualAnswerUserConnectionData:Ps,fileInput:e.jsx("input",{...Lt()}),expanded:Bt?void 0:!0,expandOnMultilineInput:Bt}),Re&&b&&e.jsx(Nn,{gptsSlashCommands:fn,libraryPromptSlashCommands:pn,slashCommands:cn,systemHints:b,composerController:o,clientThreadId:n,layoutMode:w,modelsData:_}),!1,Sn]}),An,gn,hn,Cn,A&&b&&e.jsx(du,{availableSystemHints:b,systemHintType:A,onRemoveSystemHint:Ms})]})})}const du=({availableSystemHints:t,systemHintType:a,onRemoveSystemHint:m})=>{const d=t!=null&&t.every(p=>p.systemHint!==a),{externalModelsLoading:r,fullModelsLoading:f}=qn(),{isBlocked:h}=ic(a),n=Ee(),i=!Wn(n);return l.useEffect(()=>{r||f||(d||h)&&!i&&m()},[d,h,i,m,a,r,f]),null},Pu=({clientThreadId:t,isNewThread:a,isGizmoThread:m,isProjectThread:d,isModelLoaded:r,currentModelId:f,onRequestCompletion:h,shouldUseUnifiedComposer:n,onlyAllowImageUploads:i})=>{const p=it(),{pageType:P}=gc(),y=P?.type==="landing-page",k=Pr(P?.type),v=hc(t).isOdysseyMode,se=l.useContext(kr),re=jr(se),ie=Mr(),le=rt(),te=Ss(),V=Ee(),w=lt(V);Sc(p);const _=xs(Cs),S=we(gs.sidebarUrlTrayOpen$)&&_,ue=we(gs.context$),{platformConnectors:j}=Vn(),L=ze(ct.hasSeenOdysseyConnectorsModal),ne=at(),o=Pe(t,z=>G.getConversationTurns(z).some(de=>de.messages.some(K=>K.metadata?.n7jupd_message))),H=to(),ge=Ac(),N=(H||ge)&&o;xc(async()=>{if(S)return await Br(ue,Yn)});const E=async z=>{if(nt(t)?.isLoading!==!1)return;const de=()=>{p.delete(0,p.getContentLength()),p.appendText(z.contentToSend.content),p.focus()},K=await Mc(z),he=K.completionMetadata?.systemHints?.includes(fs),me=Array.from(z.selectedSources??[]).filter(pe=>pe!=="web")[0];if(he&&me&&L.eligible){const pe=_r[me]??me,Ve=j.get(pe);if(Ve){let Y=!1;Kn(V,Tc,{connector:Ve,onConfirm:()=>{L.markAsViewed(),Y=!0,h(K)},onTurnOffConnectors:()=>{ye(t,q=>{q.selectedSources??=new Map,q.selectedSources.set(ne,new Set(["web"])),q.selectedMCPSources??=new Map,q.selectedMCPSources.set(ne,new Set),q.mentionedSources=new Set,Er({selectedSourcesMap:q.selectedSources,selectedMCPSourcesMap:q.selectedMCPSources,scope:{userId:w?.authUserId,workspaceId:w?.id}})})},onClose:()=>{Y||de()}});return}}_&&fe.logEvent("kaur1br5.messageSent"),oe(K.promptMessage?.metadata?.attachments??[])&&h(K)},oe=l.useCallback(z=>{let de=Rr;const K=z.reduce((me,Fe)=>me+(Fe.size??0),0);v&&(de=Tr(V,"1504865540").get("max_file_size_mb",25));const he=K<=de*1024*1024;return he||le.danger(te.formatMessage({id:"odyssey.fileTooLarge",defaultMessage:"The attached files are too large. The maximum size is {maxFileSizeMB}MB."},{maxFileSizeMB:de})),he},[V,te,v,le]),U=l.useCallback(z=>{fe.logEvent("Continue Completion"),h(Cc(z))},[h]),Be=bc.useState(z=>z.isReplayEnabled),O=vr({clientThreadId:t}),ke=wr({clientThreadId:t});if(O)return e.jsx(yc,{safetyLimited:ke});const Ge=e.jsxs(e.Fragment,{children:[e.jsx(Pc,{clientThreadId:t}),e.jsx(et,{verticalMargin:"none",verticalPadding:re?"last-standard":"none",horizontalPadding:_?"none":"standard",children:e.jsx(st,{children:Be?e.jsx(kc,{clientThreadId:t},t):N?null:e.jsx(mu,{clientThreadId:t,currentModelId:f,isNewThread:a,hideHeader:a,onRequestCompletion:E,onContinueGenerating:U,onAutocompleteSelect:p.onAutocompleteSelect,onlyAllowImageUploads:i})})})]}),We=a&&e.jsx("div",{className:As("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(et,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(st,{children:e.jsx(oo,{className:"block flex-1"})})})});return n?e.jsxs(e.Fragment,{children:[!ie&&We,e.jsx("div",{id:"thread-bottom",children:Ge}),ie&&We,a&&!y&&!m&&!k&&!v&&!d&&e.jsx(et,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsxs(st,{children:[!1,e.jsx(jc,{clientThreadId:t,currentModelId:f,isModelLoaded:r})]})})]}):Ge};function mu({clientThreadId:t,currentModelId:a,disableDraftPersistence:m=!1,isNewThread:d,onRequestCompletion:r,onContinueGenerating:f,onAutocompleteSelect:h,headerClassName:n,hideHeader:i,onlyAllowImageUploads:p,layoutMode:P}){const{modelsData:y,externalModelsLoading:k}=qn(),[v,se,re,ie,le]=Pe(t,O=>{const ke=G.getCurrentNode(O);return[ke.message.clientMetadata?.errType!=null&&ke.message.clientMetadata.errType!=="info",Fr(G.getCurrentNode(O).message),O?.mode,O?.continuingFromSharedConversationId!=null,!!O?.continuingFromSharedPostId]}),te=Ee(),V=lt(te),w=it(),_=uc({clientThreadId:t}),{isOpen:S,onClose:ue}=dc({type:"just-hit-rate-limit"}),j=l.useMemo(()=>_?!1:!v&&se,[v,se,_]),L=_,ne=xr(t),o=Pe(t,G.hasRecentPIMWarning),H=Cr(ne).data,ge=br(),N=o?"pimBlock":H?.gizmo.tags?.includes(ot.WorkspaceDisabled)&&!ge?"workspaceDisallowsGizmo":y?.models.size===0?"noModelsAvailable":re?.kind===Oe.GizmoTest&&re.gizmo_id==null?"noTestGizmoId":null,E=aa(),oe=to(),U=E.action==="moderate",Be=xe(te,"1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(mc,{composerController:w,clientThreadId:t,currentModelId:a,isCompletionInProgress:_}),e.jsx("div",{className:"flex justify-center empty:hidden",children:oe&&U&&Be?e.jsx(pc,{}):null}),S?e.jsx(fc,{onClose:ue}):null,e.jsx(uu,{clientThreadId:t,disableDraftPersistence:m,onCreateNewCompletion:r,onContinueGenerating:f,currentModelId:a,account:V,currentModelConfig:yr(y?.models,a),areModelsLoading:k,isNewThread:d,isCompletionInProgress:_,className:"w-full",canContinue:j,disabled:!!N,disabledReason:N??void 0,canPause:L,isInteractableSharedThread:ie||le,onAutocompleteSelect:h,headerClassName:n,hideHeader:i,onlyAllowImageUploads:p,layoutMode:P,modelsData:y},t)]})}export{mu as P,Pu as T};
//# sourceMappingURL=jpdmr6hprcjyd5ie.js.map
