import{r as f,b as C,j as e,a as w,M as x}from"./gg0tb34p9fzo1omt.js";import{e0 as k,bU as N,lT as _,cO as A,be as T,R as b,bg as v}from"./g670b8vtkhx0yc6d.js";import{bp as R}from"./forbprkns1cohsbl.js";import{JsonViewer as F}from"./kqivh2k2gjqolo2l.js";import{T as D,a as U,b as W}from"./jgs7169reknaons9.js";import{C as B}from"./gt2c25hojvlnw6hf.js";import{p as H,W as E,b as q,M as z}from"./h6uvwty3c3amaxiz.js";import{W as j}from"./e3erq0emp0cqk1ou.js";import{g as V,W as G,c as J}from"./nir0q9e2l94u37hi.js";import"./ewqfcp1vbowm20lj.js";import"./fzrn137102spawew.js";import"./f36jz1b044mtoyky.js";import"./epts3f5f624a6l7w.js";import"./mu0w85wyyiji3bj8.js";import"./eiffxi5640gvsu4t.js";import"./o68lxipd1oht2mfn.js";import"./jlkzv5bipqb1jti4.js";import"./h9p1albvmprbl3kb.js";import"./hu61i4occl5w2buc.js";import"./iot1vlqga29hiiwl.js";import"./c7e30quc1do1jojv.js";import"./kv8a9039cr2p5scx.js";import"./ogvupmk4xezkmrqf.js";import"./juuj7s9t3x7u9it2.js";import"./lptwpbjabrvjmhsj.js";import"./ii534sx9kl9dq5ip.js";import"./b40xa0ca5oqnzth6.js";import"./b451x40oixvdmzqh.js";import"./hsr6nqstg4abtqru.js";import"./k5ngqk6bkqja3f09.js";import"./cnl9n9geu2oxb8o4.js";import"./f4wsvwai0sxxe1lf.js";const M=new Set;function ye({taskId:a,suggestion:s,index:l,assistantTurn:t,isOpen:i,onClose:d}){const r=f.useMemo(()=>V(t,!0).length>0,[t]),u=f.useMemo(()=>H({assistantTurn:t,followUp:r}),[t,r]),c=!r,o=C(),m=k(),[L,y]=f.useState("diff"),S="diff";f.useEffect(()=>{const n=t.id;i&&n&&!M.has(n)&&(M.add(n),G.viewSpeculativeTurn(a,n))},[i,t.id,a]);const h=e.jsx(K,{taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:c}),P=e.jsx("div",{className:"relative flex h-full w-full flex-col",children:e.jsxs(D,{onChange:y,currentTab:L,defaultTab:S,tabs:[{key:"chat",isHidden:m,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),children:h},{key:"diff",isHidden:!1,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),children:e.jsx(O,{taskId:a,assistantTurn:t,index:l,showFullDiff:c,diffFiles:u})},{key:"logs",label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),children:e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center py-8",children:e.jsx(_,{})}),children:e.jsx(E,{taskId:a,focusedAssistantTurn:t,agentNetworkAccess:t?.environment?.agent_network_access,footer:e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:t,index:l})})})})},{key:"internal_rollout",isHidden:t?.internal_only_rollouts==null||!0,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRollout",defaultMessage:"Internal Rollout"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRolloutAriaLabel",defaultMessage:"Tab to view the internal rollout information"}),children:e.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:e.jsx(F,{json:t?.internal_only_rollouts??void 0,jsonViewProps:{collapsed:5}})})}],children:[e.jsx(U,{withUnderline:!m,className:N("p-3 max-md:py-0",!m&&"border-b"),skipTabUnderlineAnimation:!0}),e.jsx(W,{children:({content:n})=>e.jsx("div",{className:"flex h-full w-full",children:n})})]},t?.id??a)}),g=e.jsxs("div",{className:"relative flex h-full w-full flex-col",children:[P,e.jsx(R,{className:"absolute end-3 top-0 md:top-3",icon:e.jsx(A,{}),label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:d})]});return e.jsx(T,{testId:`modal-speculative-task-content-${t.id}`,isOpen:i,visuallyHiddenHeader:!0,size:"custom",className:"h-full w-full",contentClassName:"h-screen",noPadding:!0,onClose:d,onEscapeKeyDown:n=>{n.preventDefault(),n.stopPropagation(),d()},showCloseButton:!0,children:e.jsx("div",{className:"bg-token-bg-tertiary flex h-full w-full",children:m?e.jsx(q,{leftContent:h,rightContent:g}):g})})}function K({taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:i}){return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsx("span",{className:"p-6 text-sm font-medium",children:s.title}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsx(z,{isLatest:!0,assistantTurns:[t],selectedAssistantId:t.id,focusedAssistantTurn:t,setFocusedAssistantTurnId:()=>{},onClickFile:()=>{},startOpen:!0,currentTab:void 0,onTabChange:()=>{},permissions:"read",flushHeaderSeparator:!0,showFullDiff:i},t.id)}),e.jsx(p,{taskId:a,assistantTurn:t,index:l})]})}function O({taskId:a,assistantTurn:s,index:l,diffFiles:t,showFullDiff:i}){const d=t.length>0,{data:r}=J(),c=!k()||r?.git_diff_mode==="unified";return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[d&&e.jsx("div",{className:"flex w-full flex-1 flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(o=>e.jsx(B,{diff:o,stickyHeader:!0,viewType:c?"unified":"split",setUnifiedDiff:()=>{},showFullDiff:i,enableComments:!1,buttonClassName:"bg-token-bg-tertiary"},o.diffFile._newFileName))}),e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:s,index:l})})]})}function p({taskId:a,assistantTurn:s,index:l}){const t=C(),i=()=>{window.location.reload()},{mutate:d,isPending:r}=w({mutationFn:()=>(j.recordSpeculativeSuggestionRejected(a,s.id,l),b.safePost("/wham/tasks/{task_id}/speculative_turns/{turn_id}/reject",{parameters:{path:{task_id:a,turn_id:s.id}}})),onSuccess:i}),{mutate:u,isPending:c}=w({mutationFn:()=>(j.recordSpeculativeSuggestionAccepted(a,s.id,l),b.safePost("/wham/tasks/{task_id}/speculative_turns/{turn_id}/accept",{parameters:{path:{task_id:a,turn_id:s.id}}})),onSuccess:i}),o=r||c;return e.jsxs("div",{className:"flex w-full justify-center gap-3 py-10",children:[e.jsx(v,{color:"primary",onClick:()=>u(),disabled:o,loading:c,"aria-label":t.formatMessage({id:"wham.speculative.followUp.applyAriaLabel",defaultMessage:"Button to apply the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.apply",defaultMessage:"Apply"})}),e.jsx(v,{color:"secondary",onClick:()=>d(),disabled:o,loading:r,"aria-label":t.formatMessage({id:"wham.speculative.followUp.rejectAriaLabel",defaultMessage:"Button to reject the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.reject",defaultMessage:"Reject"})})]})}export{ye as SpeculativeTaskContentModal};
//# sourceMappingURL=iv14ii8okf6yz304.js.map
