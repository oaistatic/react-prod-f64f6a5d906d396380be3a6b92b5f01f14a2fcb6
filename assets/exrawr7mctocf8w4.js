import{r as m,f as R,j as S,m as x,q as b}from"./gg0tb34p9fzo1omt.js";import{d as _,lh as g,bo as L,io as P}from"./forbprkns1cohsbl.js";import{ax as u,oh as c,n as q,a5 as C,D as f,di as p,fj as M}from"./g670b8vtkhx0yc6d.js";var T=(e=>(e.SCALLION="scallion",e.SCALLION_RC="scallion-rc",e.SCALLION_RC0="scallion-rc0",e.SCALLION_RC1="scallion-rc1",e.SCALLION_RC2="scallion-rc2",e.CHIVE="chive",e.CHIVE_RC="chive-rc",e.CHIVE_RC0="chive-rc0",e.CHIVE_RC1="chive-rc1",e))(T||{});const G=async({queryKey:e})=>{const[t,n]=e;if(n.length<2)return[];const r=new URLSearchParams({query_fragment:n});return u.get(`${c}/suggestions?${r.toString()}`).then(s=>s.suggestions).catch(()=>[])};function v(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model&&e.completion_model!=="production"?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??T.SCALLION,eval_preset:e.eval_preset}}async function Z({threadId:e,threadUserId:t,routePrefix:n}){let r=c;n&&(r=r+n);const s=new URL(`${r}/threads/${e}/with_turns`);return t&&s.searchParams.append("thread_user_id",t),await u.get(s.toString())}async function B(e){const t=new FormData;return t.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),u.post(`${c}/feedback/turns`,t)}async function F(e,t){return u.post(`${c}/threads/${e}/turns/${t}/images_try_hard`)}async function ee(e){const t=new FormData;return e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),t.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail,turn_index:e.turnIndex})),u.post(`${c}/feedback/links`,t)}function te(e){const t=v(e.agentSettingsOverrides);u.post(`${c}/prefetch`,{...t,turn:{user_query:e.query},user_metadata:e.metadata})}class w extends Error{constructor(t){super(t),this.name="TurnError"}}function N(e){return e?e.model_response?.text!=null&&e.model_response.text.length>0:!1}function h(e){return e.execution_status==="fatal_system_error"}function $(e){return e.execution_status==="in_progress"||e.execution_status===null}function k(e){return o(t=>t.thread?.turns.map(n=>e.reduce((r,s)=>(r[s]=n[s],r),{}))??[],(t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!g(t[r],n[r]))return!1;return!0})}function A(){return o(e=>p(e.thread?.turns.flatMap(t=>t.model_response?.citations)),g)}const y={thread:null,error:void 0},o=q(C(()=>({...y}))),D=_(()=>{f.addError(new w("got updateTurn with no current thread"))},1e3),H=_(e=>{f.addError(new w("turn not found"),{turnIndex:e})},1e3),d={threadId:e=>e.thread?.id??null,turns:e=>e.thread?.turns??[],turnCitations:e=>t=>t.thread?.turns[e].model_response?.citations??[],hasResponse:e=>N(e.thread?.turns[0]),firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>e.thread?.turns.length??0,isLastTurnStreaming:e=>{const t=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return t!=null&&$(t)},hasModelResponseText:e=>e.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:e=>{const t=e.thread?.turns[0];return!!t&&h(t)},hasTurnError:e=>e.thread?.turns.some(h)??!1,threadError:e=>e.error,__deprecated_sportsWidget:e=>e.thread?.turns[0]?.sports_widget??null},re={appendTurn(e,t,n){o.setState(r=>{r.thread?.id!==e&&(n?.(e),r.thread={id:e,turns:[]}),r.thread.turns.push(t)})},updateTurn(e,t){o.setState(n=>{const r=n.thread;if(!r){D();return}const s=r.turns[e];if(!s){H(e);return}t(s)})},clearThread(){o.setState(()=>({...y}))},setError(e){o.setState(t=>{t.error=e})},setThread(e,t){o.setState(n=>{n.thread={id:e,turns:t}})}};class j{queue=[];attempted=new Set;isProcessing=!1;enqueue(t){this.queue.push(t),this._processQueue()}async _processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)try{const t=this.queue.shift();if(!t)continue;await this._preload(t)}catch{}this.isProcessing=!1}}_preload(t){return new Promise(n=>{this.attempted.has(t)&&n();const r=new Image;r.onload=()=>{this.attempted.add(t),n()},r.onerror=()=>{this.attempted.add(t),n()},r.src=t})}}const O=new j;function z(e){const t=m.useRef(e);return M(t.current,e)||(t.current=e),t.current}function Q(e,{enabled:t=!0}={}){const n=z(e);m.useEffect(()=>{if(!t||"connection"in navigator&&navigator.connection.type==="cellular")return;const s=setTimeout(()=>{n.forEach(a=>{a&&O.enqueue(a)})},1e3);return()=>{clearTimeout(s)}},[t,n])}function ne(){const{imageResults:e}=V();Q([...e.map(t=>I(t))])}const U=L((...e)=>F(...e),5e3);function V(e=!1){const t=k(["image_results","image_try_hard_status","execution_status"]),n=o(d.threadId),r=p(t.toReversed().flatMap(i=>i.image_results?.entries)).map(i=>({...i,thumbnail_url:i.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:i.content_url.replace(/^http:\/\//,"https://")})),s=o(d.hasModelResponseText),a=t.some(i=>h(i));let l=r.length===0&&!s;return n!=null&&e&&!l&&r.length===0&&t[0]?.image_try_hard_status==="not_attempted"&&(U(n,0),l=!0),e&&t[0]?.image_try_hard_status==="in_progress"&&(l=!0),{imageResults:r,isLoading:l,isErrored:r.length===0&&a}}function se(){const e=A(),t=o(d.hasTurnError),n=o(d.hasModelResponseText),r=P(e);return{imageResults:r,isLoading:r.length===0&&!n,isErrored:r.length===0&&t}}function J(e){return b({queryKey:["downloadImage",{imageUrl:e}],queryFn:()=>new Promise((t,n)=>{const r=new Image;r.onload=()=>{t({width:r.width,height:r.height})},r.onerror=()=>{n()},r.src=e}),enabled:!!e})}function oe(e){return R(J(e))}const E={width:474,square:!0};function I(e,t=E){if(e==null||e.is_proxied_image)return;const n=new URL(e.thumbnail_url);if(n.hostname.indexOf(".bing.")===-1)return e.thumbnail_url;const r=Math.min(t.width,e.content_size.width),s=t.height??Math.floor(r*e.content_size.height/e.content_size.width);if(n.searchParams.delete("pid"),t.square){const a=Math.min(r,s);n.searchParams.set("w",a.toString()),n.searchParams.set("h",a.toString())}else n.searchParams.set("w",r.toString()),n.searchParams.set("h",s.toString());return n.searchParams.set("c","7"),n.toString()}function ae(e,t=E){return m.useMemo(()=>I(e,t),[e,t])}const W={type:"spring",stiffness:700,damping:82};function ie({children:e,className:t}){return S.jsx(x.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:W,className:t,children:e})}export{T as B,ie as I,d as T,V as a,oe as b,o as c,h as d,ee as e,G as f,J as g,k as h,$ as i,ne as j,re as k,Z as l,ae as m,W as n,B as p,te as r,se as u};
//# sourceMappingURL=exrawr7mctocf8w4.js.map
