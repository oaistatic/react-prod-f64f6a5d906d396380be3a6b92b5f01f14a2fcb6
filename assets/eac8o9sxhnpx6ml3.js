import{b as G,r as u,j as e,M as r,e as F,ag as X,u as $,h as D,al as K}from"./gg0tb34p9fzo1omt.js";import{ch as R,be as E,bg as C,d as I,G as T,bT as H,R as L,nm as O,c6 as q,D as Z,cD as J,bU as Y}from"./g670b8vtkhx0yc6d.js";import{d_ as ee,cn as se,ht as v,aw as ae,q as z,hs as W,fR as te,at as re}from"./forbprkns1cohsbl.js";import{a as ne,c as oe}from"./c2kjct7accafncjs.js";import{T as a}from"./cfdk1y828jwp5ajh.js";import{V as le}from"./d3y72ugnrmac5z1v.js";import{G as ie}from"./c3br35oylhnmidew.js";import{e as de,f as ce,M as P}from"./mma8e4j5n32wsr2b.js";function ue({defaultName:s,placeholder:t,onSave:o,onClose:d}){const l=G(),p=s==null,[j,S]=u.useState(s||""),[x,M]=u.useState(!1),[h,i]=u.useState(null),f=R(),w=async()=>{if(j.trim()===""){i(l.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}M(!0);try{await o(j),f.success(p?l.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):l.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),d()}catch{i(l.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{M(!1)}};return e.jsx(E,{isOpen:!0,type:"success",onClose:d,title:p?l.formatMessage(U.newGroupTitle):l.formatMessage(U.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(C,{color:"primary",onClick:()=>w(),loading:x,children:e.jsx(r,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(C,{onClick:d,color:"secondary",children:e.jsx(r,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(r,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:j,placeholder:t,onChange:g=>{S(g.target.value),i(null)},className:"border-token-border-secondary focus:border-token-accent bg-token-bg-primary w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:g=>{g.key==="Enter"&&w()}}),h&&e.jsx("p",{className:"text-xs text-red-500",children:h})]})})}const U=F({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),_=1e3;function me({group:s,isOpen:t,onClose:o}){const d=G(),l=R(),p=d.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),j=I(),S=T(j),[x,M]=u.useState([]),[h,i]=u.useState(!1);async function f(){const w=S?.getWorkspaceId();if(!w)throw new Error("No workspace ID found");i(!0);const g=[],N=50;for(let m=0;m<x.length;m+=N)g.push(x.slice(m,m+N));const k=async m=>L.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:w,group_id:s.id}},requestBody:{email_addresses:m}}),c=(await Promise.all(g.map(m=>k(m)))).reduce((m,A)=>m+A.added_group_users.length,0);l.success(d.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:c})),o?.(),i(!1)}return e.jsxs(E,{testId:"modal-bulk-add-group-members",isOpen:t,onClose:o??H,title:p,type:"success",showCloseButton:!0,primaryButton:e.jsx(C,{onClick:f,disabled:x.length===0||x.length>_,loading:h,children:e.jsx(r,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(ge,{onChange:M}),x.length>_&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(r,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:_}})})]})}function ge({onChange:s}){const[t,o]=u.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(r,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(r,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(ee,{id:"group-email-paste",className:"h-[250px] text-sm",value:t,onChange:d=>{o(d.target.value),s(pe(d.target.value))},placeholder:`jean@example.com
joohyun@example.com
muhammed@example.com
susan@example.com`})]})}function pe(s){return s.split(`
`).map(t=>t.trim()).filter(t=>t.length>0).filter(t=>le.test(t))}function xe({group:s,isOpen:t,onClose:o}){const l=G().formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=I(),S=T(p)?.getWorkspaceId(),[x,M]=u.useState(""),[h,i]=u.useState(0),{data:f,isLoading:w}=se(S,h*v,x,v,X),[g,N]=u.useState([]),[k,b]=u.useState([]),[c,m]=u.useState("interactive"),A=f?Math.ceil((f.total??0)/v):0;async function V(n){b(y=>[...y,n]);try{await he(S,s.id,n),N(y=>[...y,n])}catch(y){Z.addError(y)}finally{b(y=>y.filter(Q=>Q!==n))}}return c==="batch"?e.jsx(me,{group:s,isOpen:t,onClose:o}):e.jsx(E,{testId:"modal-add-group-member",type:"warning",isOpen:t,onClose:o??H,title:l,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(C,{onClick:o,children:e.jsx(r,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:l}),e.jsx(C,{onClick:()=>{m("batch")},color:"secondary",children:e.jsx(r,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(O,{value:x,inputClassName:"w-full",onChange:n=>{M(n.target.value)}}),e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(r,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(a.HeaderCell,{children:e.jsx(r,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(a.HeaderCell,{})]}),e.jsxs(a.Body,{children:[!f&&w&&e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:3,children:e.jsx(q,{})})}),f?.items.map(n=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:n.name}),e.jsx(a.Cell,{children:n.email}),e.jsx(a.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(C,{size:"small",color:"secondary",disabled:k.includes(n.id),onClick:()=>{g.includes(n.id)||V(n.id)},icon:g.includes(n.id)?ae:z,children:g.includes(n.id)?e.jsx(r,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(r,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},n.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(W,{currentPage:h,onChangeIndex:n=>{i(n)},length:A})})]})})}async function he(s,t,o){await L.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:t}},requestBody:{user_id:o}})}function fe({workspaceId:s}){const t=G(),o=$(),d=J(),l=!(d?.isAdminOfAccount()||d?.isOwnerOfAccount()),[p,j]=u.useState(""),S=re(p,300),x=D(),[M,h]=u.useState(0),{groups:i,isLoading:f,isPlaceholderData:w}=de({workspaceId:s,currPage:M,groupFilter:S}),[g,N]=u.useState(!1),k=c=>{c&&(h(0),j("")),N(c)},{createGroup:b}=ce({workspaceId:s,currentGroups:i});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(O,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:c=>{j(c.target.value),h(0)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!l&&e.jsx(C,{onClick:()=>k(!0),icon:z,children:e.jsx(r,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(r,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(a.HeaderCell,{children:e.jsx(r,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(a.HeaderCell,{children:e.jsx(r,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(a.HeaderCell,{})]}),e.jsx(a.Body,{className:Y((f||w)&&"opacity-50"),children:i==null?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:e.jsx(q,{})})}):i.items.length===0?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:p===""?e.jsx(r,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(r,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):i.items.map(c=>e.jsx(je,{group:c,workspaceId:s,onAddMember:()=>{o.invalidateQueries({queryKey:[s,"groups"]})},readOnly:l},c.id))})]}),i&&e.jsx("div",{className:"text-center",children:e.jsx(W,{length:Math.ceil(i.total/P),currentPage:Math.min(M,Math.ceil(i.total/P)),onChangeIndex:c=>h(c)})})]}),g&&e.jsx(ue,{onClose:()=>k(!1),onSave:async c=>{const{id:m}=await b({name:c,workspaceId:s});x(`/admin/groups/${m}`)},placeholder:t.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Ge({currentWorkspaceId:s}){const t=G();return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsx("title",{children:t.formatMessage(B.title)})}),e.jsx(ne,{title:t.formatMessage(B.title),subtitle:e.jsx(r,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(oe,{showSpinner:!1,children:e.jsx(fe,{workspaceId:s})})]})}function je({group:s,onAddMember:t,readOnly:o}){const[d,l]=u.useState(!1),p=D();return e.jsxs(e.Fragment,{children:[e.jsxs(a.Row,{className:"[&>td]:py-2",onClick:()=>p(`/admin/groups/${s.id}`),children:[e.jsxs(a.Cell,{children:[e.jsx(ie,{group:s}),s.name]}),e.jsx(a.Cell,{children:e.jsx(r,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(a.Cell,{children:s.created_time&&e.jsx(K,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),d&&!o&&!s.is_scim_managed&&e.jsx(xe,{isOpen:!0,onClose:()=>{t(s.id),l(!1)},group:s})]})}const B=F({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"}});export{xe as A,ue as U,Ge as W,B as m};
//# sourceMappingURL=eac8o9sxhnpx6ml3.js.map
