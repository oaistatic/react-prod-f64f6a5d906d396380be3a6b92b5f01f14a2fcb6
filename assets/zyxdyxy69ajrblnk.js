import{b as K,j as t,e as Q,r as S,M as b,o as Je,v as Me,n as Y}from"./gg0tb34p9fzo1omt.js";import{bh as We,bg as T,c2 as O,iF as He,g as Se,$ as Pe,iN as Ye,iA as qe,or as Ke,j as Te,a6 as Ne,ja as Qe,fa as Xe,d as Ze,cE as et,ay as oe,az as re,P as Ce,gQ as tt,a7 as st,a8 as at,bk as nt,bl as ot,m$ as rt,h as it,a3 as B,a4 as Ee,aw as lt,dn as ct,k4 as dt,dy as mt,aU as ut,aV as ft,l as gt,jO as pt,el as ht}from"./g670b8vtkhx0yc6d.js";import{L as yt,a as me}from"./e0kfywq1jfn60tks.js";import{gs as xt,lC as _t,lD as jt,lE as vt,aW as j,aV as ue,dO as ke,aX as bt,bv as Ae,lF as wt}from"./forbprkns1cohsbl.js";import{M as fe}from"./ihgbljwwpo1mzi43.js";const Mt=O.div`h-px bg-token-border-default`,k=O.div`text-sm font-medium py-3 leading-6`,St=O.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,ae=":",Pt=({to:e,cc:s,bcc:o,subject:r,body:n,onClick:a,isDraft:l=!0,isCanceled:c=!1})=>{const i=K(),m=[];return e&&m.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(k,{className:"text-token-text-tertiary me-1",children:[i.formatMessage(L.draftToFieldLabel),ae]}),t.jsx(k,{children:e})]})},"to")),s&&m.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(k,{className:"text-token-text-tertiary me-1",children:[i.formatMessage(L.draftCcFieldLabel),ae]}),t.jsx(k,{children:s})]})},"cc")),o&&m.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(k,{className:"text-token-text-tertiary me-1",children:[i.formatMessage(L.draftBccFieldLabel),ae]}),t.jsx(k,{children:o})]})},"bcc")),r&&m.push(t.jsx(k,{children:r},"subject")),n&&m.push(t.jsx(k,{className:"whitespace-pre-line",children:n},"body")),t.jsxs(St,{children:[t.jsxs("div",{className:"mb-4 flex items-center",children:[t.jsx(We,{className:"icon-sm me-4"}),t.jsx("div",{className:"font-semibold",children:l?i.formatMessage(L.draftMessageLabel):i.formatMessage(L.sentMessageLabel)})]}),m.map((d,h)=>t.jsxs(S.Fragment,{children:[t.jsx(Mt,{}),d]},h)),l&&!c&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(T,{color:"primary",className:"py-2",onClick:a,children:i.formatMessage(L.sendButton)})}),c&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(T,{color:"primary",className:"py-2",disabled:!0,children:i.formatMessage(L.canceledButton)})})]})},L=Q({draftMessageLabel:{id:"emailView.draftMessageLabel",defaultMessage:"Draft Message"},sentMessageLabel:{id:"emailView.sentMessageLabel",defaultMessage:"Sent Message"},sendButton:{id:"emailView.sendButton",defaultMessage:"Send"},draftToFieldLabel:{id:"emailView.draftToLabel",defaultMessage:"To"},draftCcFieldLabel:{id:"emailView.draftCcLabel",defaultMessage:"Cc"},draftBccFieldLabel:{id:"emailView.draftBccLabel",defaultMessage:"Bcc"},canceledButton:{id:"emailView.canceledButton",defaultMessage:"Canceled"}});function Tt({action:e,handleUserAction:s,userActionParams:o,displayParams:r}){const n=He();return e.type==="deny"?t.jsx(T,{color:"secondary",size:"small",onClick:a=>{s({sourceEvent:a,...o,actionData:{type:"deny",...e.deny}})},children:t.jsx(b,{...e.name==="decline"?A.decline:A.deny})}):e.type==="allow"?t.jsx(T,{color:"primary",size:"small",onClick:a=>{s({sourceEvent:a,...o,actionData:{type:"allow",...e.allow}})},children:t.jsx(b,{...e.name==="allow"?A.allow:A.confirm})}):e.type==="always_allow"?t.jsx(T,{color:"secondary",size:"small",onClick:a=>{s({sourceEvent:a,...o,actionData:{type:"always_allow",...e.always_allow}})},children:t.jsx(b,{...A.alwaysAllow})}):e.type==="oauth_redirect"?r.connectorId?t.jsx(Nt,{connectorId:r.connectorId,connectorFixture:r.connectorFixture,onClick:()=>{const a=Se(o.clientThreadId),l=a?new URL(Pe(a),window.location.origin):new URL(window.location.href);l.searchParams.set("oauth_success","true"),n({connectorId:r.connectorId,redirectAfter:l.toString()})}}):t.jsx(T,{color:"primary",size:"small",onClick:()=>{Ct(e.oauth_redirect,o.clientThreadId,o.turnGizmo)},children:t.jsx(b,{...A.signInButton,values:{domain:r.domain}})}):e.type==="contact_gizmo"?t.jsx(T,{color:"secondary",size:"small",onClick:a=>{s({sourceEvent:a,...o,actionData:{type:"contact_gizmo",...e.contact_gizmo}})},children:t.jsx(b,{...A.allow})}):null}function Nt({connectorId:e,connectorFixture:s,onClick:o}){const r=K(),n=Ye(!0,qe.JIT_PLUGIN),a=s??n.platformConnectors.get(e??"");return a&&t.jsxs("div",{className:"flex w-80 flex-col items-center rounded-xl border p-6 text-center",children:[t.jsx(xt,{connector:a,size:"large",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),t.jsx("div",{className:"text-token-text-primary mt-3 text-lg font-semibold",children:Ke(a.name,r)}),t.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:a.description}),t.jsx(T,{className:"mt-4 w-full",color:"secondary",onClick:o,children:t.jsx(b,{...A.connectButton})})]})}function Ct(e,s,o){const r=Te(s),n=Se(s),a=r?.mode?.kind===Ne.GizmoTest,l=n&&!a?Pe(n,o):window.location.href;e.gizmo_id==="FAKE_PLUGIN_GIZMO"?Qe({id:e.gizmo_action_id},l):Xe.doOAuthRedirect(e.gizmo_id,e.gizmo_action_id,e.domain,l,a)}const A=Q({alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"},connectButton:{id:"jitPluginMessage.connectButton",defaultMessage:"Connect"}});var ge="ABORT",pe="CALL",he="REJECT",ye="RESOLVE";function P(e,s){const o=a=>{const l=a.data;if(Array.isArray(l)&&l[0]===pe){a.stopImmediatePropagation();const[c]=a.ports;if(!c)throw new Error("RPCCallMessage must contains a port.");s?async function(){const i=new AbortController;try{c.onmessage=({data:m})=>Array.isArray(m)&&m[0]===ge&&i.abort(),c.postMessage([ye,await s.call({signal:i.signal},...l.slice(1))])}catch(m){c.postMessage([he,m])}finally{c.close()}}():(c.postMessage([he,new Error("No function was registered on this RPC. This is probably calling a client which do not implement the function.")]),c.close())}};e.addEventListener("message",o),e.start();const r=a=>(...l)=>new Promise((c,i)=>{var m;const{port1:d,port2:h}=new MessageChannel;d.onmessage=g=>{const y=g.data;y[0]===ye?c(y[1]):i(y[1]),d.close()},(m=a?.signal)==null||m.addEventListener("abort",()=>{d.postMessage([ge]),d.close(),i(new Error("Aborted."))}),e.postMessage([pe,...l],[h,...a.transfer||[]])}),n=r({});return n.withOptions=r,n}var xe="GENERATOR_GENERATE";function _e(e,s){const o=a=>{const l=a.data;if(Array.isArray(l)&&l[0]===xe){if(a.stopImmediatePropagation(),!s)throw new Error("No function was registered on this RPC. This is probably calling a client which do not implement the function.");const[c,i,...m]=l,d=s(...m);P(i.next,d.next.bind(d)),P(i.return,h=>{var g;return((g=d.return)==null?void 0:g.call(d,h))||{done:!0}}),P(i.throw,h=>{var g;return((g=d.throw)==null?void 0:g.call(d,h))||Promise.reject(h)}),P(i.asyncDispose,async()=>{const h=Symbol.asyncDispose||Symbol.for("Symbol.asyncDispose"),g=Symbol.dispose||Symbol.for("Symbol.dispose");h in d?await d[h]():g in d&&d[g]()})}};e.addEventListener("message",o),e.start();const r=a=>{let l;return(...c)=>{var i;const{port1:m,port2:d}=new MessageChannel,{port1:h,port2:g}=new MessageChannel,{port1:y,port2:w}=new MessageChannel,{port1:I,port2:N}=new MessageChannel,C={signal:a.signal},G=()=>{m.close(),d.close(),h.close(),g.close(),y.close(),w.close(),I.close(),N.close()},V=P(m).withOptions(C),f=P(h).withOptions(C),x=P(y).withOptions(C),X=P(I).withOptions(C);let R=!1;const U=async v=>{if(l?.(),R)return{done:!0};const D=await v();return D.done&&(R=!0,G()),D},Z=async v=>{l?.(),await v(),R=!0,G(),l=()=>{throw new Error("This generator has been disposed.")}},$={next:v=>U(()=>f(v)),return:v=>U(()=>x(v)),throw:v=>U(()=>X(v)),[Symbol.asyncDispose||Symbol.for("Symbol.asyncDispose")]:()=>Z(()=>V()),[Symbol.asyncIterator]:()=>$};return e.postMessage([xe,{asyncDispose:d,next:g,return:w,throw:N},...c],[...a.transfer||[],d,g,w,N]),(i=a.signal)==null||i.addEventListener("abort",()=>{l=()=>{throw new Error("This generator has been aborted.")},G()},{once:!0}),$}},n=r({});return n.withOptions=r,n}const Et=async(e,s,o=[])=>{const r=new Set(Object.keys(s).filter(i=>s[i]?.constructor?.name==="AsyncGeneratorFunction")),n={};for(const[i,m]of Object.entries(s)){const d=new MessageChannel;r.has(i)?_e(d.port1,m):P(d.port1,m),n[i]=d.port2}const{ports:a,replyPort:l}=await new Promise(i=>{const m=d=>{d.data.type==="init"&&d.source&&d.source===e.contentWindow&&(window.removeEventListener("message",m),i(d.data))};window.addEventListener("message",m)});return l.postMessage(n,Object.values(n)),l.start(),Object.fromEntries(Object.entries(a).map(([i,m])=>[i,o.includes(i)?_e(m):P(m)]))};function kt({namespace:e,functionName:s}){e==="ecosystem_demo"&&(oe.count(re.ECOSYSTEM_DEMO,"ecosystem_demo.tool_impression",{tool:s}),Ce.logEvent("Ecosystem Demo: Tool Impression",{tool:s}))}function At({html:e,title:s,oai:o,toolInfo:r}){const n=S.useRef(null),a=S.useRef(!1),[l,c]=S.useState(null),[i,m]=S.useState(null),d=Ze(),h=et(d).locale;return S.useEffect(()=>{!n.current||a.current||(a.current=!0,Et(n.current,o,["runHTML"]).then(c))},[o]),S.useEffect(()=>{(async()=>{if(l){for await(const y of l.runHTML(e))if(console.log("received:",y),y.type===fe.SET_INTRINSIC_HEIGHT)m(y.intrinsicHeight);else if(y.type===fe.INSTRUMENT){const w=[r?.namespace,r?.functionName].filter(Boolean).join(".");switch(y.instrument.type){case"hist":{oe.hist(re.ECOSYSTEM,`${w}.${y.instrument.label}`,y.instrument.tags,y.instrument.value);break}case"count":{const I=`${w}.${y.instrument.label}`;oe.count(re.ECOSYSTEM,I,y.instrument.tags,y.instrument.count),Ce.logEvent("Ecosystem Demo: Tool Clicked",{name:I});break}}}}})()},[l,e]),S.useEffect(()=>{r&&kt(r)},[r]),t.jsx("iframe",{title:s,className:"no-scrollbar my-2 w-full rounded-2xl shadow-[0px_0px_0px_1px_var(--border-light),0px_4px_10px_rgba(0,0,0,0.06)] sm:rounded-3xl",style:{height:i?`${i}px`:"auto"},src:`${yt}/kanzi-sandbox.html?locale=${h}`,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox",ref:n,tabIndex:-1})}const It=O.div`h-px bg-token-border-default`,je=O.div`text-sm font-medium py-3 leading-6`,Dt=O.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,Lt=":",Ot=({functionName:e,parameters:s,onClick:o,isDraft:r=!0,isCanceled:n=!1})=>{const a=K(),l=Object.entries(s).filter(([c,i])=>!i||c==="timezone_str"&&i===Intl.DateTimeFormat().resolvedOptions().timeZone?!1:i.length>0);return t.jsxs(Dt,{children:[t.jsx("div",{className:"mb-4 flex items-center font-semibold",children:t.jsx("div",{children:r?ie(e):Rt(e,a)})}),l.map(([c,i])=>t.jsxs("div",{children:[t.jsx(It,{}),t.jsxs("div",{className:"flex",children:[t.jsxs(je,{className:"text-token-text-tertiary me-1",children:[ie(c),Lt]}),t.jsx(je,{className:"whitespace-pre-line",children:Ie(i,a)})]})]},c)),r&&!n&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(T,{color:"primary",className:"py-2",onClick:o,children:a.formatMessage(q.approveButton)})}),n&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(T,{color:"primary",className:"py-2",disabled:!0,children:a.formatMessage(q.canceledButton)})})]})},Rt=(e,s)=>{switch(e){case"create_event":return"Created Event ✅";default:return`${ie(e)} ${s.formatMessage(q.completedAction)} ✅`}},ie=e=>{switch(e){case"timezone_str":return"Timezone";default:return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}},Ie=(e,s)=>{if(Array.isArray(e))return e.map(n=>Ie(n,s)).join(s.formatMessage(q.valueSeparator));if(typeof e=="object")return JSON.stringify(e);if(e.match(/^\s*\d{4}-\d{2}-\d{2}/)==null)return e;const r=new Date(e);return Number.isNaN(r.getTime())?e:s.formatDate(r,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},q=Q({approveButton:{id:"ParametersView.approveButton",defaultMessage:"Approve"},completedAction:{id:"ParametersView.completedAction",defaultMessage:"Completed"},canceledButton:{id:"ParametersView.canceledButton",defaultMessage:"Canceled"},valueSeparator:{id:"ParametersView.valueSeparator",defaultMessage:","}}),De="openaiFileIdRefs",zt=["send_email","batch_modify_email","create_event","update_event","delete_event"];function Xt({messages:e,clientThreadId:s,isLastTurnInConversation:o,connectorFixture:r,onRequestCompletion:n}){const[a,l]=Je(),[c,...i]=e,m=K(),d=tt(s),h=c.metadata?.gizmo_id??d,g=st(s,u=>wt(u?.mode,h)),y=_t(g)&&g.gizmo_id===h,w=at(h,y)?.data,I=nt(ot.DeveloperMode),N=rt(c.recipient);let C;if(N?.functionName!=null&&w?.tools!=null){for(const u of w.tools)if(Ut(u,N.functionName)){C=u;break}}const G=i.filter(u=>u.metadata?.jit_plugin_data?.from_server?.type==="debug"),V=i.filter(u=>!["debug","send_test"].some(p=>p===u.metadata?.jit_plugin_data?.from_server?.type)),{uiState:f,jitPluginData:x,fileAttachments:X,invokedPlugin:R}=Gt(c,V,o),{isGoogleConnectorTool:U,connectorId:Z,connectorToolStatus:$,connectorStatusMessage:v}=Vt(i,o);let D;for(let u=V.length-1;u>=0;u--){const p=V[u].metadata?.jit_plugin_data;if(p?.from_server?.type==="confirm_action"){D=p;break}}let M=x?.from_server?.type!=="denied_by_user"?x?.from_server?.body.domain:C?.metadata?.domain;M?M.endsWith("__jit_plugin")&&(M=M.slice(0,-12)):M="connector";const Oe=C?.metadata?.privacy_policy_url;S.useEffect(()=>{if(Le(x?.from_client)?.type==="oauth_success")return;const u=a.get("oauth_success");if(x?.from_server?.type==="oauth_required"&&u){l(p=>(p.delete("oauth_success"),p),{replace:!0});for(const p of x.from_server.body.actions)if(p.type==="oauth_redirect"){ne({eventSource:"url",assistantMessage:c,onRequestCompletion:n,actionData:{type:"oauth_success",target_message_id:p.oauth_redirect.target_message_id},conversationMode:g});return}}},[g,c,e,s,n,x,o,a,l]);const Re=S.useMemo(()=>({sendFollowUpMessage:u=>{const p=it.getRequestId(Te(s));vt(p)||n({completionType:lt.Next,promptMessage:{id:Me(),author:{role:Ee.User,name:"user"},content:{content_type:B.Text,parts:[u]},recipient:"all",metadata:{is_visually_hidden_from_conversation:!0}},eventSource:"mouse"})},updateWidgetState:u=>{jt(u)}}),[n,s]);let z=j.Running,E=M?_.running:_.starting,ee={domain:M};if(f===7)return null;f===4||f===5?(z=j.Paused,E=_.confirmingSimple,ee={...{gizmoName:w?.gizmo.display.name??"ChatGPT",domain:M},title:p=>t.jsxs("div",{className:"inline-flex items-center gap-1 text-sm",children:[p,t.jsx(Ae,{className:"icon-sm"})]}),subtitle:p=>t.jsx("div",{className:"text-xs",children:p})}):f===1?(z=j.Finished,E=_.finished,ee={domain:M}):f===2?(z=j.Error,E=_.error):(f===3||f===6)&&(z=j.Stopped,E=f===6?_.declined:_.stopped);const le={assistantMessage:c,allMessages:e,clientThreadId:s,turnGizmo:w,onRequestCompletion:n,conversationMode:g},ze={domain:M,connectorId:Z,connectorFixture:r},te=x?.from_server?.type!=="denied_by_user"?x?.from_server?.body.actions.map((u,p)=>t.jsx(Tt,{action:u,displayParams:ze,handleUserAction:ne,userActionParams:le},p)):null;E=Wt(E,N,f);const Fe=E?m.formatMessage(E,ee):null,Be=O.div`flex gap-2 flex-wrap mt-1 empty:hidden`,J=i[i.length-1],se=we(x)??we(D),ce=$t(J),Ge=se?.[De]??[],Ve=I.data===!0&&(!!se||!!ce||Ge.length>0);let W=t.jsx(t.Fragment,{});const H=ve(x,R)??ve(D,void 0)??"";if(zt.includes(H)&&(f===5||f===1||f===3||f===6)){const u=f!==1,p=(f===3||f===6)&&!o,F=be(x,R)??be(D,void 0),de=Ue=>{x?.from_server?.type==="confirm_action"&&x?.from_server?.body?.actions?.[0].type==="allow"&&(ne({...le,sourceEvent:Ue,actionData:{type:"allow",...x?.from_server?.body?.actions?.[0].allow}}),gt(s,$e=>{$e.scrollToMessageId=s}))};switch(H){case"send_email":W=t.jsx(Pt,{to:F?.to,cc:F?.cc,bcc:F?.bcc,subject:F?.subject,body:F?.body,onClick:f===5?de:()=>{},isDraft:u,isCanceled:p});break;default:W=t.jsx(Ot,{functionName:H??"",parameters:F??{},onClick:f===5?de:()=>{},isDraft:u,isCanceled:p});break}}else(f===5||f===4)&&te&&(W=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-2 flex gap-2",children:te}),t.jsxs("div",{className:"my-1 flex items-center gap-2 text-sm",children:[t.jsx(ct,{className:"icon-sm"}),t.jsx(b,{..._.confirmingSubtitle})]})]}));return U?t.jsxs(t.Fragment,{children:[v&&t.jsx(ue,{highlightedCommand:m.formatMessage(v,{domain:M}),status:$,showWorkUserSetting:!1}),t.jsx("div",{className:"mb-2 flex gap-2",children:te})]}):t.jsxs(t.Fragment,{children:[t.jsx(Bt,{debugMessages:G}),t.jsx(ue,{highlightedCommand:Fe,status:z,showWorkUserSetting:!1,children:Ve?t.jsx(Jt,{privacyPolicyUrl:Oe,name:c.recipient??H,params:se,result:ce,isPromptingForPermission:z===j.Paused}):null}),t.jsx(Be,{children:X?.map(u=>t.jsx(ke,{file:u.name,fileId:u.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:u.download_url,contextConnectorInfo:dt(u.context_connector_info)},u.id))}),J&&J.metadata?.chatgpt_sdk?.rendered_template&&t.jsx(At,{html:J.metadata.chatgpt_sdk.rendered_template,title:"",oai:Re,toolInfo:N}),W]})}function Ft({messageMetadata:e}){const[s,o]=S.useState(!1);return t.jsxs("div",{className:"my-2 flex flex-col text-sm",children:[t.jsxs("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{o(!s)},children:[s?t.jsx(Ae,{className:"icon-sm"}):t.jsx(ht,{className:"icon-sm"}),t.jsx("div",{className:"font-semibold",children:e.display_message})]}),s&&t.jsx("pre",{children:JSON.stringify(e.data,null,2)})]})}function Bt({debugMessages:e}){return e.length===0?null:t.jsx("div",{children:e.map((s,o)=>{const r=s.metadata?.jit_plugin_data?.from_server;return r&&r.type==="debug"?t.jsx(Ft,{messageMetadata:r.body},o):null})})}function ve(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.operation:s?.parsed_function_call?.name}function be(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.params:s?.parsed_function_call?.kwargs}function Gt(e,s,o){if(e.metadata?.jit_plugin_data?.from_server?.type==="send_test")return{uiState:7};if(s.some(r=>r.content.content_type===B.SystemError))return{uiState:2};if(bt(e))return{uiState:3};for(let r=s.length-1;r>=0;r--){const n=s[r];if(n.metadata?.invoked_plugin){const c=[];return s.forEach(i=>{const m=i.metadata?.attachments?.filter(d=>d.display_files_from_actions_ext);m&&c.push(...m)}),{uiState:1,jitPluginData:n.metadata.jit_plugin_data,invokedPlugin:n.metadata.invoked_plugin,fileAttachments:c}}const a=Le(n.metadata?.jit_plugin_data?.from_client);if(a!=null){if(a?.type==="contact_gizmo")return{uiState:1,jitPluginData:s[r-1]?.metadata?.jit_plugin_data};if(a?.type==="deny")return{uiState:6};if(a?.type==="oauth_success")return{uiState:0,jitPluginData:n.metadata?.jit_plugin_data};break}const l=n.metadata?.jit_plugin_data?.from_server;if(l?.type==="preview"&&o)return{uiState:0,jitPluginData:n.metadata?.jit_plugin_data};if(l?.type==="confirm_action"&&o)return{uiState:5,jitPluginData:n.metadata?.jit_plugin_data};if(l?.type==="oauth_required"&&o)return{uiState:4,jitPluginData:n.metadata?.jit_plugin_data}}return{uiState:o?0:3}}function Vt(e,s){const o=!!e.find(i=>ut(i)===ft.JITPluginGoogleTool);if(!o)return{isGoogleConnectorTool:o,connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null};var r=void 0,n=j.Running,a=null;const l=e[e.length-1],c=l?.metadata?.jit_plugin_data;return e.some(i=>i.content.content_type===B.SystemError)?(n=j.Error,a=_.error):!l||c?.from_client?.type==="oauth_success"?(n=j.Running,a=_.running):l?.metadata?.invoked_plugin?(n=j.Finished,a=_.finished):c?.from_server?.type==="oauth_required"&&s?(r=c?.from_server?.body?.connector_id,n=j.Paused,a=null):c?.from_server?.type==="oauth_required"&&!s||c?.from_client?.type==="deny"?(n=j.Stopped,a=_.declined):(n=j.Stopped,a=_.stopped),{isGoogleConnectorTool:o,connectorId:r,connectorToolStatus:n,connectorStatusMessage:a}}function ne({actionData:e,assistantMessage:s,turnGizmo:o,onRequestCompletion:r,conversationMode:n,...a}){const l={id:Me(),author:{role:Ee.Tool,name:s.recipient},content:{content_type:B.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:e},gizmo_id:o?.gizmo.id},clientMetadata:{completionSampleFinishTime:Date.now()}};r({...a,promptMessage:l,completionMetadata:{conversationMode:n??{kind:Ne.PrimaryAssistant}}})}function Ut(e,s){if(e.type!==mt.JIT_PLUGIN||!e.metadata.json_schema)return!1;let o=!1;function r(n){for(const a in n)a==="operationId"&&n[a]===s&&(o=!0),n[a]&&typeof n[a]=="object"&&r(n[a])}return r(e.metadata.json_schema),o}function we(e){if(e&&(e.from_server?.type==="confirm_action"||e.from_server?.type==="oauth_required"||e.from_server?.type==="preview"))return e.from_server.body.params}function $t(e){if(!e)return;const s=e.content.content_type===B.Text?e.content.parts[0]:e.content.content_type===B.Code?e.content.text:void 0;if(s)try{return JSON.parse(s)}catch{return s}}function Jt({name:e,params:s,result:o,privacyPolicyUrl:r,isPromptingForPermission:n}){const l=(s?.[De]??[]).map((c,i)=>{const m=c.name.startsWith("dalle-");let d=c.name;return m&&(d=`${d}.webp`),t.jsx(ke,{file:d,fileId:c.id},i)});return t.jsxs("div",{className:"divide-token-border-default border-token-border-default mt-1 mb-4 divide-y overflow-hidden rounded-xl border",children:[s&&t.jsxs(t.Fragment,{children:[e&&t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary px-4 py-2 text-sm",children:t.jsx(b,{id:"JITPluginMessage.params.toolCall",defaultMessage:"Tool call: {name}",values:{name:t.jsx("span",{className:"text-token-text-primary",children:e})}})}),t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:[n?t.jsx(b,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):t.jsx(b,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),r&&t.jsx("a",{href:pt(r),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:t.jsx(b,{..._.privacyPolicyLink})})]}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(me,{value:s})}),l.length>0&&t.jsx("div",{className:"px-4 py-2",children:l})]}),o&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:t.jsx(b,{id:"JITPluginMessage.params.result",defaultMessage:"Result:"})}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(me,{value:o})})]})]})}function Wt(e,s,o){if([1,0,3].includes(o)&&s?.namespace==="ecosystem_demo")switch(s.functionName){case"daw":return o===1?Y({id:"BYgUCC",defaultMessage:"Composed track"}):Y({id:"9n1xDI",defaultMessage:"Composing track"});case"flashcards":return o===1?Y({id:"szZeVr",defaultMessage:"Created flashcards"}):Y({id:"NYOjya",defaultMessage:"Creating flashcards"})}return e}function Le(e){if(e&&"user_action"in e){const s=e.user_action;e={...e,...s.data},"target_message_id"in e&&s.target_message_id&&(e.target_message_id=s.target_message_id)}return e}const _=Q({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"}});export{Xt as JITPluginMessage};
//# sourceMappingURL=zyxdyxy69ajrblnk.js.map
