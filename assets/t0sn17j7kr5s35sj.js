import{e$ as qe,qN as Ie,qZ as He,q_ as fe,q$ as I,r0 as $e,r1 as L,r2 as We,r3 as pe,dc as de,b$ as me,r4 as Ge,d0 as Ke,x,r5 as ze,r6 as ge,r7 as H,r8 as Ye,bU as T,qk as he,bT as Ve,il as Xe}from"./forbprkns1cohsbl.js";import{jR as M,P as b,be as Qe,cY as Je,bg as Ze,D as et,d as tt,dw as nt,b6 as rt,bU as st,cl as ot,ay as S,az as E,g as at,ch as it,dX as ct,c6 as lt,ml as ut,mm as ye,R as ft,bt as pt,aq as dt,a6 as mt,bj as gt,e6 as ht,qe as yt,bq as bt,oG as be,qf as _t}from"./g670b8vtkhx0yc6d.js";import{r as _,b as _e,j as f,M as $,R as P,u as wt,e as xt,f as Nt}from"./gg0tb34p9fzo1omt.js";import{a as kt}from"./kr5jdtt5uczx95b1.js";import{r as Ct,b as St}from"./cnl9n9geu2oxb8o4.js";import{f as Et,r as Lt,a as At,b as vt,c as Mt,d as Dt,s as C,e as W}from"./k7lsvlcih6dj1cdg.js";import{f as we,p as G,n as K,h as xe,s as B,w as U,a as Rt,r as Tt}from"./foly6q6x9dui805g.js";import{k as z}from"./pc2givv05uuq8g6l.js";function Ot({onClose:e,url:r,onAction:n,onActionAborted:t}){const s=_.useRef(!1),i=_e(),{clientThreadId:o}=qe(),c={...M({clientThreadId:o}),url:r,link_type:"text",section:"safe-link-modal"};_.useEffect(()=>{b.logEventWithStatsig("Safe Link Warning Modal Shown","chatgpt_safe_link_warning_modal_shown")},[]);const l=async()=>{s.current=!0;try{await navigator.clipboard.writeText(r),b.logEventWithStatsig("Safe Link Warning Modal Copy Clicked","chatgpt_safe_link_warning_modal_copy_clicked"),b.logEventWithStatsig("link_action","link_action",{...c,action:"copy"})}catch(g){et.addError(g)}n?.("copy"),e()},u=()=>{s.current=!0,b.logEventWithStatsig("Safe Link Warning Modal Open Clicked","chatgpt_safe_link_warning_modal_open_clicked"),b.logEventWithStatsig("link_action","link_action",{...c,action:"click"}),n?.("open"),e()},m=()=>{s.current||(b.logEventWithStatsig("Safe Link Warning Modal Canceled","chatgpt_safe_link_warning_modal_canceled"),t?.()),s.current=!1,e()};let w="",p=r,h="";try{p=new URL(r).hostname;const y=r.indexOf(p);y!==-1&&(w=r.substring(0,y),h=r.substring(y+p.length))}catch{}return f.jsxs(Qe,{testId:"modal-safe-link-warning",isOpen:!0,hideSeparator:!0,onClose:m,showCloseButton:!0,type:"warning",title:f.jsx("div",{className:"flex items-center gap-2",children:i.formatMessage({id:"KXMlta",defaultMessage:"This link isn't verified"})}),primaryButton:f.jsx(Ze,{as:"link",openNewTab:!0,rel:"noopener noreferer",color:"primary",onClick:u,to:r,children:i.formatMessage({id:"gMzmDW",defaultMessage:"Open link"})}),secondaryButton:f.jsx(Je.Button,{title:i.formatMessage({id:"YGLt71",defaultMessage:"Copy link"}),color:"secondary",onClick:l}),children:[f.jsxs("p",{className:"text-token-text-secondary mb-6 text-sm text-pretty",children:[f.jsx($,{defaultMessage:"Make sure you trust this link before proceeding. If you don't recognize the URL, don't open the link to access the site.",id:"safe-link-warning-modal-description"}),f.jsx("a",{className:"hover:text-token-link-hover ps-1 underline underline-offset-1",href:"https://help.openai.com/en/articles/10984597-chatgpt-generated-links",target:"_blank",rel:"noopener noreferrer",children:f.jsx($,{id:"xNvPsR",defaultMessage:"Learn more"})})]}),f.jsxs("div",{className:"mb-2 text-sm break-all",children:[f.jsx("span",{className:"text-token-text-secondary",children:w}),f.jsx("span",{className:"text-token-text-primary font-medium",children:p}),f.jsx("span",{className:"text-token-text-secondary",children:h})]})]})}const Y={},V={},X={};function Q(e,r){return`${e}::${r}`}function jt({node:e,onClick:r,children:n,clientThreadId:t,messageId:s,href:i,disableSafeURLs:o,...a}){let c=r;const l=e?.properties?.href,u=_.useContext(Ie),m=tt(),w=nt(t),p=kt(w,i,u?.useSafeUrls&&!o),h=rt(m,"387775177"),g=!o&&p===void 0&&h.get("enable-copy-and-open",!1);return s!=null&&typeof l=="string"&&l.includes("/bing/redirect")&&(Y[s]||(b.logEvent("Browsing Show Bing Link",{id:s,content:l}),Y[s]=!0),c=y=>{V[s]||(b.logEvent("Browsing Click Bing Link",{id:s,content:l}),V[s]=!0),r?.(y)}),c=y=>{const N=""+l;if(s&&!X[Q(s,N)]){const A=p||g?"URL Clicked Allowed":"URL Clicked Blocked";b.logEvent(A,{id:s,content:N}),X[Q(s,N)]=!0}r?.(y),g&&i&&ot(m,Ot,{url:i})},f.jsx(f.Fragment,{children:f.jsx("a",{onClick:c,...a,className:st(a.className,g&&"cursor-pointer"),href:p,rel:"noopener",children:n})})}const vr="w";function Ft({messageId:e,clientThreadId:r,text:n,children:t,...s}){const o=`${window.location.origin}?q=${encodeURIComponent(n)}`,a=He(),c=_.useCallback(async l=>{l.preventDefault(),S.count(E.DEFAULT,"instant_follow_up_anchor_clicked"),b.logEventWithStatsig("Instant Follow Up Anchor Clicked","chatgpt_instant_follow_up_anchor_clicked",{clientThreadId:r,messageId:e}),a(l,{text:n,type:fe.Reply},[],0)},[r,e,n,a]);return f.jsx(jt,{...s,href:o,disableSafeURLs:!0,clientThreadId:r,messageId:e,className:"cursor-pointer",onClick:c,children:t})}const Mr=P.memo(Ft),J=/[#.]/g;function Pt(e,r){const n=e||"",t={};let s=0,i,o;for(;s<n.length;){J.lastIndex=s;const a=J.exec(n),c=n.slice(s,a?a.index:n.length);c&&(i?i==="#"?t.id=c:Array.isArray(t.className)?t.className.push(c):t.className=[c]:o=c,s+=c.length),a&&(i=a[0],s++)}return{type:"element",tagName:o||r||"div",properties:t,children:[]}}const Bt=new Set(["button","menu","reset","submit"]),O={}.hasOwnProperty;function Ne(e,r,n){const t=n&&Ht(n);function s(i,o,...a){let c=-1,l;if(i==null){l={type:"root",children:[]};const u=o;a.unshift(u)}else if(l=Pt(i,r),l.tagName=l.tagName.toLowerCase(),t&&O.call(t,l.tagName)&&(l.tagName=t[l.tagName]),Ut(o,l.tagName)){let u;for(u in o)O.call(o,u)&&qt(e,l.properties,u,o[u])}else a.unshift(o);for(;++c<a.length;)j(l.children,a[c]);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return s}function Ut(e,r){return e==null||typeof e!="object"||Array.isArray(e)?!1:r==="input"||!e.type||typeof e.type!="string"?!0:"children"in e&&Array.isArray(e.children)?!1:r==="button"?Bt.has(e.type.toLowerCase()):!("value"in e)}function qt(e,r,n,t){const s=we(e,n);let i=-1,o;if(t!=null){if(typeof t=="number"){if(Number.isNaN(t))return;o=t}else typeof t=="boolean"?o=t:typeof t=="string"?s.spaceSeparated?o=I(t):s.commaSeparated?o=G(t):s.commaOrSpaceSeparated?o=I(G(t).join(" ")):o=Z(s,s.property,t):Array.isArray(t)?o=t.concat():o=s.property==="style"?It(t):String(t);if(Array.isArray(o)){const a=[];for(;++i<o.length;){const c=Z(s,s.property,o[i]);a[i]=c}o=a}if(s.property==="className"&&Array.isArray(r.className)){const a=o;o=r.className.concat(a)}r[s.property]=o}}function j(e,r){let n=-1;if(r!=null)if(typeof r=="string"||typeof r=="number")e.push({type:"text",value:String(r)});else if(Array.isArray(r))for(;++n<r.length;)j(e,r[n]);else if(typeof r=="object"&&"type"in r)r.type==="root"?j(e,r.children):e.push(r);else throw new Error("Expected node, nodes, or string, got `"+r+"`")}function Z(e,r,n){if(typeof n=="string"){if(e.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((e.boolean||e.overloadedBoolean)&&(n===""||K(n)===K(r)))return!0}return n}function It(e){const r=[];let n;for(n in e)O.call(e,n)&&r.push([n,e[n]].join(": "));return r.join("; ")}function Ht(e){const r={};let n=-1;for(;++n<e.length;)r[e[n].toLowerCase()]=e[n];return r}const $t=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],Wt=Ne(xe,"div"),Gt=Ne(B,"g",$t),D={html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg"};function Kt(e,r){return ke(e,{})||{type:"root",children:[]}}function ke(e,r){const n=zt(e,r);return n&&r.afterTransform&&r.afterTransform(e,n),n}function zt(e,r){switch(e.nodeType){case 1:return Qt(e,r);case 3:return Vt(e);case 8:return Xt(e);case 9:return ee(e,r);case 10:return Yt();case 11:return ee(e,r);default:return}}function ee(e,r){return{type:"root",children:Ce(e,r)}}function Yt(){return{type:"doctype"}}function Vt(e){return{type:"text",value:e.nodeValue||""}}function Xt(e){return{type:"comment",value:e.nodeValue||""}}function Qt(e,r){const n=e.namespaceURI,t=n===D.svg?Gt:Wt,s=n===D.html?e.tagName.toLowerCase():e.tagName,i=n===D.html&&s==="template"?e.content:e,o=e.getAttributeNames(),a={};let c=-1;for(;++c<o.length;)a[o[c]]=e.getAttribute(o[c])||"";return t(s,a,Ce(i,r))}function Ce(e,r){const n=e.childNodes,t=[];let s=-1;for(;++s<n.length;){const i=ke(n[s],r);i!==void 0&&t.push(i)}return t}new DOMParser;function Jt(e,r){const n=Zt(e);return Kt(n)}function Zt(e){const r=document.createElement("template");return r.innerHTML=e,r.content}const te=function(e,r,n){const t=$e(n);if(!e||!e.type||!e.children)throw new Error("Expected parent node");if(typeof r=="number"){if(r<0||r===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(r=e.children.indexOf(r),r<0)throw new Error("Expected child node or index");for(;++r<e.children.length;)if(t(e.children[r],r,e))return e.children[r]},ne=/\n/g,re=/[\t ]+/g,F=L("br"),se=L(cn),en=L("p"),oe=L("tr"),tn=L(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",an,ln]),Se=L(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function nn(e,r){const n=r||{},t="children"in e?e.children:[],s=Se(e),i=Ae(e,{whitespace:n.whitespace||"normal"}),o=[];(e.type==="text"||e.type==="comment")&&o.push(...Le(e,{breakBefore:!0,breakAfter:!0}));let a=-1;for(;++a<t.length;)o.push(...Ee(t[a],e,{whitespace:i,breakBefore:a?void 0:s,breakAfter:a<t.length-1?F(t[a+1]):s}));const c=[];let l;for(a=-1;++a<o.length;){const u=o[a];typeof u=="number"?l!==void 0&&u>l&&(l=u):u&&(l!==void 0&&l>-1&&c.push(`
`.repeat(l)||" "),l=-1,c.push(u))}return c.join("")}function Ee(e,r,n){return e.type==="element"?rn(e,r,n):e.type==="text"?n.whitespace==="normal"?Le(e,n):sn(e):[]}function rn(e,r,n){const t=Ae(e,n),s=e.children||[];let i=-1,o=[];if(tn(e))return o;let a,c;for(F(e)||oe(e)&&te(r,e,oe)?c=`
`:en(e)?(a=2,c=2):Se(e)&&(a=1,c=1);++i<s.length;)o=o.concat(Ee(s[i],e,{whitespace:t,breakBefore:i?void 0:a,breakAfter:i<s.length-1?F(s[i+1]):c}));return se(e)&&te(r,e,se)&&o.push("	"),a&&o.unshift(a),c&&o.push(c),o}function Le(e,r){const n=String(e.value),t=[],s=[];let i=0;for(;i<=n.length;){ne.lastIndex=i;const c=ne.exec(n),l=c&&"index"in c?c.index:n.length;t.push(on(n.slice(i,l).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),i===0?r.breakBefore:!0,l===n.length?r.breakAfter:!0)),i=l+1}let o=-1,a;for(;++o<t.length;)t[o].charCodeAt(t[o].length-1)===8203||o<t.length-1&&t[o+1].charCodeAt(0)===8203?(s.push(t[o]),a=void 0):t[o]?(typeof a=="number"&&s.push(a),s.push(t[o]),a=0):(o===0||o===t.length-1)&&s.push(0);return s}function sn(e){return[String(e.value)]}function on(e,r,n){const t=[];let s=0,i;for(;s<e.length;){re.lastIndex=s;const o=re.exec(e);i=o?o.index:e.length,!s&&!i&&o&&!r&&t.push(""),s!==i&&t.push(e.slice(s,i)),s=o?i+o[0].length:i}return s!==i&&!n&&t.push(""),t.join(" ")}function Ae(e,r){if(e.type==="element"){const n=e.properties||{};switch(e.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return n.wrap?"pre-wrap":"pre";case"td":case"th":return n.noWrap?"nowrap":r.whitespace;case"textarea":return"pre-wrap"}}return r.whitespace}function an(e){return!!(e.properties||{}).hidden}function cn(e){return e.tagName==="td"||e.tagName==="th"}function ln(e){return e.tagName==="dialog"&&!(e.properties||{}).open}const un={},fn=[];function ve(e){const r=e||un;return function(n,t){We(n,"element",function(s,i){const o=Array.isArray(s.properties.className)?s.properties.className:fn,a=o.includes("language-math"),c=o.includes("math-display"),l=o.includes("math-inline");let u=c;if(!a&&!c&&!l)return;let m=i[i.length-1],w=s;if(s.tagName==="code"&&a&&m&&m.type==="element"&&m.tagName==="pre"&&(w=m,m=i[i.length-2],u=!0),!m)return;const p=nn(w,{whitespace:"pre"});let h;try{h=z.renderToString(p,{...r,displayMode:u,throwOnError:!0})}catch(y){const N=y,A=N.name.toLowerCase();t.message("Could not render math with KaTeX",{ancestors:[...i,s],cause:N,place:s.position,ruleId:A,source:"rehype-katex"}),A==="parseerror"?h=z.renderToString(p,{...r,displayMode:u,strict:"ignore",throwOnError:!1}):h=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(r.errorColor||"#cc0000"),title:String(y)},children:[{type:"text",value:p}]}]}typeof h=="string"&&(h=Jt(h).children);const g=m.children.indexOf(w);return m.children.splice(g,1,...h),pe})}}function pn(e){Et(e,[/\r?\n|\r/g,dn])}function dn(){return{type:"break"}}function mn(){return function(e){pn(e)}}const Me="sandbox:";function Dr({messageId:e,clientThreadId:r,href:n,...t}){const s=wt(),[i,o]=_.useState(!1),a=n.substring(Me.length),c=at(r),l=_e(),u=it(),m=_.useCallback(g=>{const y=document.createElement("a");y.href=g,y.click(),o(!1)},[]),w=_.useCallback(g=>{o(!1),u.danger(g,{toastId:"file_download_failed"})},[u]),p=hn(i,e,c,a,w,m).data,h=_.useCallback(async g=>{r!==void 0&&(g.preventDefault(),(p===void 0||p?.status!=="success")&&s.invalidateQueries({queryKey:De(e,a)}),p?.status==="success"&&p?.download_url?m(p.download_url):o(!0))},[r,p,s,e,a,m]);return f.jsx(ct,{closeOnOutsideClick:!1,label:f.jsxs("span",{className:"flex items-center gap-1",children:[i?l.formatMessage(ae.startingDownload):l.formatMessage(ae.downloadFile),i&&f.jsx(lt,{})]}),side:"top",children:f.jsx("a",{...t,className:"cursor-pointer",onClick:g=>!i&&h(g)})})}async function gn(e,r,n){const t=await ft.safeGet("/conversation/{conversation_id}/interpreter/download",{parameters:{path:{conversation_id:r},query:{message_id:e,sandbox_path:n}}});if(t.status===pt.Success)return t;throw new ye("Could not download file from advanced data analysis","error_code"in t?t.error_code:"unknown_error")}function hn(e,r,n,t,s,i){const o=ut();return Nt({queryKey:De(r,t),queryFn:()=>gn(r,n,t).then(a=>(a?.status==="success"&&i(a.download_url),a)).catch(a=>{let c=o("default_download_link_error",{fileName:t});throw a instanceof ye&&a.code!=null&&(c=o(a.code)),s?.(c),a}),enabled:!!(e&&r&&n&&t)})}function De(e,r){return["downloadSandboxLink",e,r]}const ae=xt({downloadFile:{id:"SandboxDownload.downloadFile",defaultMessage:"Download file"},startingDownload:{id:"SandboxDownload.startingDownload",defaultMessage:"Starting download"}}),Rr="f",Tr="dr",Re=(e,r,n=!1)=>{const t=_.useRef(!1);_.useEffect(()=>{t.current||(t.current=!0,S.count(E.DEFAULT,"clickable_follow_up_text_shown"),n&&S.count(E.DEFAULT,"clickable_follow_up_deep_research_text_shown"),b.logEventWithStatsig("Clickable Follow Up Text Shown","chatgpt_clickable_follow_up_text_shown",{...M({clientThreadId:e,messageId:r})}))},[e,r,n])},Te=({messageId:e,clientThreadId:r,text:n})=>{const t=de(r),s=dt.useStore(),i=me(r);Re(r,e,!1);const o=_.useCallback(a=>{a.preventDefault(),S.count(E.DEFAULT,"clickable_follow_up_text_clicked"),b.logEventWithStatsig("Clickable Follow Up Text Clicked","chatgpt_clickable_follow_up_text_clicked",M({clientThreadId:r,messageId:e}));const c=s.getActiveSystemHintType();t({sourceEvent:a,promptMessage:gt(n.toLowerCase(),{suggestion_type:fe.Reply}),completionMetadata:{systemHints:c?[c]:[],conversationMode:i??{kind:mt.PrimaryAssistant}}})},[r,i,e,s,t,n]);return f.jsx("span",{className:"decoration-token-text-secondary hover:text-token-text-secondary cursor-pointer underline decoration-dotted decoration-[12%] underline-offset-4 transition-colors duration-200 ease-in-out",onClick:o,children:n})},yn=({messageId:e,clientThreadId:r,text:n})=>f.jsx(Te,{messageId:e,clientThreadId:r,text:n}),Or=P.memo(yn),bn=({messageId:e,clientThreadId:r,text:n})=>{const t=ht(),{setThreadSystemHintMode:s}=Ge(),i=!!yt(),o=de(r),a=me(r);Re(r,e,!0);const c=_.useCallback(l=>{l.preventDefault(),S.count(E.DEFAULT,"clickable_follow_up_text_clicked"),S.count(E.DEFAULT,"clickable_follow_up_deep_research_text_clicked"),b.logEventWithStatsig("Clickable Follow Up Text Clicked","chatgpt_clickable_follow_up_text_clicked",M({clientThreadId:r,messageId:e}));const u={clientThreadId:r};s(bt.Research,!0,u),t.focus(),t.setText(n)},[r,e,n,t,s,a,o]);return i?f.jsx(Te,{messageId:e,clientThreadId:r,text:n}):f.jsxs("span",{className:"decoration-token-text-secondary hover:text-token-text-secondary cursor-pointer underline decoration-dotted decoration-[12%] underline-offset-4 transition-colors duration-200 ease-in-out",onClick:c,children:[f.jsx(Ke,{className:"icon me-1 inline-block"}),n]})},_n=({messageId:e,clientThreadId:r,text:n})=>f.jsx(bn,{messageId:e,clientThreadId:r,text:n}),jr=P.memo(_n);function wn(){return e=>{x(e,{tagName:"table"},r=>{const n=r.children.find(s=>k(s,"thead"))?.children.find(s=>k(s,"tr"))?.children.filter(s=>k(s,"th"))??[],t=r.children.find(s=>k(s,"tbody"))?.children.filter(s=>k(s,"tr"))?.map(s=>s.children.filter(i=>k(i,"td")))??[];for(let s=0;s<n.length;s++){const i=n[s];let o=ie(i);for(let c=0;c<t.length;c++)o=Math.max(o,ie(t[c]?.[s]));const a=o>160?"xl":o>100?"lg":o>40?"md":"sm";i.properties["data-col-size"]=a;for(let c=0;c<t.length;c++)t[c]?.[s]&&(t[c][s].properties["data-col-size"]=a)}})}}function k(e,r){return e.type==="element"&&e.tagName===r}function ie(e){let r=0;return e&&x(e,"text",n=>{r+=n.value.length}),r}const Fr=e=>(e.startsWith(Me),e);function xn(){return e=>{x(e,"list",r=>{for(const n of r.children)n.spread=!0})}}function Pr(e){return r=>{x(r,n=>{Object.defineProperties(n,{markdownSource:{get(){try{return e.slice(this.position.start.offset,this.position.end.offset)}catch{return""}}}})})}}const Oe=[Lt,mn,xn,[At,{singleDollarTextMath:!1}],vt,Mt,Dt,...H?[H]:[],Ct,Nn,Cn];function Nn(){return e=>{x(e,"textDirective",r=>{r.name!==be&&(r.type="text",r.value=`:${r.name}`)})}}const kn=/\u200b/g;function Cn(){return e=>{x(e,"text",r=>{r.value=r.value.replace(kn,"")})}}function Sn(){return e=>{const r=e.position?.end.offset;x(e,"element",(n,t)=>{const{position:s}=n;if(!s)return;const{start:i,end:o}=s,a=i.offset,c=o.offset;n.properties??={},a!=null&&(n.properties["data-start"]=a),c!=null&&(n.properties["data-end"]=c,r===c&&(n.properties["data-is-last-node"]=""),t===e.children.length-1&&(n.properties["data-is-only-node"]=""))})}}const Br=[ve,Sn,wn,[ze,{target:"_new",rel:"noopener noreferrer"}],ge],En=[[ve,{output:"mathml"}],ge],Ln=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],ce={}.hasOwnProperty;function An(e,r){const n=r||{};function t(s,...i){let o=t.invalid;const a=t.handlers;if(s&&ce.call(s,e)){const c=String(s[e]);o=ce.call(a,c)?a[c]:t.unknown}if(o)return o.call(this,s,...i)}return t.handlers=n.handlers||{},t.invalid=n.invalid,t.unknown=n.unknown,t}const vn=/^>|^->|<!--|-->|--!>|<!-$/g,Mn=[">"],Dn=["<",">"];function Rn(e,r,n,t){return t.settings.bogusComments?"<?"+C(e.value,Object.assign({},t.settings.characterReferences,{subset:Mn}))+">":"<!--"+e.value.replace(vn,s)+"-->";function s(i){return C(i,Object.assign({},t.settings.characterReferences,{subset:Dn}))}}function Tn(e,r,n,t){return"<!"+(t.settings.upperDoctype?"DOCTYPE":"doctype")+(t.settings.tightDoctype?"":" ")+"html>"}const d=Fe(1),je=Fe(-1),On=[];function Fe(e){return r;function r(n,t,s){const i=n?n.children:On;let o=(t||0)+e,a=i[o];if(!s)for(;a&&U(a);)o+=e,a=i[o];return a}}const jn={}.hasOwnProperty;function Pe(e){return r;function r(n,t,s){return jn.call(e,n.tagName)&&e[n.tagName](n,t,s)}}const q=Pe({body:Pn,caption:R,colgroup:R,dd:In,dt:qn,head:R,html:Fn,li:Un,optgroup:Hn,option:$n,p:Bn,rp:le,rt:le,tbody:Gn,td:ue,tfoot:Kn,th:ue,thead:Wn,tr:zn});function R(e,r,n){const t=d(n,r,!0);return!t||t.type!=="comment"&&!(t.type==="text"&&U(t.value.charAt(0)))}function Fn(e,r,n){const t=d(n,r);return!t||t.type!=="comment"}function Pn(e,r,n){const t=d(n,r);return!t||t.type!=="comment"}function Bn(e,r,n){const t=d(n,r);return t?t.type==="element"&&(t.tagName==="address"||t.tagName==="article"||t.tagName==="aside"||t.tagName==="blockquote"||t.tagName==="details"||t.tagName==="div"||t.tagName==="dl"||t.tagName==="fieldset"||t.tagName==="figcaption"||t.tagName==="figure"||t.tagName==="footer"||t.tagName==="form"||t.tagName==="h1"||t.tagName==="h2"||t.tagName==="h3"||t.tagName==="h4"||t.tagName==="h5"||t.tagName==="h6"||t.tagName==="header"||t.tagName==="hgroup"||t.tagName==="hr"||t.tagName==="main"||t.tagName==="menu"||t.tagName==="nav"||t.tagName==="ol"||t.tagName==="p"||t.tagName==="pre"||t.tagName==="section"||t.tagName==="table"||t.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function Un(e,r,n){const t=d(n,r);return!t||t.type==="element"&&t.tagName==="li"}function qn(e,r,n){const t=d(n,r);return!!(t&&t.type==="element"&&(t.tagName==="dt"||t.tagName==="dd"))}function In(e,r,n){const t=d(n,r);return!t||t.type==="element"&&(t.tagName==="dt"||t.tagName==="dd")}function le(e,r,n){const t=d(n,r);return!t||t.type==="element"&&(t.tagName==="rp"||t.tagName==="rt")}function Hn(e,r,n){const t=d(n,r);return!t||t.type==="element"&&t.tagName==="optgroup"}function $n(e,r,n){const t=d(n,r);return!t||t.type==="element"&&(t.tagName==="option"||t.tagName==="optgroup")}function Wn(e,r,n){const t=d(n,r);return!!(t&&t.type==="element"&&(t.tagName==="tbody"||t.tagName==="tfoot"))}function Gn(e,r,n){const t=d(n,r);return!t||t.type==="element"&&(t.tagName==="tbody"||t.tagName==="tfoot")}function Kn(e,r,n){return!d(n,r)}function zn(e,r,n){const t=d(n,r);return!t||t.type==="element"&&t.tagName==="tr"}function ue(e,r,n){const t=d(n,r);return!t||t.type==="element"&&(t.tagName==="td"||t.tagName==="th")}const Yn=Pe({body:Qn,colgroup:Jn,head:Xn,html:Vn,tbody:Zn});function Vn(e){const r=d(e,-1);return!r||r.type!=="comment"}function Xn(e){const r=new Set;for(const t of e.children)if(t.type==="element"&&(t.tagName==="base"||t.tagName==="title")){if(r.has(t.tagName))return!1;r.add(t.tagName)}const n=e.children[0];return!n||n.type==="element"}function Qn(e){const r=d(e,-1,!0);return!r||r.type!=="comment"&&!(r.type==="text"&&U(r.value.charAt(0)))&&!(r.type==="element"&&(r.tagName==="meta"||r.tagName==="link"||r.tagName==="script"||r.tagName==="style"||r.tagName==="template"))}function Jn(e,r,n){const t=je(n,r),s=d(e,-1,!0);return n&&t&&t.type==="element"&&t.tagName==="colgroup"&&q(t,n.children.indexOf(t),n)?!1:!!(s&&s.type==="element"&&s.tagName==="col")}function Zn(e,r,n){const t=je(n,r),s=d(e,-1);return n&&t&&t.type==="element"&&(t.tagName==="thead"||t.tagName==="tbody")&&q(t,n.children.indexOf(t),n)?!1:!!(s&&s.type==="element"&&s.tagName==="tr")}const v={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function er(e,r,n,t){const s=t.schema,i=s.space==="svg"?!1:t.settings.omitOptionalTags;let o=s.space==="svg"?t.settings.closeEmptyElements:t.settings.voids.includes(e.tagName.toLowerCase());const a=[];let c;s.space==="html"&&e.tagName==="svg"&&(t.schema=B);const l=tr(t,e.properties),u=t.all(s.space==="html"&&e.tagName==="template"?e.content:e);return t.schema=s,u&&(o=!1),(l||!i||!Yn(e,r,n))&&(a.push("<",e.tagName,l?" "+l:""),o&&(s.space==="svg"||t.settings.closeSelfClosing)&&(c=l.charAt(l.length-1),(!t.settings.tightSelfClosing||c==="/"||c&&c!=='"'&&c!=="'")&&a.push(" "),a.push("/")),a.push(">")),a.push(u),!o&&(!i||!q(e,r,n))&&a.push("</"+e.tagName+">"),a.join("")}function tr(e,r){const n=[];let t=-1,s;if(r){for(s in r)if(r[s]!==null&&r[s]!==void 0){const i=nr(e,s,r[s]);i&&n.push(i)}}for(;++t<n.length;){const i=e.settings.tightAttributes?n[t].charAt(n[t].length-1):void 0;t!==n.length-1&&i!=='"'&&i!=="'"&&(n[t]+=" ")}return n.join("")}function nr(e,r,n){const t=we(e.schema,r),s=e.settings.allowParseErrors&&e.schema.space==="html"?0:1,i=e.settings.allowDangerousCharacters?0:1;let o=e.quote,a;if(t.overloadedBoolean&&(n===t.attribute||n==="")?n=!0:(t.boolean||t.overloadedBoolean&&typeof n!="string")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const c=C(t.attribute,Object.assign({},e.settings.characterReferences,{subset:v.name[s][i]}));return n===!0||(n=Array.isArray(n)?(t.commaSeparated?Rt:Ye)(n,{padLeft:!e.settings.tightCommaSeparatedLists}):String(n),e.settings.collapseEmptyAttributes&&!n)?c:(e.settings.preferUnquoted&&(a=C(n,Object.assign({},e.settings.characterReferences,{attribute:!0,subset:v.unquoted[s][i]}))),a!==n&&(e.settings.quoteSmart&&W(n,o)>W(n,e.alternative)&&(o=e.alternative),a=o+C(n,Object.assign({},e.settings.characterReferences,{subset:(o==="'"?v.single:v.double)[s][i],attribute:!0}))+o),c+(a&&"="+a))}const rr=["<","&"];function Be(e,r,n,t){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?e.value:C(e.value,Object.assign({},t.settings.characterReferences,{subset:rr}))}function sr(e,r,n,t){return t.settings.allowDangerousHtml?e.value:Be(e,r,n,t)}function or(e,r,n,t){return t.all(e)}const ar=An("type",{invalid:ir,unknown:cr,handlers:{comment:Rn,doctype:Tn,element:er,raw:sr,root:or,text:Be}});function ir(e){throw new Error("Expected node, not `"+e+"`")}function cr(e){const r=e;throw new Error("Cannot compile unknown node `"+r.type+"`")}const lr={},ur={},fr=[];function pr(e,r){const n=r||lr,t=n.quote||'"',s=t==='"'?"'":'"';if(t!=='"'&&t!=="'")throw new Error("Invalid quote `"+t+"`, expected `'` or `\"`");return{one:dr,all:mr,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||Ln,characterReferences:n.characterReferences||ur,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?B:xe,quote:t,alternative:s}.one(Array.isArray(e)?{type:"root",children:e}:e,void 0,void 0)}function dr(e,r,n){return ar(e,r,n,this)}function mr(e){const r=[],n=e&&e.children||fr;let t=-1;for(;++t<n.length;)r[t]=this.one(n[t],t,e);return r.join("")}function gr(e){const r=this,n={...r.data("settings"),...e};r.compiler=t;function t(s){return pr(s,n)}}function hr(e,r){const n=_t(e,r);return Ue(n,r)}function Ue(e,r){const n=T().use(he).use(Oe).use([[_r,r??[]]]).use(St,{rule:"-",tightDefinitions:!0,handlers:{break:()=>`
`,link:yr}}),t=T().use(Tt).use(En).use(gr),s=n.runSync(n.parse(e)),i=n.stringify(s),o=t.stringify(t.runSync(s));return{"text/plain":i,"text/html":o}}const yr=(e,r,n,t)=>{const s=n.createTracker(t),i=n.enter("link"),o=n.enter("label");let a=s.move("[");return a+=s.move(n.containerPhrasing(e,{before:a,after:"](",...s.current()})),a+=s.move("]("),o(),a+=s.move(e.url.replace(/[\x00-\x1F\x7F-\x9F()"]/g,br)),e.title&&(a+=s.move(" "+JSON.stringify(e.title))),a+=s.move(")"),i(),a};function br(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0")}function _r(e){return r=>{const n={},t=(s,i)=>{switch(i.type){case"grouped_webpages":{const o=[];for(const a of i.items)if(a.url&&a.title){let c=n[a.url];c||(c=n[a.url]={type:"definition",identifier:String(Object.keys(n).length+1),url:a.url,title:a.title}),o.push({type:"linkReference",referenceType:"shortcut",identifier:c.identifier,children:[{type:"text",value:a.attribution??Xe(a.url)}]})}return o.length===0?[]:[{type:"text",value:"("},...o.flatMap((a,c,l)=>c<l.length-1?[a,{type:"text",value:", "}]:[a]),{type:"text",value:")"}]}case"title_citation":case"location_search":case"time":case"image_v2":case"nav_list":case"file_navlist":case"file":case"grouped_webpages_model_predicted_fallback":case"tldr":case"navigation":case"stock":case"calculator":case"python":case"container":case"code_execution":case"forecast":case"businesses_map":case"video":case"entity":case"sources_footnote":case"sports_standings":case"sports_schedule":case"attribution":case"webpage_extended":case"checkout_confirmation":case"image_inline":case"image_group":case"product_entity":case"products":case"alt_text":case"product_reviews":case"product_rationale":if(i.alt){const o=T().use(he).use(Oe).parse(i.alt);if(s.type!=="textDirective")return o.children;const a=o.children[0];if(a.type==="paragraph")return a.children}return[];case"hidden":case"status":case"optimistic_image_citation":case"webpage":case"optimistic_image_inline":case"invalid":case"attribution_footer":case"sports":case"grouped_webpages_v2":return[]}};x(r,Ve,(s,i,o)=>{if(o==null||i==null)return;const a=wr(s,e),c=a?t(s,a)??[s]:[];return o.children.splice(i,1,...c),[pe,i+c.length]}),r.children.push(...Object.values(n))}}function wr(e,r){if(e.name===be){const n=e.attributes?.index;if(n)return r[parseInt(n,10)]}}const Ur=Object.freeze(Object.defineProperty({__proto__:null,markdownToClipboardContent:Ue,messageTextToClipboardContent:hr},Symbol.toStringTag,{value:"Module"}));export{Rr as C,vr as I,jt as M,Oe as R,Me as S,Br as a,Dr as b,Mr as c,Or as d,Tr as e,jr as f,Ur as g,Ue as m,Pr as r,Fr as u};
//# sourceMappingURL=t0sn17j7kr5s35sj.js.map
