const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ktkip0mvmcezjx46.js","assets/g670b8vtkhx0yc6d.js","assets/gg0tb34p9fzo1omt.js","assets/root-ilxovqci.css","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/jpdmr6hprcjyd5ie.js","assets/me58wahxzwibdrxp.js","assets/pnx8yl9r7yj5moem.js","assets/felxwdrg3fgsr1mu.js","assets/f51c6zie1stj9anw.js","assets/cs320738df36xnc1.js"])))=>i.map(i=>d[i]);
import{b as F,h as H,r,j as e,M as N,m as Q,A as ae}from"./gg0tb34p9fzo1omt.js";import{by as oe,bz as ne,bC as re,bE as M,bF as ie,bG as le,bL as de,bM as ce,eY as Z,N as $,eZ as ue,e_ as X,a8 as pe,a9 as me,aa as he,e$ as ge,F as fe,f0 as xe,f1 as ve,f2 as je,f3 as be,f4 as ye,f5 as Ce,bp as Me,f6 as Se,f7 as we,f8 as ke,f9 as Ie,dv as Pe,fa as _e,fb as Re,fc as Te,fd as Ne,fe as Ee,dH as De,bd as Fe,d6 as Ae,ff as Oe,fg as Le,fh as Be,fi as Ue,fj as He,fk as Ge,fl as qe,fm as ze,de as Ve,az as We}from"./forbprkns1cohsbl.js";import{ch as G,R as J,cY as A,cO as Ke,bV as Ye,bW as Qe,d as q,kJ as z,hl as V,hm as W,g0 as Ze,g as $e,bS as Xe,g2 as K,g1 as Je,go as et,co as tt,a3 as O,D as ee,aQ as st,dU as at,c5 as ot,dm as nt,c2 as rt,bU as B,j5 as it,dZ as lt,a7 as dt,h as ct,e$ as ut,jQ as pt,dN as mt,S as T,P as L,bm as ht,dE as gt,dj as ft,dL as xt,ni as vt}from"./g670b8vtkhx0yc6d.js";import{I as jt}from"./kapf1vasjh1lo9ik.js";import"./k5ngqk6bkqja3f09.js";const bt=({image:t,onClose:s,onRequestCompletion:n,clientThreadId:o,currentModelId:d,post:c,canDelete:m,onOpenReport:i})=>{const a=F(),h=G(),v=H(),[u,g]=r.useState("default"),l=oe(),b=r.useRef(null),S=r.useRef(l);r.useEffect(()=>{S.current=l},[l]);const y=r.useCallback(()=>ne(a),[a]),k=r.useCallback(()=>{t&&g("inpaint")},[t]),I=r.useCallback(()=>{g("default"),S.current.clearAllDrawings()},[]),P=r.useCallback(()=>{t&&re({url:t.url,fileName:y()})},[t,y]),w=r.useCallback(()=>b.current?.getImageData(),[]),R=r.useCallback(async()=>{if(window.confirm(a.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await J.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:c.id}}}),v("/",{replace:!0})}catch{h.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[c.id,a,h,v]),_=u==="inpaint"?a.formatMessage({id:"TjVqYb",defaultMessage:"Edit Selection"}):c.text??a.formatMessage({id:"htGxHc",defaultMessage:"Image"}),f=r.useCallback(j=>{j.key==="Escape"&&(s(),j.preventDefault())},[s]);return r.useEffect(()=>(document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)),[f]),e.jsx(A.Root,{isOpen:!0,onClose:s,testId:"modal-lightbox-post-share",shouldIgnoreClickOutside:u==="inpaint",children:e.jsx(A.Overlay,{children:e.jsxs(A.Content,{size:"fullscreen",removePopoverStyling:!0,className:"grid min-h-0 grid-rows-[auto_minmax(0,1fr)] overflow-hidden",children:[e.jsxs("header",{className:"flex h-14 w-full items-center justify-between gap-2 px-2 md:px-4",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(M,{icon:Ke,onClick:s,"aria-label":a.formatMessage({id:"EYLKSm",defaultMessage:"Close"})}),e.jsx("h2",{className:"line-clamp-1 text-base font-medium",children:_})]}),e.jsx("div",{className:"flex items-center gap-2",children:u==="inpaint"?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"aspect-square",icon:ie,onClick:l.undoDrawing,disabled:!l.canUndoDrawing,"aria-label":a.formatMessage({id:"OmaTPx",defaultMessage:"Undo"})}),e.jsx(M,{className:"aspect-square",icon:le,onClick:l.redoDrawing,disabled:!l.canRedoDrawing,"aria-label":a.formatMessage({id:"ZUr4oh",defaultMessage:"Redo"})}),e.jsx(M,{className:"w-auto px-3",onClick:I,children:a.formatMessage({id:"D9xvar",defaultMessage:"Cancel"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"aspect-square",icon:de,onClick:k,"aria-label":a.formatMessage({id:"pRGwlp",defaultMessage:"Edit image"})}),e.jsx(M,{className:"aspect-square",icon:ce,onClick:P,"aria-label":a.formatMessage({id:"9DNHka",defaultMessage:"Download image"})}),e.jsx(M,{className:"aspect-square",icon:Z,onClick:i,"aria-label":a.formatMessage({id:"2gNXdX",defaultMessage:"Report content"})}),m&&e.jsx(M,{className:"aspect-square",icon:$,onClick:R,"aria-label":a.formatMessage({id:"rzlDpj",defaultMessage:"Delete post"})})]})})]}),e.jsxs("div",{className:"grid h-full w-full grid-rows-[1fr_auto] items-center overflow-y-auto overscroll-contain",children:[e.jsx("div",{className:"flex h-full w-full items-center justify-center px-4 pb-4",children:t&&e.jsxs("div",{className:"relative inline-block max-h-full rounded bg-neutral-100",children:[e.jsx("img",{src:t.url,alt:_,className:"h-full max-h-[70vh] w-auto max-w-full rounded object-contain",fetchPriority:"high"}),u==="inpaint"&&e.jsx(ue,{image:t,drawingState:l,drawingCanvasRef:b})]})}),e.jsx("div",{className:"flex w-full justify-center px-4 pb-8",children:e.jsx("div",{className:"w-full max-w-[768px]",children:e.jsx(jt,{clientThreadId:o,currentModelId:d,onRequestCompletion:n,onClose:s,activeImage:t,inpainting:u==="inpaint"&&l.currentDrawnShape!=null,currentDrawnShape:l.currentDrawnShape,getImageData:w,onCancelInpaint:I})})})]})]})})})},yt=Ye(()=>Qe(()=>import("./ktkip0mvmcezjx46.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(t=>t.ImageGenNewEditor));function Tt({postWithProfile:t,clientThreadId:s,onClose:n}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(Ct,{postWithProfile:t,clientThreadId:s,onClose:n}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(Mt,{postWithProfile:t,onClose:n}):null}function Ct({postWithProfile:t,clientThreadId:s,onClose:n}){const o=r.useRef(null),[d,c]=r.useState(!1),m=H(),{post:i}=t,a=i.attachments[i.attachments.length-1],h={url:a.url,content_type:W.ImageAssetPointer,asset_pointer:a.asset_pointer??V(a.id),size_bytes:0,width:a.width,height:a.height},v=F(),u=Ze(),g=$e(s),l=G(),b=r.useCallback(x=>u.getState().files.find(p=>p.tempId===x),[u]),S=a.url,y=r.useCallback(async x=>{if(o.current){const p=await o.current,C=p?b(p?.tempId):null;if(C)return C}return o.current=fetch(x).then(p=>p.blob()).then(p=>{const C=new File([p],"image.png",{type:"image/png"}),E=Xe(C);return K.uploadFile(u,E,C,Je.Multimodal,[C.type],v,l).then(()=>{const D=b(E);return D&&D.status===et.Ready&&D.fileId?D:null})}),o.current},[u,v,l,b]),{onRequestCompletion:k,currentModelId:I}=ge(),{isUnauthenticated:P}=tt(),w=r.useCallback(async x=>{if(!(!x.promptMessage||P))try{const p=await y(S);if(!p||!p.fileId||!p.fileSpec)return;const C=[{content_type:W.ImageAssetPointer,asset_pointer:V(p.fileId),size_bytes:p.fileSpec.size,width:a.width,height:a.height},...x.promptMessage.content.content_type===O.MultimodalText||x.promptMessage.content.content_type===O.Text?x.promptMessage.content.parts:[]],E={...x,promptMessage:{...x.promptMessage,content:{content_type:O.MultimodalText,parts:C}},extraStreamParams:{...x.extraStreamParams??{},continueFromSharedPostId:i.id}};k(E),K.reset(u)}catch(p){ee.addError(new Error("post_receiver_handle_request_failed",{cause:p})),l.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}},[a.height,a.width,y,k,u,S,P,l,i.id]),R=q(),_=st(R).checkGate("2780352974"),f={id:i.id,archived:!1,transformationId:null,url:h.url,assetPointer:h.asset_pointer,thumbnail:null,width:h.width,height:h.height,title:null,conversationId:g,messageId:i.id},j=r.useCallback(()=>{n(),m("/",{replace:!0})},[n,m]);if(_)return e.jsxs(e.Fragment,{children:[e.jsx(bt,{image:f,onClose:j,onRequestCompletion:w,clientThreadId:s,currentModelId:I,post:i,canDelete:!!i.permissions.can_delete,onOpenReport:()=>c(!0)}),d&&e.jsx(U,{post:i,onClose:()=>c(!1)})]});const se=e.jsx(te,{post:i,setIsReportModalOpen:c,onClose:n,additionalButtons:e.jsx(ve,{imageAsset:h,serverThreadId:g})});return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(fe,{children:e.jsx(yt,{image:h,isLoadingNewImage:!1,clientThreadId:s,onClose:()=>{n(),m("/",{replace:!0})},onRequestCompletion:w,editorControls:se,messageId:i.id})}),d&&e.jsx(U,{post:i,onClose:()=>c(!1)})]})}function Mt({postWithProfile:t,onClose:s}){const[n,o]=r.useState(!1),{post:d}=t;return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(te,{post:d,setIsReportModalOpen:o,onClose:s}),e.jsx(xe,{attachments:d.attachments,variant:"fullscreen"}),n&&e.jsx(U,{post:d,onClose:()=>o(!1)})]})}function te({post:t,setIsReportModalOpen:s,onClose:n,additionalButtons:o}){const d=H(),c=F(),m=G(),i=r.useCallback(async()=>{if(window.confirm(c.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await J.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),d("/",{replace:!0})}catch{m.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[t.id,c,m,d]);return e.jsx(e.Fragment,{children:e.jsxs(Q.div,{className:"flex h-16 w-full px-2 sm:px-4",...je,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(be,{onClose:()=>{n(),d("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(ye,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:s})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(Ce,{tooltip:c.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:i,children:e.jsx($,{})}),o]})]})})}function U({post:t,onClose:s}){const n=q(),{data:o}=pe(n,z.Post),d=F(),c=me(n,d,t.id,z.Post);if(o==null)return null;const m=`Report ${t.text??"Post"}`;return e.jsx(he,{reasons:o.reasons,submitReport:c,title:m,onClose:s,header:o.header,subHeader:o.header_explanation})}function St(){const t=r.useContext(X),s=t?.postWithProfile?.post,n=t?.setIsReportModalOpen;return!s||!n?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(N,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(at,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(Me,{className:"rounded-full",label:"",icon:e.jsx(nt,{className:"icon-sm"})}),children:e.jsx(ot.Item,{icon:Z,onClick:()=>n(!0),children:e.jsx(N,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function Nt(){const t=r.useContext(X),s=t?.postWithProfile?.post,n=t?.setIsReportModalOpen;return!s||!n?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(N,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:o=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{n(!0)},children:o})}})})}function Et(t){const{prefetchNavlink:s,clearPrefetchNavlink:n,clientThreadId:o,pageLoadSearchQuery:d}=t,c=q(),m=Se(c),i=we(o),a=ke(),h=Ie(),{isOpen:v}=Pe(),u=h.store.useContentAreaDimensions(_e.Header,l=>l?.height?l.height:void 0);let g=e.jsx(wt,{isNewScrollEnabled:m,...t});return Re()&&(g=e.jsx(Ee,{clientThreadId:o,children:g})),g=e.jsx(De,{clientThreadId:o,children:g}),e.jsxs("div",{onCopy:i,className:B("@thread-xl/thread:pt-header-height flex flex-col text-sm",a&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",u?null:!m&&(v?"max-sm:pb-25":"pb-25")),style:{paddingBottom:u},children:[d&&e.jsx("div",{children:e.jsx(Te,{query:d})}),s?e.jsx(it,{name:"prefetch-navlink",onError:l=>{ee.addError("Error with prefetch navlink",{error:l}),n()},children:e.jsx(r.Suspense,{fallback:null,children:e.jsx(Ne,{clientThreadId:o,prefetchNavlink:s,clearPrefetchNavlink:n})})}):null,e.jsx(lt,{children:g})]})}function wt({onRequestCompletion:t,clientThreadId:s,scrollContainerRef:n,isNewScrollEnabled:o}){const[d,c,m]=dt(s,f=>[ct.getConversationTurnIds(f),f?.conversationOrigin===ut.APPLE,f?.scrollToMessageId]),i=Fe(),a=Ae(),h=pt(),v=Oe(),[u]=Le(),g=Be(),[l]=Ue(),b=mt(s);He({isDynamicSharedThread:i,clientThreadId:s}),r.useEffect(()=>{i&&(T.logEvent("chatgpt_continue_conversation_page_loaded"),L.logEvent("Continue Conversation: Page Loaded"),T.logEvent("chatgpt_conversation_share_page_loaded"),L.logEvent("Share Public Chat: Shared Conversation Loaded"))},[i]);const S=r.useCallback(()=>{o||v({behavior:"smooth"})},[o,v]),y=ht(gt),[k,I]=r.useState(!1),P=(k||!1)&&!y,w=r.useRef(null),R=Ge(s),_=a&&!h;return e.jsxs(e.Fragment,{children:[_&&e.jsx(St,{}),i&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(N,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{ft.openModal(xt.ReportConversation),T.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),L.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(N,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),d.map((f,j)=>e.jsx(ze,{isFinalTurn:j===d.length-1,turnIndex:j,clientThreadId:s,onRequestCompletion:t,currentModelId:b.id,scrollToBottom:o?void 0:S,scrollToMessageId:o?void 0:m,dateHeaderType:R(j),hideUserActions:y},f)),!o&&e.jsxs(e.Fragment,{children:[n?.current&&e.jsx(vt,{setIsScrolledToEdge:f=>{I(f)},options:{root:n.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:w}),c&&u&&!l&&e.jsx(Y,{className:B("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{T.logEvent("chatgpt_thread_scroll_to_top"),g({behavior:"smooth"})},children:e.jsx(Ve,{className:"icon text-token-text-primary"})}),e.jsx(ae,{children:P&&e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Y,{className:B("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{T.logEvent("chatgpt_thread_scroll_to_bottom"),w.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(We,{className:"icon text-token-text-primary"})})})})]})]})}const Y=rt.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Tt as P,Nt as S,Et as T,U as a};
//# sourceMappingURL=l4lldnfjv1apahqp.js.map
