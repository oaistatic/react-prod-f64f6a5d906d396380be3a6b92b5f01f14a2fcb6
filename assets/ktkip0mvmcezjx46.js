const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fuhwxekevlnnnazm.js","assets/gg0tb34p9fzo1omt.js","assets/g670b8vtkhx0yc6d.js","assets/root-ilxovqci.css","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/fy8kd3fagrnuzc6i.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{bU as S,dw as F,e0 as V,ho as q,n6 as B,a7 as K,bV as U,n7 as Y,b2 as Z,i as $,bW as J}from"./g670b8vtkhx0yc6d.js";import{j as t,m as M,r as n}from"./gg0tb34p9fzo1omt.js";import{f2 as Q,by as X,bB as ee,gB as te,y as ne,dc as se,gC as ae,bA as R,gD as oe,gE as ie,gw as D,dj as re,G as ce,E as le,z as de}from"./forbprkns1cohsbl.js";import{P as ue}from"./jpdmr6hprcjyd5ie.js";import"./me58wahxzwibdrxp.js";import"./pnx8yl9r7yj5moem.js";import"./felxwdrg3fgsr1mu.js";import"./f51c6zie1stj9anw.js";import"./cs320738df36xnc1.js";const me=0,he=48;function fe({imageAsset:e,children:a,containerDimensions:s,isLoadingNewImage:i}){return t.jsxs(M.div,{className:"absolute",style:pe(e,s),...Q,children:[a,t.jsx("div",{className:S("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",i?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function pe(e,a){const{width:s,height:i}=e,{width:d,height:u}=a,m=d-2*me,h=u-2*he,l=s/i,r=m/h,c=l>r,g=c?m:h*l,x=c?m/l:h;return{top:"50%",left:"50%",width:g,height:x,transform:"translate(-50%, -50%)"}}const ge=({onEscape:e})=>{n.useEffect(()=>{function a(s){s.key==="Escape"&&e()}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e])},xe=U(()=>J(()=>import("./fuhwxekevlnnnazm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),N=126,we=63,Ie=136,Ce=50;function ve({delay:e=Ce,height:a,width:s}){const[i,d]=n.useState(!1);return n.useEffect(()=>{const u=setTimeout(()=>{d(!0)},e);return()=>{clearTimeout(u)}},[e]),i?t.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:s,height:a,aspectRatio:`${s} / ${a}`},children:t.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function Me({image:e,isLoadingNewImage:a,clientThreadId:s,onClose:i,messageId:d,onRequestCompletion:u,editorControls:m,footer:h}){const l=F(s),[r,c]=n.useState("default"),[g,x]=n.useState({width:window.innerWidth,height:window.innerHeight-N}),P=V(),[_,L]=n.useState(!1),I=X(),{currentDrawnShape:w,onNewDrawnShape:T,clearAllDrawings:G}=I,C=n.useRef(null),k=n.useMemo(()=>new q(B()),[]),v=n.useRef(void 0),f=n.useMemo(()=>ee({pointer:e,conversationId:l,messageId:d,source:"editor"}),[e,d,l]),W=te(o=>{const{width:p,height:b}=o.contentRect;x({width:p,height:P?b-N:b-we})});ge(n.useMemo(()=>({onEscape:()=>{r==="inpaint"?c("default"):i()}}),[r,i])),ne(n.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>c("default"),getImageData:()=>C.current?.getImageData()}),[e,w])),n.useEffect(()=>{r!=="inpaint"&&G()},[r]),n.useEffect(()=>{c("default")},[e]);const E=se(s),A=n.useCallback(o=>{c("default"),E(o),i()},[E,i]),y=n.useMemo(()=>u||A,[u,A]),[O]=K(s,o=>[o?.modelId]),j=ae({imageAssetPointer:e,serverThreadId:l}),H=n.useCallback(()=>{c("inpaint"),R.inpaintClick({analyticsContext:f})},[f]),z=n.useCallback(o=>{const p=o.deltaY<0?"in":"out";o.ctrlKey&&v.current!==p&&(R.zoom({zoomType:p,analyticsContext:f}),v.current=p)},[f]);return t.jsx(oe.Provider,{value:f,children:t.jsxs("div",{ref:W,className:"flex h-full w-full flex-col items-center justify-between",onWheel:z,children:[m??t.jsx(ie,{clientThreadId:s,imageAsset:e,mode:r,setMode:c,inpaintingDrawingState:I,isLoadingNewImage:a,onClose:i,onInpaintClick:H,messageId:d,serverThreadId:l}),t.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:t.jsxs(fe,{imageAsset:e,containerDimensions:g,isLoadingNewImage:a,children:[j&&r!=="inpaint"&&t.jsx("img",{alt:D(e),className:"absolute inset-0 z-1 opacity-0",src:j}),!_&&t.jsx(ve,{width:e.width,height:e.height}),t.jsx(re,{className:"h-full w-full",alt:D(e),onLoad:()=>{L(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),t.jsx("div",{className:S("absolute inset-0",r==="inpaint"?"":"hidden"),children:t.jsx(xe,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:Ie,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:T})})]})}),t.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:t.jsx(M.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??t.jsx(ce,{value:{isImageGenEditor:!0,isInpainting:r==="inpaint",onCancelInpaint:()=>c("default")},children:t.jsx(Y.Provider,{value:k,children:t.jsx(ue,{clientThreadId:s,isNewThread:$(s),currentModelId:O??Z(void 0).id,onContinueGenerating:o=>y(de(o)),onRequestCompletion:async o=>y(await le(o)),hideHeader:!0})})})})})]})})}export{Me as ImageGenNewEditor,ve as ShimmerLoader};
//# sourceMappingURL=ktkip0mvmcezjx46.js.map
