const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ej1bms9fbyedlq1e.js","assets/h4xohl2w3x2tfapf.js","assets/hb16nhh4rqym397l.js","assets/be6sa05e05n18ich.js","assets/g670b8vtkhx0yc6d.js","assets/gg0tb34p9fzo1omt.js","assets/root-ilxovqci.css","assets/mpci7q2qqicm6del.js","assets/n2o54kk90wpa6tc9.js","assets/gffsn29yylc5pncm.js","assets/forbprkns1cohsbl.js","assets/conversation-small-mtta3ozz.css","assets/ihgbljwwpo1mzi43.js","assets/j0nw4kv698ot3br0.js","assets/f76gy0b8ieo4s693.js","assets/jh4r0k3f3n3zptua.js","assets/jy1u8exw8iz2slve.js","assets/g622vs9j8fcjhdch.js","assets/csqmgqamfqbmz64h.js","assets/55k7cyst53ds55j5.js","assets/g0y4jei68vbnum8l.js","assets/j3podsohfsuuzn30.js","assets/nl9ot2ro6g3k9q08.js","assets/gv31kw2784zvh4dc.js","assets/dokst4zjxf0wvjk3.js","assets/fykmhm6ikn0ejop6.js","assets/kpakmdcyunnluxu5.js","assets/cgblc6idnw8spywd.js"])))=>i.map(i=>d[i]);
import{E as L,b as he,P as Re,F as de,V as En,j as D,a as p,S as M,k as At,m as N,h as Pn,s as _n,e as kt,l as Pe,n as vt,o as Et,A as Me,M as _e,p as Tn,T as se,q as Ne,C as Te,D as me,W as Ln,i as Pt,f as Ve,r as Q,t as In,u as Dn}from"./be6sa05e05n18ich.js";import{e as U,o as _t,q as Tt,r as Lt,u as le,b as Le,v as z,w as Ie,c as On,S as Bn,H as It,t as m}from"./hb16nhh4rqym397l.js";import{bW as y,f9 as Dt,oM as wn,nx as Rn,oN as Mn,oO as Ke,oP as Ot,jA as Nn}from"./g670b8vtkhx0yc6d.js";import{e as g}from"./gffsn29yylc5pncm.js";import{R as Vn,T as ce}from"./j0nw4kv698ot3br0.js";import{i as Je,a as Fn,C as Ae,u as jn,j as Un,c as Hn}from"./jh4r0k3f3n3zptua.js";import{m as zn}from"./forbprkns1cohsbl.js";import{H as $n}from"./jy1u8exw8iz2slve.js";const Wn="_modelCursor_1knkf_1",ps={modelCursor:Wn};class Bt{constructor(t,n,o,r){this.state=t,this.pos=n,this.explicit=o,this.view=r,this.abortListeners=[]}tokenBefore(t){let n=U(this.state).resolveInner(this.pos,-1);for(;n&&t.indexOf(n.name)<0;)n=n.parent;return n?{from:n.from,to:this.pos,text:this.state.sliceDoc(n.from,this.pos),type:n.type}:null}matchBefore(t){let n=this.state.doc.lineAt(this.pos),o=Math.max(n.from,this.pos-250),r=n.text.slice(o-n.from,this.pos-n.from),s=r.search(wt(t,!1));return s<0?null:{from:o+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(t,n){t=="abort"&&this.abortListeners&&this.abortListeners.push(n)}}function Qe(e){let t=Object.keys(e).join(""),n=/\w/.test(t);return n&&(t=t.replace(/\w/g,"")),`[${n?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function qn(e){let t=Object.create(null),n=Object.create(null);for(let{label:r}of e){t[r[0]]=!0;for(let s=1;s<r.length;s++)n[r[s]]=!0}let o=Qe(t)+Qe(n)+"*$";return[new RegExp("^"+o),new RegExp(o)]}function Gn(e){let t=e.map(r=>typeof r=="string"?{label:r}:r),[n,o]=t.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:qn(t);return r=>{let s=r.matchBefore(o);return s||r.explicit?{from:s?s.from:r.pos,options:t,validFor:n}:null}}function gs(e,t){return n=>{for(let o=U(n.state).resolveInner(n.pos,-1);o;o=o.parent){if(e.indexOf(o.name)>-1)return null;if(o.type.isTop)break}return t(n)}}class Ye{constructor(t,n,o,r){this.completion=t,this.source=n,this.match=o,this.score=r}}function V(e){return e.selection.main.from}function wt(e,t){var n;let{source:o}=e,r=t&&o[0]!="^",s=o[o.length-1]!="$";return!r&&!s?e:new RegExp(`${r?"^":""}(?:${o})${s?"$":""}`,(n=e.flags)!==null&&n!==void 0?n:e.ignoreCase?"i":"")}const Fe=Me.define();function Kn(e,t,n,o){let{main:r}=e.selection,s=n-r.from,i=o-r.from;return Object.assign(Object.assign({},e.changeByRange(l=>l!=r&&n!=o&&e.sliceDoc(l.from+s,l.from+i)!=e.sliceDoc(n,o)?{range:l}:{changes:{from:l.from+s,to:o==r.from?l.to:l.from+i,insert:t},range:p.cursor(l.from+s+t.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const Xe=new WeakMap;function Jn(e){if(!Array.isArray(e))return e;let t=Xe.get(e);return t||Xe.set(e,t=Gn(e)),t}const ae=M.define(),Y=M.define();class Qn{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let n=0;n<t.length;){let o=D(t,n),r=N(o);this.chars.push(o);let s=t.slice(n,n+r),i=s.toUpperCase();this.folded.push(D(i==s?s.toLowerCase():i,0)),n+=r}this.astral=t.length!=this.chars.length}ret(t,n){return this.score=t,this.matched=n,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:n,folded:o,any:r,precise:s,byWord:i}=this;if(n.length==1){let S=D(t,0),H=N(S),R=H==t.length?0:-100;if(S!=n[0])if(S==o[0])R+=-200;else return null;return this.ret(R,[0,H])}let l=t.indexOf(this.pattern);if(l==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let c=n.length,a=0;if(l<0){for(let S=0,H=Math.min(t.length,200);S<H&&a<c;){let R=D(t,S);(R==n[a]||R==o[a])&&(r[a++]=S),S+=N(R)}if(a<c)return null}let f=0,u=0,h=!1,d=0,C=-1,b=-1,xe=/[a-z]/.test(t),K=!0;for(let S=0,H=Math.min(t.length,200),R=0;S<H&&u<c;){let v=D(t,S);l<0&&(f<c&&v==n[f]&&(s[f++]=S),d<c&&(v==n[d]||v==o[d]?(d==0&&(C=S),b=S+1,d++):d=0));let ne,be=v<255?v>=48&&v<=57||v>=97&&v<=122?2:v>=65&&v<=90?1:0:(ne=Et(v))!=ne.toLowerCase()?1:ne!=ne.toUpperCase()?2:0;(!S||be==1&&xe||R==0&&be!=0)&&(n[u]==v||o[u]==v&&(h=!0)?i[u++]=S:i.length&&(K=!1)),R=be,S+=N(v)}return u==c&&i[0]==0&&K?this.result(-100+(h?-200:0),i,t):d==c&&C==0?this.ret(-200-t.length+(b==t.length?0:-100),[0,b]):l>-1?this.ret(-700-t.length,[l,l+this.pattern.length]):d==c?this.ret(-900-t.length,[C,b]):u==c?this.result(-100+(h?-200:0)+-700+(K?0:-1100),i,t):n.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,t)}result(t,n,o){let r=[],s=0;for(let i of n){let l=i+(this.astral?N(D(o,i)):1);s&&r[s-1]==i?r[s-1]=l:(r[s++]=i,r[s++]=l)}return this.ret(t-o.length,r)}}class Yn{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let n=t.slice(0,this.pattern.length),o=n==this.pattern?0:n.toLowerCase()==this.folded?-200:null;return o==null?null:(this.matched=[0,n.length],this.score=o+(t.length==this.pattern.length?0:-100),this)}}const A=de.define({combine(e){return kt(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:Xn,filterStrict:!1,compareCompletions:(t,n)=>t.label.localeCompare(n.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,n)=>t&&n,closeOnBlur:(t,n)=>t&&n,icons:(t,n)=>t&&n,tooltipClass:(t,n)=>o=>Ze(t(o),n(o)),optionClass:(t,n)=>o=>Ze(t(o),n(o)),addToOptions:(t,n)=>t.concat(n),filterStrict:(t,n)=>t||n})}});function Ze(e,t){return e?t?e+" "+t:e:t}function Xn(e,t,n,o,r,s){let i=e.textDirection==Pt.RTL,l=i,c=!1,a="top",f,u,h=t.left-r.left,d=r.right-t.right,C=o.right-o.left,b=o.bottom-o.top;if(l&&h<Math.min(C,d)?l=!1:!l&&d<Math.min(C,h)&&(l=!0),C<=(l?h:d))f=Math.max(r.top,Math.min(n.top,r.bottom-b))-t.top,u=Math.min(400,l?h:d);else{c=!0,u=Math.min(400,(i?t.right:r.right-t.left)-30);let S=r.bottom-t.bottom;S>=b||S>t.top?f=n.bottom-t.top:(a="bottom",f=t.bottom-n.top)}let xe=(t.bottom-t.top)/s.offsetHeight,K=(t.right-t.left)/s.offsetWidth;return{style:`${a}: ${f/xe}px; max-width: ${u/K}px`,class:"cm-completionInfo-"+(c?i?"left-narrow":"right-narrow":l?"left":"right")}}function Zn(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(n){let o=document.createElement("div");return o.classList.add("cm-completionIcon"),n.type&&o.classList.add(...n.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),o.setAttribute("aria-hidden","true"),o},position:20}),t.push({render(n,o,r,s){let i=document.createElement("span");i.className="cm-completionLabel";let l=n.displayLabel||n.label,c=0;for(let a=0;a<s.length;){let f=s[a++],u=s[a++];f>c&&i.appendChild(document.createTextNode(l.slice(c,f)));let h=i.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(l.slice(f,u))),h.className="cm-completionMatchedText",c=u}return c<l.length&&i.appendChild(document.createTextNode(l.slice(c))),i},position:50},{render(n){if(!n.detail)return null;let o=document.createElement("span");return o.className="cm-completionDetail",o.textContent=n.detail,o},position:80}),t.sort((n,o)=>n.position-o.position).map(n=>n.render)}function ke(e,t,n){if(e<=n)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let r=Math.floor(t/n);return{from:r*n,to:(r+1)*n}}let o=Math.floor((e-t)/n);return{from:e-(o+1)*n,to:e-o*n}}class eo{constructor(t,n,o){this.view=t,this.stateField=n,this.applyCompletion=o,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:c=>this.placeInfo(c),key:this},this.space=null,this.currentClass="";let r=t.state.field(n),{options:s,selected:i}=r.open,l=t.state.facet(A);this.optionContent=Zn(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=ke(s.length,i,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",c=>{let{options:a}=t.state.field(n).open;for(let f=c.target,u;f&&f!=this.dom;f=f.parentNode)if(f.nodeName=="LI"&&(u=/-(\d+)$/.exec(f.id))&&+u[1]<a.length){this.applyCompletion(t,a[+u[1]]),c.preventDefault();return}}),this.dom.addEventListener("focusout",c=>{let a=t.state.field(this.stateField,!1);a&&a.tooltip&&t.state.facet(A).closeOnBlur&&c.relatedTarget!=t.contentDOM&&t.dispatch({effects:Y.of(null)})}),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(t,n){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,n,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var n;let o=t.state.field(this.stateField),r=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),o!=r){let{options:s,selected:i,disabled:l}=o.open;(!r.open||r.open.options!=s)&&(this.range=ke(s.length,i,t.state.facet(A).maxRenderedOptions),this.showOptions(s,o.id)),this.updateSel(),l!=((n=r.open)===null||n===void 0?void 0:n.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(t){let n=this.tooltipClass(t);if(n!=this.currentClass){for(let o of this.currentClass.split(" "))o&&this.dom.classList.remove(o);for(let o of n.split(" "))o&&this.dom.classList.add(o);this.currentClass=n}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),n=t.open;if((n.selected>-1&&n.selected<this.range.from||n.selected>=this.range.to)&&(this.range=ke(n.options.length,n.selected,this.view.state.facet(A).maxRenderedOptions),this.showOptions(n.options,t.id)),this.updateSelectedOption(n.selected)){this.destroyInfo();let{completion:o}=n.options[n.selected],{info:r}=o;if(!r)return;let s=typeof r=="string"?document.createTextNode(r):r(o);if(!s)return;"then"in s?s.then(i=>{i&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(i,o)}).catch(i=>Pe(this.view.state,i,"completion info")):this.addInfoPane(s,o)}}addInfoPane(t,n){this.destroyInfo();let o=this.info=document.createElement("div");if(o.className="cm-tooltip cm-completionInfo",t.nodeType!=null)o.appendChild(t),this.infoDestroy=null;else{let{dom:r,destroy:s}=t;o.appendChild(r),this.infoDestroy=s||null}this.dom.appendChild(o),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let n=null;for(let o=this.list.firstChild,r=this.range.from;o;o=o.nextSibling,r++)o.nodeName!="LI"||!o.id?r--:r==t?o.hasAttribute("aria-selected")||(o.setAttribute("aria-selected","true"),n=o):o.hasAttribute("aria-selected")&&o.removeAttribute("aria-selected");return n&&no(this.list,n),n}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let n=this.dom.getBoundingClientRect(),o=this.info.getBoundingClientRect(),r=t.getBoundingClientRect(),s=this.space;if(!s){let i=this.dom.ownerDocument.defaultView||window;s={left:0,top:0,right:i.innerWidth,bottom:i.innerHeight}}return r.top>Math.min(s.bottom,n.bottom)-10||r.bottom<Math.max(s.top,n.top)+10?null:this.view.state.facet(A).positionInfo(this.view,n,r,o,s,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,n,o){const r=document.createElement("ul");r.id=n,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions"));let s=null;for(let i=o.from;i<o.to;i++){let{completion:l,match:c}=t[i],{section:a}=l;if(a){let h=typeof a=="string"?a:a.name;if(h!=s&&(i>o.from||o.from==0))if(s=h,typeof a!="string"&&a.header)r.appendChild(a.header(a));else{let d=r.appendChild(document.createElement("completion-section"));d.textContent=h}}const f=r.appendChild(document.createElement("li"));f.id=n+"-"+i,f.setAttribute("role","option");let u=this.optionClass(l);u&&(f.className=u);for(let h of this.optionContent){let d=h(l,this.view.state,this.view,c);d&&f.appendChild(d)}}return o.from&&r.classList.add("cm-completionListIncompleteTop"),o.to<t.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function to(e,t){return n=>new eo(n,e,t)}function no(e,t){let n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=n.height/e.offsetHeight;o.top<n.top?e.scrollTop-=(n.top-o.top)/r:o.bottom>n.bottom&&(e.scrollTop+=(o.bottom-n.bottom)/r)}function et(e){return(e.boost||0)*100+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function oo(e,t){let n=[],o=null,r=a=>{n.push(a);let{section:f}=a.completion;if(f){o||(o=[]);let u=typeof f=="string"?f:f.name;o.some(h=>h.name==u)||o.push(typeof f=="string"?{name:u}:f)}},s=t.facet(A);for(let a of e)if(a.hasResult()){let f=a.result.getMatch;if(a.result.filter===!1)for(let u of a.result.options)r(new Ye(u,a.source,f?f(u):[],1e9-n.length));else{let u=t.sliceDoc(a.from,a.to),h,d=s.filterStrict?new Yn(u):new Qn(u);for(let C of a.result.options)if(h=d.match(C.label)){let b=C.displayLabel?f?f(C,h.matched):[]:h.matched;r(new Ye(C,a.source,b,h.score+(C.boost||0)))}}}if(o){let a=Object.create(null),f=0,u=(h,d)=>{var C,b;return((C=h.rank)!==null&&C!==void 0?C:1e9)-((b=d.rank)!==null&&b!==void 0?b:1e9)||(h.name<d.name?-1:1)};for(let h of o.sort(u))f-=1e5,a[h.name]=f;for(let h of n){let{section:d}=h.completion;d&&(h.score+=a[typeof d=="string"?d:d.name])}}let i=[],l=null,c=s.compareCompletions;for(let a of n.sort((f,u)=>u.score-f.score||c(f.completion,u.completion))){let f=a.completion;!l||l.label!=f.label||l.detail!=f.detail||l.type!=null&&f.type!=null&&l.type!=f.type||l.apply!=f.apply||l.boost!=f.boost?i.push(a):et(a.completion)>et(l)&&(i[i.length-1]=a),l=a.completion}return i}class ${constructor(t,n,o,r,s,i){this.options=t,this.attrs=n,this.tooltip=o,this.timestamp=r,this.selected=s,this.disabled=i}setSelected(t,n){return t==this.selected||t>=this.options.length?this:new $(this.options,tt(n,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,n,o,r,s){let i=oo(t,n);if(!i.length)return r&&t.some(c=>c.state==1)?new $(r.options,r.attrs,r.tooltip,r.timestamp,r.selected,!0):null;let l=n.facet(A).selectOnOpen?0:-1;if(r&&r.selected!=l&&r.selected!=-1){let c=r.options[r.selected].completion;for(let a=0;a<i.length;a++)if(i[a].completion==c){l=a;break}}return new $(i,tt(o,l),{pos:t.reduce((c,a)=>a.hasResult()?Math.min(c,a.from):c,1e8),create:ao,above:s.aboveCursor},r?r.timestamp:Date.now(),l,!1)}map(t){return new $(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class fe{constructor(t,n,o){this.active=t,this.id=n,this.open=o}static start(){return new fe(lo,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:n}=t,o=n.facet(A),s=(o.override||n.languageDataAt("autocomplete",V(n)).map(Jn)).map(l=>(this.active.find(a=>a.source==l)||new _(l,this.active.some(a=>a.state!=0)?1:0)).update(t,o));s.length==this.active.length&&s.every((l,c)=>l==this.active[c])&&(s=this.active);let i=this.open;i&&t.docChanged&&(i=i.map(t.changes)),t.selection||s.some(l=>l.hasResult()&&t.changes.touchesRange(l.from,l.to))||!ro(s,this.active)?i=$.build(s,n,this.id,i,o):i&&i.disabled&&!s.some(l=>l.state==1)&&(i=null),!i&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new _(l.source,0):l));for(let l of t.effects)l.is(Nt)&&(i=i&&i.setSelected(l.value,this.id));return s==this.active&&i==this.open?this:new fe(s,this.id,i)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?so:io}}function ro(e,t){if(e==t)return!0;for(let n=0,o=0;;){for(;n<e.length&&!e[n].hasResult;)n++;for(;o<t.length&&!t[o].hasResult;)o++;let r=n==e.length,s=o==t.length;if(r||s)return r==s;if(e[n++].result!=t[o++].result)return!1}}const so={"aria-autocomplete":"list"},io={};function tt(e,t){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(n["aria-activedescendant"]=e+"-"+t),n}const lo=[];function Rt(e,t){if(e.isUserEvent("input.complete")){let o=e.annotation(Fe);if(o&&t.activateOnCompletion(o))return 12}let n=e.isUserEvent("input.type");return n&&t.activateOnTyping?5:n?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class _{constructor(t,n,o=-1){this.source=t,this.state=n,this.explicitPos=o}hasResult(){return!1}update(t,n){let o=Rt(t,n),r=this;(o&8||o&16&&this.touches(t))&&(r=new _(r.source,0)),o&4&&r.state==0&&(r=new _(this.source,1)),r=r.updateFor(t,o);for(let s of t.effects)if(s.is(ae))r=new _(r.source,1,s.value?V(t.state):-1);else if(s.is(Y))r=new _(r.source,0);else if(s.is(Mt))for(let i of s.value)i.source==r.source&&(r=i);return r}updateFor(t,n){return this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new _(this.source,this.state,t.mapPos(this.explicitPos))}touches(t){return t.changes.touchesRange(V(t.state))}}class W extends _{constructor(t,n,o,r,s){super(t,2,n),this.result=o,this.from=r,this.to=s}hasResult(){return!0}updateFor(t,n){var o;if(!(n&3))return this.map(t.changes);let r=this.result;r.map&&!t.changes.empty&&(r=r.map(r,t.changes));let s=t.changes.mapPos(this.from),i=t.changes.mapPos(this.to,1),l=V(t.state);if((this.explicitPos<0?l<=s:l<this.from)||l>i||!r||n&2&&V(t.startState)==this.from)return new _(this.source,n&4?1:0);let c=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return co(r.validFor,t.state,s,i)?new W(this.source,c,r,s,i):r.update&&(r=r.update(r,s,i,new Bt(t.state,l,c>=0)))?new W(this.source,c,r,r.from,(o=r.to)!==null&&o!==void 0?o:V(t.state)):new _(this.source,1,c)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new W(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new _(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function co(e,t,n,o){if(!e)return!1;let r=t.sliceDoc(n,o);return typeof e=="function"?e(r,n,o,t):wt(e,!0).test(r)}const Mt=M.define({map(e,t){return e.map(n=>n.map(t))}}),Nt=M.define(),E=he.define({create(){return fe.start()},update(e,t){return e.update(t)},provide:e=>[_n.from(e,t=>t.tooltip),L.contentAttributes.from(e,t=>t.attrs)]});function je(e,t){const n=t.completion.apply||t.completion.label;let o=e.state.field(E).active.find(r=>r.source==t.source);return o instanceof W?(typeof n=="string"?e.dispatch(Object.assign(Object.assign({},Kn(e.state,n,o.from,o.to)),{annotations:Fe.of(t.completion)})):n(e,t.completion,o.from,o.to),!0):!1}const ao=to(E,je);function oe(e,t="option"){return n=>{let o=n.state.field(E,!1);if(!o||!o.open||o.open.disabled||Date.now()-o.open.timestamp<n.state.facet(A).interactionDelay)return!1;let r=1,s;t=="page"&&(s=At(n,o.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:i}=o.open.options,l=o.open.selected>-1?o.open.selected+r*(e?1:-1):e?0:i-1;return l<0?l=t=="page"?0:i-1:l>=i&&(l=t=="page"?i-1:0),n.dispatch({effects:Nt.of(l)}),!0}}const fo=e=>{let t=e.state.field(E,!1);return e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(A).interactionDelay?!1:je(e,t.open.options[t.open.selected])},uo=e=>e.state.field(E,!1)?(e.dispatch({effects:ae.of(!0)}),!0):!1,ho=e=>{let t=e.state.field(E,!1);return!t||!t.active.some(n=>n.state!=0)?!1:(e.dispatch({effects:Y.of(null)}),!0)};class mo{constructor(t,n){this.active=t,this.context=n,this.time=Date.now(),this.updates=[],this.done=void 0}}const po=50,go=1e3,yo=En.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(E).active)t.state==1&&this.startQuery(t)}update(e){let t=e.state.field(E),n=e.state.facet(A);if(!e.selectionSet&&!e.docChanged&&e.startState.field(E)==t)return;let o=e.transactions.some(s=>{let i=Rt(s,n);return i&8||(s.selection||s.docChanged)&&!(i&3)});for(let s=0;s<this.running.length;s++){let i=this.running[s];if(o||i.updates.length+e.transactions.length>po&&Date.now()-i.time>go){for(let l of i.context.abortListeners)try{l()}catch(c){Pe(this.view.state,c)}i.context.abortListeners=null,this.running.splice(s--,1)}else i.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some(s=>s.effects.some(i=>i.is(ae)))&&(this.pendingStart=!0);let r=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(s=>s.state==1&&!this.running.some(i=>i.active.source==s.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let s of e.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(E);for(let n of t.active)n.state==1&&!this.running.some(o=>o.active.source==n.source)&&this.startQuery(n)}startQuery(e){let{state:t}=this.view,n=V(t),o=new Bt(t,n,e.explicitPos==n,this.view),r=new mo(e,o);this.running.push(r),Promise.resolve(e.source(o)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:Y.of(null)}),Pe(this.view.state,s)})}scheduleAccept(){this.running.every(e=>e.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(A).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],n=this.view.state.facet(A);for(let o=0;o<this.running.length;o++){let r=this.running[o];if(r.done===void 0)continue;if(this.running.splice(o--,1),r.done){let i=new W(r.active.source,r.active.explicitPos,r.done,r.done.from,(e=r.done.to)!==null&&e!==void 0?e:V(r.updates.length?r.updates[0].startState:this.view.state));for(let l of r.updates)i=i.update(l,n);if(i.hasResult()){t.push(i);continue}}let s=this.view.state.field(E).active.find(i=>i.source==r.active.source);if(s&&s.state==1)if(r.done==null){let i=new _(r.active.source,0);for(let l of r.updates)i=i.update(l,n);i.state!=1&&t.push(i)}else this.startQuery(s)}t.length&&this.view.dispatch({effects:Mt.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(E,!1);if(t&&t.tooltip&&this.view.state.facet(A).closeOnBlur){let n=t.open&&At(this.view,t.open.tooltip);(!n||!n.dom.contains(e.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:Y.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:ae.of(!1)}),20),this.composing=0}}}),Co=typeof navigator=="object"&&/Win/.test(navigator.platform),So=Re.highest(L.domEventHandlers({keydown(e,t){let n=t.state.field(E,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||e.key.length>1||e.ctrlKey&&!(Co&&e.altKey)||e.metaKey)return!1;let o=n.open.options[n.open.selected],r=n.active.find(i=>i.source==o.source),s=o.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(e.key)>-1&&je(t,o),!1}})),Vt=L.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class xo{constructor(t,n,o,r){this.field=t,this.line=n,this.from=o,this.to=r}}class Ue{constructor(t,n,o){this.field=t,this.from=n,this.to=o}map(t){let n=t.mapPos(this.from,-1,_e.TrackDel),o=t.mapPos(this.to,1,_e.TrackDel);return n==null||o==null?null:new Ue(this.field,n,o)}}class He{constructor(t,n){this.lines=t,this.fieldPositions=n}instantiate(t,n){let o=[],r=[n],s=t.doc.lineAt(n),i=/^\s*/.exec(s.text)[0];for(let c of this.lines){if(o.length){let a=i,f=/^\t*/.exec(c)[0].length;for(let u=0;u<f;u++)a+=t.facet(_t);r.push(n+a.length-f),c=a+c.slice(f)}o.push(c),n+=c.length+1}let l=this.fieldPositions.map(c=>new Ue(c.field,r[c.line]+c.from,r[c.line]+c.to));return{text:o,ranges:l}}static parse(t){let n=[],o=[],r=[],s;for(let i of t.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(i);){let l=s[1]?+s[1]:null,c=s[2]||s[3]||"",a=-1,f=c.replace(/\\[{}]/g,u=>u[1]);for(let u=0;u<n.length;u++)(l!=null?n[u].seq==l:f&&n[u].name==f)&&(a=u);if(a<0){let u=0;for(;u<n.length&&(l==null||n[u].seq!=null&&n[u].seq<l);)u++;n.splice(u,0,{seq:l,name:f}),a=u;for(let h of r)h.field>=a&&h.field++}r.push(new xo(a,o.length,s.index,s.index+f.length)),i=i.slice(0,s.index)+c+i.slice(s.index+s[0].length)}i=i.replace(/\\([{}])/g,(l,c,a)=>{for(let f of r)f.line==o.length&&f.from>a&&(f.from--,f.to--);return c}),o.push(i)}return new He(o,r)}}let bo=me.widget({widget:new class extends Ln{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),Ao=me.mark({class:"cm-snippetField"});class q{constructor(t,n){this.ranges=t,this.active=n,this.deco=me.set(t.map(o=>(o.from==o.to?bo:Ao).range(o.from,o.to)))}map(t){let n=[];for(let o of this.ranges){let r=o.map(t);if(!r)return null;n.push(r)}return new q(n,this.active)}selectionInsideField(t){return t.ranges.every(n=>this.ranges.some(o=>o.field==this.active&&o.from<=n.from&&o.to>=n.to))}}const ee=M.define({map(e,t){return e&&e.map(t)}}),ko=M.define(),X=he.define({create(){return null},update(e,t){for(let n of t.effects){if(n.is(ee))return n.value;if(n.is(ko)&&e)return new q(e.ranges,n.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>L.decorations.from(e,t=>t?t.deco:me.none)});function ze(e,t){return p.create(e.filter(n=>n.field==t).map(n=>p.range(n.from,n.to)))}function vo(e){let t=He.parse(e);return(n,o,r,s)=>{let{text:i,ranges:l}=t.instantiate(n.state,r),c={changes:{from:r,to:s,insert:Ne.of(i)},scrollIntoView:!0,annotations:o?[Fe.of(o),se.userEvent.of("input.complete")]:void 0};if(l.length&&(c.selection=ze(l,0)),l.some(a=>a.field>0)){let a=new q(l,0),f=c.effects=[ee.of(a)];n.state.field(X,!1)===void 0&&f.push(M.appendConfig.of([X,Lo,Io,Vt]))}n.dispatch(n.state.update(c))}}function Ft(e){return({state:t,dispatch:n})=>{let o=t.field(X,!1);if(!o||e<0&&o.active==0)return!1;let r=o.active+e,s=e>0&&!o.ranges.some(i=>i.field==r+e);return n(t.update({selection:ze(o.ranges,r),effects:ee.of(s?null:new q(o.ranges,r)),scrollIntoView:!0})),!0}}const Eo=({state:e,dispatch:t})=>e.field(X,!1)?(t(e.update({effects:ee.of(null)})),!0):!1,Po=Ft(1),_o=Ft(-1),To=[{key:"Tab",run:Po,shift:_o},{key:"Escape",run:Eo}],nt=de.define({combine(e){return e.length?e[0]:To}}),Lo=Re.highest(vt.compute([nt],e=>e.facet(nt)));function ys(e,t){return Object.assign(Object.assign({},t),{apply:vo(e)})}const Io=L.domEventHandlers({mousedown(e,t){let n=t.state.field(X,!1),o;if(!n||(o=t.posAtCoords({x:e.clientX,y:e.clientY}))==null)return!1;let r=n.ranges.find(s=>s.from<=o&&s.to>=o);return!r||r.field==n.active?!1:(t.dispatch({selection:ze(n.ranges,r.field),effects:ee.of(n.ranges.some(s=>s.field>r.field)?new q(n.ranges,r.field):null),scrollIntoView:!0}),!0)}}),Z={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},j=M.define({map(e,t){let n=t.mapPos(e,-1,_e.TrackAfter);return n??void 0}}),$e=new class extends Tn{};$e.startSide=1;$e.endSide=-1;const jt=he.define({create(){return Pn.empty},update(e,t){if(e=e.map(t.changes),t.selection){let n=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:o=>o>=n.from&&o<=n.to})}for(let n of t.effects)n.is(j)&&(e=e.update({add:[$e.range(n.value,n.value+1)]}));return e}});function Cs(){return[Oo,jt]}const ve="()[]{}<>";function Ut(e){for(let t=0;t<ve.length;t+=2)if(ve.charCodeAt(t)==e)return ve.charAt(t+1);return Et(e<128?e:e+1)}function Ht(e,t){return e.languageDataAt("closeBrackets",t)[0]||Z}const Do=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Oo=L.inputHandler.of((e,t,n,o)=>{if((Do?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let r=e.state.selection.main;if(o.length>2||o.length==2&&N(D(o,0))==1||t!=r.from||n!=r.to)return!1;let s=wo(e.state,o);return s?(e.dispatch(s),!0):!1}),Bo=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let o=Ht(e,e.selection.main.head).brackets||Z.brackets,r=null,s=e.changeByRange(i=>{if(i.empty){let l=Ro(e.doc,i.head);for(let c of o)if(c==l&&pe(e.doc,i.head)==Ut(D(c,0)))return{changes:{from:i.head-c.length,to:i.head+c.length},range:p.cursor(i.head-c.length)}}return{range:r=i}});return r||t(e.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},Ss=[{key:"Backspace",run:Bo}];function wo(e,t){let n=Ht(e,e.selection.main.head),o=n.brackets||Z.brackets;for(let r of o){let s=Ut(D(r,0));if(t==r)return s==r?Vo(e,r,o.indexOf(r+r+r)>-1,n):Mo(e,r,s,n.before||Z.before);if(t==s&&zt(e,e.selection.main.from))return No(e,r,s)}return null}function zt(e,t){let n=!1;return e.field(jt).between(0,e.doc.length,o=>{o==t&&(n=!0)}),n}function pe(e,t){let n=e.sliceString(t,t+2);return n.slice(0,N(D(n,0)))}function Ro(e,t){let n=e.sliceString(t-2,t);return N(D(n,0))==n.length?n:n.slice(1)}function Mo(e,t,n,o){let r=null,s=e.changeByRange(i=>{if(!i.empty)return{changes:[{insert:t,from:i.from},{insert:n,from:i.to}],effects:j.of(i.to+t.length),range:p.range(i.anchor+t.length,i.head+t.length)};let l=pe(e.doc,i.head);return!l||/\s/.test(l)||o.indexOf(l)>-1?{changes:{insert:t+n,from:i.head},effects:j.of(i.head+t.length),range:p.cursor(i.head+t.length)}:{range:r=i}});return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function No(e,t,n){let o=null,r=e.changeByRange(s=>s.empty&&pe(e.doc,s.head)==n?{changes:{from:s.head,to:s.head+n.length,insert:n},range:p.cursor(s.head+n.length)}:o={range:s});return o?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Vo(e,t,n,o){let r=o.stringPrefixes||Z.stringPrefixes,s=null,i=e.changeByRange(l=>{if(!l.empty)return{changes:[{insert:t,from:l.from},{insert:t,from:l.to}],effects:j.of(l.to+t.length),range:p.range(l.anchor+t.length,l.head+t.length)};let c=l.head,a=pe(e.doc,c),f;if(a==t){if(ot(e,c))return{changes:{insert:t+t,from:c},effects:j.of(c+t.length),range:p.cursor(c+t.length)};if(zt(e,c)){let h=n&&e.sliceDoc(c,c+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:c,to:c+h.length,insert:h},range:p.cursor(c+h.length)}}}else{if(n&&e.sliceDoc(c-2*t.length,c)==t+t&&(f=rt(e,c-2*t.length,r))>-1&&ot(e,f))return{changes:{insert:t+t+t+t,from:c},effects:j.of(c+t.length),range:p.cursor(c+t.length)};if(e.charCategorizer(c)(a)!=Te.Word&&rt(e,c,r)>-1&&!Fo(e,c,t,r))return{changes:{insert:t+t,from:c},effects:j.of(c+t.length),range:p.cursor(c+t.length)}}return{range:s=l}});return s?null:e.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function ot(e,t){let n=U(e).resolveInner(t+1);return n.parent&&n.from==t}function Fo(e,t,n,o){let r=U(e).resolveInner(t,-1),s=o.reduce((i,l)=>Math.max(i,l.length),0);for(let i=0;i<5;i++){let l=e.sliceDoc(r.from,Math.min(r.to,r.from+n.length+s)),c=l.indexOf(n);if(!c||c>-1&&o.indexOf(l.slice(0,c))>-1){let f=r.firstChild;for(;f&&f.from==r.from&&f.to-f.from>n.length+c;){if(e.sliceDoc(f.to-n.length,f.to)==n)return!1;f=f.firstChild}return!0}let a=r.to==t&&r.parent;if(!a)break;r=a}return!1}function rt(e,t,n){let o=e.charCategorizer(t);if(o(e.sliceDoc(t-1,t))!=Te.Word)return t;for(let r of n){let s=t-r.length;if(e.sliceDoc(s,t)==r&&o(e.sliceDoc(s-1,s))!=Te.Word)return s}return-1}function xs(e={}){return[So,E,A.of(e),yo,Uo,Vt]}const jo=[{key:"Ctrl-Space",run:uo},{key:"Escape",run:ho},{key:"ArrowDown",run:oe(!0)},{key:"ArrowUp",run:oe(!1)},{key:"PageDown",run:oe(!0,"page")},{key:"PageUp",run:oe(!1,"page")},{key:"Enter",run:fo}],Uo=Re.highest(vt.computeN([A],e=>e.facet(A).defaultKeymap?[jo]:[])),Ho=e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),o=qe(e.state,n.from);return o.line?zo(e):o.block?Wo(e):!1};function We(e,t){return({state:n,dispatch:o})=>{if(n.readOnly)return!1;let r=e(t,n);return r?(o(n.update(r)),!0):!1}}const zo=We(Ko,0),$o=We($t,0),Wo=We((e,t)=>$t(e,t,Go(t)),0);function qe(e,t){let n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}const J=50;function qo(e,{open:t,close:n},o,r){let s=e.sliceDoc(o-J,o),i=e.sliceDoc(r,r+J),l=/\s*$/.exec(s)[0].length,c=/^\s*/.exec(i)[0].length,a=s.length-l;if(s.slice(a-t.length,a)==t&&i.slice(c,c+n.length)==n)return{open:{pos:o-l,margin:l&&1},close:{pos:r+c,margin:c&&1}};let f,u;r-o<=2*J?f=u=e.sliceDoc(o,r):(f=e.sliceDoc(o,o+J),u=e.sliceDoc(r-J,r));let h=/^\s*/.exec(f)[0].length,d=/\s*$/.exec(u)[0].length,C=u.length-d-n.length;return f.slice(h,h+t.length)==t&&u.slice(C,C+n.length)==n?{open:{pos:o+h+t.length,margin:/\s/.test(f.charAt(h+t.length))?1:0},close:{pos:r-d-n.length,margin:/\s/.test(u.charAt(C-1))?1:0}}:null}function Go(e){let t=[];for(let n of e.selection.ranges){let o=e.doc.lineAt(n.from),r=n.to<=o.to?o:e.doc.lineAt(n.to),s=t.length-1;s>=0&&t[s].to>o.from?t[s].to=r.to:t.push({from:o.from+/^\s*/.exec(o.text)[0].length,to:r.to})}return t}function $t(e,t,n=t.selection.ranges){let o=n.map(s=>qe(t,s.from).block);if(!o.every(s=>s))return null;let r=n.map((s,i)=>qo(t,o[i],s.from,s.to));if(e!=2&&!r.every(s=>s))return{changes:t.changes(n.map((s,i)=>r[i]?[]:[{from:s.from,insert:o[i].open+" "},{from:s.to,insert:" "+o[i].close}]))};if(e!=1&&r.some(s=>s)){let s=[];for(let i=0,l;i<r.length;i++)if(l=r[i]){let c=o[i],{open:a,close:f}=l;s.push({from:a.pos-c.open.length,to:a.pos+a.margin},{from:f.pos-f.margin,to:f.pos+c.close.length})}return{changes:s}}return null}function Ko(e,t,n=t.selection.ranges){let o=[],r=-1;for(let{from:s,to:i}of n){let l=o.length,c=1e9,a=qe(t,s).line;if(a){for(let f=s;f<=i;){let u=t.doc.lineAt(f);if(u.from>r&&(s==i||i>u.from)){r=u.from;let h=/^\s*/.exec(u.text)[0].length,d=h==u.length,C=u.text.slice(h,h+a.length)==a?h:-1;h<u.text.length&&h<c&&(c=h),o.push({line:u,comment:C,token:a,indent:h,empty:d,single:!1})}f=u.to+1}if(c<1e9)for(let f=l;f<o.length;f++)o[f].indent<o[f].line.text.length&&(o[f].indent=c);o.length==l+1&&(o[l].single=!0)}}if(e!=2&&o.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:c,indent:a,empty:f,single:u}of o)(u||!f)&&s.push({from:l.from+a,insert:c+" "});let i=t.changes(s);return{changes:i,selection:t.selection.map(i,1)}}else if(e!=1&&o.some(s=>s.comment>=0)){let s=[];for(let{line:i,comment:l,token:c}of o)if(l>=0){let a=i.from+l,f=a+c.length;i.text[f-i.from]==" "&&f++,s.push({from:a,to:f})}return{changes:s}}return null}const De=Me.define(),Jo=Me.define(),Qo=de.define(),Wt=de.define({combine(e){return kt(e,{minDepth:100,newGroupDelay:500,joinToEvent:(t,n)=>n},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,n)=>(o,r)=>t(o,r)||n(o,r)})}}),qt=he.define({create(){return B.empty},update(e,t){let n=t.state.facet(Wt),o=t.annotation(De);if(o){let c=P.fromTransaction(t,o.selection),a=o.side,f=a==0?e.undone:e.done;return c?f=ue(f,f.length,n.minDepth,c):f=Jt(f,t.startState.selection),new B(a==0?o.rest:f,a==0?f:o.rest)}let r=t.annotation(Jo);if((r=="full"||r=="before")&&(e=e.isolate()),t.annotation(se.addToHistory)===!1)return t.changes.empty?e:e.addMapping(t.changes.desc);let s=P.fromTransaction(t),i=t.annotation(se.time),l=t.annotation(se.userEvent);return s?e=e.addChanges(s,i,l,n,t):t.selection&&(e=e.addSelection(t.startState.selection,i,l,n.newGroupDelay)),(r=="full"||r=="after")&&(e=e.isolate()),e},toJSON(e){return{done:e.done.map(t=>t.toJSON()),undone:e.undone.map(t=>t.toJSON())}},fromJSON(e){return new B(e.done.map(P.fromJSON),e.undone.map(P.fromJSON))}});function bs(e={}){return[qt,Wt.of(e),L.domEventHandlers({beforeinput(t,n){let o=t.inputType=="historyUndo"?Gt:t.inputType=="historyRedo"?Oe:null;return o?(t.preventDefault(),o(n)):!1}})]}function ge(e,t){return function({state:n,dispatch:o}){if(!t&&n.readOnly)return!1;let r=n.field(qt,!1);if(!r)return!1;let s=r.pop(e,n,t);return s?(o(s),!0):!1}}const Gt=ge(0,!1),Oe=ge(1,!1),Yo=ge(0,!0),Xo=ge(1,!0);class P{constructor(t,n,o,r,s){this.changes=t,this.effects=n,this.mapped=o,this.startSelection=r,this.selectionsAfter=s}setSelAfter(t){return new P(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,n,o;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(n=this.mapped)===null||n===void 0?void 0:n.toJSON(),startSelection:(o=this.startSelection)===null||o===void 0?void 0:o.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(t){return new P(t.changes&&In.fromJSON(t.changes),[],t.mapped&&Dn.fromJSON(t.mapped),t.startSelection&&p.fromJSON(t.startSelection),t.selectionsAfter.map(p.fromJSON))}static fromTransaction(t,n){let o=T;for(let r of t.startState.facet(Qo)){let s=r(t);s.length&&(o=o.concat(s))}return!o.length&&t.changes.empty?null:new P(t.changes.invert(t.startState.doc),o,void 0,n||t.startState.selection,T)}static selection(t){return new P(void 0,T,void 0,void 0,t)}}function ue(e,t,n,o){let r=t+1>n+20?t-n-1:0,s=e.slice(r,t);return s.push(o),s}function Zo(e,t){let n=[],o=!1;return e.iterChangedRanges((r,s)=>n.push(r,s)),t.iterChangedRanges((r,s,i,l)=>{for(let c=0;c<n.length;){let a=n[c++],f=n[c++];l>=a&&i<=f&&(o=!0)}}),o}function er(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((n,o)=>n.empty!=t.ranges[o].empty).length===0}function Kt(e,t){return e.length?t.length?e.concat(t):e:t}const T=[],tr=200;function Jt(e,t){if(e.length){let n=e[e.length-1],o=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-tr));return o.length&&o[o.length-1].eq(t)?e:(o.push(t),ue(e,e.length-1,1e9,n.setSelAfter(o)))}else return[P.selection([t])]}function nr(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function Ee(e,t){if(!e.length)return e;let n=e.length,o=T;for(;n;){let r=or(e[n-1],t,o);if(r.changes&&!r.changes.empty||r.effects.length){let s=e.slice(0,n);return s[n-1]=r,s}else t=r.mapped,n--,o=r.selectionsAfter}return o.length?[P.selection(o)]:T}function or(e,t,n){let o=Kt(e.selectionsAfter.length?e.selectionsAfter.map(l=>l.map(t)):T,n);if(!e.changes)return P.selection(o);let r=e.changes.map(t),s=t.mapDesc(e.changes,!0),i=e.mapped?e.mapped.composeDesc(s):s;return new P(r,M.mapEffects(e.effects,t),i,e.startSelection.map(s),o)}const rr=/^(input\.type|delete)($|\.)/;class B{constructor(t,n,o=0,r=void 0){this.done=t,this.undone=n,this.prevTime=o,this.prevUserEvent=r}isolate(){return this.prevTime?new B(this.done,this.undone):this}addChanges(t,n,o,r,s){let i=this.done,l=i[i.length-1];return l&&l.changes&&!l.changes.empty&&t.changes&&(!o||rr.test(o))&&(!l.selectionsAfter.length&&n-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,Zo(l.changes,t.changes))||o=="input.type.compose")?i=ue(i,i.length-1,r.minDepth,new P(t.changes.compose(l.changes),Kt(t.effects,l.effects),l.mapped,l.startSelection,T)):i=ue(i,i.length,r.minDepth,t),new B(i,T,n,o)}addSelection(t,n,o,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:T;return s.length>0&&n-this.prevTime<r&&o==this.prevUserEvent&&o&&/^select($|\.)/.test(o)&&er(s[s.length-1],t)?this:new B(Jt(this.done,t),this.undone,n,o)}addMapping(t){return new B(Ee(this.done,t),Ee(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,n,o){let r=t==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1],i=s.selectionsAfter[0]||n.selection;if(o&&s.selectionsAfter.length)return n.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:De.of({side:t,rest:nr(r),selection:i}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let l=r.length==1?T:r.slice(0,r.length-1);return s.mapped&&(l=Ee(l,s.mapped)),n.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:De.of({side:t,rest:l,selection:i}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}B.empty=new B(T,T);const As=[{key:"Mod-z",run:Gt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Oe,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Oe,preventDefault:!0},{key:"Mod-u",run:Yo,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Xo,preventDefault:!0}];function G(e,t){return p.create(e.ranges.map(t),e.mainIndex)}function w(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function O({state:e,dispatch:t},n){let o=G(e.selection,n);return o.eq(e.selection,!0)?!1:(t(w(e,o)),!0)}function ye(e,t){return p.cursor(t?e.to:e.from)}function Qt(e,t){return O(e,n=>n.empty?e.moveByChar(n,t):ye(n,t))}function k(e){return e.textDirectionAt(e.state.selection.main.head)==Pt.LTR}const Yt=e=>Qt(e,!k(e)),Xt=e=>Qt(e,k(e));function Zt(e,t){return O(e,n=>n.empty?e.moveByGroup(n,t):ye(n,t))}const sr=e=>Zt(e,!k(e)),ir=e=>Zt(e,k(e));function lr(e,t,n){if(t.type.prop(n))return!0;let o=t.to-t.from;return o&&(o>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function Ce(e,t,n){let o=U(e).resolveInner(t.head),r=n?Le.closedBy:Le.openedBy;for(let c=t.head;;){let a=n?o.childAfter(c):o.childBefore(c);if(!a)break;lr(e,a,r)?o=a:c=n?a.to:a.from}let s=o.type.prop(r),i,l;return s&&(i=n?z(e,o.from,1):z(e,o.to,-1))&&i.matched?l=n?i.end.to:i.end.from:l=n?o.to:o.from,p.cursor(l,n?-1:1)}const cr=e=>O(e,t=>Ce(e.state,t,!k(e))),ar=e=>O(e,t=>Ce(e.state,t,k(e)));function en(e,t){return O(e,n=>{if(!n.empty)return ye(n,t);let o=e.moveVertically(n,t);return o.head!=n.head?o:e.moveToLineBoundary(n,t)})}const tn=e=>en(e,!1),nn=e=>en(e,!0);function on(e){let t=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,n=0,o=0,r;if(t){for(let s of e.state.facet(L.scrollMargins)){let i=s(e);i?.top&&(n=Math.max(i?.top,n)),i?.bottom&&(o=Math.max(i?.bottom,o))}r=e.scrollDOM.clientHeight-n-o}else r=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:o,selfScroll:t,height:Math.max(e.defaultLineHeight,r-5)}}function rn(e,t){let n=on(e),{state:o}=e,r=G(o.selection,i=>i.empty?e.moveVertically(i,t,n.height):ye(i,t));if(r.eq(o.selection))return!1;let s;if(n.selfScroll){let i=e.coordsAtPos(o.selection.main.head),l=e.scrollDOM.getBoundingClientRect(),c=l.top+n.marginTop,a=l.bottom-n.marginBottom;i&&i.top>c&&i.bottom<a&&(s=L.scrollIntoView(r.main.head,{y:"start",yMargin:i.top-c}))}return e.dispatch(w(o,r),{effects:s}),!0}const st=e=>rn(e,!1),Be=e=>rn(e,!0);function F(e,t,n){let o=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,n);if(r.head==t.head&&r.head!=(n?o.to:o.from)&&(r=e.moveToLineBoundary(t,n,!1)),!n&&r.head==o.from&&o.length){let s=/^\s*/.exec(e.state.sliceDoc(o.from,Math.min(o.from+100,o.to)))[0].length;s&&t.head!=o.from+s&&(r=p.cursor(o.from+s))}return r}const fr=e=>O(e,t=>F(e,t,!0)),ur=e=>O(e,t=>F(e,t,!1)),hr=e=>O(e,t=>F(e,t,!k(e))),dr=e=>O(e,t=>F(e,t,k(e))),mr=e=>O(e,t=>p.cursor(e.lineBlockAt(t.head).from,1)),pr=e=>O(e,t=>p.cursor(e.lineBlockAt(t.head).to,-1));function gr(e,t,n){let o=!1,r=G(e.selection,s=>{let i=z(e,s.head,-1)||z(e,s.head,1)||s.head>0&&z(e,s.head-1,1)||s.head<e.doc.length&&z(e,s.head+1,-1);if(!i||!i.end)return s;o=!0;let l=i.start.from==s.head?i.end.to:i.end.from;return p.cursor(l)});return o?(t(w(e,r)),!0):!1}const yr=({state:e,dispatch:t})=>gr(e,t);function I(e,t){let n=G(e.state.selection,o=>{let r=t(o);return p.range(o.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return n.eq(e.state.selection)?!1:(e.dispatch(w(e.state,n)),!0)}function sn(e,t){return I(e,n=>e.moveByChar(n,t))}const ln=e=>sn(e,!k(e)),cn=e=>sn(e,k(e));function an(e,t){return I(e,n=>e.moveByGroup(n,t))}const Cr=e=>an(e,!k(e)),Sr=e=>an(e,k(e)),xr=e=>I(e,t=>Ce(e.state,t,!k(e))),br=e=>I(e,t=>Ce(e.state,t,k(e)));function fn(e,t){return I(e,n=>e.moveVertically(n,t))}const un=e=>fn(e,!1),hn=e=>fn(e,!0);function dn(e,t){return I(e,n=>e.moveVertically(n,t,on(e).height))}const it=e=>dn(e,!1),lt=e=>dn(e,!0),Ar=e=>I(e,t=>F(e,t,!0)),kr=e=>I(e,t=>F(e,t,!1)),vr=e=>I(e,t=>F(e,t,!k(e))),Er=e=>I(e,t=>F(e,t,k(e))),Pr=e=>I(e,t=>p.cursor(e.lineBlockAt(t.head).from)),_r=e=>I(e,t=>p.cursor(e.lineBlockAt(t.head).to)),ct=({state:e,dispatch:t})=>(t(w(e,{anchor:0})),!0),at=({state:e,dispatch:t})=>(t(w(e,{anchor:e.doc.length})),!0),ft=({state:e,dispatch:t})=>(t(w(e,{anchor:e.selection.main.anchor,head:0})),!0),ut=({state:e,dispatch:t})=>(t(w(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),Tr=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),Lr=({state:e,dispatch:t})=>{let n=Se(e).map(({from:o,to:r})=>p.range(o,Math.min(r+1,e.doc.length)));return t(e.update({selection:p.create(n),userEvent:"select"})),!0},Ir=({state:e,dispatch:t})=>{let n=G(e.selection,o=>{var r;let s=U(e).resolveStack(o.from,1);for(let i=s;i;i=i.next){let{node:l}=i;if((l.from<o.from&&l.to>=o.to||l.to>o.to&&l.from<=o.from)&&(!((r=l.parent)===null||r===void 0)&&r.parent))return p.range(l.to,l.from)}return o});return t(w(e,n)),!0},Dr=({state:e,dispatch:t})=>{let n=e.selection,o=null;return n.ranges.length>1?o=p.create([n.main]):n.main.empty||(o=p.create([p.cursor(n.main.head)])),o?(t(w(e,o)),!0):!1};function te(e,t){if(e.state.readOnly)return!1;let n="delete.selection",{state:o}=e,r=o.changeByRange(s=>{let{from:i,to:l}=s;if(i==l){let c=t(s);c<i?(n="delete.backward",c=re(e,c,!1)):c>i&&(n="delete.forward",c=re(e,c,!0)),i=Math.min(i,c),l=Math.max(l,c)}else i=re(e,i,!1),l=re(e,l,!0);return i==l?{range:s}:{changes:{from:i,to:l},range:p.cursor(i,i<s.head?-1:1)}});return r.changes.empty?!1:(e.dispatch(o.update(r,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?L.announce.of(o.phrase("Selection deleted")):void 0})),!0)}function re(e,t,n){if(e instanceof L)for(let o of e.state.facet(L.atomicRanges).map(r=>r(e)))o.between(t,t,(r,s)=>{r<t&&s>t&&(t=n?s:r)});return t}const mn=(e,t,n)=>te(e,o=>{let r=o.from,{state:s}=e,i=s.doc.lineAt(r),l,c;if(n&&!t&&r>i.from&&r<i.from+200&&!/[^ \t]/.test(l=i.text.slice(0,r-i.from))){if(l[l.length-1]=="	")return r-1;let a=Ve(l,s.tabSize),f=a%Ie(s)||Ie(s);for(let u=0;u<f&&l[l.length-1-u]==" ";u++)r--;c=r}else c=Q(i.text,r-i.from,t,t)+i.from,c==r&&i.number!=(t?s.doc.lines:1)?c+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(i.text.slice(c-i.from,r-i.from))&&(c=Q(i.text,c-i.from,!1,!1)+i.from);return c}),we=e=>mn(e,!1,!0),pn=e=>mn(e,!0,!1),gn=(e,t)=>te(e,n=>{let o=n.head,{state:r}=e,s=r.doc.lineAt(o),i=r.charCategorizer(o);for(let l=null;;){if(o==(t?s.to:s.from)){o==n.head&&s.number!=(t?r.doc.lines:1)&&(o+=t?1:-1);break}let c=Q(s.text,o-s.from,t)+s.from,a=s.text.slice(Math.min(o,c)-s.from,Math.max(o,c)-s.from),f=i(a);if(l!=null&&f!=l)break;(a!=" "||o!=n.head)&&(l=f),o=c}return o}),yn=e=>gn(e,!1),Or=e=>gn(e,!0),Br=e=>te(e,t=>{let n=e.lineBlockAt(t.head).to;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),wr=e=>te(e,t=>{let n=e.moveToLineBoundary(t,!1).head;return t.head>n?n:Math.max(0,t.head-1)}),Rr=e=>te(e,t=>{let n=e.moveToLineBoundary(t,!0).head;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),Mr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>({changes:{from:o.from,to:o.to,insert:Ne.of(["",""])},range:p.cursor(o.from)}));return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},Nr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>{if(!o.empty||o.from==0||o.from==e.doc.length)return{range:o};let r=o.from,s=e.doc.lineAt(r),i=r==s.from?r-1:Q(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:Q(s.text,r-s.from,!0)+s.from;return{changes:{from:i,to:l,insert:e.doc.slice(r,l).append(e.doc.slice(i,r))},range:p.cursor(l)}});return n.changes.empty?!1:(t(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Se(e){let t=[],n=-1;for(let o of e.selection.ranges){let r=e.doc.lineAt(o.from),s=e.doc.lineAt(o.to);if(!o.empty&&o.to==s.from&&(s=e.doc.lineAt(o.to-1)),n>=r.number){let i=t[t.length-1];i.to=s.to,i.ranges.push(o)}else t.push({from:r.from,to:s.to,ranges:[o]});n=s.number+1}return t}function Cn(e,t,n){if(e.readOnly)return!1;let o=[],r=[];for(let s of Se(e)){if(n?s.to==e.doc.length:s.from==0)continue;let i=e.doc.lineAt(n?s.to+1:s.from-1),l=i.length+1;if(n){o.push({from:s.to,to:i.to},{from:s.from,insert:i.text+e.lineBreak});for(let c of s.ranges)r.push(p.range(Math.min(e.doc.length,c.anchor+l),Math.min(e.doc.length,c.head+l)))}else{o.push({from:i.from,to:s.from},{from:s.to,insert:e.lineBreak+i.text});for(let c of s.ranges)r.push(p.range(c.anchor-l,c.head-l))}}return o.length?(t(e.update({changes:o,scrollIntoView:!0,selection:p.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Vr=({state:e,dispatch:t})=>Cn(e,t,!1),Fr=({state:e,dispatch:t})=>Cn(e,t,!0);function Sn(e,t,n){if(e.readOnly)return!1;let o=[];for(let r of Se(e))n?o.push({from:r.from,insert:e.doc.slice(r.from,r.to)+e.lineBreak}):o.push({from:r.to,insert:e.lineBreak+e.doc.slice(r.from,r.to)});return t(e.update({changes:o,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const jr=({state:e,dispatch:t})=>Sn(e,t,!1),Ur=({state:e,dispatch:t})=>Sn(e,t,!0),Hr=e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(Se(t).map(({from:r,to:s})=>(r>0?r--:s<t.doc.length&&s++,{from:r,to:s}))),o=G(t.selection,r=>{let s;if(e.lineWrapping){let i=e.lineBlockAt(r.head),l=e.coordsAtPos(r.head,r.assoc||1);l&&(s=i.bottom+e.documentTop-l.bottom+e.defaultLineHeight/2)}return e.moveVertically(r,!0,s)}).map(n);return e.dispatch({changes:n,selection:o,scrollIntoView:!0,userEvent:"delete.line"}),!0};function zr(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n=U(e).resolveInner(t),o=n.childBefore(t),r=n.childAfter(t),s;return o&&r&&o.to<=t&&r.from>=t&&(s=o.type.prop(Le.closedBy))&&s.indexOf(r.name)>-1&&e.doc.lineAt(o.to).from==e.doc.lineAt(r.from).from&&!/\S/.test(e.sliceDoc(o.to,r.from))?{from:o.to,to:r.from}:null}const $r=xn(!1),Wr=xn(!0);function xn(e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let o=t.changeByRange(r=>{let{from:s,to:i}=r,l=t.doc.lineAt(s),c=!e&&s==i&&zr(t,s);e&&(s=i=(i<=l.to?l:t.doc.lineAt(i)).to);let a=new Tt(t,{simulateBreak:s,simulateDoubleBreak:!!c}),f=Lt(a,s);for(f==null&&(f=Ve(/^\s*/.exec(t.doc.lineAt(s).text)[0],t.tabSize));i<l.to&&/\s/.test(l.text[i-l.from]);)i++;c?{from:s,to:i}=c:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let u=["",le(t,f)];return c&&u.push(le(t,a.lineIndent(l.from,-1))),{changes:{from:s,to:i,insert:Ne.of(u)},range:p.cursor(s+1+u[1].length)}});return n(t.update(o,{scrollIntoView:!0,userEvent:"input"})),!0}}function Ge(e,t){let n=-1;return e.changeByRange(o=>{let r=[];for(let i=o.from;i<=o.to;){let l=e.doc.lineAt(i);l.number>n&&(o.empty||o.to>l.from)&&(t(l,r,o),n=l.number),i=l.to+1}let s=e.changes(r);return{changes:r,range:p.range(s.mapPos(o.anchor,1),s.mapPos(o.head,1))}})}const qr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),o=new Tt(e,{overrideIndentation:s=>{let i=n[s];return i??-1}}),r=Ge(e,(s,i,l)=>{let c=Lt(o,s.from);if(c==null)return;/\S/.test(s.text)||(c=0);let a=/^\s*/.exec(s.text)[0],f=le(e,c);(a!=f||l.from<s.from+a.length)&&(n[s.from]=c,i.push({from:s.from,to:s.from+a.length,insert:f}))});return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0},bn=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(Ge(e,(n,o)=>{o.push({from:n.from,insert:e.facet(_t)})}),{userEvent:"input.indent"})),!0),An=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(Ge(e,(n,o)=>{let r=/^\s*/.exec(n.text)[0];if(!r)return;let s=Ve(r,e.tabSize),i=0,l=le(e,Math.max(0,s-Ie(e)));for(;i<r.length&&i<l.length&&r.charCodeAt(i)==l.charCodeAt(i);)i++;o.push({from:n.from+i,to:n.from+r.length,insert:l.slice(i)})}),{userEvent:"delete.dedent"})),!0),Gr=e=>(e.setTabFocusMode(),!0),Kr=[{key:"Ctrl-b",run:Yt,shift:ln,preventDefault:!0},{key:"Ctrl-f",run:Xt,shift:cn},{key:"Ctrl-p",run:tn,shift:un},{key:"Ctrl-n",run:nn,shift:hn},{key:"Ctrl-a",run:mr,shift:Pr},{key:"Ctrl-e",run:pr,shift:_r},{key:"Ctrl-d",run:pn},{key:"Ctrl-h",run:we},{key:"Ctrl-k",run:Br},{key:"Ctrl-Alt-h",run:yn},{key:"Ctrl-o",run:Mr},{key:"Ctrl-t",run:Nr},{key:"Ctrl-v",run:Be}],Jr=[{key:"ArrowLeft",run:Yt,shift:ln,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:sr,shift:Cr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:hr,shift:vr,preventDefault:!0},{key:"ArrowRight",run:Xt,shift:cn,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:ir,shift:Sr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:dr,shift:Er,preventDefault:!0},{key:"ArrowUp",run:tn,shift:un,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ct,shift:ft},{mac:"Ctrl-ArrowUp",run:st,shift:it},{key:"ArrowDown",run:nn,shift:hn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:at,shift:ut},{mac:"Ctrl-ArrowDown",run:Be,shift:lt},{key:"PageUp",run:st,shift:it},{key:"PageDown",run:Be,shift:lt},{key:"Home",run:ur,shift:kr,preventDefault:!0},{key:"Mod-Home",run:ct,shift:ft},{key:"End",run:fr,shift:Ar,preventDefault:!0},{key:"Mod-End",run:at,shift:ut},{key:"Enter",run:$r},{key:"Mod-a",run:Tr},{key:"Backspace",run:we,shift:we},{key:"Delete",run:pn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:yn},{key:"Mod-Delete",mac:"Alt-Delete",run:Or},{mac:"Mod-Backspace",run:wr},{mac:"Mod-Delete",run:Rr}].concat(Kr.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),ks=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cr,shift:xr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:ar,shift:br},{key:"Alt-ArrowUp",run:Vr},{key:"Shift-Alt-ArrowUp",run:jr},{key:"Alt-ArrowDown",run:Fr},{key:"Shift-Alt-ArrowDown",run:Ur},{key:"Escape",run:Dr},{key:"Mod-Enter",run:Wr},{key:"Alt-l",mac:"Ctrl-l",run:Lr},{key:"Mod-i",run:Ir,preventDefault:!0},{key:"Mod-[",run:An},{key:"Mod-]",run:bn},{key:"Mod-Alt-\\",run:qr},{key:"Shift-Mod-k",run:Hr},{key:"Shift-Mod-\\",run:yr},{key:"Mod-/",run:Ho},{key:"Alt-A",run:$o},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Gr}].concat(Jr),vs={key:"Tab",run:bn,shift:An};function x(e){return new On(Bn.define(e))}const ht=()=>y(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>x(e.shell)),kn={[g.bash]:ht,[g.zsh]:ht,[g.swift]:()=>y(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>x(e.swift)),[g.css]:()=>y(()=>import("./ej1bms9fbyedlq1e.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>e.css()),[g.html]:()=>y(()=>import("./mpci7q2qqicm6del.js"),__vite__mapDeps([7,1,2,3,4,5,6,0,8,9,10,11,12,13,14,15,16])).then(e=>e.html()),[g.javascript]:()=>y(()=>import("./n2o54kk90wpa6tc9.js"),__vite__mapDeps([8,1,2,3,4,5,6,9,10,11,12,13,14,15,16])).then(e=>e.javascript({jsx:!0,typescript:!1})),[g.typescript]:()=>y(()=>import("./n2o54kk90wpa6tc9.js"),__vite__mapDeps([8,1,2,3,4,5,6,9,10,11,12,13,14,15,16])).then(e=>e.javascript({jsx:!0,typescript:!0})),[g.json]:()=>y(()=>import("./g622vs9j8fcjhdch.js"),__vite__mapDeps([17,1,2,3,4,5,6])).then(e=>e.json()),[g.python]:()=>y(()=>import("./csqmgqamfqbmz64h.js"),__vite__mapDeps([18,1,2,3,4,5,6,9,10,11,12,13,14,15,16])).then(e=>e.python()),[g.sql]:()=>y(()=>import("./55k7cyst53ds55j5.js"),__vite__mapDeps([19,2,3,4,5,6,1,9,10,11,12,13,14,15,16])).then(e=>e.sql()),[g.go]:()=>y(()=>import("./g0y4jei68vbnum8l.js"),__vite__mapDeps([20,1,2,3,4,5,6,9,10,11,12,13,14,15,16])).then(e=>e.go()),[g.yaml]:()=>y(()=>import("./j3podsohfsuuzn30.js"),__vite__mapDeps([21,1,2,3,4,5,6])).then(e=>e.yaml()),[g.java]:()=>y(()=>import("./nl9ot2ro6g3k9q08.js"),__vite__mapDeps([22,1,2,3,4,5,6])).then(e=>e.java()),[g.rust]:()=>y(()=>import("./gv31kw2784zvh4dc.js"),__vite__mapDeps([23,1,2,3,4,5,6])).then(e=>e.rust()),[g.cpp]:()=>y(()=>import("./dokst4zjxf0wvjk3.js"),__vite__mapDeps([24,1,2,3,4,5,6])).then(e=>e.cpp()),[g.php]:()=>y(()=>import("./fykmhm6ikn0ejop6.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,0,8,9,10,11,12,13,14,15,16])).then(e=>e.php()),[g.xml]:()=>y(()=>import("./kpakmdcyunnluxu5.js"),__vite__mapDeps([26,1,2,3,4,5,6])).then(e=>e.xml()),[g.vue]:()=>y(()=>import("./cgblc6idnw8spywd.js"),__vite__mapDeps([27,2,3,4,5,6,7,1,0,8,9,10,11,12,13,14,15,16])).then(e=>e.vue()),[g.ruby]:()=>y(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>x(e.ruby)),[g.haskell]:()=>y(()=>import("./bf6r3t2rw7f01so5.js"),[]).then(e=>x(e.haskell)),[g.kotlin]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.kotlin)),[g.csharp]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.csharp)),[g.c]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.c)),[g.objectivec]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.objectiveC)),[g.r]:()=>y(()=>import("./ejmf57etl4wj4dsl.js"),[]).then(e=>x(e.r)),[g.lua]:()=>y(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>x(e.lua)),[g.dart]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.dart)),[g.scala]:()=>y(()=>import("./kgvtb74bv9aeuy4s.js"),[]).then(e=>x(e.scala)),[g.perl]:()=>y(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>x(e.perl)),[g.commonlisp]:()=>y(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>x(e.commonLisp)),[g.clojure]:()=>y(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>x(e.clojure)),[g.ocaml]:()=>y(()=>import("./no1gl1ax0ypay171.js"),[]).then(e=>x(e.oCaml)),[g.powershell]:()=>y(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>x(e.powerShell)),[g.verilog]:()=>y(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>x(e.verilog)),[g.dockerfile]:()=>y(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>x(e.dockerFile)),[g.other]:()=>null},Qr=e=>e in kn,ie={},Es=async e=>{if(ie[e]!=null)return ie[e];if(Qr(e)){const t=await kn[e]();return ie[e]=t,t}return null},Ps=e=>ie[e]??null,Yr=It.define([{tag:m.variableName,color:"white"},{tag:m.comment,color:"rgb(255 255 255 / 50%)"},{tag:m.meta,color:"rgb(255 255 255 / 60%)"},{tag:[m.typeName],color:"#e9950c"},{tag:[m.keyword,m.literal],color:"#2e95d3"},{tag:[m.string,m.special(m.string),m.regexp],color:"#00a67d"},{tag:[m.number,m.bool,m.atom],color:"#df3079"},{tag:[m.propertyName,m.attributeName],color:"#df3079"},{tag:[m.className,m.labelName],color:"#f22c3d"},{tag:m.emphasis,fontStyle:"italic"},{tag:m.strong,fontWeight:"bold"},{tag:m.link,textDecoration:"underline"}]),Xr=It.define([{tag:[m.comment,m.quote],color:"#a0a1a7",fontStyle:"italic"},{tag:m.meta,color:"#a0a1a7"},{tag:[m.typeName],color:"#c18401"},{tag:[m.keyword,m.literal],color:"#a626a4"},{tag:[m.string,m.special(m.string),m.regexp],color:"#50a14f"},{tag:[m.number,m.bool,m.atom],color:"#986801"},{tag:[m.propertyName,m.attributeName],color:"#986801"},{tag:[m.variableName],color:"black"},{tag:[m.labelName,m.className],color:"#4078f2"},{tag:m.emphasis,fontStyle:"italic"},{tag:m.strong,fontWeight:"bold"},{tag:m.link,textDecoration:"underline"}]),_s=e=>e?Yr:Xr;function Zr(e){return e.nodeSize-2}function Ts(e,t){return t>=0&&t<=Zr(e)}const dt=(e,t)=>{if(!t)return!1;const[n,o]=t;return e>=n&&e<o},vn=(e,t)=>e.pmPos-t.pmPos,mt=(e,t)=>{const n=t[t.length-1].sourcePos;return Math.min(Math.max(e,0),n)},pt=(e,t)=>{const n=Dt(t)?.sourcePos??0;return Math.min(Math.max(e,0),n)},gt=({positions:e,sourcePos:t,sourceEndPos:n})=>{const o=[];for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:i,leafSourceRange:l,isClose:c=!1}=s;if(n!=null&&i>n)break;const a=e[r+1]??null,f=u=>{let h=e[u];if(h==null)return u;let d=e[u+1],{leafSourceRange:C}=h;for(;h.nodeTypeName!==ce.proseMirrorNodeName()&&!h.isClose&&d!=null&&!dt(t,C);)o.push(d),h=d,d=e[u+2],C=h.leafSourceRange,u++;return u};if(i===t&&!c||dt(t,l))o.push(s),r=f(r);else if(i<=t&&(a?.sourcePos??Number.POSITIVE_INFINITY)>=t){let u=r+1;const h=[];for(;e[u]?.isClose===!0;)h.push(u),u++;if(e[u]){const{sourcePos:d}=e[u];do o.push(e[u]);while(e[++u].sourcePos===d);u=f(u-1)}else{(i===t||c)&&o.push(s);for(const d of h)o.push(e[d])}r=u}}return o.sort(vn)},yt=({positions:e,sourcePos:t})=>{const n=[],o=r=>{r&&n.push(r)};for(let r=0;r<e.length;r++){const s=e[r],{sourcePos:i}=s;if(t==null||i>t)break;const l=e[r-1]??null,c=e[r+1]??null,a=t>i&&t<(c?.sourcePos??-1),f=s.nodeTypeName===ce.proseMirrorNodeName();if(i===t||a&&!f){if(s.isClose&&!l?.isClose&&s.nodeTypeName===l?.nodeTypeName||!s.isClose&&c.isClose&&s.nodeTypeName===c.nodeTypeName||s.isClose&&l?.isClose||!s.isClose&&l!=null&&l?.nodeTypeName!==ce.proseMirrorNodeName()){o(l);let C=r-2,b=e[C];for(;C>=0&&b.isClose;)o(b),b=e[--C]}let u=r,h=s,d=h;do o(h),d=h,h=e[++u];while(h?.sourcePos===t||h?.depth<d?.depth);break}else if(a&&f){let u=r+1,h=e[u];for(;h?.isClose;)o(h),h=e[++u];break}}return n.sort(vn)},es=e=>{const t=new Map;e.descendants((r,s)=>{const i=Je(r);if(!i)return;const{start:l,end:c}=i,a=r.type.name,{depth:f}=e.resolve(s);if(t.set(s,{pmPos:s,sourcePos:l,leafSourceRange:r.isBlock?void 0:[l,c],depth:f,nodeTypeName:a,isClose:!1,parentNodeTypeNameStack:[]}),r.isBlock){const u=s+r.nodeSize-1;t.set(u,{pmPos:u,sourcePos:c,depth:e.resolve(u).depth,nodeTypeName:a,isClose:!0,parentNodeTypeNameStack:[]})}if(r.isText)for(let u=0;u<(r.text?.length??0);u++){const h=s+u;t.set(h,{pmPos:h,sourcePos:l+u,depth:f,nodeTypeName:a,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:Je(e)?.end??0,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([r],[s])=>r-s).map(([,r])=>r),o=[Vn.proseMirrorNodeName()];for(const r of n)r.isClose?(r.parentNodeTypeNameStack=o.concat(),o.pop()):(r.parentNodeTypeNameStack=o.concat(),r.nodeTypeName!==ce.proseMirrorNodeName()&&Dt(o)!==r.nodeTypeName&&o.push(r.nodeTypeName));return{positions:n,pmRangeToSourceRange:({start:r,end:s})=>({start:n[Math.max(r,0)].sourcePos,end:n[Math.min(s,n.length-1)].sourcePos}),sourceStartToPmPos:r=>gt({sourcePos:mt(r,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:r=>yt({sourcePos:pt(r,n),positions:n}),sourceRangeToPmRange:r=>{const{start:s,end:i}=r,l=pt(i,n),c=gt({sourcePos:mt(s,n),sourceEndPos:l,positions:n}),a=yt({sourcePos:l,positions:n});return{start:c,end:a}}}},ts=zn(es);function Ls(e,t){return t?e.getState(t)??null:null}const Ct=(e,t,n)=>{const o=n==="min"?0:t.length-1;for(let r=o;n==="min"?r<t.length:r>=0;n==="min"?r++:r--){const{sourcePos:s,pmPos:i}=t[r];if(s===e)return i;if(n==="min"&&s>e||n==="max"&&s<e)return n==="min"?t[r-1]?.pmPos??i:i}return null};function ns(e,t){const n=ss(e);if(n.length===0)return t;let o=t;return n.forEach(r=>{o=os(r,o)}),o}function os(e,t){return Fn(t,{start:e.from,end:e.to},rs(e))}function rs(e){return e.slice.size-(e.to-e.from)}function ss(e){return e.steps.filter(t=>t instanceof wn)}const St=new Mn("comments");function xt(e,t){const{sourceRangeToPmRange:n}=ts(e),o=t.map(({id:r,at:s})=>{const{start:i,end:l}=n(s),c=Ct(s.start,i,"max"),a=Ct(s.end,l,"min");return a==null||c==null?null:[r,{start:c,end:a}]}).filter(Nn);return new Map(o)}function is(e,t){const{type:n}=t;if(n===Un.SELECTION){const{from:s,to:i}=t;return[s,i]}const{pos:o}=t,r=o+(e.nodeAt(o)?.nodeSize??0);return[o,r]}const bt=(e,t,n=null,o=null)=>{const r=[],s=Array.from(t.entries()).reverse(),i=new Map(e.map(l=>[l.id,l]));for(const[l,c]of s){const a=i.get(l),h=Hn({isHovered:n===l,isFocused:o===l,isCode:!1,diffStatus:a?.diffStatus});r.push(Ot.inline(c.start,c.end,{class:h,"data-comment-id":l,nodeName:"span"}))}return r},Is=e=>new Rn({key:St,state:{init:(t,{doc:n})=>{const o=xt(n,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:bt(e,o),positions:o}},apply:(t,n)=>{const o=t.getMeta(St)??{},r=o.comments,s=r??n.comments,i=r!=null?xt(t.doc,s):n.positions;let l=o.commentingOn;l===void 0&&(l=n.commentingOn);let c=o.hoveredCommentId;c===void 0&&(c=n.hoveredCommentId);let a=o.focusedCommentId;a===void 0&&(a=n.focusedCommentId);const f=ns(t,i),u=jn(s,f);return{comments:u,commentingOn:l,hoveredCommentId:c,focusedCommentId:a,decorations:bt(u,f,c,a),positions:f}}},props:{handleClickOn:(t,n,o,r,s)=>{const{target:i}=s;if(i instanceof HTMLElement){const{commentId:l}=i.dataset;if(!l)return;Ae.focusComment(l)}},handleDOMEvents:{mouseover(t,n){const{target:o}=n;if(o instanceof HTMLElement){const{commentId:r}=o.dataset;r?Ae.mouseEnterComment(r):Ae.mouseLeaveComment()}}},decorations(t){const n=this.getState(t);if(!n)return Ke.empty;const{commentingOn:o,decorations:r}=n,{doc:s}=t;if(o){const[i,l]=is(s,o);i!=null&&l!=null&&r.push(Ot.inline(i,l,{class:$n.document},{comment:{pattern:o}}))}return Ke.create(s,r.concat())}}});export{Ts as a,ps as b,Gn as c,Cs as d,xs as e,Ss as f,ks as g,bs as h,gs as i,jo as j,As as k,vs as l,_s as m,Ps as n,Es as o,Ls as p,St as q,ts as r,ys as s,Ct as t,Is as u,Zr as v};
//# sourceMappingURL=bfgn782syyllzt4r.js.map
