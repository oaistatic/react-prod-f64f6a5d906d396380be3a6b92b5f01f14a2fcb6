import{g8 as o,kw as N,d as w,lO as y,ch as b,lP as M,R as g,g7 as i,eO as k,eP as U,ix as L,dp as H,e7 as u,lQ as x,dr as D,lR as O,P as C,af as F}from"./g670b8vtkhx0yc6d.js";import{b as G,h as j,r as f,j as T,ae as E}from"./gg0tb34p9fzo1omt.js";import{g as v}from"./bh2z1g8widqy6g72.js";import{C as B}from"./c7q67liujwt03fxw.js";const q={OAUTH_SCOPES_MISMATCH:o.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:o.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},Y=N(function(){const _=G(),A=w(),s=j(),l=y(),R=b(),h=f.useRef(!1),{mutateAsync:S}=M();return f.useEffect(()=>{if(h.current===!0)return;h.current=!0;async function m(){const p=v()==="popup"||l,I=window.location.href;try{const e=await g.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:I}});if(!e?.post_auth_url){s(i(o.OAUTH_FAILED_GENERIC));return}const t=new URL(e.post_auth_url,location.origin),r=e?.link?.connector_id===k[U.GITHUB_CONNECTOR],c=t.searchParams.get("github_onboarding")==="sync-repos";if(r&&c){const n=await g.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!n||n.repos.length===0){window.open(`${L}?state=${encodeURIComponent(JSON.stringify({client_redirect_to:`${window.location.origin}/?github_onboarding=sync-repos`}))}`,"_self");return}}const d=H(t.hash)===u.Connectors;if(!d){const n=x[e.link.connector_id];n&&t.searchParams.set("add_source",n)}let a;if(d){const n=new URLSearchParams;n.set("connector",e.link.connector_id),r&&!c&&n.set("github_onboarding","configure-repos");const P={...t,search:"",hash:D(u.Connectors).hash+`?${n.toString()}`};a=E(P)}else r&&!c&&t.searchParams.set("github_onboarding","configure-repos"),a=E({pathname:t.pathname,search:t.search,hash:t.hash});if(p){O({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}C.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id}),s(i(o.CUSTOM_MSG,a,_.formatMessage({id:"Og/gZO",defaultMessage:"{connector} is now connected"},{connector:e.link.name})))}catch(e){const t=e instanceof F?q[e.detail?.error_code]??o.OAUTH_FAILED_GENERIC:o.OAUTH_FAILED_GENERIC;if(p){O({success:!1,connectorId:"",errorType:t}),window.close();return}C.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:t,success:!1,type:"unknown"}),s(i(t,`#settings/${u.Connectors}`))}}m()},[A,l,_,s,R,S]),T.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:T.jsx(B,{size:36})})});export{Y as default};
//# sourceMappingURL=536xjbfpqfwfswi9.js.map
