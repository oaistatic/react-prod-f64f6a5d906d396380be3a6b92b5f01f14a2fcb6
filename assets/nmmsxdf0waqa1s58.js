import{r as c,j as e,b as ve,M as a,e as je,L as E,R as Se}from"./gg0tb34p9fzo1omt.js";import{b0 as Me,gF as Ce,gG as Le,fn as De,a3 as Ie,t as Ne,B as we,gH as Ae,gI as Ee,gJ as Pe,a4 as X,d1 as Re}from"./forbprkns1cohsbl.js";import{c as Te,a as Be,j as K,h as k,R as se,je as te,dj as ae,d as Ue,ch as Fe,cI as He,eX as qe,a7 as Z,F as Oe,be as V,bT as ze,c6 as Ye,cY as $e,hx as Ge,bU as We,dr as P,e7 as R,P as H,S as q}from"./g670b8vtkhx0yc6d.js";const Je=()=>Te((s,o)=>({title:void 0,highlightedMessageId:void 0,initiallyHighlightedMessageId:void 0,currentNodeId:void 0,shareLinkId:void 0,shareLinkUrl:void 0,isPublic:!1,isDeleted:!1,isAnonymous:!0,isDiscoverable:!1,canDisableDiscoverability:!1,linkAlreadyExisted:!1,linkAlreadyPublic:!1,linkError:void 0,moderationState:void 0,piiDetected:!1})),O=c.createContext(),b=s=>Be(c.useContext(O),s),Xe=()=>b(s=>s.shareLinkId),Ke=()=>b(s=>s.shareLinkUrl),Ze=()=>b(s=>s.currentNodeId),Ve=()=>b(s=>s.linkAlreadyPublic);function Qe(s){return s.metadata?.aggregate_result?.messages?.some(Me)===!0}function es(s){const o=s.content;return("parts"in o?o.parts.join(""):"").includes("sandbox:")}function ss(s){return Qe(s)||es(s)}const g=je({moderationBlocked:{id:"sharingModal.moderationBlocked",defaultMessage:"This shared link has been disabled by moderation."},confirmDeleteLink:{id:"sharingModal.confirmDeleteLink",defaultMessage:"Are you sure you want to delete the share link?"},advancedDataAnalysisSupportDisclaimer:{id:"sharingModal.advancedDataAnalysisSupportDisclaimer",defaultMessage:"Recipients won’t be able to view Advanced Data Analysis images or download files."},imageLicenseDisclaimer:{id:"sharingModal.imageLicenseDisclaimer",defaultMessage:"Only use images you have confirmed you have the license to use."},screenshotDisclaimer:{id:"sharingModal.screenshotDisclaimer",defaultMessage:"Screenshots may contain sensitive information."},copying:{id:"thread.sharingModal.copying",defaultMessage:"Copying..."},failedToCopyLink:{id:"thread.sharingModal.failedToCopyLink",defaultMessage:"Failed to copy link to clipboard"},failedToDeleteSharedLink:{id:"thread.sharingModal.failedToDeleteSharedLink",defaultMessage:"Failed to delete shared link"},plusProjectDescription:{id:"sharingModal.plusProjectDescription",defaultMessage:"Your name, uploaded files, custom instructions, and any messages you add after sharing stay private."},enterpriseProjectDescription:{id:"sharingModal.enterpriseProjectDescription",defaultMessage:"Any messages you add after sharing will be visible to members of your workspace. Project files and custom instructions won’t be accessible via the shared link."}}),ts=e.jsx(a,{id:"HuCdJn",defaultMessage:"This conversation may include personal information."}),as=e.jsx(a,{id:"AEHBcL",defaultMessage:"Take a moment to check the content before sharing the link."});function hs({serverThreadId:s}){const o=Ce(s),m=K(s)!=null?k.getCurrentNode(K(s)).message.id:o?.current_node,[l]=c.useState(()=>Je()),h=!Le()&&m,[I,v]=c.useState(!0),M=c.useRef(!1);return c.useEffect(()=>{h&&(M.current||(M.current=!0,se.safePost("/share/create",{requestBody:{current_node_id:m,conversation_id:s,is_anonymous:!0}}).then(i=>{l.setState({shareLinkId:i.share_id,shareLinkUrl:i.share_url,isPublic:i.is_public,isDeleted:!i.is_visible,title:i.title,highlightedMessageId:i.highlighted_message_id??void 0,initiallyHighlightedMessageId:i.highlighted_message_id??void 0,currentNodeId:i.current_node_id,linkAlreadyExisted:i.already_exists,linkAlreadyPublic:i.is_public,isAnonymous:i.is_anonymous,isDiscoverable:i.is_discoverable,canDisableDiscoverability:i.can_disable_discoverability,moderationState:i.moderation_state??void 0,piiDetected:i.pii_detected??!1})}).catch(i=>{const f=te(i);f?l.setState({linkError:f}):ae.closeSharingModal()}).finally(()=>{v(!1)})))},[h]),e.jsx(O.Provider,{value:l,children:e.jsx(os,{serverThreadId:s,isLoading:I})})}function Q(s){return s.has_been_auto_blocked===!0||s.has_been_auto_moderated===!0||s.has_been_blocked===!0}const is="https://help.openai.com/en/articles/7925741-chatgpt-shared-links-faq",ns="https://help.openai.com/en/articles/8474715-chatgpt-enterprise-shared-links-faq";function os({serverThreadId:s,isLoading:o}){const m=Ue(),l=ve(),[_,h]=c.useState(!1),[I,v]=c.useState(!1),[M,i]=c.useState(!1),f=Fe(),C=c.useContext(O),L=Xe(),p=Ke(),ie=Ze(),j=Ve(),z=b(t=>t.linkError),D=b(t=>t.moderationState),ne=D!=null&&Q(D),oe=b(t=>t.piiDetected),N=He(qe.isBusinessWorkspace),[Y,re,le,de,ce]=Z(s,t=>[k.getCurrentNode(t),k.hasUserContextPrompt(t),k.hasModelEditableContext(t),k.findNode(t,n=>ss(n.message))!=null,k.getGizmoId(t)]),ue=Y?.message.id,T=De(ce),$=Z(s,t=>t?k.getConversationTurns(t).flatMap(n=>n.messages):[]),{hasImage:G,hasScreenshot:W}=c.useMemo(()=>{let t=!1,n=!1;const u=/(\.jpe?g|\.png|\.gif|\.webp|\.bmp|\.tiff)$/i;return $.forEach(F=>{const x=F.metadata;if(!x)return;const S=A=>{if(Array.isArray(A)){for(const r of A)if(r.type==="image_inline"&&r.clicked_from_url&&(n=!0),r.type==="file"&&"file_name"in r){const y=r.file_name?.toLowerCase?.()??"";(y.endsWith(".pptx")||u.test(y))&&(t=!0)}}};S(Object.values(x.n7jupd_crefs_by_file??{}).flat()),S(Object.values(x.content_references_by_file??{}).flat()),S([...x.n7jupd_crefs??[],...x.content_references??[]])}),{hasImage:t,hasScreenshot:n}},[$]),ge=Oe(m,"1547743984").get("show_copylink_state_if_no_updates",!1),J=re||le;if(o)return e.jsx(V,{isOpen:!0,testId:"modal-sharing",onClose:ze,size:"custom",className:"max-w-[550px]",type:"success",showCloseButton:!0,children:e.jsx("div",{className:"flex h-full items-center justify-center py-4",children:e.jsx(Ye,{className:"icon text-token-text-secondary"})})});const he=async(t,n,u)=>{const{highlightedMessageId:F,title:x,isDeleted:S,isAnonymous:A}=C.getState();try{X(n,f,u)}catch{f.danger(g.failedToCopyLink,{toastId:"failed_to_copy_link"}),h(!1);return}if(M){try{X(n,f,u)}catch{f.danger(g.failedToCopyLink,{toastId:"failed_to_copy_link"});return}v(!0),setTimeout(()=>{v(!1)},1500);return}h(!0);try{const{moderation_state:r,is_discoverable:y,can_disable_discoverability:_e}=await se.safePatch("/share/{shared_conversation_id}",{parameters:{path:{shared_conversation_id:t}},requestBody:{highlighted_message_id:F,title:x??void 0,is_public:!S,is_visible:!S,is_anonymous:A,current_node_id:Y?.message.id}});if(Q(r)){C.setState({moderationState:r});return}C.setState({isPublic:!0,moderationState:r,isDiscoverable:y??void 0,canDisableDiscoverability:_e}),v(!0),setTimeout(()=>{v(!1)},1500)}catch(r){const y=te(r);y&&C.setState({linkError:y})}finally{h(!1)}i(!0)},d=M||N&&j||j&&ie===ue&&ge;function me(){ae.closeSharingModal()}const fe=()=>{let t,n;return N?(t=e.jsx(a,{id:"IR+p6G",defaultMessage:"Share link to chat"}),n=T?l.formatMessage(g.enterpriseProjectDescription):e.jsx(a,{id:"ZKoPTp",defaultMessage:"Any messages you add after sharing will be visible to members of your workspace."}),d&&(t=e.jsx(a,{id:"AX5quN",defaultMessage:"Link created"}),n=e.jsx(a,{id:"OmpNr/",defaultMessage:"A link to your chat has been created. Manage previously shared chats at any time via <settingsLink>Settings</settingsLink>.",values:{settingsLink:u=>e.jsx(E,{to:P(R.DataControls),className:"underline",children:u})}})),{modalTitle:t,modalDescription:ee(n,G,W)}):(d?j?(t=e.jsx(a,{id:"DD6oDE",defaultMessage:"Public link updated"}),n=e.jsx(a,{id:"sJl/nl",defaultMessage:"The public link to your chat has been updated. Manage previously shared chats via <settingsLink>Settings</settingsLink>.",values:{settingsLink:u=>e.jsx(E,{to:P(R.DataControls),className:"underline",children:u})}})):(t=e.jsx(a,{id:"7xzg3Y",defaultMessage:"Public link created"}),n=e.jsx(a,{id:"LZ5EAo",defaultMessage:"A public link to your chat has been created. Manage previously shared chats at any time via <settingsLink>Settings</settingsLink>.",values:{settingsLink:u=>e.jsx(E,{to:P(R.DataControls),className:"underline",children:u})}})):j?(t=e.jsx(a,{id:"FyIlHR",defaultMessage:"Update public link to chat"}),n=T?l.formatMessage(g.plusProjectDescription):J?e.jsx(a,{id:"091Z/H",defaultMessage:"Your name, custom instructions, and any messages you add after sharing stay private."}):e.jsx(a,{id:"U7wOdx",defaultMessage:"Your name and any messages you add after sharing stay private."})):(t=e.jsx(a,{id:"xgkjrq",defaultMessage:"Share public link to chat"}),n=T?l.formatMessage(g.plusProjectDescription):J?e.jsx(a,{id:"091Z/H",defaultMessage:"Your name, custom instructions, and any messages you add after sharing stay private."}):e.jsx(a,{id:"U7wOdx",defaultMessage:"Your name and any messages you add after sharing stay private."})),{modalTitle:t,modalDescription:ee(n,G,W)})},pe=()=>_?e.jsx(a,{...g.copying}):I?e.jsx(a,{id:"zMndTF",defaultMessage:"Copied"}):d?e.jsx(a,{id:"F+gzqW",defaultMessage:"Copy link"}):j?e.jsx(a,{id:"SviHx3",defaultMessage:"Update link"}):e.jsx(a,{id:"Ns/mpl",defaultMessage:"Create link"}),{modalTitle:xe,modalDescription:ye}=fe(),B=pe(),ke=e.jsx($e.Button,{onClick:t=>he(L,p,t),color:"primary",disabled:_||I||L==null||p==null||z!=null||ne,className:"ms-4 me-0 mt-0 rounded-full px-4 py-1 text-base font-bold sm:py-3",loading:_,icon:d?Ie:Ne,"data-testid":B.props.defaultMessage==="Create link"?"create-link-shared-chat-button":B.props.defaultMessage==="Copied"?"copied-shared-chat-button":void 0,children:B});let w=z;w==null&&(D?.has_been_auto_blocked||D?.has_been_auto_moderated||D?.has_been_blocked)&&(w=e.jsx(a,{...g.moderationBlocked}));const be=d?p:window.location.origin+"/share/…",U=C.getState().title??"My ChatGPT conversation";return e.jsxs(V,{isOpen:!0,testId:"modal-sharing",onClose:()=>{me()},size:"custom",className:"max-w-[550px]",type:"success",title:xe,showCloseButton:!0,children:[oe&&e.jsx("div",{className:"mb-4",children:e.jsx(we,{title:ts,content:as,icon:e.jsx(Ge,{"aria-hidden":!0}),type:"info"})}),w!=null&&e.jsx("div",{className:"mb-4 rounded-md bg-red-500 p-4 text-white",children:w}),e.jsx("div",{className:"w-full",children:e.jsx("p",{className:"text-token-text-secondary mb-6",children:e.jsxs("span",{children:[ye," ",!d&&e.jsx("a",{href:N?ns:is,className:"text-token-text-secondary hover:text-token-text-tertiary inline-flex items-center gap-2 underline",target:"_blank",rel:"noreferrer",children:e.jsx(a,{id:"TKNIin",defaultMessage:"Learn more"})})]})})}),!d&&e.jsx(rs,{shouldShowCodeInterpreterDisclaimer:de}),e.jsxs("div",{className:"border-token-border-medium bg-token-main-surface-primary text-token-text-secondary has-focus-visible:border-token-border-xheavy mb-2 flex items-center justify-between rounded-full border p-1.5 last:mb-2 sm:p-2",children:[e.jsxs("div",{className:"relative ms-1 grow",children:[e.jsx("input",{type:"text",readOnly:!0,value:be,disabled:!d,className:We("bg-token-main-surface-primary w-full rounded-xl border-0 px-2 py-1 text-lg focus:ring-0 sm:py-2.5",d?"text-token-text-primary":"text-token-text-tertiary")}),e.jsx("div",{className:"from-token-main-surface-primary pointer-events-none absolute end-0 top-0 bottom-0 w-12 bg-linear-to-l"})]}),ke]}),j&&!d&&e.jsx("div",{className:"w-full",children:e.jsx("p",{className:"text-token-text-tertiary mb-3 text-sm",children:e.jsx(a,{id:"A9Jgr5",defaultMessage:"A past version of this chat has already been shared. Manage previously shared chats via <settingsLink>Settings</settingsLink>.",values:{settingsLink:t=>e.jsx(E,{to:P(R.DataControls),className:"underline",children:t})}})})}),!N&&d&&p&&e.jsxs("div",{className:"mt-6 flex justify-center space-x-14",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(p)}&text=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{H.logEvent("Share Public Chat: LinkedIn Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","linkedin")},children:e.jsx(Ae,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"YtW6Uh",defaultMessage:"LinkedIn"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://www.reddit.com/submit?url=${encodeURIComponent(p)}&title=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{H.logEvent("Share Public Chat: Reddit Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","reddit")},children:e.jsx(Ee,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"VLrIK1",defaultMessage:"Reddit"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(p)}&text=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{H.logEvent("Share Public Chat: X Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","x")},children:e.jsx(Pe,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"CgECe/",defaultMessage:"X"})})]})]})]})}const rs=({shouldShowCodeInterpreterDisclaimer:s})=>e.jsx(e.Fragment,{children:s&&e.jsx(ls,{icon:Re,children:e.jsx(a,{id:"iEl3pV",defaultMessage:"Images and files in this chat won't be shown in the public link."})})}),ls=({children:s,icon:o})=>e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-secondary mb-4 flex items-center justify-between rounded-2xl p-4 last:mb-0",children:[s,o!=null&&e.jsx(o,{className:"icon-sm mt-1 shrink-0"})]});function ee(s,o,m){const l=[];return m&&l.push(e.jsx(a,{...g.screenshotDisclaimer},"screenshot-note")),o&&l.push(e.jsx(a,{...g.imageLicenseDisclaimer},"image-note")),l.length?e.jsxs(e.Fragment,{children:[s,l.map((_,h)=>e.jsxs(Se.Fragment,{children:[e.jsx(e.Fragment,{children:" "}),_]},h))]}):s}export{is as SHARED_LINKS_HELP_URL,hs as default};
//# sourceMappingURL=nmmsxdf0waqa1s58.js.map
