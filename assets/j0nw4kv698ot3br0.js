import{nw as v,nx as x,ny as T,nz as y,jA as b,nA as w}from"./g670b8vtkhx0yc6d.js";import{N as h}from"./f76gy0b8ieo4s693.js";class C extends h{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:r,schema:e,attrs:t}){return v(r,e,t)}proseMirrorNodeToUnistNodes(r){return[{type:this.unistNodeName(),value:r.text??""}]}}class p{constructor(r,e,t={}){this.match=r,this.match=r,this.handler=typeof e=="string"?R(e):e,this.undoable=t.undoable!==!1,this.inCode=t.inCode||!1}}function R(s){return function(r,e,t,o){let n=s;if(e[1]){let i=e[0].lastIndexOf(e[1]);n+=e[0].slice(i+e[1].length),t+=i;let l=t-o;l>0&&(n=e[0].slice(i-l,i)+n,t=o)}return r.tr.insertText(n,t,o)}}const $=500;function I({rules:s}){let r=new x({state:{init(){return null},apply(e,t){let o=e.getMeta(this);return o||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,o,n){return m(e,t,o,n,s,r)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&m(e,t.pos,t.pos,"",s,r)})}}},isInputRules:!0});return r}function m(s,r,e,t,o,n){if(s.composing)return!1;let i=s.state,l=i.doc.resolve(r),d=l.parent.textBetween(Math.max(0,l.parentOffset-$),l.parentOffset,null,"￼")+t;for(let a=0;a<o.length;a++){let u=o[a];if(l.parent.type.spec.code){if(!u.inCode)continue}else if(u.inCode==="only")continue;let c=u.match.exec(d),f=c&&u.handler(i,c,r-(c[0].length-t.length),e);if(f)return u.undoable&&f.setMeta(n,{transform:f,from:r,to:e,text:t}),s.dispatch(f),!0}return!1}new p(/--$/,"—");new p(/\.\.\.$/,"…");new p(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new p(/"$/,"”");new p(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new p(/'$/,"’");function D(s,r,e=null,t){return new p(s,(o,n,i,l)=>{let d=e instanceof Function?e(n):e,a=o.tr.delete(i,l),u=a.doc.resolve(i),c=u.blockRange(),f=c&&T(c,r,d);if(!f)return null;a.wrap(c,f);let g=a.doc.resolve(i-1).nodeBefore;return g&&g.type==r&&y(a.doc,i-1)&&(!t||t(n,g))&&a.join(i-1),a})}function A(s,r,e=null){return new p(s,(t,o,n,i)=>{let l=t.doc.resolve(n),d=e instanceof Function?e(o):e;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),r)?t.tr.delete(n,i).setBlockType(n,n,r,d):null})}function M(s,r,e,t={}){if(s==null)return null;const o=(Array.isArray(e)?e:[e]).filter(b),n=r.nodes[s].createAndFill(t,o);return n??null}const P={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},k="paragraph";class O extends h{unistNodeName(){return k}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return P}unistNodeToProseMirrorNodes({schema:r,convertedChildren:e,attrs:t}){return M(this.proseMirrorNodeName(),r,e,t)}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),children:e}]}}class N extends h{static isAtStart(r,e){return r.selection.empty?e!==void 0?e.endOfTextblock("backward",r):r.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(r,e,t){return(o,n,i)=>{if(t&&!N.isAtStart(o,i))return!1;const{$anchor:l}=o.selection,d=l.parent;if(d.type.name!=="heading")return!1;const a=d.attrs.level+e;if(a<0||a>6)return!1;if(n===void 0)return!0;const u=l.before(l.depth);return a>0?n(o.tr.setNodeMarkup(u,void 0,{level:a})):n(o.tr.setNodeMarkup(u,r.nodes.paragraph)),!0}}dependencies(){return[new O,new C]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(r){return["h"+r.attrs.level.toString(),0]}}}proseMirrorInputRules(r){return[A(/^\s{0,3}(#{1,6})\s$/,r.nodes[this.proseMirrorNodeName()],e=>({level:e[1].length}))]}proseMirrorKeymap(r){const e={Tab:N.headingLevelCommandBuilder(r,1,!1),"#":N.headingLevelCommandBuilder(r,1,!0),"Shift-Tab":N.headingLevelCommandBuilder(r,-1,!1)};for(let t=1;t<=6;t++)e[`Shift-Mod-${t.toString()}`]=w(r.nodes[this.proseMirrorNodeName()],{level:t});return e}unistNodeToProseMirrorNodes({node:r,schema:e,convertedChildren:t,attrs:o}){const{depth:n}=r;return M(this.proseMirrorNodeName(),e,t,{...o,level:n})}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),depth:r.attrs.level,children:e}]}}class E extends h{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:r,convertedChildren:e,attrs:t}){return M(this.proseMirrorNodeName(),r,e,t)}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),children:e}]}}export{N as H,p as I,O as P,E as R,C as T,P as a,k as b,M as c,I as i,A as t,D as w};
//# sourceMappingURL=j0nw4kv698ot3br0.js.map
