import{j as e,b as W,l as L,h as H,r,M as w,A as O,m as D,L as B,ai as y,u as U}from"./gg0tb34p9fzo1omt.js";import{iV as z,bP as V,e3 as Q,hi as q}from"./forbprkns1cohsbl.js";import{d as N,m as E,c6 as G,bg as _,ck as K,j3 as Z,jp as $,nC as J,bU as X,kv as Y,G as ee,dZ as se,gE as te,n5 as ae,ho as ne,n6 as re,a as P,ic as oe,n7 as ie}from"./g670b8vtkhx0yc6d.js";import{b as ce}from"./dkpt9rl3nmxrd3k2.js";import{W as le}from"./ii534sx9kl9dq5ip.js";import{b as de,a as me,c as he,h as ue}from"./gltmx7p7ryx2z3jy.js";import{W as xe}from"./lv749h5qyvjegoog.js";import{a as fe}from"./jgs7169reknaons9.js";import{j as f,k as ge,y as pe,t as ke,z as ve}from"./nir0q9e2l94u37hi.js";import{S as je}from"./ksqri1osv1y7da34.js";import{I as be}from"./mu0w85wyyiji3bj8.js";import{W as we,a as Te,S as Se}from"./ds557awgotgdm7n4.js";import{u as Ce}from"./eqymi4bdej7dbca6.js";import{W as ye}from"./lq61ygipep4zgxzl.js";function Ne({disabled:a,children:o}){return a?e.jsx("div",{className:"pointer-events-none opacity-50 select-none","aria-hidden":"true",tabIndex:-1,inert:!0,children:o}):o}function Ee(){const a=W(),o=f(({tasksFilter:d})=>d),u=f(({setTasksFilter:d})=>d),g=N(),m=L(),x=H(),i=E(g,"2665240312"),l=r.useCallback(d=>{u(d);const k=new URLSearchParams(m.search);k.set("tab",d==="archived"?"archived":"all"),x({pathname:m.pathname,search:k.toString()},{replace:!0})},[u,m,x]);return e.jsx("div",{className:"border-token-border-primary mt-4 flex w-full items-center border-b align-middle md:mt-6",children:i&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(fe,{currentTab:o,onChange:l,withUnderline:!0,tabs:[{label:a.formatMessage({id:"wham.whamTasksHeader.all",defaultMessage:"Tasks"}),ariaLabel:a.formatMessage({id:"wham.whamTasksHeader.allAriaLabel",defaultMessage:"Tab selector to view all tasks"}),key:"current"},{label:a.formatMessage({id:"wham.whamTasksHeader.archived",defaultMessage:"Archive"}),ariaLabel:a.formatMessage({id:"wham.whamTasksHeader.archivedAriaLabel",defaultMessage:"Tab selector to view archived tasks"}),key:"archived"}]})})})}function Me(){const a=W(),o=f(({tasksFilter:c})=>c),{data:u,isLoading:g,error:m,fetchNextPage:x,hasNextPage:i,isFetchingNextPage:l,refetch:d,isPending:k}=ge({refetchOnMount:!0,refetchOnWindowFocus:!0}),n=u?.pages.flatMap(c=>c.items??[])??[],T=f(c=>c.pendingTaskIds),S=n.length>0,[j,v]=r.useState(null),p=o==="archived"?[]:Array.from(Object.entries(T)).filter(([c,t])=>!n.some(C=>C.id===t)).map(([c])=>c).reverse(),M=n.length===0&&p.length===0;return e.jsx("div",{className:"flex flex-col justify-center",children:g&&!S?e.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:e.jsx(G,{})}):e.jsxs(e.Fragment,{children:[M&&e.jsx(e.Fragment,{children:m?e.jsxs("div",{className:"mt-6 flex w-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(w,{id:"wham.whamTasksSection.errorLoadingTasks",defaultMessage:"Error loading tasks"})}),e.jsx(_,{color:"secondary",onClick:()=>d(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{id:"wham.whamTasksSection.retry",defaultMessage:"Retry"}),e.jsx(je,{className:"icon-xs"})]})})]}):e.jsx("div",{className:"mt-6 flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"text-token-text-secondary text-sm",children:o==="current"?a.formatMessage({id:"wham.whamTasksSection.noActiveTasks",defaultMessage:"No active tasks"}):a.formatMessage({id:"wham.whamTasksSection.noArchivedTasks",defaultMessage:"No archived tasks"})})})}),o!=="archived"&&p.map(c=>e.jsx(we,{},c)),n.map((c,t)=>e.jsx(Te,{index:t,taskListItem:c,hoveredIndex:j,onMouseEnter:()=>{v(t)},onMouseLeave:()=>v(null)},c.id)),e.jsx(be,{isFetchingNextPage:l||k,hasNextPage:i??!1,fetchNextPage:x})]})})}const Pe=r.memo(Me);function We(){const a=N();return E(a,"3984934927")}function Le(){const{eligible:a,markAsViewed:o}=z(),{data:u,isLoading:g}=pe(),m=u??!1,x=K(),i=Z(),l=r.useMemo(()=>[{id:"step-1",link:"/codex/settings/environment/create",checked:!0,label:e.jsx(w,{id:"codex.onboarding.step-1",defaultMessage:"Set up your first environment"})},{id:"step-2",checked:m,label:e.jsx(w,{id:"codex.onboarding.step-2",defaultMessage:"Create your first task"})}],[m]),d=l.every(n=>n.checked);r.useEffect(()=>{d&&o()},[d,o]);const k=x||!a||g||d;return e.jsx(O,{children:k?null:e.jsx(D.div,{className:"fixed end-6 bottom-6 z-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:i?1e-5:.5},children:e.jsxs("div",{className:"bg-token-bg-primary border-token-border-default flex w-[272px] flex-col gap-4 rounded-xl border p-4 shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(w,{id:"k3HHpd",defaultMessage:"Finish setting up Codex"})})}),e.jsx("div",{className:"flex flex-col gap-3",children:l.map((n,T)=>{const S=!n.checked&&l.filter(v=>!v.checked).length===1&&l.findIndex(v=>!v.checked)===T,j=e.jsxs("div",{className:"flex items-start gap-3 select-none",children:[e.jsx("div",{className:"mt-0.5",children:n.checked?e.jsx($,{className:"icon text-token-text-tertiary"}):e.jsx(J,{className:"icon text-token-text-tertiary"})}),e.jsx("span",{className:X("text-sm",n.checked?"text-token-text-tertiary line-through":"text-token-text-primary"),children:n.label}),n.link&&!n.checked&&e.jsx(Se,{className:"icon text-token-text-primary"})]},n.id);return n.link&&!n.checked?e.jsx(B,{to:n.link,onClick:()=>{S&&o()},children:j},n.id):j})})]})})})}function Ke(){const a=N(),o=Y(),u=We(),g=ee(a),{eligible:m}=V(),x=Q();Ce();const i=E(a,"547652119");return f(l=>l.showReactQueryDevtools),o?i?e.jsx(y,{to:"/codex/failwhale"}):x==="DISABLED"?e.jsx(y,{to:"/",replace:!0}):m?e.jsx(y,{to:"/codex/onboarding"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{page:"codex"},g?.getWorkspaceId()),!1,e.jsx(ce,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(me,{children:e.jsx(he,{hideNotificationBell:!0})}),e.jsx(se,{children:e.jsx(Re,{})})]})})]}):u?e.jsx(de,{}):e.jsx(y,{to:"/"})}const Re=()=>{const a=f(({setPromptDraft:s})=>s),o=f(({setTasksFilter:s})=>s),u=f(s=>s.setEnvironmentId),g=f(s=>s.setBranch),m=U(),{data:x}=ke(),i=L(),l=f(s=>s.lastViewedTaskId),[d,k]=r.useState(l?!1:void 0),[n]=r.useState(!!l),[T,S]=r.useState(!1),j=r.useRef(null),v=N(),p=E(v,"1406552515"),M=f(({promptDraft:s})=>s),c=te(),t=r.useMemo(()=>c?new ne(re(),{isExpanded:!l}):new ae,[c,l]),C=r.useRef(!1);r.useEffect(()=>{m.prefetchInfiniteQuery(ve("archived"))},[m]),r.useEffect(()=>{i.state?.focusComposer&&!C.current&&!p&&(t.focus(),C.current=!0)},[i.state?.focusComposer,t,p]),r.useEffect(()=>{t.setText(p?"":M)},[t,p]);const R=r.useRef(null),I=P(t.store,({isFocused:s})=>s),F=P(t.store,({isExpanded:s})=>s);oe(()=>{const s=j.current;if(!s)return;const h=()=>{const b=s.scrollTop>0;S(b),k(void 0)};return s.addEventListener("scroll",h),()=>s.removeEventListener("scroll",h)},[F,I,t]),r.useEffect(()=>t.subscribe("change",()=>{a(t.getContentToSend().content)}),[t,a]),r.useEffect(()=>t.subscribe("focus",()=>{k(void 0)}),[t]),r.useEffect(()=>{const s=new URLSearchParams(i.search),h=s.get("prompt");h&&t.setText(h);const b=s.get("tab");b==="archived"?o("archived"):b==="all"&&o("current")},[i.search,t,o]),r.useEffect(()=>{const h=new URLSearchParams(i.search).get("environment");h&&x?.some(b=>b.id===h)&&u(h)},[i.search,x,u]),r.useEffect(()=>{const h=new URLSearchParams(i.search).get("branch");h&&g(h)},[i.search,g]);const A=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-full w-full overflow-y-auto",ref:j,style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"z-0 mx-auto flex w-full flex-col md:w-3xl",children:[e.jsx(xe,{}),e.jsxs("div",{className:"bg-token-bg-primary sticky top-0 z-50 flex flex-col items-center",children:[e.jsx("h1",{className:"mb-4 pt-4 text-2xl 2xl:mb-8 2xl:pt-8 2xl:text-3xl [@media(max-height:550px)]:hidden",children:e.jsx(w,{id:"wham.home.title",defaultMessage:"What should we code next?"})}),e.jsx("div",{ref:R,className:"w-full pt-px max-md:px-3",children:e.jsx(Ne,{disabled:p,children:e.jsx(le,{disableAutoFocus:n||p,expanded:d??(T?void 0:!0),isBigBoxMode:!p,onSubmit:()=>{t.eraseContent(),a("")},onSuccess:()=>{ue.set(s=>s+1)}})})}),e.jsx(Ee,{})]}),e.jsx(Pe,{})]})}),e.jsx(Le,{})]});return e.jsx(ie.Provider,{value:t,children:e.jsx(ye,{children:A})})};export{Ke as W};
//# sourceMappingURL=mrr2c2ctj9tx5a9u.js.map
