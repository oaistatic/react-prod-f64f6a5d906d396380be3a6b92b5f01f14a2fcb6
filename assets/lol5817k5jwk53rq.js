import{r as m,j as o,A as w,M as g}from"./gg0tb34p9fzo1omt.js";import{a7 as E,dN as T,l9 as N,a4 as D,a3 as U,P as C,bU as F,h as S}from"./g670b8vtkhx0yc6d.js";import{bb as A,bc as k,bd as $,be as L,bf as M,bg as O,bh as W,bi as P}from"./forbprkns1cohsbl.js";import{F as z}from"./lddrj8r4o5uu22o6.js";function b(t,e){const l=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),d=t.match(l);return d&&d[1]?d[1].trim():t}function B(t){if(t===void 0)return;const e="Content Snippet:",l=t.indexOf(e);return l===-1?t:t.substring(l+e.length).trim()}function G(t,e){e.text=B(t.contents),t.documentId?.includes("ks--slack")||e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=b(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=b(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=b(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function Q({turnIndex:t,clientThreadId:e}){const[l,d]=E(e,i=>[S.getTurnContentReferences(i,t),S.getConversationTurnAtIndex(i,t).messages]),f=T(e),r=m.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),x=m.useMemo(()=>{const i=[],n=new Set;return l.forEach(s=>{s.type==="file"&&!n.has(s.id)?(i.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text}),n.add(s.id)):s.type==="file_navlist"&&s.items.forEach(u=>{n.has(u.id)||(i.push({name:u.name,cloud_doc_url:u.cloud_doc_url,text:u.description,id:u.id,lastModifiedTime:u.last_modified_time}),n.add(u.id))})}),i},[l]),c=N(f),p=m.useMemo(()=>{if(!c)return[];const i=[],n=new Set;for(const s of d)if(s.author.role===D.Tool&&s.author.name==="file_search"&&s.content.content_type===U.TetherBrowsingDisplay){const u=A(s.content.result),h=s.metadata?.cloud_doc_urls??[];u.chunks.forEach((a,v)=>{if(!a.documentId||n.has(a.documentId))return;n.add(a.documentId);let _;a.metadata.cloud_doc_url?_=a.metadata.cloud_doc_url.toString():v<h.length?_=h[v]:a.documentId.endsWith("--google")&&(_=`https://drive.google.com/file/d/${a.documentId.split("--")[1]}`);const y=a.metadata["File last modified at"]??a.metadata["File created at"],j={id:a.documentId,name:a.title,cloud_doc_url:_,text:a.contents,lastModifiedTime:y?y.toString():void 0};G(a,j),i.push(j)})}return i},[c,d]);return o.jsx(w,{children:o.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[o.jsx(I,{title:o.jsx(g,{id:"dlVlo6",defaultMessage:"Citations"}),items:x,clientThreadId:e,sectionId:"citations",analyticsMetadata:r}),o.jsx(I,{title:o.jsx(g,{id:"njZblE",defaultMessage:"Search Results"}),items:p,clientThreadId:e,sectionId:"search-results",analyticsMetadata:r})]})})}function I({title:t,items:e,scrollToHeader:l,shouldAnimateScroll:d,clientThreadId:f,analyticsMetadata:r,sectionId:x}){const c=m.useRef(null),p=m.useMemo(()=>r?{...r,sectionId:x,numResultsInSection:e.length}:void 0,[r,e.length,x]);return m.useEffect(()=>{c.current&&l&&setTimeout(()=>{c.current&&c.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[l,d]),!e||e.length===0?null:o.jsxs("div",{ref:c,children:[o.jsx(k,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),o.jsx("div",{className:"flex list-none flex-col px-3 py-2",children:e.map((i,n)=>o.jsx(k,{index:n,children:o.jsx(V,{positionInSection:n,item:i,analyticsMetadata:p,clientThreadId:f},n)},`${t}-${n}`))})]})}function V({item:t,analyticsMetadata:e,positionInSection:l,clientThreadId:d}){const f=$(),r=L(t.cloud_doc_url??"");let x=r?.type??o.jsx(g,{id:"bqY3sN",defaultMessage:"File"}),c=r?.Icon??(t.cloud_doc_url?M:O);!t.cloud_doc_url&&!W(t.id)&&(x=o.jsx(g,{id:"hGgoxF",defaultMessage:"Source"}),c=M);const[p,i]=m.useState(!1),n=m.useCallback(()=>{e&&C.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:l,sourceType:r?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,r?.type,l]),s=m.useCallback(()=>{e&&C.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...e,positionInSection:l,sourceType:r?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,r?.type,l]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:n,className:F("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",p&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[c&&o.jsx(c,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),x]}),o.jsx("div",{className:"line-clamp-2 text-sm font-semibold break-words",children:t.name}),(t.text??t.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(P,{date:new Date(t.lastModifiedTime)}),t.text&&" â€” "]}),t.text]}),f?null:o.jsx(z,{className:F("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",p&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:p,setIsFollowupMenuOpen:i,trackFileSourceFollowup:s})]})})}export{Q as ChatScreenRetrievalResultsFlyoutContent,I as SourcesListGroup};
//# sourceMappingURL=lol5817k5jwk53rq.js.map
