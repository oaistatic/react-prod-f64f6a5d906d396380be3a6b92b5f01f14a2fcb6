import{r as d,j as e,g as ve,b as te,m as $,A as Q}from"./gg0tb34p9fzo1omt.js";import{ic as ge,dw as q,h as G,j as Y,dU as je,c6 as se,be as ne,c5 as ye,bU as oe,a2 as be,bg as Ce}from"./g670b8vtkhx0yc6d.js";import{W as Me}from"./hsr6nqstg4abtqru.js";import{is as we,it as Se,cV as ke,hB as S,iu as Ne,ap as De,iv as ae,hC as Ie,i2 as z,bv as T,iw as _e,ix as $e,iy as W,iz as Ee,i8 as Oe}from"./forbprkns1cohsbl.js";import{S as Ve}from"./je4q4vopywnye8lt.js";import{u as Ae,g as Te}from"./jhjkuez66hdb5deb.js";import{u as Be,g as Fe}from"./bj0vu1nj07afex4q.js";import{r as Pe}from"./gomrh6779xe4lvq3.js";import Ue from"./b07550145r5z9uf7.js";import"./k5ngqk6bkqja3f09.js";import"./hecirjrcp1pgfsfa.js";import"./h431y4zi2z7ivdmh.js";import"./jnwbhjiq0zuf26x3.js";import"./oqyy1xfq5y51tstr.js";import"./foly6q6x9dui805g.js";function We(s,t){const a={},i=(n,r="")=>{Object.entries(n).forEach(([h,v])=>{const m=r?`${r}.${h}`:h;v&&typeof v=="object"&&!Array.isArray(v)?i(v,m):v&&(typeof v=="number"||typeof v=="string"||v==null)&&(a[m]=v)})};i(s);const c={},l=n=>c[n]||={},f=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(a).forEach(n=>{const r=a[n];if(r==null)return;const h=n.split(".").pop(),v=[[/^(.*)_start_time$/,"start",m=>m[1]],[/^(.*)_end_time$/,"end",m=>m[1]],[/^(.*)_sent_time$/,"start",m=>m[1]],[/^(.*)_success_time$/,"end",m=>m[1]],[/^(.*)_time$/,"start",m=>m[1]]];for(const[m,D,b]of v){const C=h.match(m);if(C){const g=b(C),B=l(g);B[D]=f(r);break}}});const u=[];Object.entries(c).forEach(([n,{start:r,end:h}])=>{r!==void 0&&h!==void 0?u.push({name:n,start:r,end:h,duration:h-r}):r!==void 0&&u.push({name:n,start:r,end:r,duration:0,noEnd:!0})});let x=u;if(t&&t.length){const n=new Set(t);x=x.filter(r=>n.has(r.name))}return x.sort((n,r)=>n.start-r.start||n.name.localeCompare(r.name)),x}const H=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],Le=({json:s,focusNames:t,width:a,barHeight:i=18,rowGap:c=6,paddingX:l=50,paddingTop:f=20})=>{const u=d.useRef(null),[x,n]=d.useState(a||600);ge(()=>{if(!a){const o=()=>{if(u.current){const p=u.current.clientWidth;n(Math.max(300,p))}};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)}},[a]);const r=d.useMemo(()=>We(s,t),[s,t]),[h,v]=d.useState({}),m=d.useCallback(o=>h[o]!==!1,[h]),D=d.useCallback(o=>v(p=>({...p,[o]:p[o]===!1})),[]),b=d.useMemo(()=>r.filter(o=>m(o.name)),[r,m]),C=b.length>0,g=C?Math.min(...b.map(o=>o.start)):0,B=C?Math.max(...b.map(o=>o.end)):1,I=Math.max(B-g,1),F=f+r.length*(i+c)+c+32,ce=(r.length?Math.max(...r.map(o=>o.name.length)):0)*7+16+16,E=Math.max(l,ce),le=l,P=(x-E-le)/I,[de,J]=d.useState(null),[O,X]=d.useState({visible:!1,x:0,y:0,lines:[]}),Z=(o,p)=>{if(!u.current)return;const j=u.current.getBoundingClientRect(),y=p.clientX-j.left,V=p.clientY-j.top,N=(o.start-g).toFixed(2),_=o.noEnd?void 0:(o.end-g).toFixed(2),U=_?[`start: ${N} ms`,`end: ${_} ms`,`dur: ${o.duration.toFixed(2)} ms`]:[`start: ${N} ms`];X({visible:!0,x:y+10,y:V+10,lines:U})},ue=()=>X(o=>({...o,visible:!1})),me=d.useMemo(()=>{if(!C)return[0,I];const o=new Set;b.forEach(j=>{o.add(j.start-g),o.add(j.end-g)});const p=Array.from(o).sort((j,y)=>j-y);return p[0]!==0&&p.unshift(0),p[p.length-1]!==I&&p.push(I),p},[b,g,I,C]);return e.jsxs("div",{ref:u,className:"relative w-full",style:a?{width:`${a}px`}:void 0,children:[e.jsxs("svg",{width:x,height:F,className:"font-sans",children:[r.map((o,p)=>{const j=f+p*(i+c),y=m(o.name)?E+(o.start-g)*P:0,V=m(o.name)?Math.max(o.duration*P,1):0,N=H[p%H.length],_=de===p?"opacity-80":"opacity-100",U=o.duration===0,K=!!o.noEnd,xe=w=>{m(o.name)&&(J(p),Z(o,w))},pe=w=>{m(o.name)&&Z(o,w)},fe=()=>{J(null),ue()};return e.jsxs("g",{onMouseEnter:xe,onMouseMove:pe,onMouseLeave:fe,children:[e.jsx("foreignObject",{x:0,y:j,width:E-8,height:i,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:m(o.name),onChange:()=>D(o.name),className:"cursor-pointer"}),e.jsx("span",{children:o.name})]})})}),m(o.name)&&(K?(()=>{const w=j+i/2,A=i*.6/2,he=[`${y},${w-A}`,`${y+A},${w}`,`${y},${w+A}`,`${y-A},${w}`].join(" ");return e.jsx("polygon",{points:he,fill:"currentColor",className:`${N} ${_}`})})():U?e.jsx("line",{x1:y,x2:y,y1:j,y2:j+i,stroke:"currentColor",strokeWidth:2,className:N}):e.jsx("rect",{x:y,y:j,width:V,height:i,fill:"currentColor",className:`${N} ${_}`})),m(o.name)&&e.jsxs("text",{x:y+(K?i*.6:V)+4,y:j+i/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[o.duration.toFixed(2)," ms"]})]},o.name)}),me.map(o=>{const p=E+o*P;return e.jsx("line",{x1:p,x2:p,y1:f-3,y2:F-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},o)}),e.jsx("text",{x:x/2,y:F-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),O.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:O.x,top:O.y},children:O.lines.map((o,p)=>e.jsx("div",{children:o},p))})]})};var L,ee;function ze(){if(ee)return L;ee=1;var s=Pe(),t=we(),a=s(function(i,c,l){return i+(l?" ":"")+t(c)});return L=a,L}var Re=ze();const Qe=ve(Re);function qe({conversationId:s}){const t=q(s),a=G.getCurrentNode(Y(s))?.id,i=Se();return ke()?e.jsx(k,{conversationId:t??s,parentMessageId:a,status:i}):null}function k(s){const t=s?.status?.modes,[a,i]=d.useState(!1),[c,l]=d.useState(),f=d.useCallback(n=>{l(n),i(!0)},[]),u=te(),x=d.useCallback(()=>i(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(je,{contentAlign:"center",triggerButton:e.jsx(k.Trigger,{}),children:t?t.map(n=>d.createElement(k.Item,{...s,key:n.display_name,voiceStatusMode:n,onShowModal:f})):e.jsx("div",{role:"progressbar","aria-valuetext":u.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(se,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(k.Modal,{conversationId:s.conversationId,disabledModeMetadata:c,isOpen:a,onClose:x})]})}k.Modal=function(t){const a=t.disabledModeMetadata?.buttons??[],i=Be({buttons:a,conversationId:t.conversationId,onClick:t.onClose}),c=e.jsx(Ue,{children:t.disabledModeMetadata?.description_markdown});return e.jsx(ne,{testId:"modal-voice-mode",title:t.disabledModeMetadata?.title,description:c,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:i.primary,secondaryButton:i.secondary})};k.Trigger=d.forwardRef(function(t,a){const i=S(c=>c.voiceMode);return e.jsxs(Ne,{ref:a,...t,children:[Qe(i)??e.jsx(se,{}),e.jsx(De,{className:"icon text-token-text-tertiary"})]})});k.Item=function({conversationId:t,parentMessageId:a,voiceStatusMode:i,onShowModal:c}){const{disabled_mode_metadata:l,mode:f}=i,{startVoiceMode:u}=Ae(),x=q(t),n=d.useCallback(async()=>{l?c(l.disabled_message):u(Te({serverThreadId:x,parentMessageId:a,isAdvancedMode:f==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:G.getGizmoId(Y(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,f,c,a,x,u]);return e.jsx(ye.Item,{onClick:n,children:e.jsxs("div",{children:[i.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:i.description})]})})};function jt({conversationId:s}){const t=S(a=>a.voiceSessionId);return e.jsx("div",{className:"relative h-full",children:e.jsx($.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(qe,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(M,{name:"Voice Session ID",text:t??"n/a"}),e.jsx(Ge,{conversationId:s}),e.jsx(Ye,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(Je,{}),e.jsx(Ze,{})]})}),e.jsx(Xe,{})]})]})})})})}function Ge({conversationId:s}){const t=q(s),a=t&&Y(t),i=G.getTree(a),l=S(r=>r.server.messages.findLast(h=>h.type===ae.ConversationUpdate))?.payload.parent_message_id,f=l?i.findNode(r=>r.message.author.role==="assistant"&&be.isMultimodalTextMessage(r.message),l):void 0,{model_definition_slug:u,model_definition_virtual_model_id:x}=f?.message.metadata?.__internal??{},n=[u,x].filter(Boolean).join(", ")??"pending model response";return e.jsx(M,{name:"Model ID",text:n,allowWrap:!0})}function Ye(){const[s,t]=d.useState(!1),[a,i]=d.useState({}),c=Ie(),l=d.useCallback(()=>{t(f=>!f)},[]);return d.useEffect(()=>{s&&Fe(c).then(i)},[s,c]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(ne,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(Le,{json:a}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(a,null,2)})]})]})}function Je(){const[s,t]=d.useState("timestamp"),[a,i]=d.useState("asc"),c=S(n=>n.server.messages.filter(r=>r.type===ae.Performance)),l=c[c.length-1],f=d.useCallback(n=>n>=1e3?`${(n/1e3).toFixed(2)}s`:`${n.toFixed(1)}ms`,[]),u=d.useMemo(()=>l?[...l.payload.metrics].sort((n,r)=>{const h=s==="name"?n.name.localeCompare(r.name):n.ms-r.ms;return a==="asc"?h:-h}):[],[l,s,a]);if(!l)return null;const x=n=>{n===s?i(a==="asc"?"desc":"asc"):(t(n),i("asc"))};return e.jsx(ie,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(R,{text:"Metric"}),s==="name"?a==="asc"?e.jsx(z,{}):e.jsx(T,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>x("timestamp"),children:[e.jsx(R,{text:"Timestamp"}),s==="timestamp"?a==="asc"?e.jsx(z,{}):e.jsx(T,{}):null]}),u.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:f(n.ms)},n.name+n.ms)]}))]})})}function Xe(){const s=S(t=>t.server.messages);return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-token-text-secondary px-4 py-2 text-lg font-semibold",children:"Messages"}),e.jsx("div",{className:"grow",children:e.jsx(Me,{children:e.jsx($.ul,{className:"flex w-full flex-col",initial:"initial",animate:"animate",exit:"exit",variants:re,transition:{delayChildren:.25,staggerChildren:.05},children:s.map((t,a)=>e.jsx(He,{index:a,message:t},a))})})})]})}function Ze(){const s=S(u=>u.server.connectionState),t=S(u=>u.dev.room),[a,i]=d.useState("Unknown"),c=t?.localParticipant,l=t?.numParticipants??"Unknown",f=t?.activeSpeakers??[];return d.useEffect(()=>{if(c){const u=x=>{i(x)};return c.on("connectionQualityChanged",u),()=>{c.off("connectionQualityChanged",u)}}},[c]),e.jsxs(ie,{title:"Room",open:!1,children:[e.jsx(M,{name:"Connection Quality",text:String(a)}),e.jsx(M,{name:"Connection State",text:String(s)}),e.jsx(M,{name:"Participants",text:l}),e.jsx(M,{name:"Speakers",text:f.length}),e.jsx(Ke,{})]})}function Ke(){const s=S(r=>r.dev.room),[t,a]=d.useState(null),[i,c]=d.useState(null),[l,f]=d.useState(null),u=s?.getActiveDevice("audioinput"),x=s?.getActiveDevice("audiooutput"),n=s?.getActiveDevice("videoinput");return d.useEffect(()=>{async function r(){const h=await W.getLocalDevices("audioinput"),v=await W.getLocalDevices("audiooutput"),m=await W.getLocalDevices("videoinput"),D=h.find(g=>g.deviceId===u),b=v.find(g=>g.deviceId===x),C=m.find(g=>g.deviceId===n);a(D?.label??"Unknown"),c(b?.label??"Unknown"),f(C?.label??null)}r()},[u,x,n]),e.jsxs(e.Fragment,{children:[e.jsx(R,{text:"Devices"}),l?e.jsx(M,{icon:_e,name:"Video Input",text:l}):null,e.jsx(M,{icon:$e,name:"Audio Input",text:t??"Unknown"}),e.jsx(M,{icon:Ve,name:"Audio Output",text:i??"Unknown"})]})}function ie({title:s,titleClassName:t,children:a,open:i}){const[c,l]=d.useState(i??!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:oe("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!c),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:c?e.jsx(T,{className:"icon-sm"}):e.jsx(z,{className:"icon-sm"})})]}),e.jsx(Q,{initial:!1,children:c&&e.jsx($.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:a},"content")})]})}function R({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function M(s){return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),s.content??e.jsx("span",{className:oe(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}function He({index:s,message:t}){const[a,i]=d.useState(!1),c=te();let l=null;switch(t.source){case"remote":l=Oe;break;case"local":l=Ee;break}const f=d.useCallback(u=>{u.stopPropagation(),u.preventDefault(),i(x=>!x)},[]);return e.jsx($.div,{className:"border-token-bg-tertiary w-full border-t px-4 py-0",variants:re,children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex w-full flex-col gap-1 rounded-lg",children:[e.jsx("div",{className:"text-token-text-secondary font-mono text-[0.65rem] font-semibold",children:e.jsxs("div",{className:"flex w-full cursor-pointer flex-row flex-nowrap items-center justify-between hover:text-red-500",onClick:f,children:[e.jsxs("div",{className:"flex flex-row flex-nowrap items-center",children:[e.jsx(l,{className:"text-token-text-secondary me-2 h-3 w-3"}),e.jsx("span",{children:`| ${s+1} | ${c.formatDate(t.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})} | ${t.type}`})]}),e.jsx("div",{className:"flex max-h-[20px] flex-row flex-nowrap items-center",children:e.jsx(Ce,{className:"rounded-full p-0",color:"ghost",size:"small",onClick:f,children:e.jsx(T,{className:`transform transition-transform ${a?"rotate-180":""}`})})})]})}),e.jsx(Q,{children:a?e.jsx($.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"bg-token-bg-tertiary text-token-text-secondary mb-1 overflow-x-auto rounded-md p-0 text-[10px] font-semibold",children:JSON.stringify(t.payload,null,2)}):null})]})})}const re={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};export{jt as VoiceModeDevPanel};
//# sourceMappingURL=fuvc81vmwlhx5j5l.js.map
