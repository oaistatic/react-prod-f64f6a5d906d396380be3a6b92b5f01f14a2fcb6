import{bc as U,d as E,l$ as u,iU as d,dr as S,e7 as k,m0 as L,m1 as M}from"./g670b8vtkhx0yc6d.js";import{J as I}from"./forbprkns1cohsbl.js";import{h as b,r as c,p as f}from"./gg0tb34p9fzo1omt.js";const O=new Set(["google-oauth2","windowslive","apple"]),P="password",R=4*60;function _(t,e){return e?.idp&&O.has(e.idp)?{connection:e.idp,...e.email&&{login_hint:e.email}}:e?.idp==="auth0"?{connection:P,...e.email?{login_hint:e.email}:{[L]:"true"}}:e?.email?{...e.email&&{login_hint:e.email}}:{}}function h(t){if(!t)throw new Error("No session found, cannot enable MFA");if(t.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function m(t){try{return I(t)}catch{throw new Error("Unable to decode access token")}}function v(t){return t.pwd_auth_time}function g(t){const e=v(t);if(!e)return!0;const o=e/1e3;return Date.now()/1e3-o>R}function x(t){return t[M]?.required==="yes"}function y(t){const{session:e}=U(),o=b(),[l,s]=c.useState(!1),w=e?.user?.idp==="auth0",p=!!e?.user?.mfa,a=E(),A=c.useCallback(async()=>{h(e),s(!0);const i=new URL(t.redirectUrl?`/auth/enroll_mfa?redirect_path=${encodeURIComponent(t.redirectUrl)}`:"/auth/enroll_mfa",window.location.origin).toString();let n=!0;if(e?.accessToken){const r=m(e.accessToken);n=g(r)}if(n){f.signIn(e?.authProvider,{callbackUrl:i},{max_age:"0",...u(d()),..._(a,e?.user)});return}window.location.href=i,s(!1)},[a,e,t.redirectUrl]),T=c.useCallback(async()=>{h(e);const i=new URL("/auth/disable_mfa",window.location.origin).toString();let n=!0;if(e?.accessToken){const r=m(e.accessToken);n=g(r)||!x(r)}if(n){f.signIn(e?.authProvider,{callbackUrl:i},{max_age:"0",..._(a,e?.user),...u(d())});return}o({...S(k.Security),pathname:"/",search:"disable_mfa=true"})},[a,e,o]);return{setupMfa:A,isUsernamePassword:w,isLoggedInWithMfa:p,removeMfa:T,isLoadingRedirect:l}}export{y as u};
//# sourceMappingURL=b40xa0ca5oqnzth6.js.map
