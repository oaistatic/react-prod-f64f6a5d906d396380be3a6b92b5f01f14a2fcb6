import{kw as R,ch as S,g7 as l,g8 as f,R as C}from"./g670b8vtkhx0yc6d.js";import{a as O}from"./itdwpc2q0aiung3v.js";import{O as b,h as E,r}from"./gg0tb34p9fzo1omt.js";async function k(p,t,e,s){const c=await C.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:p},query:{code:t,redirect_uri:e,state:s}}});return{...c,redirect_path:O(c.redirect_path).toString()}}const $=R(function(){const{pluginId:t}=b(),e=E(),s=r.useRef(!1),[c,g]=r.useState(""),{code:o,error:n,error_description:i,state:u}=Object.fromEntries(new URLSearchParams(c.substring(1)).entries());r.useEffect(()=>{g(window.location.hash)},[]),r.useEffect(()=>{if(s.current)return;if(t&&o&&u)s.current=!0;else{e("/");return}async function _(){const m=window.location.origin+`/ccc/${t}/oauth/callback`;if(!(!t||!o||!u))try{const a=await k(t,o,m,u);if(a.success){const h=new URL(l(f.OAUTH_SUCCESS,a.redirect_path),location.origin);h.searchParams.set("oauth_success","true"),e(h.pathname+h.search+h.hash)}else e(l(f.CUSTOM_ERROR,a.redirect_path,a.error??a.message))}catch{e(l(f.CUSTOM_ERROR))}}_()},[t,o,u,e]);const d=S();return r.useEffect(()=>{n&&d.danger(`${n}${i?`: ${i}`:""}`,{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:n,loggingDescription:i??""})},[n,i,d]),null});export{$ as default};
//# sourceMappingURL=ghcbycf56j1ec051.js.map
