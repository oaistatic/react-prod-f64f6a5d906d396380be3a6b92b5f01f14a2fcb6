import{r as d,j as e,G as fe,as as Qe,at as pe,E as et,H as ge,m as H,b as Me,e as Oe,A as Y,M as tt}from"./gg0tb34p9fzo1omt.js";import{c as ot,a as st,s as nt,g as at,b as rt,d as it,P as Q,T as he}from"./k33dlpm8wya9l7ki.js";import{f8 as lt,bo as ct,bU as B,ic as dt,jw as ut,aG as _e,nA as ye,j2 as mt,D as ft,jW as se,n as pt,ck as gt,cp as ht}from"./g670b8vtkhx0yc6d.js";import{g as Et,u as Pe,D as bt}from"./e6r7gqenbe47ga9h.js";import{b as xt,T as Tt,a as At,c as k,A as Ee,u as Ct,i as vt,C as St,g as be}from"./io7yp3xixkpaizow.js";import{c as Nt}from"./gffsn29yylc5pncm.js";import{M as It,S as Rt,d as wt,e as Mt,h as xe,i as Ot,C as ee}from"./ejkv34dzwipa230i.js";import{h as ae,i as _t,k as Le,f as U}from"./jh4r0k3f3n3zptua.js";import{T as Te,Z as yt,C as Pt}from"./jy1u8exw8iz2slve.js";import{hH as je,c1 as ke,lz as N,o9 as Lt,g as jt,lA as P,c$ as kt,de as Ht,az as Bt,hI as Dt}from"./forbprkns1cohsbl.js";import{u as He}from"./go2lz3yja1ixfdzl.js";import{a as Ae}from"./bfgn782syyllzt4r.js";import{t as Vt,B as Wt,I as Ft}from"./oe9a5f58lvevdkk3.js";import{H as Gt,P as Xt}from"./j0nw4kv698ot3br0.js";import{D as zt,S as Ut,a as Yt}from"./l8bgi7e4c78ddktv.js";import"./hb16nhh4rqym397l.js";import"./be6sa05e05n18ich.js";import"./f76gy0b8ieo4s693.js";import"./l0kfwbyw3s1gkuhr.js";import"./ihgbljwwpo1mzi43.js";import"./pc2givv05uuq8g6l.js";import"./jec2dxephizdapuu.js";import"./eiffxi5640gvsu4t.js";import"./o68lxipd1oht2mfn.js";import"./k5ngqk6bkqja3f09.js";import"./gomrh6779xe4lvq3.js";import"./k7lsvlcih6dj1cdg.js";import"./exrawr7mctocf8w4.js";import"./f4wsvwai0sxxe1lf.js";import"./dl1zw2u5dp7czf6c.js";function Zt(t,o){d.useEffect(()=>{const n=t?.current;if(n!=null)return lt(n,{mousedown:u=>{o.current?.maybeFocusOnEditor(u)===!0&&u.preventDefault()}})},[o,t])}const $t=({wrapperClassName:t,value:o="",width:n,comments:u,paddingBottom:h})=>{const i=d.useRef(null),a=d.useRef(null),r=ct();return d.useEffect(()=>{const{current:c}=i;if(c)return a.current=ot({mount:c,comments:u,value:o,isDarkMode:r}),()=>{a.current?.destroy()}},[]),d.useEffect(()=>{const c=st(o,u);a.current?.updateState(c)},[o,u]),e.jsx("div",{className:t,children:e.jsx("div",{ref:je(i),className:B(nt.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:n,paddingBottom:h}})})},Be=t=>!t||"docView"in t&&t.docView==null||xt(t.state.doc),te=100,Jt={type:"spring",duration:1.5,bounce:.1},qt={type:"spring",duration:.5,bounce:0},Ce={type:"spring",duration:.2},ve={type:"spring",duration:1,delay:.1},Kt={type:"spring",duration:1},Qt={type:"spring",duration:.5,bounce:0},eo=({isRewriting:t=!1,value:o,previousValue:n,previousComments:u,documentWidth:h,paddingBottom:i,onStart:a})=>{const r=ae(),c=fe(0),m=fe(-100),T=d.useRef(!1),[f,b]=Qe(),[{height:C},l]=He(),E=ke();dt(()=>{const s=r();return s&&(s.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const p=r();p&&(p.dom.style.clipPath="")}},[]),d.useEffect(()=>{const s=r();if(!s||Be(s))return f?void 0:b?.();try{const p=_t(s.state.doc)?.end;if(p==null||p>o.length)return;const{top:A}=s.coordsAtPos(0),{top:S,bottom:O}=s.coordsAtPos(Math.max(s.state.doc.content.size-1,0),-1),v=O-A,I=S-A;if(c.set(v-I),!f){pe(m,v+2*c.get(),qt).then(()=>b?.());return}pe(m,v,Jt)}catch(p){N.logError("Failed to set rewrite animation position",p),b?.()}},[f,o]);const g=et(m,s=>ut(s)-te+2);return ge(m,"change",s=>{const p=r();!p||!s||!T.current||(p.dom.style.clipPath=`inset(0 0 calc(100% - ${s}px) 0)`)}),ge(m,"animationStart",()=>{t&&a?.()}),e.jsxs(e.Fragment,{children:[E&&e.jsx(H.div,{style:{visibility:"hidden",pointerEvents:"none",height:C},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(H.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-10% to-transparent",style:{translateY:g,height:te},initial:{opacity:0},animate:{opacity:1,transition:Ce},exit:{opacity:0,transition:ve},onAnimationComplete:()=>T.current=!0},"wash-top"),e.jsx(H.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full bg-linear-to-b to-transparent",style:{translateY:m,height:te},initial:{opacity:0},animate:{opacity:1,transition:Ce},exit:{opacity:0,transition:ve}},"wash-bottom"),e.jsx(H.div,{ref:l,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:Kt},exit:{opacity:0,transition:Qt},children:e.jsx($t,{value:n,width:h,comments:u,wrapperClassName:"h-fit flex",paddingBottom:i})},"previousValue")]})},to=t=>d.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M4.91463 13.3C4.2134 13.3 3.80005 12.874 3.80005 12.1394V3.8533C3.80005 3.12606 4.2134 2.70001 4.91463 2.70001H8.43555C10.4359 2.70001 11.6908 3.72108 11.6908 5.3445C11.6908 6.50515 10.8197 7.47479 9.69038 7.64375V7.70252C11.1372 7.8127 12.2 8.86315 12.2 10.2662C12.2 12.1321 10.7902 13.3 8.51674 13.3H4.91463ZM6.02923 7.1075H7.63098C8.81939 7.1075 9.49847 6.58595 9.49847 5.68976C9.49847 4.83764 8.90058 4.35282 7.8598 4.35282H6.02923V7.1075ZM6.02923 11.6472H7.94838C9.23274 11.6472 9.92662 11.1036 9.92662 10.0899C9.92662 9.09822 9.2106 8.56932 7.89671 8.56932H6.02923V11.6472Z"})),oo=t=>d.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M9.95321 12.8207C9.90524 13.0976 9.66251 13.3 9.37844 13.3H4.93339C4.57343 13.3 4.29943 12.9807 4.35802 12.6295C4.40447 12.3511 4.64795 12.1468 4.93338 12.1468H6.59937L8.09417 3.8533H6.62059C6.26063 3.8533 5.98663 3.534 6.04523 3.1828C6.09169 2.90432 6.33517 2.70001 6.62059 2.70001H11.0668C11.4254 2.70001 11.6989 3.01687 11.6428 3.367C11.5978 3.6471 11.3536 3.8533 11.0668 3.8533H9.39658L7.90177 12.1468H9.37844C9.73986 12.1468 10.0142 12.4685 9.95321 12.8207Z"}));function Se(t,o){if(t==null)return!1;const n=t.state.schema.marks[o];return n==null?!1:Vt(t.state,t.dispatch,n)}function oe(t,o){if(t==null)return!1;const{state:n,dispatch:u}=t,h=_e(n.schema.nodes[Gt.proseMirrorNodeName()]);return ye(h,{level:o})(n,u)}function so(t){if(t==null)return!1;const{state:o,dispatch:n}=t,u=_e(o.schema.nodes[Xt.proseMirrorNodeName()]);return ye(u)(o,n)}const no=({availableWidth:t,onAddComment:o,isSendDisabled:n=!1,isWaitingForCommentResponse:u=!1,onSubmitAccelerator:h})=>{const i=Me(),a=ae(),r=Le(),c=Lt(),m=d.useCallback(l=>{const{width:E,height:g}=l,s=a();if(!r||!s||Be(s))return null;const{to:p,empty:A,head:S}=r.selection,{platform:O}=jt(),v=O==="web"?S:p,I=v===p;if(A||!Ae(s.state.doc,v))return null;const{right:L,left:_,top:V}=s.coordsAtPos(0);let y=v,W=s.state.doc.nodeAt(y);const F=I?-1:1;for(;!W?.isText&&Ae(s.state.doc,y+F);)y+=F,W=s.state.doc.nodeAt(y);const{left:D,bottom:G,top:Z}=s.coordsAtPos(y,I?-1:1),X=L-_;function re(){if(I)return Math.max(D-_-E,0);let w=D-_;return w+E>X&&(w=-(E-X)),w}function j(){const w=window.innerHeight-G>g*2;return I&&w?{top:G-V+8,aboveOrBelow:Ee.BELOW}:{top:Z-V-g-8,aboveOrBelow:Ee.ABOVE}}const R=j();return{left:re(),top:R.top,aboveOrBelow:R.aboveOrBelow,toolbarSize:l}},[r,a]),T=d.useCallback(()=>a()?.dom??null,[a]),f=[{label:i.formatMessage(M.heading1),className:"text-5xl font-semibold",onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_HEADER1),oe(a(),1)}},{label:i.formatMessage(M.heading2),className:"text-3xl font-semibold",onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_HEADER2),oe(a(),2)}},{label:i.formatMessage(M.heading3),className:"text-2xl font-semibold",onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_HEADER3),oe(a(),3)}},{label:i.formatMessage(M.body),className:"text-base",onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_PARAGRAPH),so(a())}}],b=()=>{const l=a();if(!l)return null;const{state:E}=l,{from:g,to:s,sourceFrom:p,sourceTo:A}=Et(E);return g==null||s==null||p==null||A==null?(N.logError("Prosemirror getSelectionRange has null values",null,{from:g,to:s,sourceFrom:p,sourceTo:A}),null):{from:g,to:s,sourceFrom:p,sourceTo:A}},C=(l,E,g)=>{const s=a(),p=b();if(p==null)return;const{sourceFrom:A,sourceTo:S}=p,O={start:A,end:S};if(r&&s){const v=r.tr.setSelection(mt.create(r.doc,r.selection.anchor));s.dispatch(v)}N.logButtonClick(P.TOOLBAR_FORMAT_STYLE,{action:{action:g.action,id:g.id,title:g.title},prompt:E,sourceFrom:A,sourceTo:S}),h?.(l,O,i.formatMessage(E),g)};return e.jsxs(Tt,{isWaitingForCommentResponse:u,isSendDisabled:n,onAddComment:o,toolbarType:At.WRITING,getToolbarPosition:m,getEditorDom:T,getSelectionRange:b,children:[c&&e.jsxs(e.Fragment,{children:[e.jsx(k.Separator,{}),e.jsx(k.Popover,{label:i.formatMessage(M.format),hideLabel:t<=400,icon:kt,align:"center",children:e.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",Te),children:zt.map(l=>{const{title:E,icon:g}=l;return e.jsxs("button",{onClick:s=>{"prompt"in l&&C(s,l.prompt,l)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(g,{className:"icon"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:i.formatMessage(E)})]},l.id)})})})]}),e.jsx(k.Separator,{}),e.jsx(k.Action,{label:i.formatMessage(M.bold),hideLabel:!0,icon:to,onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_BOLD),Se(a(),Wt.proseMirrorMarkName())},onMouseDown:l=>l.preventDefault()}),e.jsx(k.Action,{label:i.formatMessage(M.italic),hideLabel:!0,icon:oo,onClick:()=>{N.logButtonClick(P.TOOLBAR_FORMAT_ITALIC),Se(a(),Ft.proseMirrorMarkName())},onMouseDown:l=>l.preventDefault()}),e.jsx(k.Popover,{label:i.formatMessage(M.format),hideLabel:!0,icon:Ut,children:e.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",Te),children:f.map(({label:l,className:E,onClick:g})=>e.jsx("button",{onClick:g,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:E,children:l})},l))})})]})},M=Oe({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Ne({position:t,numEdits:o,closestEditId:n}){const u=Pe(),h=Me(),i=t==="top"?Ht:Bt,a=()=>{const c=u();if(!c||!n)return;const m=at(c,n);if(m.length===0){ft.addError("Edit could not be found while attempting to scroll",{closestEditId:n});return}m[t==="top"?0:m.length-1].scrollIntoView({behavior:"smooth",block:"center"})},r=t==="top"?-4:4;return e.jsx(Y,{children:o>0&&e.jsx(H.div,{className:B("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:r,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:r,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:B("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":h.formatMessage(Ie.ariaLabel),role:"button",onClick:a,children:[e.jsx(tt,{...Ie.label,values:{count:o}}),e.jsx(i,{className:"icon-sm ms-2"})]})})})}const Ie=Oe({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function ao({diff:t=null}){const o=Pe(),[n,u]=d.useState([]),[h,i]=d.useState([]),a=se.useState(se.selectWindowHeight),r=d.useCallback(()=>{const c=o();if(!c||!t)return;const m=[],T=[];for(const f of t.edits){const b=rt(c,f.id);if(b.length>0){const C=it(b);C.bottom<0?m.push([f.id,C]):C.top>a&&T.push([f.id,C])}}m.sort(([,f],[,b])=>f.bottom-b.bottom),T.sort(([,f],[,b])=>f.top-b.top),u(m.map(([f])=>f)),i(T.map(([f])=>f))},[t,a,o]);return Ct(t?.edits??[],r),d.useEffect(()=>{const c=setTimeout(r,500);return()=>{clearTimeout(c)}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(Ne,{position:"top",numEdits:n.length,closestEditId:n[n.length-1]}),e.jsx(Ne,{position:"bottom",numEdits:h.length,closestEditId:h[0]})]})}const ne=pt(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Go}=ne,ro=({pos:t})=>{const o=ae()(),n=Le();if(!o||!n||t==null)return null;const{doc:u}=n,{top:h,left:i}=o.coordsAtPos(0),{top:a,left:r}=o.coordsAtPos(t),c=u.nodeAt(t),m=t+(c?.nodeSize??0)-1,{top:T}=o.coordsAtPos(t+1),{top:f,bottom:b,right:C}=o.coordsAtPos(m),E=(T>=f?C:o.dom.getBoundingClientRect().right)-r,g=b-a+4;return e.jsx(H.div,{style:{top:a-h,left:r-i,height:g,width:E},className:B("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",yt.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},io=({pos:t})=>e.jsx(Y,{children:t!=null&&e.jsx(ro,{pos:t})}),Re=24,lo=16,co=0,uo=8,we=4,Xo=({comments:t,diff:o,readonlyReason:n,isDisabled:u=!1,isRewriting:h=!1,isSendDisabled:i=!1,previousComments:a,previousValue:r,isPreview:c=!1,isRequestActive:m=!1,isWaitingForCommentResponse:T=!1,targetedContent:f=null,onAcceleratorsExpandedChange:b,getAutocompleteSuggestion:C,getStableCommentId:l=Dt,onBlur:E,onCancelRequest:g,onChange:s,onSave:p,onAddComment:A,onSubmitAccelerator:S,onAcceptComment:O,onDismissComment:v,onExitShowChanges:I,value:L,commentsMode:_=ee.ENABLED,hideAccelerators:V=!1,hideToolbar:y=!1,hideEditOverlay:W=!1,safeUrls:F,width:D,modelCursor:G,shouldResetSelection:Z,metadata:X})=>{const j=ke()&&c,R=d.useRef(null),w=d.useRef(null);Zt(w,R);const[{width:De},Ve]=He(),ie=gt(),We=ht(),le=d.useRef(null),[$,ce]=d.useState(!1),Fe=le.current,Ge=vt(Fe)??!1,de=j?We?It:Rt:ie?wt:Mt,z=(()=>{if(D==null){const x=Ge?0:be();return De-x}return D-de*2-be()})(),J=j?z:z>=xe+Nt?xe:Ot,Xe=z-J,ze=U(({commentingOn:x})=>x),Ue=U(({hoveredCommentId:x})=>x),Ye=U(({focusedCommentId:x})=>x),Ze=U(({hoveredBlockCommentLauncherPos:x})=>x),$e=ne(x=>x.hoveredEditId),Je=ne(x=>x.rejectedEdits);d.useEffect(()=>{f==null&&R.current?.revertChanges()},[f]),d.useEffect(()=>{R.current?.flushChanges(),R.current?.UNSAFE_setValue(L)},[L]);const qe=se.useState(({windowHeight:x})=>{if(j)return we;if(ie)return c?co:lo;if(c)return Re;const q=uo/100*x;return Math.max(Re,q)}),Ke=({currentTarget:x,nativeEvent:q})=>{const me=q.composedPath();for(const K of me.slice(0,me.indexOf(x)))if(K instanceof HTMLElement&&(K.id===he.PROSEMIRROR_EDITOR_CONTAINER||K.id===he.PROSEMIRROR_CONTEXT_CHILDREN))return;I?.()},ue=j?we:c?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:w,onClick:Ke,children:e.jsx("div",{className:Pt.document,style:{margin:`0 ${de}px`,paddingTop:qe},children:e.jsx("div",{ref:je(Ve,le),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(Q,{comments:t,diff:o,editorRef:R,hoveredCommentId:Ue,focusedCommentId:Ye,hoveredEditId:$e,rejectedEdits:Je,value:h&&!$?"":L,commentingOn:ze,isDisabled:u||h||$,onBlur:E,onChange:s,onSave:p,width:J,safeUrls:F,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:ue,modelCursor:G,shouldResetSelection:Z,transparentBackground:!$,contentReferences:X?.contentReferences??[],getAutocompleteSuggestion:C,children:[e.jsxs(Q.EditorChildren,{children:[e.jsx(Y,{onExitComplete:()=>ce(!1),children:h&&e.jsx(eo,{isRewriting:h,documentWidth:J,previousValue:r,previousComments:a,value:L,paddingBottom:ue,onStart:()=>ce(!0)})}),!y&&e.jsx(no,{availableWidth:z,isWaitingForCommentResponse:T,isSendDisabled:i,onAddComment:A,onSubmitAccelerator:S}),_===ee.ENABLED&&e.jsx(io,{pos:Ze}),e.jsx(Y,{children:_!==ee.ALL_HIDDEN&&e.jsx(St,{availableWidth:Xe,comments:t,commentsMode:_,isRequestActive:m,onAddComment:A,onAcceptComment:O,onDismissComment:v,isWaitingForCommentResponse:T,disableBlockComments:m,getStableCommentId:l})})]}),e.jsxs(Q.ContextChildren,{children:[!W&&o&&e.jsx(ao,{diff:o}),!V&&e.jsx(bt,{isRequestActive:m,onSubmit:S,isVisuallyHidden:i||!!n?.isStreamingFromNative||n?.isReadonly&&!n.isStreaming,actions:Yt,onCancel:g,onExpandedChange:b})]})]})})})})};export{Xo as DocumentComposer};
//# sourceMappingURL=e6xdb8g7ko0bf2j1.js.map
